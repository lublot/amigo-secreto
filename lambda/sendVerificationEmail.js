!function(e,t){for(var n in t)e[n]=t[n]}(exports,function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=299)}([function(e,t,n){"use strict";const i=n(2).MongoError,o=n(25);var r=t.formatSortValue=function(e){switch((""+e).toLowerCase()){case"ascending":case"asc":case"1":return 1;case"descending":case"desc":case"-1":return-1;default:throw new Error("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]")}},s=t.formattedOrderClause=function(e){var t={};if(null==e)return null;if(Array.isArray(e)){if(0===e.length)return null;for(var n=0;n<e.length;n++)e[n].constructor===String?t[e[n]]=1:t[e[n][0]]=r(e[n][1])}else if(null!=e&&"object"==typeof e)t=e;else{if("string"!=typeof e)throw new Error("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]");t[e]=1}return t},a=t.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},c=["w","j","wtimeout","fsync"];const l=process.emitWarning?e=>process.emitWarning(e,"DeprecationWarning"):e=>console.error(e);function p(e,t){return`${e} option [${t}] is deprecated and will be removed in a later version.`}const u={};try{n(93),u.ASYNC_ITERATOR=!0}catch(e){u.ASYNC_ITERATOR=!1}class d{constructor(e,t){this.db=e,this.collection=t}toString(){return this.collection?`${this.db}.${this.collection}`:this.db}withCollection(e){return new d(this.db,e)}static fromString(e){if(!e)throw new Error(`Cannot parse namespace from "${e}"`);const t=e.indexOf(".");return new d(e.substring(0,t),e.substring(t+1))}}function h(){const e=process.hrtime();return Math.floor(1e3*e[0]+e[1]/1e6)}e.exports={filterOptions:function(e,t){var n={};for(var i in e)-1!==t.indexOf(i)&&(n[i]=e[i]);return n},mergeOptions:function(e,t){for(var n in t)e[n]=t[n];return e},translateOptions:function(e,t){var n={sslCA:"ca",sslCRL:"crl",sslValidate:"rejectUnauthorized",sslKey:"key",sslCert:"cert",sslPass:"passphrase",socketTimeoutMS:"socketTimeout",connectTimeoutMS:"connectionTimeout",replicaSet:"setName",rs_name:"setName",secondaryAcceptableLatencyMS:"acceptableLatency",connectWithNoPrimary:"secondaryOnlyConnectionAllowed",acceptableLatencyMS:"localThresholdMS"};for(var i in t)n[i]?e[n[i]]=t[i]:e[i]=t[i];return e},shallowClone:function(e){var t={};for(var n in e)t[n]=e[n];return t},getSingleProperty:function(e,t,n){Object.defineProperty(e,t,{enumerable:!0,get:function(){return n}})},checkCollectionName:function(e){if("string"!=typeof e)throw new i("collection name must be a String");if(!e||-1!==e.indexOf(".."))throw new i("collection names cannot be empty");if(-1!==e.indexOf("$")&&null==e.match(/((^\$cmd)|(oplog\.\$main))/))throw new i("collection names must not contain '$'");if(null!=e.match(/^\.|\.$/))throw new i("collection names must not start or end with '.'");if(-1!==e.indexOf("\0"))throw new i("collection names cannot contain a null character")},toError:function(e){if(e instanceof Error)return e;for(var t=e.err||e.errmsg||e.errMessage||e,n=i.create({message:t,driver:!0}),o="object"==typeof e?Object.keys(e):[],r=0;r<o.length;r++)try{n[o[r]]=e[o[r]]}catch(e){}return n},formattedOrderClause:s,parseIndexOptions:function(e){var t,n={},i=[];return"string"==typeof e?(i.push(e+"_1"),n[e]=1):Array.isArray(e)?e.forEach((function(e){"string"==typeof e?(i.push(e+"_1"),n[e]=1):Array.isArray(e)?(i.push(e[0]+"_"+(e[1]||1)),n[e[0]]=e[1]||1):a(e)&&(t=Object.keys(e)).forEach((function(t){i.push(t+"_"+e[t]),n[t]=e[t]}))})):a(e)&&(t=Object.keys(e)).forEach((function(t){i.push(t+"_"+e[t]),n[t]=e[t]})),{name:i.join("_"),keys:t,fieldHash:n}},normalizeHintField:function(e){var t=null;if("string"==typeof e)t=e;else if(Array.isArray(e))t={},e.forEach((function(e){t[e]=1}));else if(null!=e&&"object"==typeof e)for(var n in t={},e)t[n]=e[n];return t},handleCallback:function(e,t,n,i){try{if(null==e)return;if(e)return i?e(t,n,i):e(t,n)}catch(t){return process.nextTick((function(){throw t})),!1}return!0},decorateCommand:function(e,t,n){for(var i in t)-1===n.indexOf(i)&&(e[i]=t[i]);return e},isObject:a,debugOptions:function(e,t){var n={};return e.forEach((function(e){n[e]=t[e]})),n},MAX_JS_INT:Number.MAX_SAFE_INTEGER+1,mergeOptionsAndWriteConcern:function(e,t,n,i){for(var o=0;o<n.length;o++)e[n[o]]||void 0===t[n[o]]||(e[n[o]]=t[n[o]]);if(!i)return e;var r=!1;for(o=0;o<c.length;o++)if(e[c[o]]){r=!0;break}if(!r)for(o=0;o<c.length;o++)t[c[o]]&&(e[c[o]]=t[c[o]]);return e},executeLegacyOperation:(e,t,n,o)=>{if(null==e)throw new TypeError("This method requires a valid topology instance");if(!Array.isArray(n))throw new TypeError("This method requires an array of arguments to apply");o=o||{};const r=e.s.promiseLibrary;let s,a,c,l=n[n.length-1];if(!o.skipSessions&&e.hasSessionSupport())if(a=n[n.length-2],null==a||null==a.session){c=Symbol(),s=e.startSession({owner:c});const t=n.length-2;n[t]=Object.assign({},n[t],{session:s})}else if(a.session&&a.session.hasEnded)throw new i("Use of expired sessions is not permitted");const p=(e,t)=>function(n,i){if(s&&s.owner===c&&!o.returnsCursor)s.endSession(()=>{if(delete a.session,n)return t(n);e(i)});else{if(n)return t(n);e(i)}};if("function"==typeof l){l=n.pop();const e=p(e=>l(null,e),e=>l(e,null));n.push(e);try{return t.apply(null,n)}catch(t){throw e(t),t}}if(null!=n[n.length-1])throw new TypeError("final argument to `executeLegacyOperation` must be a callback");return new r((function(e,i){const o=p(e,i);n[n.length-1]=o;try{return t.apply(null,n)}catch(e){o(e)}}))},applyRetryableWrites:function(e,t){return t&&t.s.options.retryWrites&&(e.retryWrites=!0),e},applyWriteConcern:function(e,t,n){n=n||{};const i=t.db,r=t.collection;if(n.session&&n.session.inTransaction())return e.writeConcern&&delete e.writeConcern,e;const s=o.fromOptions(n);return s?Object.assign(e,{writeConcern:s}):r&&r.writeConcern?Object.assign(e,{writeConcern:Object.assign({},r.writeConcern)}):i&&i.writeConcern?Object.assign(e,{writeConcern:Object.assign({},i.writeConcern)}):e},isPromiseLike:function(e){return e&&"function"==typeof e.then},decorateWithCollation:function(e,t,n){const o=t.s&&t.s.topology||t.topology;if(!o)throw new TypeError('parameter "target" is missing a topology');const r=o.capabilities();if(n.collation&&"object"==typeof n.collation){if(!r||!r.commandsTakeCollation)throw new i("Current topology does not support collation");e.collation=n.collation}},decorateWithReadConcern:function(e,t,n){if(n&&n.session&&n.session.inTransaction())return;let i=Object.assign({},e.readConcern||{});t.s.readConcern&&Object.assign(i,t.s.readConcern),Object.keys(i).length>0&&Object.assign(e,{readConcern:i})},deprecateOptions:function(e,t){if(!0===process.noDeprecation)return t;const n=e.msgHandler?e.msgHandler:p,i=new Set;function o(){const o=arguments[e.optionsIndex];return a(o)&&0!==Object.keys(o).length?(e.deprecatedOptions.forEach(t=>{if(Object.prototype.hasOwnProperty.call(o,t)&&!i.has(t)){i.add(t);const o=n(e.name,t);if(l(o),this&&this.getLogger){const e=this.getLogger();e&&e.warn(o)}}}),t.apply(this,arguments)):t.apply(this,arguments)}return Object.setPrototypeOf(o,t),t.prototype&&(o.prototype=t.prototype),o},SUPPORTS:u,MongoDBNamespace:d,emitDeprecationWarning:l,makeCounter:function*(e){let t=e||0;for(;;){const e=t;t+=1,yield e}},maybePromise:function(e,t,n){const i=e&&e.s&&e.s.promiseLibrary||Promise;let o;return"function"!=typeof t&&(o=new i((e,n)=>{t=(t,i)=>{if(t)return n(t);e(i)}})),n((function(e,n){if(null==e)t(e,n);else try{t(e)}catch(e){return process.nextTick(()=>{throw e})}})),o},now:h,calculateDurationInMs:function(e){if("number"!=typeof e)throw TypeError("numeric value required to calculate duration");const t=h()-e;return t<0?0:t},makeInterruptableAsyncInterval:function(e,t){let n,i,o,r=!1;const s=(t=t||{}).interval||1e3,a=t.minInterval||500,c="boolean"==typeof t.immediate&&t.immediate,l="function"==typeof t.clock?t.clock:h;function p(e){r||(clearTimeout(n),n=setTimeout(u,e||s))}function u(){o=0,i=l(),e(e=>{if(e)throw e;p(s)})}return c?u():(i=l(),p()),{wake:function(){const e=l(),t=e-o,n=s-(e-i);o=e,t<a||(n>a&&p(a),n<0&&u())},stop:function(){r=!0,n&&(clearTimeout(n),n=null),i=0,o=0}}},hasAtomicOperators:function e(t){if(Array.isArray(t))return t.reduce((t,n)=>t||e(n),null);const n=Object.keys(t);return n.length>0&&"$"===n[0][0]}}},function(e,t,n){"use strict";let i=n(90);const o=n(70),r=n(4).retrieveEJSON();try{const e=o("bson-ext");e&&(i=e)}catch(e){}e.exports={MongoError:n(2).MongoError,MongoNetworkError:n(2).MongoNetworkError,MongoParseError:n(2).MongoParseError,MongoTimeoutError:n(2).MongoTimeoutError,MongoServerSelectionError:n(2).MongoServerSelectionError,MongoWriteConcernError:n(2).MongoWriteConcernError,Connection:n(91),Server:n(73),ReplSet:n(158),Mongos:n(160),Logger:n(15),Cursor:n(16).CoreCursor,ReadPreference:n(11),Sessions:n(27),BSON:i,EJSON:r,Topology:n(161).Topology,Query:n(18).Query,MongoCredentials:n(102).MongoCredentials,defaultAuthProviders:n(97).defaultAuthProviders,MongoCR:n(98),X509:n(99),Plain:n(100),GSSAPI:n(101),ScramSHA1:n(56).ScramSHA1,ScramSHA256:n(56).ScramSHA256,parseConnectionString:n(177)}},function(e,t,n){"use strict";const i=Symbol("errorLabels");class o extends Error{constructor(e){if(e instanceof Error)super(e.message),this.stack=e.stack;else{if("string"==typeof e)super(e);else for(var t in super(e.message||e.errmsg||e.$err||"n/a"),e.errorLabels&&(this[i]=new Set(e.errorLabels)),e)"errorLabels"!==t&&"errmsg"!==t&&(this[t]=e[t]);Error.captureStackTrace(this,this.constructor)}this.name="MongoError"}get errmsg(){return this.message}static create(e){return new o(e)}hasErrorLabel(e){return null!=this[i]&&this[i].has(e)}addErrorLabel(e){null==this[i]&&(this[i]=new Set),this[i].add(e)}get errorLabels(){return this[i]?Array.from(this[i]):[]}}const r=Symbol("beforeHandshake");class s extends o{constructor(e,t){super(e),this.name="MongoNetworkError",t&&!0===t.beforeHandshake&&(this[r]=!0)}}class a extends o{constructor(e){super(e),this.name="MongoParseError"}}class c extends o{constructor(e,t){t&&t.error?super(t.error.message||t.error):super(e),this.name="MongoTimeoutError",t&&(this.reason=t)}}class l extends o{constructor(e,t){super(e),this.name="MongoWriteConcernError",t&&Array.isArray(t.errorLabels)&&(this[i]=new Set(t.errorLabels)),null!=t&&(this.result=function(e){const t=Object.assign({},e);return 0===t.ok&&(t.ok=1,delete t.errmsg,delete t.code,delete t.codeName),t}(t))}}const p=new Set([6,7,89,91,189,9001,10107,11600,11602,13435,13436]),u=new Set([11600,11602,10107,13435,13436,189,91,7,6,89,9001,262]);const d=new Set([91,189,11600,11602,13436]),h=new Set([10107,13435]),f=new Set([11600,91]);function m(e){return!(!e.code||!d.has(e.code))||(e.message.match(/not master or secondary/)||e.message.match(/node is recovering/))}e.exports={MongoError:o,MongoNetworkError:s,MongoNetworkTimeoutError:class extends s{constructor(e,t){super(e,t),this.name="MongoNetworkTimeoutError"}},MongoParseError:a,MongoTimeoutError:c,MongoServerSelectionError:class extends c{constructor(e,t){super(e,t),this.name="MongoServerSelectionError"}},MongoWriteConcernError:l,isRetryableError:function(e){return p.has(e.code)||e instanceof s||e.message.match(/not master/)||e.message.match(/node is recovering/)},isSDAMUnrecoverableError:function(e){return e instanceof a||null==e||!!(m(e)||(t=e,t.code&&h.has(t.code)||!m(t)&&t.message.match(/not master/)));var t},isNodeShuttingDownError:function(e){return e.code&&f.has(e.code)},isRetryableWriteError:function(e){return e instanceof l?u.has(e.code)||u.has(e.result.code):u.has(e.code)},isNetworkErrorBeforeHandshake:function(e){return!0===e[r]}}},function(e,t,n){"use strict";const i={READ_OPERATION:Symbol("READ_OPERATION"),WRITE_OPERATION:Symbol("WRITE_OPERATION"),RETRYABLE:Symbol("RETRYABLE"),EXECUTE_WITH_SELECTION:Symbol("EXECUTE_WITH_SELECTION"),NO_INHERIT_OPTIONS:Symbol("NO_INHERIT_OPTIONS")};e.exports={Aspect:i,defineAspects:function(e,t){return Array.isArray(t)||t instanceof Set||(t=[t]),t=new Set(t),Object.defineProperty(e,"aspects",{value:t,writable:!1}),t},OperationBase:class{constructor(e){this.options=Object.assign({},e)}hasAspect(e){return null!=this.constructor.aspects&&this.constructor.aspects.has(e)}set session(e){Object.assign(this.options,{session:e})}get session(){return this.options.session}clearSession(){delete this.options.session}get canRetryRead(){return!0}execute(){throw new TypeError("`execute` must be implemented for OperationBase subclasses")}}}},function(e,t,n){"use strict";const i=n(131),o=n(17),r=n(70);const s=function(){throw new Error("The `mongodb-extjson` module was not found. Please install it and try again.")};function a(e){if(e){if(e.ismaster)return e.ismaster.maxWireVersion;if("function"==typeof e.lastIsMaster){const t=e.lastIsMaster();if(t)return t.maxWireVersion}if(e.description)return e.description.maxWireVersion}return 0}e.exports={uuidV4:()=>{const e=o.randomBytes(16);return e[6]=15&e[6]|64,e[8]=63&e[8]|128,e},relayEvents:function(e,t,n){n.forEach(n=>e.on(n,e=>t.emit(n,e)))},collationNotSupported:function(e,t){return t&&t.collation&&a(e)<5},retrieveEJSON:function(){let e=null;try{e=r("mongodb-extjson")}catch(e){}return e||(e={parse:s,deserialize:s,serialize:s,stringify:s,setBSONModule:s,BSON:s}),e},retrieveKerberos:function(){let e;try{e=r("kerberos")}catch(e){if("MODULE_NOT_FOUND"===e.code)throw new Error("The `kerberos` module was not found. Please install it and try again.");throw e}return e},maxWireVersion:a,isPromiseLike:function(e){return e&&"function"==typeof e.then},eachAsync:function(e,t,n){e=e||[];let i=0,o=0;for(i=0;i<e.length;++i)o++,t(e[i],r);function r(t){o--,t?n(t):i===e.length&&o<=0&&n()}0!==o||n()},eachAsyncSeries:function(e,t,n){let i=0,o=(e=e||[]).length;0!==o?t(e[i],(function r(s){i++,o--,s?n(s):i===e.length&&o<=0?n():t(e[i],r)})):n()},isUnifiedTopology:function(e){return null!=e.description},arrayStrictEqual:function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&(e.length===t.length&&e.every((e,n)=>e===t[n]))},tagsStrictEqual:function(e,t){const n=Object.keys(e),i=Object.keys(t);return n.length===i.length&&n.every(n=>t[n]===e[n])},errorStrictEqual:function(e,t){return e===t||!(null==e&&null!=t||null!=e&&null==t)&&(e.constructor.name===t.constructor.name&&e.message===t.message)},makeStateMachine:function(e){return function(t,n){const i=e[t.s.state];if(i&&i.indexOf(n)<0)throw new TypeError(`illegal state transition from [${t.s.state}] => [${n}], allowed: [${i}]`);t.emit("stateChanged",t.s.state,n),t.s.state=n}},makeClientMetadata:function(e){e=e||{};const t={driver:{name:"nodejs",version:n(145).version},os:{type:i.type(),name:process.platform,architecture:process.arch,version:i.release()},platform:`'Node.js ${process.version}, ${i.endianness} (${e.useUnifiedTopology?"unified":"legacy"})`};if(e.driverInfo&&(e.driverInfo.name&&(t.driver.name=`${t.driver.name}|${e.driverInfo.name}`),e.driverInfo.version&&(t.version=`${t.driver.version}|${e.driverInfo.version}`),e.driverInfo.platform&&(t.platform=`${t.platform}|${e.driverInfo.platform}`)),e.appname){const n=Buffer.from(e.appname);t.application={name:n.length>128?n.slice(0,128).toString("utf8"):e.appname}}return t},noop:()=>{}}},function(e,t){e.exports=require("util")},function(e,t,n){"use strict";const i=n(11),o=n(2).MongoError,r=n(13).ServerType,s=n(92).TopologyDescription;e.exports={getReadPreference:function(e,t){var n=e.readPreference||new i("primary");if(t.readPreference&&(n=t.readPreference),"string"==typeof n&&(n=new i(n)),!(n instanceof i))throw new o("read preference must be a ReadPreference instance");return n},MESSAGE_HEADER_SIZE:16,COMPRESSION_DETAILS_SIZE:9,opcodes:{OP_REPLY:1,OP_UPDATE:2001,OP_INSERT:2002,OP_QUERY:2004,OP_GETMORE:2005,OP_DELETE:2006,OP_KILL_CURSORS:2007,OP_COMPRESSED:2012,OP_MSG:2013},parseHeader:function(e){return{length:e.readInt32LE(0),requestId:e.readInt32LE(4),responseTo:e.readInt32LE(8),opCode:e.readInt32LE(12)}},applyCommonQueryOptions:function(e,t){return Object.assign(e,{raw:"boolean"==typeof t.raw&&t.raw,promoteLongs:"boolean"!=typeof t.promoteLongs||t.promoteLongs,promoteValues:"boolean"!=typeof t.promoteValues||t.promoteValues,promoteBuffers:"boolean"==typeof t.promoteBuffers&&t.promoteBuffers,monitoring:"boolean"==typeof t.monitoring&&t.monitoring,fullResult:"boolean"==typeof t.fullResult&&t.fullResult}),"number"==typeof t.socketTimeout&&(e.socketTimeout=t.socketTimeout),t.session&&(e.session=t.session),"string"==typeof t.documentsReturnedIn&&(e.documentsReturnedIn=t.documentsReturnedIn),e},isSharded:function(e){if("mongos"===e.type)return!0;if(e.description&&e.description.type===r.Mongos)return!0;if(e.description&&e.description instanceof s){return Array.from(e.description.servers.values()).some(e=>e.type===r.Mongos)}return!1},databaseNamespace:function(e){return e.split(".")[0]},collectionNamespace:function(e){return e.split(".").slice(1).join(".")}}},function(e,t,n){"use strict";const i=n(11),o=n(13).TopologyType,r=n(2).MongoError,s=n(2).isRetryableWriteError,a=n(4).maxWireVersion,c=n(2).MongoNetworkError;function l(e,t,n){e.listeners(t).length>0&&e.emit(t,n)}var p=function(e){return e.s.serverDescription||(e.s.serverDescription={address:e.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}),e.s.serverDescription},u=function(e,t){e.listeners("serverDescriptionChanged").length>0&&(e.emit("serverDescriptionChanged",{topologyId:-1!==e.s.topologyId?e.s.topologyId:e.id,address:e.name,previousDescription:p(e),newDescription:t}),e.s.serverDescription=t)},d=function(e){return e.s.topologyDescription||(e.s.topologyDescription={topologyType:"Unknown",servers:[{address:e.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}]}),e.s.topologyDescription},h=function(e,t){return t||(t=e.ismaster),t?t.ismaster&&"isdbgrid"===t.msg?"Mongos":t.ismaster&&!t.hosts?"Standalone":t.ismaster?"RSPrimary":t.secondary?"RSSecondary":t.arbiterOnly?"RSArbiter":"Unknown":"Unknown"},f=function(e){return function(t){if("destroyed"!==e.s.state){var n=(new Date).getTime();l(e,"serverHeartbeatStarted",{connectionId:e.name}),e.command("admin.$cmd",{ismaster:!0},{monitoring:!0},(function(i,o){if(i)l(e,"serverHeartbeatFailed",{durationMS:r,failure:i,connectionId:e.name});else{e.emit("ismaster",o,e);var r=(new Date).getTime()-n;l(e,"serverHeartbeatSucceeded",{durationMS:r,reply:o.result,connectionId:e.name}),function(e,t,n){var i=h(e,t);return h(e,n)!==i}(e,e.s.ismaster,o.result)&&u(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:e.s.inTopology?h(e):"Standalone"}),e.s.ismaster=o.result,e.s.isMasterLatencyMS=r}if("function"==typeof t)return t(i,o);e.s.inquireServerStateTimeout=setTimeout(f(e),e.s.haInterval)}))}}};const m={endSessions:function(e,t){Array.isArray(e)||(e=[e]),this.command("admin.$cmd",{endSessions:e},{readPreference:i.primaryPreferred},()=>{"function"==typeof t&&t()})}};function g(e){return e.description?e.description.type:"mongos"===e.type?o.Sharded:"replset"===e.type?o.ReplicaSetWithPrimary:o.Single}const y=function(e){return!(e.lastIsMaster().maxWireVersion<6)&&(!!e.logicalSessionTimeoutMinutes&&g(e)!==o.Single)},v="This MongoDB deployment does not support retryable writes. Please add retryWrites=false to your connection string.";e.exports={SessionMixins:m,resolveClusterTime:function(e,t){(null==e.clusterTime||t.clusterTime.greaterThan(e.clusterTime.clusterTime))&&(e.clusterTime=t)},inquireServerState:f,getTopologyType:h,emitServerDescriptionChanged:u,emitTopologyDescriptionChanged:function(e,t){e.listeners("topologyDescriptionChanged").length>0&&(e.emit("topologyDescriptionChanged",{topologyId:-1!==e.s.topologyId?e.s.topologyId:e.id,address:e.name,previousDescription:d(e),newDescription:t}),e.s.serverDescription=t)},cloneOptions:function(e){var t={};for(var n in e)t[n]=e[n];return t},createCompressionInfo:function(e){return e.compression&&e.compression.compressors?(e.compression.compressors.forEach((function(e){if("snappy"!==e&&"zlib"!==e)throw new Error("compressors must be at least one of snappy or zlib")})),e.compression.compressors):[]},clone:function(e){return JSON.parse(JSON.stringify(e))},diff:function(e,t){var n={servers:[]};e||(e={servers:[]});for(var i=0;i<e.servers.length;i++){for(var o=!1,r=0;r<t.servers.length;r++)if(t.servers[r].address.toLowerCase()===e.servers[i].address.toLowerCase()){o=!0;break}o||n.servers.push({address:e.servers[i].address,from:e.servers[i].type,to:"Unknown"})}for(r=0;r<t.servers.length;r++){for(o=!1,i=0;i<e.servers.length;i++)if(e.servers[i].address.toLowerCase()===t.servers[r].address.toLowerCase()){o=!0;break}o||n.servers.push({address:t.servers[r].address,from:"Unknown",to:t.servers[r].type})}for(i=0;i<e.servers.length;i++){var s=e.servers[i];for(r=0;r<t.servers.length;r++){var a=t.servers[r];s.address.toLowerCase()===a.address.toLowerCase()&&s.type!==a.type&&n.servers.push({address:s.address,from:s.type,to:a.type})}}return n},Interval:function(e,t){var n=!1;this.start=function(){return this.isRunning()||(n=setInterval(e,t)),this},this.stop=function(){return clearInterval(n),n=!1,this},this.isRunning=function(){return!1!==n}},Timeout:function(e,t){var n=!1,i=()=>{n&&(clearTimeout(n),n=!1,e())};this.start=function(){return this.isRunning()||(n=setTimeout(i,t)),this},this.stop=function(){return clearTimeout(n),n=!1,this},this.isRunning=function(){return!1!==n}},isRetryableWritesSupported:y,getMMAPError:function(e){return 20===e.code&&e.errmsg.includes("Transaction numbers")?new r({message:v,errmsg:v,originalError:e}):e},topologyType:g,legacyIsRetryableWriteError:function(e,t){return e instanceof r&&(y(t)&&(e instanceof c||a(t)<9&&s(e))&&e.addErrorLabel("RetryableWriteError"),e.hasErrorLabel("RetryableWriteError"))}}},function(e,t){e.exports=require("events")},function(e,t,n){"use strict";const i=n(70);function o(){throw new Error("Attempted to use Snappy compression, but Snappy is not installed. Install or disable Snappy compression and try again.")}e.exports={debugOptions:function(e,t){var n={};return e.forEach((function(e){n[e]=t[e]})),n},retrieveBSON:function(){var e=n(90);e.native=!1;try{var t=i("bson-ext");if(t)return t.native=!0,t}catch(e){}return e},retrieveSnappy:function(){var e=null;try{e=i("snappy")}catch(e){}return e||(e={compress:o,uncompress:o,compressSync:o,uncompressSync:o}),e}}},function(e,t,n){"use strict";const i=n(0).applyRetryableWrites,o=n(0).applyWriteConcern,r=n(0).decorateWithCollation,s=n(0).decorateWithReadConcern,a=n(12).executeCommand,c=n(0).formattedOrderClause,l=n(0).handleCallback,p=n(1).MongoError,u=n(1).ReadPreference,d=n(0).toError,h=n(16).CursorState;function f(e,t,n){const i="boolean"==typeof n.forceServerObjectId?n.forceServerObjectId:e.s.db.options.forceServerObjectId;return!0===i?t:t.map(t=>(!0!==i&&null==t._id&&(t._id=e.s.pkFactory.createPk()),t))}e.exports={buildCountCommand:function(e,t,n){const i=n.skip,o=n.limit;let a=n.hint;const c=n.maxTimeMS;t=t||{};const l={count:n.collectionName,query:t};return e.s.numberOfRetries?(e.options.hint?a=e.options.hint:e.cmd.hint&&(a=e.cmd.hint),r(l,e,e.cmd)):r(l,e,n),"number"==typeof i&&(l.skip=i),"number"==typeof o&&(l.limit=o),"number"==typeof c&&(l.maxTimeMS=c),a&&(l.hint=a),s(l,e),l},deleteCallback:function(e,t,n){if(null!=n){if(e&&n)return n(e);if(null==t)return n(null,{result:{ok:1}});t.deletedCount=t.result.n,n&&n(null,t)}},findAndModify:function(e,t,n,s,p,d){const h={findAndModify:e.collectionName,query:t};(n=c(n))&&(h.sort=n),h.new=!!p.new,h.remove=!!p.remove,h.upsert=!!p.upsert;const f=p.projection||p.fields;f&&(h.fields=f),p.arrayFilters&&(h.arrayFilters=p.arrayFilters,delete p.arrayFilters),s&&!p.remove&&(h.update=s),p.maxTimeMS&&(h.maxTimeMS=p.maxTimeMS),p.serializeFunctions=p.serializeFunctions||e.s.serializeFunctions,p.checkKeys=!1;let m=Object.assign({},p);m=i(m,e.s.db),m=o(m,{db:e.s.db,collection:e},p),m.writeConcern&&(h.writeConcern=m.writeConcern),!0===m.bypassDocumentValidation&&(h.bypassDocumentValidation=m.bypassDocumentValidation),m.readPreference=u.primary;try{r(h,e,m)}catch(e){return d(e,null)}a(e.s.db,h,m,(e,t)=>e?l(d,e,null):l(d,null,t))},indexInformation:function(e,t,n,i){const o=null!=n.full&&n.full;if(e.serverConfig&&e.serverConfig.isDestroyed())return i(new p("topology was destroyed"));e.collection(t).listIndexes(n).toArray((e,t)=>e?i(d(e)):Array.isArray(t)?o?l(i,null,t):void l(i,null,function(e){let t={};for(let n=0;n<e.length;n++){const i=e[n];t[i.name]=[];for(let e in i.key)t[i.name].push([e,i.key[e]])}return t}(t)):l(i,null,[]))},nextObject:function(e,t){if(e.s.state===h.CLOSED||e.isDead&&e.isDead())return l(t,p.create({message:"Cursor is closed",driver:!0}));if(e.s.state===h.INIT&&e.cmd&&e.cmd.sort)try{e.cmd.sort=c(e.cmd.sort)}catch(e){return l(t,e)}e._next((n,i)=>{if(e.s.state=h.OPEN,n)return l(t,n);l(t,null,i)})},prepareDocs:f,insertDocuments:function(e,t,n,r){"function"==typeof n&&(r=n,n={}),n=n||{},t=Array.isArray(t)?t:[t];let s=Object.assign({},n);s=i(s,e.s.db),s=o(s,{db:e.s.db,collection:e},n),!0===s.keepGoing&&(s.ordered=!1),s.serializeFunctions=n.serializeFunctions||e.s.serializeFunctions,t=f(e,t,n),e.s.topology.insert(e.s.namespace,t,s,(e,n)=>{if(null!=r){if(e)return l(r,e);if(null==n)return l(r,null,null);if(n.result.code)return l(r,d(n.result));if(n.result.writeErrors)return l(r,d(n.result.writeErrors[0]));n.ops=t,l(r,null,n)}})},removeDocuments:function(e,t,n,s){"function"==typeof n?(s=n,n={}):"function"==typeof t&&(s=t,n={},t={}),n=n||{};let a=Object.assign({},n);a=i(a,e.s.db),a=o(a,{db:e.s.db,collection:e},n),null==t&&(t={});const c={q:t,limit:0};n.single?c.limit=1:a.retryWrites&&(a.retryWrites=!1),n.hint&&(c.hint=n.hint);try{r(a,e,n)}catch(e){return s(e,null)}e.s.topology.remove(e.s.namespace,[c],a,(e,t)=>{if(null!=s)return e?l(s,e,null):null==t?l(s,null,null):t.result.code?l(s,d(t.result)):t.result.writeErrors?l(s,d(t.result.writeErrors[0])):void l(s,null,t)})},updateDocuments:function(e,t,n,s,a){if("function"==typeof s&&(a=s,s=null),null==s&&(s={}),"function"!=typeof a&&(a=null),null==t||"object"!=typeof t)return a(d("selector must be a valid JavaScript object"));if(null==n||"object"!=typeof n)return a(d("document must be a valid JavaScript object"));let c=Object.assign({},s);c=i(c,e.s.db),c=o(c,{db:e.s.db,collection:e},s),c.serializeFunctions=s.serializeFunctions||e.s.serializeFunctions;const p={q:t,u:n};p.upsert=void 0!==s.upsert&&!!s.upsert,p.multi=void 0!==s.multi&&!!s.multi,s.hint&&(p.hint=s.hint),c.arrayFilters&&(p.arrayFilters=c.arrayFilters,delete c.arrayFilters),c.retryWrites&&p.multi&&(c.retryWrites=!1);try{r(c,e,s)}catch(e){return a(e,null)}e.s.topology.update(e.s.namespace,[p],c,(e,t)=>{if(null!=a)return e?l(a,e,null):null==t?l(a,null,null):t.result.code?l(a,d(t.result)):t.result.writeErrors?l(a,d(t.result.writeErrors[0])):void l(a,null,t)})},updateCallback:function(e,t,n){if(null!=n){if(e)return n(e);if(null==t)return n(null,{result:{ok:1}});t.modifiedCount=null!=t.result.nModified?t.result.nModified:t.result.n,t.upsertedId=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?t.result.upserted[0]:null,t.upsertedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length?t.result.upserted.length:0,t.matchedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?0:t.result.n,n(null,t)}}}},function(e,t,n){"use strict";const i=function(e,t,n){if(!i.isValid(e))throw new TypeError("Invalid read preference mode "+e);if(t&&!Array.isArray(t)){console.warn("ReadPreference tags must be an array, this will change in the next major version");const e=void 0!==t.maxStalenessSeconds,i=void 0!==t.hedge;e||i?(n=t,t=void 0):t=[t]}if(this.mode=e,this.tags=t,this.hedge=n&&n.hedge,null!=(n=n||{}).maxStalenessSeconds){if(n.maxStalenessSeconds<=0)throw new TypeError("maxStalenessSeconds must be a positive integer");this.maxStalenessSeconds=n.maxStalenessSeconds,this.minWireVersion=5}if(this.mode===i.PRIMARY){if(this.tags&&Array.isArray(this.tags)&&this.tags.length>0)throw new TypeError("Primary read preference cannot be combined with tags");if(this.maxStalenessSeconds)throw new TypeError("Primary read preference cannot be combined with maxStalenessSeconds");if(this.hedge)throw new TypeError("Primary read preference cannot be combined with hedge")}};Object.defineProperty(i.prototype,"preference",{enumerable:!0,get:function(){return this.mode}}),i.PRIMARY="primary",i.PRIMARY_PREFERRED="primaryPreferred",i.SECONDARY="secondary",i.SECONDARY_PREFERRED="secondaryPreferred",i.NEAREST="nearest";const o=[i.PRIMARY,i.PRIMARY_PREFERRED,i.SECONDARY,i.SECONDARY_PREFERRED,i.NEAREST,null];i.fromOptions=function(e){if(!e)return null;const t=e.readPreference;if(!t)return null;const n=e.readPreferenceTags,o=e.maxStalenessSeconds;if("string"==typeof t)return new i(t,n);if(!(t instanceof i)&&"object"==typeof t){const e=t.mode||t.preference;if(e&&"string"==typeof e)return new i(e,t.tags,{maxStalenessSeconds:t.maxStalenessSeconds||o,hedge:t.hedge})}return t},i.resolve=function(e,t){const n=(t=t||{}).session,o=e&&e.readPreference;let r;return r=t.readPreference?i.fromOptions(t):n&&n.inTransaction()&&n.transaction.options.readPreference?n.transaction.options.readPreference:null!=o?o:i.primary,"string"==typeof r?new i(r):r},i.translate=function(e){if(null==e.readPreference)return e;const t=e.readPreference;if("string"==typeof t)e.readPreference=new i(t);else if(!t||t instanceof i||"object"!=typeof t){if(!(t instanceof i))throw new TypeError("Invalid read preference: "+t)}else{const n=t.mode||t.preference;n&&"string"==typeof n&&(e.readPreference=new i(n,t.tags,{maxStalenessSeconds:t.maxStalenessSeconds}))}return e},i.isValid=function(e){return-1!==o.indexOf(e)},i.prototype.isValid=function(e){return i.isValid("string"==typeof e?e:this.mode)};const r=["primaryPreferred","secondary","secondaryPreferred","nearest"];i.prototype.slaveOk=function(){return-1!==r.indexOf(this.mode)},i.prototype.equals=function(e){return e.mode===this.mode},i.prototype.toJSON=function(){const e={mode:this.mode};return Array.isArray(this.tags)&&(e.tags=this.tags),this.maxStalenessSeconds&&(e.maxStalenessSeconds=this.maxStalenessSeconds),this.hedge&&(e.hedge=this.hedge),e},i.primary=new i("primary"),i.primaryPreferred=new i("primaryPreferred"),i.secondary=new i("secondary"),i.secondaryPreferred=new i("secondaryPreferred"),i.nearest=new i("nearest"),e.exports=i},function(e,t,n){"use strict";const i=n(0).applyWriteConcern,o=n(1).BSON.Code,r=n(0).debugOptions,s=n(0).handleCallback,a=n(1).MongoError,c=n(0).parseIndexOptions,l=n(1).ReadPreference,p=n(0).toError,u=n(77),d=n(0).MongoDBNamespace,h=["authSource","w","wtimeout","j","native_parser","forceServerObjectId","serializeFunctions","raw","promoteLongs","promoteValues","promoteBuffers","bufferMaxEntries","numberOfRetries","retryMiliSeconds","readPreference","pkFactory","parentDb","promiseLibrary","noListener"];function f(e,t,n,o,r){let d=Object.assign({},{readPreference:l.PRIMARY},o);if(d=i(d,{db:e},o),d.writeConcern&&"function"!=typeof r)throw a.create({message:"Cannot use a writeConcern without a provided callback",driver:!0});if(e.serverConfig&&e.serverConfig.isDestroyed())return r(new a("topology was destroyed"));!function(e,t,n,o,r){const u=c(n),d="string"==typeof o.name?o.name:u.name,h=[{name:d,key:u.fieldHash}],f=Object.keys(h[0]).concat(["writeConcern","w","wtimeout","j","fsync","readPreference","session"]);for(let e in o)-1===f.indexOf(e)&&(h[0][e]=o[e]);const g=e.s.topology.capabilities();if(h[0].collation&&g&&!g.commandsTakeCollation){const e=new a("server/primary/mongos does not support collation");return e.code=67,r(e)}const y=i({createIndexes:t,indexes:h},{db:e},o);o.readPreference=l.PRIMARY,m(e,y,o,(e,t)=>e?s(r,e,null):0===t.ok?s(r,p(t),null):void s(r,null,d))}(e,t,n,d,(i,c)=>{if(null==i)return s(r,i,c);if(67===i.code||11e3===i.code||85===i.code||86===i.code||11600===i.code||197===i.code)return s(r,i,c);const l=y(e,t,n,o);d.checkKeys=!1,e.s.topology.insert(e.s.namespace.withCollection(u.SYSTEM_INDEX_COLLECTION),l,d,(e,t)=>{if(null!=r)return e?s(r,e):null==t?s(r,null,null):t.result.writeErrors?s(r,a.create(t.result.writeErrors[0]),null):void s(r,null,l.name)})})}function m(e,t,n,i){if(e.serverConfig&&e.serverConfig.isDestroyed())return i(new a("topology was destroyed"));const o=n.dbName||n.authdb||e.databaseName;n.readPreference=l.resolve(e,n),e.s.logger.isDebug()&&e.s.logger.debug(`executing command ${JSON.stringify(t)} against ${o}.$cmd with options [${JSON.stringify(r(h,n))}]`),e.s.topology.command(e.s.namespace.withCollection("$cmd"),t,n,(e,t)=>e?s(i,e):n.full?s(i,null,t):void s(i,null,t.result))}function g(e,t,n,i){const o=null!=n.full&&n.full;if(e.serverConfig&&e.serverConfig.isDestroyed())return i(new a("topology was destroyed"));e.collection(t).listIndexes(n).toArray((e,t)=>e?i(p(e)):Array.isArray(t)?o?s(i,null,t):void s(i,null,function(e){let t={};for(let n=0;n<e.length;n++){const i=e[n];t[i.name]=[];for(let e in i.key)t[i.name].push([e,i.key[e]])}return t}(t)):s(i,null,[]))}function y(e,t,n,i){const o=c(n),r=o.fieldHash,s="string"==typeof i.name?i.name:o.name,a={ns:e.s.namespace.withCollection(t).toString(),key:r,name:s},l=null!=i&&"object"!=typeof i&&i;i=null==i||"boolean"==typeof i?{}:i;const p=Object.keys(a);for(let e in i)-1===p.indexOf(e)&&(a[e]=i[e]);null==a.unique&&(a.unique=l);const u=["w","wtimeout","j","fsync","readPreference","session"];for(let e=0;e<u.length;e++)delete a[u[e]];return a}e.exports={createListener:function(e,t,n){return function(i){if(n.listeners(t).length>0){n.emit(t,i,e);for(let n=0;n<e.s.children.length;n++)e.s.children[n].emit(t,i,e.s.children[n])}}},createIndex:f,ensureIndex:function(e,t,n,o,r){const c=i({},{db:e},o),p=y(e,t,n,o).name;if(e.serverConfig&&e.serverConfig.isDestroyed())return r(new a("topology was destroyed"));c.readPreference=l.PRIMARY,g(e,t,c,(i,a)=>{if(null!=i&&26!==i.code)return s(r,i,null);if(null!=a&&a[p]){if("function"==typeof r)return s(r,null,p)}else f(e,t,n,o,r)})},evaluate:function(e,t,n,i,r){let c=t,p=[];if(e.serverConfig&&e.serverConfig.isDestroyed())return r(new a("topology was destroyed"));c&&"Code"===c._bsontype||(c=new o(c)),null==n||Array.isArray(n)||"function"==typeof n?null!=n&&Array.isArray(n)&&"function"!=typeof n&&(p=n):p=[n];let u={$eval:c,args:p};i.nolock&&(u.nolock=i.nolock),i.readPreference=new l(l.PRIMARY),m(e,u,i,(e,t)=>e?s(r,e,null):t&&1===t.ok?s(r,null,t.retval):t?s(r,a.create({message:"eval failed: "+t.errmsg,driver:!0}),null):void s(r,e,t))},executeCommand:m,executeDbAdminCommand:function(e,t,n,i){const o=new d("admin","$cmd");e.s.topology.command(o,t,n,(t,n)=>e.serverConfig&&e.serverConfig.isDestroyed()?i(new a("topology was destroyed")):t?s(i,t):void s(i,null,n.result))},indexInformation:g,profilingInfo:function(e,t,n){try{e.collection("system.profile").find({},t).toArray(n)}catch(e){return n(e,null)}},validateDatabaseName:function(e){if("string"!=typeof e)throw a.create({message:"database name must be a string",driver:!0});if(0===e.length)throw a.create({message:"database name cannot be the empty string",driver:!0});if("$external"===e)return;const t=[" ",".","$","/","\\"];for(let n=0;n<t.length;n++)if(-1!==e.indexOf(t[n]))throw a.create({message:"database names cannot contain the character '"+t[n]+"'",driver:!0})}}},function(e,t,n){"use strict";const i={Single:"Single",ReplicaSetNoPrimary:"ReplicaSetNoPrimary",ReplicaSetWithPrimary:"ReplicaSetWithPrimary",Sharded:"Sharded",Unknown:"Unknown"};e.exports={STATE_CLOSING:"closing",STATE_CLOSED:"closed",STATE_CONNECTING:"connecting",STATE_CONNECTED:"connected",TOPOLOGY_DEFAULTS:{useUnifiedTopology:!0,localThresholdMS:15,serverSelectionTimeoutMS:3e4,heartbeatFrequencyMS:1e4,minHeartbeatFrequencyMS:500},TopologyType:i,ServerType:{Standalone:"Standalone",Mongos:"Mongos",PossiblePrimary:"PossiblePrimary",RSPrimary:"RSPrimary",RSSecondary:"RSSecondary",RSArbiter:"RSArbiter",RSOther:"RSOther",RSGhost:"RSGhost",Unknown:"Unknown"},serverType:function(e){let t=e.s.description||e.s.serverDescription;return t.topologyType===i.Single?t.servers[0].type:t.type},drainTimerQueue:function(e){e.forEach(clearTimeout),e.clear()},clearAndRemoveTimerFrom:function(e,t){return clearTimeout(e),t.delete(e)}}},function(e,t){e.exports=require("stream")},function(e,t,n){"use strict";var i=n(5).format,o=n(2).MongoError,r={},s={},a=null,c=process.pid,l=null,p=function(e,t){if(!(this instanceof p))return new p(e,t);t=t||{},this.className=e,t.logger?l=t.logger:null==l&&(l=console.log),t.loggerLevel&&(a=t.loggerLevel||"error"),null==s[this.className]&&(r[this.className]=!0)};p.prototype.debug=function(e,t){if(this.isDebug()&&(Object.keys(s).length>0&&s[this.className]||0===Object.keys(s).length&&r[this.className])){var n=(new Date).getTime(),o=i("[%s-%s:%s] %s %s","DEBUG",this.className,c,n,e),a={type:"debug",message:e,className:this.className,pid:c,date:n};t&&(a.meta=t),l(o,a)}},p.prototype.warn=function(e,t){if(this.isWarn()&&(Object.keys(s).length>0&&s[this.className]||0===Object.keys(s).length&&r[this.className])){var n=(new Date).getTime(),o=i("[%s-%s:%s] %s %s","WARN",this.className,c,n,e),a={type:"warn",message:e,className:this.className,pid:c,date:n};t&&(a.meta=t),l(o,a)}},p.prototype.info=function(e,t){if(this.isInfo()&&(Object.keys(s).length>0&&s[this.className]||0===Object.keys(s).length&&r[this.className])){var n=(new Date).getTime(),o=i("[%s-%s:%s] %s %s","INFO",this.className,c,n,e),a={type:"info",message:e,className:this.className,pid:c,date:n};t&&(a.meta=t),l(o,a)}},p.prototype.error=function(e,t){if(this.isError()&&(Object.keys(s).length>0&&s[this.className]||0===Object.keys(s).length&&r[this.className])){var n=(new Date).getTime(),o=i("[%s-%s:%s] %s %s","ERROR",this.className,c,n,e),a={type:"error",message:e,className:this.className,pid:c,date:n};t&&(a.meta=t),l(o,a)}},p.prototype.isInfo=function(){return"info"===a||"debug"===a},p.prototype.isError=function(){return"error"===a||"info"===a||"debug"===a},p.prototype.isWarn=function(){return"error"===a||"warn"===a||"info"===a||"debug"===a},p.prototype.isDebug=function(){return"debug"===a},p.reset=function(){a="error",s={}},p.currentLogger=function(){return l},p.setCurrentLogger=function(e){if("function"!=typeof e)throw new o("current logger must be a function");l=e},p.filter=function(e,t){"class"===e&&Array.isArray(t)&&(s={},t.forEach((function(e){s[e]=!0})))},p.setLevel=function(e){if("info"!==e&&"error"!==e&&"debug"!==e&&"warn"!==e)throw new Error(i("%s is an illegal logging level",e));a=e},e.exports=p},function(e,t,n){"use strict";const i=n(15),o=n(9).retrieveBSON,r=n(2).MongoError,s=n(2).MongoNetworkError,a=n(4).collationNotSupported,c=n(11),l=n(4).isUnifiedTopology,p=n(38),u=n(14).Readable,d=n(0).SUPPORTS,h=n(0).MongoDBNamespace,f=n(3).OperationBase,m=o().Long,g={INIT:0,OPEN:1,CLOSED:2,GET_MORE:3};function y(e,t,n){try{e(t,n)}catch(t){process.nextTick((function(){throw t}))}}class v extends u{constructor(e,t,n,o){super({objectMode:!0}),o=o||{},t instanceof f&&(this.operation=t,t=this.operation.ns.toString(),o=this.operation.options,n=this.operation.cmd?this.operation.cmd:{}),this.pool=null,this.server=null,this.disconnectHandler=o.disconnectHandler,this.bson=e.s.bson,this.ns=t,this.namespace=h.fromString(t),this.cmd=n,this.options=o,this.topology=e,this.cursorState={cursorId:null,cmd:n,documents:o.documents||[],cursorIndex:0,dead:!1,killed:!1,init:!1,notified:!1,limit:o.limit||n.limit||0,skip:o.skip||n.skip||0,batchSize:o.batchSize||n.batchSize||1e3,currentLimit:0,transforms:o.transforms,raw:o.raw||n&&n.raw},"object"==typeof o.session&&(this.cursorState.session=o.session);const r=e.s.options;"boolean"==typeof r.promoteLongs?this.cursorState.promoteLongs=r.promoteLongs:"boolean"==typeof o.promoteLongs&&(this.cursorState.promoteLongs=o.promoteLongs),"boolean"==typeof r.promoteValues?this.cursorState.promoteValues=r.promoteValues:"boolean"==typeof o.promoteValues&&(this.cursorState.promoteValues=o.promoteValues),"boolean"==typeof r.promoteBuffers?this.cursorState.promoteBuffers=r.promoteBuffers:"boolean"==typeof o.promoteBuffers&&(this.cursorState.promoteBuffers=o.promoteBuffers),r.reconnect&&(this.cursorState.reconnect=r.reconnect),this.logger=i("Cursor",r),"number"==typeof n?(this.cursorState.cursorId=m.fromNumber(n),this.cursorState.lastCursorId=this.cursorState.cursorId):n instanceof m&&(this.cursorState.cursorId=n,this.cursorState.lastCursorId=n),this.operation&&(this.operation.cursorState=this.cursorState)}setCursorBatchSize(e){this.cursorState.batchSize=e}cursorBatchSize(){return this.cursorState.batchSize}setCursorLimit(e){this.cursorState.limit=e}cursorLimit(){return this.cursorState.limit}setCursorSkip(e){this.cursorState.skip=e}cursorSkip(){return this.cursorState.skip}_next(e){!function e(t,n){if(t.cursorState.notified)return n(new Error("cursor is exhausted"));if(function(e,t){if(e.cursorState.killed)return x(e,t),!0;return!1}(t,n))return;if(function(e,t){if(e.cursorState.dead&&!e.cursorState.killed)return e.cursorState.killed=!0,x(e,t),!0;return!1}(t,n))return;if(function(e,t){if(e.cursorState.dead&&e.cursorState.killed)return y(t,new r("cursor is dead")),!0;return!1}(t,n))return;if(!t.cursorState.init){if(!t.topology.isConnected(t.options)){if("server"===t.topology._type&&!t.topology.s.options.reconnect)return n(new r("no connection available"));if(null!=t.disconnectHandler)return t.topology.isDestroyed()?n(new r("Topology was destroyed")):void t.disconnectHandler.addObjectAndMethod("cursor",t,"next",[n],n)}return void t._initializeCursor((i,o)=>{i||null===o?n(i,o):e(t,n)})}if(t.cursorState.limit>0&&t.cursorState.currentLimit>=t.cursorState.limit)t.kill(()=>b(t,n));else if(t.cursorState.cursorIndex!==t.cursorState.documents.length||m.ZERO.equals(t.cursorState.cursorId)){if(t.cursorState.documents.length===t.cursorState.cursorIndex&&t.cmd.tailable&&m.ZERO.equals(t.cursorState.cursorId))return y(n,new r({message:"No more documents in tailed cursor",tailable:t.cmd.tailable,awaitData:t.cmd.awaitData}));if(t.cursorState.documents.length===t.cursorState.cursorIndex&&m.ZERO.equals(t.cursorState.cursorId))b(t,n);else{if(t.cursorState.limit>0&&t.cursorState.currentLimit>=t.cursorState.limit)return void t.kill(()=>b(t,n));t.cursorState.currentLimit+=1;let e=t.cursorState.documents[t.cursorState.cursorIndex++];if(!e||e.$err)return void t.kill(()=>b(t,(function(){y(n,new r(e?e.$err:void 0))})));t.cursorState.transforms&&"function"==typeof t.cursorState.transforms.doc&&(e=t.cursorState.transforms.doc(e)),y(n,null,e)}}else{if(t.cursorState.documents=[],t.cursorState.cursorIndex=0,t.topology.isDestroyed())return n(new s("connection destroyed, not possible to instantiate cursor"));if(function(e,t){if(e.pool&&e.pool.isDestroyed()){e.cursorState.killed=!0;const n=new s(`connection to host ${e.pool.host}:${e.pool.port} was destroyed`);return w(e,()=>t(n)),!0}return!1}(t,n))return;t._getMore((function(i,o,s){return i?y(n,i):(t.connection=s,0===t.cursorState.documents.length&&t.cmd.tailable&&m.ZERO.equals(t.cursorState.cursorId)?y(n,new r({message:"No more documents in tailed cursor",tailable:t.cmd.tailable,awaitData:t.cmd.awaitData})):0===t.cursorState.documents.length&&t.cmd.tailable&&!m.ZERO.equals(t.cursorState.cursorId)?e(t,n):t.cursorState.limit>0&&t.cursorState.currentLimit>=t.cursorState.limit?b(t,n):void e(t,n))}))}}(this,e)}clone(){return this.topology.cursor(this.ns,this.cmd,this.options)}isDead(){return!0===this.cursorState.dead}isKilled(){return!0===this.cursorState.killed}isNotified(){return!0===this.cursorState.notified}bufferedCount(){return this.cursorState.documents.length-this.cursorState.cursorIndex}readBufferedDocuments(e){const t=this.cursorState.documents.length-this.cursorState.cursorIndex,n=e<t?e:t;let i=this.cursorState.documents.slice(this.cursorState.cursorIndex,this.cursorState.cursorIndex+n);if(this.cursorState.transforms&&"function"==typeof this.cursorState.transforms.doc)for(let e=0;e<i.length;e++)i[e]=this.cursorState.transforms.doc(i[e]);return this.cursorState.limit>0&&this.cursorState.currentLimit+i.length>this.cursorState.limit&&(i=i.slice(0,this.cursorState.limit-this.cursorState.currentLimit),this.kill()),this.cursorState.currentLimit=this.cursorState.currentLimit+i.length,this.cursorState.cursorIndex=this.cursorState.cursorIndex+i.length,i}kill(e){this.cursorState.dead=!0,this.cursorState.killed=!0,this.cursorState.documents=[],null==this.cursorState.cursorId||this.cursorState.cursorId.isZero()||!1===this.cursorState.init?e&&e(null,null):this.server.killCursors(this.ns,this.cursorState,e)}rewind(){this.cursorState.init&&(this.cursorState.dead||this.kill(),this.cursorState.currentLimit=0,this.cursorState.init=!1,this.cursorState.dead=!1,this.cursorState.killed=!1,this.cursorState.notified=!1,this.cursorState.documents=[],this.cursorState.cursorId=null,this.cursorState.cursorIndex=0)}_read(){if(this.s&&this.s.state===g.CLOSED||this.isDead())return this.push(null);this._next((e,t)=>e?(this.listeners("error")&&this.listeners("error").length>0&&this.emit("error",e),this.isDead()||this.close(),this.emit("end"),this.emit("finish")):this.cursorState.streamOptions&&"function"==typeof this.cursorState.streamOptions.transform&&null!=t?this.push(this.cursorState.streamOptions.transform(t)):(this.push(t),void(null===t&&this.isDead()&&this.once("end",()=>{this.close(),this.emit("finish")}))))}_endSession(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};const n=this.cursorState.session;return n&&(e.force||n.owner===this)?(this.cursorState.session=void 0,this.operation&&this.operation.clearSession(),n.endSession(t),!0):(t&&t(),!1)}_getMore(e){this.logger.isDebug()&&this.logger.debug(`schedule getMore call for query [${JSON.stringify(this.query)}]`);let t=this.cursorState.batchSize;this.cursorState.limit>0&&this.cursorState.currentLimit+t>this.cursorState.limit&&(t=this.cursorState.limit-this.cursorState.currentLimit);const n=this.cursorState;this.server.getMore(this.ns,n,t,this.options,(t,i,o)=>{(t||n.cursorId&&n.cursorId.isZero())&&this._endSession(),e(t,i,o)})}_initializeCursor(e){const t=this;if(l(t.topology)&&t.topology.shouldCheckForSessionSupport())return void t.topology.selectServer(c.primaryPreferred,t=>{t?e(t):this._initializeCursor(e)});function n(n,i){const o=t.cursorState;if((n||o.cursorId&&o.cursorId.isZero())&&t._endSession(),0===o.documents.length&&o.cursorId&&o.cursorId.isZero()&&!t.cmd.tailable&&!t.cmd.awaitData)return x(t,e);e(n,i)}const i=(e,i)=>{if(e)return n(e);const o=i.message;if(Array.isArray(o.documents)&&1===o.documents.length){const e=o.documents[0];if(o.queryFailure)return n(new r(e),null);if(!t.cmd.find||t.cmd.find&&!1===t.cmd.virtual){if(e.$err||e.errmsg)return n(new r(e),null);if(null!=e.cursor&&"string"!=typeof e.cursor){const i=e.cursor.id;return e.cursor.ns&&(t.ns=e.cursor.ns),t.cursorState.cursorId="number"==typeof i?m.fromNumber(i):i,t.cursorState.lastCursorId=t.cursorState.cursorId,t.cursorState.operationTime=e.operationTime,Array.isArray(e.cursor.firstBatch)&&(t.cursorState.documents=e.cursor.firstBatch),n(null,o)}}}const s=o.cursorId||0;t.cursorState.cursorId=s instanceof m?s:m.fromNumber(s),t.cursorState.documents=o.documents,t.cursorState.lastCursorId=o.cursorId,t.cursorState.transforms&&"function"==typeof t.cursorState.transforms.query&&(t.cursorState.documents=t.cursorState.transforms.query(o)),n(null,o)};if(t.operation)return t.logger.isDebug()&&t.logger.debug(`issue initial query [${JSON.stringify(t.cmd)}] with flags [${JSON.stringify(t.query)}]`),void p(t.topology,t.operation,(e,o)=>{if(e)n(e);else{if(t.server=t.operation.server,t.cursorState.init=!0,null!=t.cursorState.cursorId)return n();i(e,o)}});const o={};return t.cursorState.session&&(o.session=t.cursorState.session),t.operation?o.readPreference=t.operation.readPreference:t.options.readPreference&&(o.readPreference=t.options.readPreference),t.topology.selectServer(o,(o,s)=>{if(o){const n=t.disconnectHandler;return null!=n?n.addObjectAndMethod("cursor",t,"next",[e],e):e(o)}if(t.server=s,t.cursorState.init=!0,a(t.server,t.cmd))return e(new r(`server ${t.server.name} does not support collation`));if(null!=t.cursorState.cursorId)return n();if(t.logger.isDebug()&&t.logger.debug(`issue initial query [${JSON.stringify(t.cmd)}] with flags [${JSON.stringify(t.query)}]`),null!=t.cmd.find)return void s.query(t.ns,t.cmd,t.cursorState,t.options,i);const c=Object.assign({session:t.cursorState.session},t.options);s.command(t.ns,t.cmd,c,i)})}}function b(e,t){e.cursorState.dead=!0,x(e,t)}function x(e,t){w(e,()=>y(t,null,null))}function w(e,t){if(e.cursorState.notified=!0,e.cursorState.documents=[],e.cursorState.cursorIndex=0,!e.cursorState.session)return t();e._endSession(t)}d.ASYNC_ITERATOR&&(v.prototype[Symbol.asyncIterator]=n(93).asyncIterator),e.exports={CursorState:g,CoreCursor:v}},function(e,t){e.exports=require("crypto")},function(e,t,n){"use strict";var i=(0,n(9).retrieveBSON)().Long;const o=n(19).Buffer;var r=0,s=n(6).opcodes,a=function(e,t,n,i){if(null==t)throw new Error("ns must be specified for query");if(null==n)throw new Error("query must be specified for query");if(-1!==t.indexOf("\0"))throw new Error("namespace cannot contain a null character");this.bson=e,this.ns=t,this.query=n,this.numberToSkip=i.numberToSkip||0,this.numberToReturn=i.numberToReturn||0,this.returnFieldSelector=i.returnFieldSelector||null,this.requestId=a.getRequestId(),this.pre32Limit=i.pre32Limit,this.serializeFunctions="boolean"==typeof i.serializeFunctions&&i.serializeFunctions,this.ignoreUndefined="boolean"==typeof i.ignoreUndefined&&i.ignoreUndefined,this.maxBsonSize=i.maxBsonSize||16777216,this.checkKeys="boolean"!=typeof i.checkKeys||i.checkKeys,this.batchSize=this.numberToReturn,this.tailable=!1,this.slaveOk="boolean"==typeof i.slaveOk&&i.slaveOk,this.oplogReplay=!1,this.noCursorTimeout=!1,this.awaitData=!1,this.exhaust=!1,this.partial=!1};a.prototype.incRequestId=function(){this.requestId=r++},a.nextRequestId=function(){return r+1},a.prototype.toBin=function(){var e=[],t=null,n=0;this.tailable&&(n|=2),this.slaveOk&&(n|=4),this.oplogReplay&&(n|=8),this.noCursorTimeout&&(n|=16),this.awaitData&&(n|=32),this.exhaust&&(n|=64),this.partial&&(n|=128),this.batchSize!==this.numberToReturn&&(this.numberToReturn=this.batchSize);var i=o.alloc(20+o.byteLength(this.ns)+1+4+4);e.push(i);var r=this.bson.serialize(this.query,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined});e.push(r),this.returnFieldSelector&&Object.keys(this.returnFieldSelector).length>0&&(t=this.bson.serialize(this.returnFieldSelector,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined}),e.push(t));var a=i.length+r.length+(t?t.length:0),c=4;return i[3]=a>>24&255,i[2]=a>>16&255,i[1]=a>>8&255,i[0]=255&a,i[c+3]=this.requestId>>24&255,i[c+2]=this.requestId>>16&255,i[c+1]=this.requestId>>8&255,i[c]=255&this.requestId,i[(c+=4)+3]=0,i[c+2]=0,i[c+1]=0,i[c]=0,i[(c+=4)+3]=s.OP_QUERY>>24&255,i[c+2]=s.OP_QUERY>>16&255,i[c+1]=s.OP_QUERY>>8&255,i[c]=255&s.OP_QUERY,i[(c+=4)+3]=n>>24&255,i[c+2]=n>>16&255,i[c+1]=n>>8&255,i[c]=255&n,c=(c+=4)+i.write(this.ns,c,"utf8")+1,i[c-1]=0,i[c+3]=this.numberToSkip>>24&255,i[c+2]=this.numberToSkip>>16&255,i[c+1]=this.numberToSkip>>8&255,i[c]=255&this.numberToSkip,i[(c+=4)+3]=this.numberToReturn>>24&255,i[c+2]=this.numberToReturn>>16&255,i[c+1]=this.numberToReturn>>8&255,i[c]=255&this.numberToReturn,c+=4,e},a.getRequestId=function(){return++r};var c=function(e,t,n,i){i=i||{},this.numberToReturn=i.numberToReturn||0,this.requestId=r++,this.bson=e,this.ns=t,this.cursorId=n};c.prototype.toBin=function(){var e=4+o.byteLength(this.ns)+1+4+8+16,t=0,n=o.alloc(e);return n[t+3]=e>>24&255,n[t+2]=e>>16&255,n[t+1]=e>>8&255,n[t]=255&e,n[(t+=4)+3]=this.requestId>>24&255,n[t+2]=this.requestId>>16&255,n[t+1]=this.requestId>>8&255,n[t]=255&this.requestId,n[(t+=4)+3]=0,n[t+2]=0,n[t+1]=0,n[t]=0,n[(t+=4)+3]=s.OP_GETMORE>>24&255,n[t+2]=s.OP_GETMORE>>16&255,n[t+1]=s.OP_GETMORE>>8&255,n[t]=255&s.OP_GETMORE,n[(t+=4)+3]=0,n[t+2]=0,n[t+1]=0,n[t]=0,t=(t+=4)+n.write(this.ns,t,"utf8")+1,n[t-1]=0,n[t+3]=this.numberToReturn>>24&255,n[t+2]=this.numberToReturn>>16&255,n[t+1]=this.numberToReturn>>8&255,n[t]=255&this.numberToReturn,n[(t+=4)+3]=this.cursorId.getLowBits()>>24&255,n[t+2]=this.cursorId.getLowBits()>>16&255,n[t+1]=this.cursorId.getLowBits()>>8&255,n[t]=255&this.cursorId.getLowBits(),n[(t+=4)+3]=this.cursorId.getHighBits()>>24&255,n[t+2]=this.cursorId.getHighBits()>>16&255,n[t+1]=this.cursorId.getHighBits()>>8&255,n[t]=255&this.cursorId.getHighBits(),t+=4,n};var l=function(e,t,n){this.ns=t,this.requestId=r++,this.cursorIds=n};l.prototype.toBin=function(){var e=24+8*this.cursorIds.length,t=0,n=o.alloc(e);n[t+3]=e>>24&255,n[t+2]=e>>16&255,n[t+1]=e>>8&255,n[t]=255&e,n[(t+=4)+3]=this.requestId>>24&255,n[t+2]=this.requestId>>16&255,n[t+1]=this.requestId>>8&255,n[t]=255&this.requestId,n[(t+=4)+3]=0,n[t+2]=0,n[t+1]=0,n[t]=0,n[(t+=4)+3]=s.OP_KILL_CURSORS>>24&255,n[t+2]=s.OP_KILL_CURSORS>>16&255,n[t+1]=s.OP_KILL_CURSORS>>8&255,n[t]=255&s.OP_KILL_CURSORS,n[(t+=4)+3]=0,n[t+2]=0,n[t+1]=0,n[t]=0,n[(t+=4)+3]=this.cursorIds.length>>24&255,n[t+2]=this.cursorIds.length>>16&255,n[t+1]=this.cursorIds.length>>8&255,n[t]=255&this.cursorIds.length,t+=4;for(var i=0;i<this.cursorIds.length;i++)n[t+3]=this.cursorIds[i].getLowBits()>>24&255,n[t+2]=this.cursorIds[i].getLowBits()>>16&255,n[t+1]=this.cursorIds[i].getLowBits()>>8&255,n[t]=255&this.cursorIds[i].getLowBits(),n[(t+=4)+3]=this.cursorIds[i].getHighBits()>>24&255,n[t+2]=this.cursorIds[i].getHighBits()>>16&255,n[t+1]=this.cursorIds[i].getHighBits()>>8&255,n[t]=255&this.cursorIds[i].getHighBits(),t+=4;return n};var p=function(e,t,n,o,r){r=r||{promoteLongs:!0,promoteValues:!0,promoteBuffers:!1},this.parsed=!1,this.raw=t,this.data=o,this.bson=e,this.opts=r,this.length=n.length,this.requestId=n.requestId,this.responseTo=n.responseTo,this.opCode=n.opCode,this.fromCompressed=n.fromCompressed,this.responseFlags=o.readInt32LE(0),this.cursorId=new i(o.readInt32LE(4),o.readInt32LE(8)),this.startingFrom=o.readInt32LE(12),this.numberReturned=o.readInt32LE(16),this.documents=new Array(this.numberReturned),this.cursorNotFound=0!=(1&this.responseFlags),this.queryFailure=0!=(2&this.responseFlags),this.shardConfigStale=0!=(4&this.responseFlags),this.awaitCapable=0!=(8&this.responseFlags),this.promoteLongs="boolean"!=typeof r.promoteLongs||r.promoteLongs,this.promoteValues="boolean"!=typeof r.promoteValues||r.promoteValues,this.promoteBuffers="boolean"==typeof r.promoteBuffers&&r.promoteBuffers};p.prototype.isParsed=function(){return this.parsed},p.prototype.parse=function(e){if(!this.parsed){var t,n,i=(e=e||{}).raw||!1,o=e.documentsReturnedIn||null;n={promoteLongs:"boolean"==typeof e.promoteLongs?e.promoteLongs:this.opts.promoteLongs,promoteValues:"boolean"==typeof e.promoteValues?e.promoteValues:this.opts.promoteValues,promoteBuffers:"boolean"==typeof e.promoteBuffers?e.promoteBuffers:this.opts.promoteBuffers},this.index=20;for(var r=0;r<this.numberReturned;r++)t=this.data[this.index]|this.data[this.index+1]<<8|this.data[this.index+2]<<16|this.data[this.index+3]<<24,this.documents[r]=i?this.data.slice(this.index,this.index+t):this.bson.deserialize(this.data.slice(this.index,this.index+t),n),this.index=this.index+t;if(1===this.documents.length&&null!=o&&i){const e={};e[o]=!0,n.fieldsAsRaw=e;const t=this.bson.deserialize(this.documents[0],n);this.documents=[t]}this.parsed=!0}},e.exports={Query:a,GetMore:c,Response:p,KillCursor:l}},function(e,t,n){
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
var i=n(69),o=i.Buffer;function r(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return o(e,t,n)}o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?e.exports=i:(r(i,t),t.Buffer=s),s.prototype=Object.create(o.prototype),r(o,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return o(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=o(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},function(e,t,n){"use strict";const i=n(3).Aspect,o=n(3).OperationBase,r=n(0).applyWriteConcern,s=n(0).debugOptions,a=n(0).handleCallback,c=n(1).MongoError,l=n(1).ReadPreference,p=n(0).MongoDBNamespace,u=["authSource","w","wtimeout","j","native_parser","forceServerObjectId","serializeFunctions","raw","promoteLongs","promoteValues","promoteBuffers","bufferMaxEntries","numberOfRetries","retryMiliSeconds","readPreference","pkFactory","parentDb","promiseLibrary","noListener"];e.exports=class extends o{constructor(e,t,n,o){super(t),this.hasAspect(i.WRITE_OPERATION)?(r(this.options,null!=n?{db:e,coll:n}:{db:e},this.options),this.options.readPreference=l.primary):this.options.readPreference=null!=n?l.resolve(n,t):l.resolve(e,t),this.db=e,null!=o&&(this.command=o),null!=n&&(this.collection=n)}_buildCommand(){if(null!=this.command)return this.command}execute(e){const t=this.db,n=Object.assign({},this.options);if(t.serverConfig&&t.serverConfig.isDestroyed())return e(new c("topology was destroyed"));let o;try{o=this._buildCommand()}catch(t){return e(t)}const r=n.dbName||n.authdb||t.databaseName;this.hasAspect(i.WRITE_OPERATION)&&(!n.writeConcern||n.session&&n.session.inTransaction()||(o.writeConcern=n.writeConcern)),t.s.logger.isDebug()&&t.s.logger.debug(`executing command ${JSON.stringify(o)} against ${r}.$cmd with options [${JSON.stringify(s(u,n))}]`);const l=null!=this.namespace?this.namespace:new p(r,"$cmd");t.s.topology.command(l,o,n,(t,i)=>t?a(e,t):n.full?a(e,null,i):void a(e,null,i.result))}}},function(e,t,n){"use strict";const i=n(14).Transform,o=n(14).PassThrough,r=n(5).deprecate,s=n(0).handleCallback,a=n(1).ReadPreference,c=n(1).MongoError,l=n(16).CoreCursor,p=n(16).CursorState,u=n(1).BSON.Map,d=n(0).maybePromise,h=n(38),f=n(0).formattedOrderClause,m=n(179).each,g=n(180),y=["tailable","oplogReplay","noCursorTimeout","awaitData","exhaust","partial"],v=["numberOfRetries","tailableRetryInterval"];class b extends l{constructor(e,t,n,i){super(e,t,n,i),this.operation&&(i=this.operation.options);const o=i.numberOfRetries||5,r=i.tailableRetryInterval||500,s=o,a=i.promiseLibrary||Promise;this.s={numberOfRetries:o,tailableRetryInterval:r,currentNumberOfRetries:s,state:p.INIT,promiseLibrary:a,explicitlyIgnoreSession:!!i.explicitlyIgnoreSession},!i.explicitlyIgnoreSession&&i.session&&(this.cursorState.session=i.session),!0===this.options.noCursorTimeout&&this.addCursorFlag("noCursorTimeout",!0);let c=1e3;this.cmd.cursor&&this.cmd.cursor.batchSize?c=this.cmd.cursor.batchSize:i.cursor&&i.cursor.batchSize?c=i.cursor.batchSize:"number"==typeof i.batchSize&&(c=i.batchSize),this.setCursorBatchSize(c)}get readPreference(){return this.operation?this.operation.readPreference:this.options.readPreference}get sortValue(){return this.cmd.sort}_initializeCursor(e){this.operation&&null!=this.operation.session?this.cursorState.session=this.operation.session:this.s.explicitlyIgnoreSession||this.cursorState.session||!this.topology.hasSessionSupport()||(this.cursorState.session=this.topology.startSession({owner:this}),this.operation&&(this.operation.session=this.cursorState.session)),super._initializeCursor(e)}hasNext(e){if(this.s.state===p.CLOSED||this.isDead&&this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return d(this,e,e=>{const t=this;if(t.isNotified())return e(null,!1);t._next((n,i)=>n?e(n):null==i||t.s.state===b.CLOSED||t.isDead()?e(null,!1):(t.s.state=p.OPEN,t.cursorState.cursorIndex--,t.cursorState.limit>0&&t.cursorState.currentLimit--,void e(null,!0)))})}next(e){return d(this,e,e=>{const t=this;if(t.s.state===p.CLOSED||t.isDead&&t.isDead())e(c.create({message:"Cursor is closed",driver:!0}));else{if(t.s.state===p.INIT&&t.cmd.sort)try{t.cmd.sort=f(t.cmd.sort)}catch(t){return e(t)}t._next((n,i)=>{if(n)return e(n);t.s.state=p.OPEN,e(null,i)})}})}filter(e){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.query=e,this}maxScan(e){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.maxScan=e,this}hint(e){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.hint=e,this}min(e){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.min=e,this}max(e){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.max=e,this}returnKey(e){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.returnKey=e,this}showRecordId(e){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.showDiskLoc=e,this}snapshot(e){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.snapshot=e,this}setCursorOption(e,t){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if(-1===v.indexOf(e))throw c.create({message:`option ${e} is not a supported option ${v}`,driver:!0});return this.s[e]=t,"numberOfRetries"===e&&(this.s.currentNumberOfRetries=t),this}addCursorFlag(e,t){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if(-1===y.indexOf(e))throw c.create({message:`flag ${e} is not a supported flag ${y}`,driver:!0});if("boolean"!=typeof t)throw c.create({message:`flag ${e} must be a boolean value`,driver:!0});return this.cmd[e]=t,this}addQueryModifier(e,t){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if("$"!==e[0])throw c.create({message:e+" is not a valid query modifier",driver:!0});const n=e.substr(1);return this.cmd[n]=t,"orderby"===n&&(this.cmd.sort=this.cmd[n]),this}comment(e){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.comment=e,this}maxAwaitTimeMS(e){if("number"!=typeof e)throw c.create({message:"maxAwaitTimeMS must be a number",driver:!0});if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.maxAwaitTimeMS=e,this}maxTimeMS(e){if("number"!=typeof e)throw c.create({message:"maxTimeMS must be a number",driver:!0});if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.maxTimeMS=e,this}project(e){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.fields=e,this}sort(e,t){if(this.options.tailable)throw c.create({message:"Tailable cursor doesn't support sorting",driver:!0});if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});let n=e;return Array.isArray(n)&&Array.isArray(n[0])&&(n=new u(n.map(e=>{const t=[e[0],null];if("asc"===e[1])t[1]=1;else if("desc"===e[1])t[1]=-1;else{if(1!==e[1]&&-1!==e[1]&&!e[1].$meta)throw new c("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]");t[1]=e[1]}return t}))),null!=t&&(n=[[e,t]]),this.cmd.sort=n,this}batchSize(e){if(this.options.tailable)throw c.create({message:"Tailable cursor doesn't support batchSize",driver:!0});if(this.s.state===p.CLOSED||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw c.create({message:"batchSize requires an integer",driver:!0});return this.cmd.batchSize=e,this.setCursorBatchSize(e),this}collation(e){return this.cmd.collation=e,this}limit(e){if(this.options.tailable)throw c.create({message:"Tailable cursor doesn't support limit",driver:!0});if(this.s.state===p.OPEN||this.s.state===p.CLOSED||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw c.create({message:"limit requires an integer",driver:!0});return this.cmd.limit=e,this.setCursorLimit(e),this}skip(e){if(this.options.tailable)throw c.create({message:"Tailable cursor doesn't support skip",driver:!0});if(this.s.state===p.OPEN||this.s.state===p.CLOSED||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw c.create({message:"skip requires an integer",driver:!0});return this.cmd.skip=e,this.setCursorSkip(e),this}each(e){this.rewind(),this.s.state=p.INIT,m(this,e)}forEach(e,t){if(this.rewind(),this.s.state=p.INIT,"function"!=typeof t)return new this.s.promiseLibrary((t,n)=>{m(this,(i,o)=>i?(n(i),!1):null==o?(t(null),!1):(e(o),!0))});m(this,(n,i)=>{if(n)return t(n),!1;if(null!=i)return e(i),!0;if(null==i&&t){const e=t;return t=null,e(null),!1}})}setReadPreference(e){if(this.s.state!==p.INIT)throw c.create({message:"cannot change cursor readPreference after cursor has been accessed",driver:!0});if(e instanceof a)this.options.readPreference=e;else{if("string"!=typeof e)throw new TypeError("Invalid read preference: "+e);this.options.readPreference=new a(e)}return this}toArray(e){if(this.options.tailable)throw c.create({message:"Tailable cursor cannot be converted to array",driver:!0});return d(this,e,e=>{const t=this,n=[];t.rewind(),t.s.state=p.INIT;const i=()=>{t._next((o,r)=>{if(o)return s(e,o);if(null==r)return t.close({skipKillCursors:!0},()=>s(e,null,n));if(n.push(r),t.bufferedCount()>0){let e=t.readBufferedDocuments(t.bufferedCount());Array.prototype.push.apply(n,e)}i()})};i()})}count(e,t,n){if(null==this.cmd.query)throw c.create({message:"count can only be used with find command",driver:!0});"function"==typeof t&&(n=t,t={}),t=t||{},"function"==typeof e&&(n=e,e=!0),this.cursorState.session&&(t=Object.assign({},t,{session:this.cursorState.session}));const i=new g(this,e,t);return h(this.topology,i,n)}close(e,t){return"function"==typeof e&&(t=e,e={}),e=Object.assign({},{skipKillCursors:!1},e),d(this,t,t=>{this.s.state=p.CLOSED,e.skipKillCursors||this.kill(),this._endSession(()=>{this.emit("close"),t(null,this)})})}map(e){if(this.cursorState.transforms&&this.cursorState.transforms.doc){const t=this.cursorState.transforms.doc;this.cursorState.transforms.doc=n=>e(t(n))}else this.cursorState.transforms={doc:e};return this}isClosed(){return this.isDead()}destroy(e){e&&this.emit("error",e),this.pause(),this.close()}stream(e){return this.cursorState.streamOptions=e||{},this}transformStream(e){const t=e||{};if("function"==typeof t.transform){const e=new i({objectMode:!0,transform:function(e,n,i){this.push(t.transform(e)),i()}});return this.pipe(e)}return this.pipe(new o({objectMode:!0}))}explain(e){return this.operation&&null==this.operation.cmd?(this.operation.options.explain=!0,this.operation.fullResponse=!1,h(this.topology,this.operation,e)):(this.cmd.explain=!0,this.cmd.readConcern&&delete this.cmd.readConcern,d(this,e,e=>{l.prototype._next.apply(this,[e])}))}getLogger(){return this.logger}}b.prototype.maxTimeMs=b.prototype.maxTimeMS,r(b.prototype.each,"Cursor.each is deprecated. Use Cursor.forEach instead."),r(b.prototype.maxScan,"Cursor.maxScan is deprecated, and will be removed in a later version"),r(b.prototype.snapshot,"Cursor Snapshot is deprecated, and will be removed in a later version"),e.exports=b},function(e,t,n){"use strict";const i=n(3).Aspect,o=n(3).OperationBase,r=n(1).ReadPreference,s=n(32),a=n(25),c=n(4).maxWireVersion,l=n(27).commandSupportsReadConcern,p=n(2).MongoError;e.exports=class extends o{constructor(e,t,n){super(t),this.ns=e.s.namespace.withCollection("$cmd");const o=this.hasAspect(i.NO_INHERIT_OPTIONS)?void 0:e;this.readPreference=this.hasAspect(i.WRITE_OPERATION)?r.primary:r.resolve(o,this.options),this.readConcern=function(e,t){return s.fromOptions(t)||e&&e.readConcern}(o,this.options),this.writeConcern=function(e,t){return a.fromOptions(t)||e&&e.writeConcern}(o,this.options),this.explain=!1,n&&"boolean"==typeof n.fullResponse&&(this.fullResponse=!0),this.options.readPreference=this.readPreference,e.s.logger?this.logger=e.s.logger:e.s.db&&e.s.db.logger&&(this.logger=e.s.db.logger)}executeCommand(e,t,n){this.server=e;const o=this.options,r=c(e),s=this.session&&this.session.inTransaction();this.readConcern&&l(t)&&!s&&Object.assign(t,{readConcern:this.readConcern}),o.collation&&r<5?n(new p(`Server ${e.name}, which reports wire version ${r}, does not support collation`)):(r>=5&&(this.writeConcern&&this.hasAspect(i.WRITE_OPERATION)&&Object.assign(t,{writeConcern:this.writeConcern}),o.collation&&"object"==typeof o.collation&&Object.assign(t,{collation:o.collation})),"number"==typeof o.maxTimeMS&&(t.maxTimeMS=o.maxTimeMS),"string"==typeof o.comment&&(t.comment=o.comment),this.logger&&this.logger.isDebug()&&this.logger.debug(`executing command ${JSON.stringify(t)} against ${this.ns}`),e.command(this.ns.toString(),t,this.options,(e,t)=>{e?n(e,null):this.fullResponse?n(null,t):n(null,t.result)}))}}},function(e,t,n){"use strict";const i=n(9).retrieveSnappy(),o=n(134),r={snappy:1,zlib:2},s=new Set(["ismaster","saslStart","saslContinue","getnonce","authenticate","createUser","updateUser","copydbSaslStart","copydbgetnonce","copydb"]);e.exports={compressorIDs:r,uncompressibleCommands:s,compress:function(e,t,n){switch(e.options.agreedCompressor){case"snappy":i.compress(t,n);break;case"zlib":var r={};e.options.zlibCompressionLevel&&(r.level=e.options.zlibCompressionLevel),o.deflate(t,r,n);break;default:throw new Error('Attempt to compress message using unknown compressor "'+e.options.agreedCompressor+'".')}},decompress:function(e,t,n){if(e<0||e>r.length)throw new Error("Server sent message compressed using an unsupported compressor. (Received compressor ID "+e+")");switch(e){case r.snappy:i.uncompress(t,n);break;case r.zlib:o.inflate(t,n);break;default:n(null,t)}}}},function(e,t,n){"use strict";function i(e,t){return new Buffer(e,t)}e.exports={normalizedFunctionString:function(e){return e.toString().replace(/function *\(/,"function (")},allocBuffer:"function"==typeof Buffer.alloc?function(){return Buffer.alloc.apply(Buffer,arguments)}:i,toBuffer:"function"==typeof Buffer.from?function(){return Buffer.from.apply(Buffer,arguments)}:i}},function(e,t,n){"use strict";const i=new Set(["w","wtimeout","j","fsync"]);class o{constructor(e,t,n,i){null!=e&&(this.w=e),null!=t&&(this.wtimeout=t),null!=n&&(this.j=n),null!=i&&(this.fsync=i)}static fromOptions(e){if(null!=e&&(null!=e.writeConcern||null!=e.w||null!=e.wtimeout||null!=e.j||null!=e.fsync)){if(e.writeConcern){if("string"==typeof e.writeConcern)return new o(e.writeConcern);if(!Object.keys(e.writeConcern).some(e=>i.has(e)))return;return new o(e.writeConcern.w,e.writeConcern.wtimeout,e.writeConcern.j,e.writeConcern.fsync)}return new o(e.w,e.wtimeout,e.j,e.fsync)}}}e.exports=o},function(e,t,n){"use strict";e.exports={AuthContext:class{constructor(e,t,n){this.connection=e,this.credentials=t,this.options=n}},AuthProvider:class{constructor(e){this.bson=e}prepare(e,t,n){n(void 0,e)}auth(e,t){t(new TypeError("`auth` method must be overridden by subclass"))}}}},function(e,t,n){"use strict";const i=n(9).retrieveBSON,o=n(8),r=i(),s=r.Binary,a=n(4).uuidV4,c=n(2).MongoError,l=n(2).isRetryableError,p=n(2).MongoNetworkError,u=n(2).MongoWriteConcernError,d=n(36).Transaction,h=n(36).TxnState,f=n(4).isPromiseLike,m=n(11),g=n(0).maybePromise,y=n(36).isTransactionCommand,v=n(7).resolveClusterTime,b=n(6).isSharded,x=n(4).maxWireVersion,w=n(0).now,S=n(0).calculateDurationInMs;function _(e,t){if(null==e.serverSession){const e=new c("Cannot use a session that has ended");if("function"==typeof t)return t(e,null),!1;throw e}return!0}const T=Symbol("serverSession");class E extends o{constructor(e,t,n,i){if(super(),null==e)throw new Error("ClientSession requires a topology");if(null==t||!(t instanceof B))throw new Error("ClientSession requires a ServerSessionPool");n=n||{},i=i||{},this.topology=e,this.sessionPool=t,this.hasEnded=!1,this.clientOptions=i,this[T]=void 0,this.supports={causalConsistency:void 0===n.causalConsistency||n.causalConsistency},this.clusterTime=n.initialClusterTime,this.operationTime=null,this.explicit=!!n.explicit,this.owner=n.owner,this.defaultTransactionOptions=Object.assign({},n.defaultTransactionOptions),this.transaction=new d}get id(){return this.serverSession.id}get serverSession(){return null==this[T]&&(this[T]=this.sessionPool.acquire()),this[T]}endSession(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};const n=this;return g(this,t,e=>{if(n.hasEnded)return e();function t(){n.sessionPool.release(n.serverSession),n[T]=void 0,n.hasEnded=!0,n.emit("ended",n),e()}n.serverSession&&n.inTransaction()?n.abortTransaction(n=>{if(n)return e(n);t()}):t()})}advanceOperationTime(e){null!=this.operationTime?e.greaterThan(this.operationTime)&&(this.operationTime=e):this.operationTime=e}equals(e){return e instanceof E&&this.id.id.buffer.equals(e.id.id.buffer)}incrementTransactionNumber(){this.serverSession.txnNumber++}inTransaction(){return this.transaction.isActive}startTransaction(e){if(_(this),this.inTransaction())throw new c("Transaction already in progress");const t=x(this.topology);if(b(this.topology)&&null!=t&&t<8)throw new c("Transactions are not supported on sharded clusters in MongoDB < 4.2.");this.incrementTransactionNumber(),this.transaction=new d(Object.assign({},this.clientOptions,e||this.defaultTransactionOptions)),this.transaction.transition(h.STARTING_TRANSACTION)}commitTransaction(e){return g(this,e,e=>N(this,"commitTransaction",e))}abortTransaction(e){return g(this,e,e=>N(this,"abortTransaction",e))}toBSON(){throw new Error("ClientSession cannot be serialized to BSON.")}withTransaction(e,t){return I(this,w(),e,t)}}const O=new Set(["CannotSatisfyWriteConcern","UnknownReplWriteConcern","UnsatisfiableWriteConcern"]);function k(e,t){return S(e)<t}function C(e){return null!=e&&(50===e.code||e.writeConcernError&&50===e.writeConcernError.code)}const A=new Set([h.NO_TRANSACTION,h.TRANSACTION_COMMITTED,h.TRANSACTION_ABORTED]);function I(e,t,n,i){let o;e.startTransaction(i);try{o=n(e)}catch(e){o=Promise.reject(e)}if(!f(o))throw e.abortTransaction(),new TypeError("Function provided to `withTransaction` must return a Promise");return o.then(()=>{if(!function(e){return A.has(e.transaction.state)}(e))return function e(t,n,i,o){return t.commitTransaction().catch(r=>{if(r instanceof c&&k(n,12e4)&&!C(r)){if(r.hasErrorLabel("UnknownTransactionCommitResult"))return e(t,n,i,o);if(r.hasErrorLabel("TransientTransactionError"))return I(t,n,i,o)}throw r})}(e,t,n,i)}).catch(o=>{function r(o){if(o instanceof c&&o.hasErrorLabel("TransientTransactionError")&&k(t,12e4))return I(e,t,n,i);throw C(o)&&o.addErrorLabel("UnknownTransactionCommitResult"),o}return e.transaction.isActive?e.abortTransaction().then(()=>r(o)):r(o)})}function N(e,t,n){if(!_(e,n))return;let i=e.transaction.state;if(i===h.NO_TRANSACTION)return void n(new c("No transaction started"));if("commitTransaction"===t){if(i===h.STARTING_TRANSACTION||i===h.TRANSACTION_COMMITTED_EMPTY)return e.transaction.transition(h.TRANSACTION_COMMITTED_EMPTY),void n(null,null);if(i===h.TRANSACTION_ABORTED)return void n(new c("Cannot call commitTransaction after calling abortTransaction"))}else{if(i===h.STARTING_TRANSACTION)return e.transaction.transition(h.TRANSACTION_ABORTED),void n(null,null);if(i===h.TRANSACTION_ABORTED)return void n(new c("Cannot call abortTransaction twice"));if(i===h.TRANSACTION_COMMITTED||i===h.TRANSACTION_COMMITTED_EMPTY)return void n(new c("Cannot call abortTransaction after calling commitTransaction"))}const o={[t]:1};let r;function s(i,o){var r;"commitTransaction"===t?(e.transaction.transition(h.TRANSACTION_COMMITTED),i&&(i instanceof p||i instanceof u||l(i)||C(i))&&(C(r=i)||!O.has(r.codeName)&&100!==r.code&&79!==r.code)&&(i.addErrorLabel("UnknownTransactionCommitResult"),e.transaction.unpinServer())):e.transaction.transition(h.TRANSACTION_ABORTED),n(i,o)}function a(e){return"commitTransaction"===t?e:null}e.transaction.options.writeConcern?r=Object.assign({},e.transaction.options.writeConcern):e.clientOptions&&e.clientOptions.w&&(r={w:e.clientOptions.w}),i===h.TRANSACTION_COMMITTED&&(r=Object.assign({wtimeout:1e4},r,{w:"majority"})),r&&Object.assign(o,{writeConcern:r}),"commitTransaction"===t&&e.transaction.options.maxTimeMS&&Object.assign(o,{maxTimeMS:e.transaction.options.maxTimeMS}),e.transaction.recoveryToken&&function(e){return!!e.topology.s.options.useRecoveryToken}(e)&&(o.recoveryToken=e.transaction.recoveryToken),e.topology.command("admin.$cmd",o,{session:e},(t,n)=>{if(t&&l(t))return o.commitTransaction&&(e.transaction.unpinServer(),o.writeConcern=Object.assign({wtimeout:1e4},o.writeConcern,{w:"majority"})),e.topology.command("admin.$cmd",o,{session:e},(e,t)=>s(a(e),t));s(a(t),n)})}class M{constructor(){this.id={id:new s(a(),s.SUBTYPE_UUID)},this.lastUse=w(),this.txnNumber=0,this.isDirty=!1}hasTimedOut(e){return Math.round(S(this.lastUse)%864e5%36e5/6e4)>e-1}}class B{constructor(e){if(null==e)throw new Error("ServerSessionPool requires a topology");this.topology=e,this.sessions=[]}endAllPooledSessions(e){this.sessions.length?this.topology.endSessions(this.sessions.map(e=>e.id),()=>{this.sessions=[],"function"==typeof e&&e()}):"function"==typeof e&&e()}acquire(){const e=this.topology.logicalSessionTimeoutMinutes;for(;this.sessions.length;){const t=this.sessions.shift();if(!t.hasTimedOut(e))return t}return new M}release(e){const t=this.topology.logicalSessionTimeoutMinutes;for(;this.sessions.length;){if(!this.sessions[this.sessions.length-1].hasTimedOut(t))break;this.sessions.pop()}if(!e.hasTimedOut(t)){if(e.isDirty)return;this.sessions.unshift(e)}}}function R(e,t){return!!(e.aggregate||e.count||e.distinct||e.find||e.parallelCollectionScan||e.geoNear||e.geoSearch)||!(!(e.mapReduce&&t&&t.out)||1!==t.out.inline&&"inline"!==t.out)}e.exports={ClientSession:E,ServerSession:M,ServerSessionPool:B,TxnState:h,applySession:function(e,t,n){if(e.hasEnded)return new c("Cannot use a session that has ended");if(n&&n.writeConcern&&0===n.writeConcern.w)return;const i=e.serverSession;i.lastUse=w(),t.lsid=i.id;const o=e.inTransaction()||y(t),s=n.willRetryWrite,a=R(t,n);if(i.txnNumber&&(s||o)&&(t.txnNumber=r.Long.fromNumber(i.txnNumber)),!o)return e.transaction.state!==h.NO_TRANSACTION&&e.transaction.transition(h.NO_TRANSACTION),void(e.supports.causalConsistency&&e.operationTime&&a&&(t.readConcern=t.readConcern||{},Object.assign(t.readConcern,{afterClusterTime:e.operationTime})));if(n.readPreference&&!n.readPreference.equals(m.primary))return new c("Read preference in a transaction must be primary, not: "+n.readPreference.mode);if(t.autocommit=!1,e.transaction.state===h.STARTING_TRANSACTION){e.transaction.transition(h.TRANSACTION_IN_PROGRESS),t.startTransaction=!0;const n=e.transaction.options.readConcern||e.clientOptions.readConcern;n&&(t.readConcern=n),e.supports.causalConsistency&&e.operationTime&&(t.readConcern=t.readConcern||{},Object.assign(t.readConcern,{afterClusterTime:e.operationTime}))}},updateSessionFromResponse:function(e,t){t.$clusterTime&&v(e,t.$clusterTime),t.operationTime&&e&&e.supports.causalConsistency&&e.advanceOperationTime(t.operationTime),t.recoveryToken&&e&&e.inTransaction()&&(e.transaction._recoveryToken=t.recoveryToken)},commandSupportsReadConcern:R}},function(e,t,n){"use strict";const i=n(8),o=n(1).MongoError,r=n(5).format,s=n(1).ReadPreference,a=n(1).Sessions.ClientSession;var c=function(e,t){var n=this;t=t||{force:!1,bufferMaxEntries:-1},this.s={storedOps:[],storeOptions:t,topology:e},Object.defineProperty(this,"length",{enumerable:!0,get:function(){return n.s.storedOps.length}})};c.prototype.add=function(e,t,n,i,s){if(this.s.storeOptions.force)return s(o.create({message:"db closed by application",driver:!0}));if(0===this.s.storeOptions.bufferMaxEntries)return s(o.create({message:r("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}));if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries)for(;this.s.storedOps.length>0;){this.s.storedOps.shift().c(o.create({message:r("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}))}else this.s.storedOps.push({t:e,n:t,o:n,op:i,c:s})},c.prototype.addObjectAndMethod=function(e,t,n,i,s){if(this.s.storeOptions.force)return s(o.create({message:"db closed by application",driver:!0}));if(0===this.s.storeOptions.bufferMaxEntries)return s(o.create({message:r("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}));if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries)for(;this.s.storedOps.length>0;){this.s.storedOps.shift().c(o.create({message:r("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}))}else this.s.storedOps.push({t:e,m:n,o:t,p:i,c:s})},c.prototype.flush=function(e){for(;this.s.storedOps.length>0;)this.s.storedOps.shift().c(e||o.create({message:r("no connection available for operation"),driver:!0}))};var l=["primary","primaryPreferred","nearest","secondaryPreferred"],p=["secondary","secondaryPreferred"];c.prototype.execute=function(e){e=e||{};var t=this.s.storedOps;this.s.storedOps=[];for(var n="boolean"!=typeof e.executePrimary||e.executePrimary,i="boolean"!=typeof e.executeSecondary||e.executeSecondary;t.length>0;){var o=t.shift();"cursor"===o.t?(n&&i||n&&o.o.options&&o.o.options.readPreference&&-1!==l.indexOf(o.o.options.readPreference.mode)||!n&&i&&o.o.options&&o.o.options.readPreference&&-1!==p.indexOf(o.o.options.readPreference.mode))&&o.o[o.m].apply(o.o,o.p):"auth"===o.t?this.s.topology[o.t].apply(this.s.topology,o.o):(n&&i||n&&o.op&&o.op.readPreference&&-1!==l.indexOf(o.op.readPreference.mode)||!n&&i&&o.op&&o.op.readPreference&&-1!==p.indexOf(o.op.readPreference.mode))&&this.s.topology[o.t](o.n,o.o,o.op,o.c)}},c.prototype.all=function(){return this.s.storedOps};var u=function(e){var t=function(e,t,n){Object.defineProperty(e,t,{enumerable:!0,get:function(){return n}})},n=!1,i=!1,o=!1,r=!1,s=!1,a=!1,c=e.maxWriteBatchSize||1e3,l=!1,p=!1;e.minWireVersion>=0&&(o=!0),e.maxWireVersion>=1&&(n=!0,r=!0),e.maxWireVersion>=2&&(i=!0),e.maxWireVersion>=3&&(s=!0,a=!0),e.maxWireVersion>=5&&(l=!0,p=!0),null==e.minWireVersion&&(e.minWireVersion=0),null==e.maxWireVersion&&(e.maxWireVersion=0),t(this,"hasAggregationCursor",n),t(this,"hasWriteCommands",i),t(this,"hasTextSearch",o),t(this,"hasAuthCommands",r),t(this,"hasListCollectionsCommand",s),t(this,"hasListIndexesCommand",a),t(this,"minWireVersion",e.minWireVersion),t(this,"maxWireVersion",e.maxWireVersion),t(this,"maxNumberOfDocsInBatch",c),t(this,"commandsTakeWriteConcern",l),t(this,"commandsTakeCollation",p)};class d extends i{constructor(){super(),this.setMaxListeners(1/0)}hasSessionSupport(){return null!=this.logicalSessionTimeoutMinutes}startSession(e,t){const n=new a(this,this.s.sessionPool,e,t);return n.once("ended",()=>{this.s.sessions.delete(n)}),this.s.sessions.add(n),n}endSessions(e,t){return this.s.coreTopology.endSessions(e,t)}get clientMetadata(){return this.s.coreTopology.s.options.metadata}capabilities(){return this.s.sCapabilities?this.s.sCapabilities:null==this.s.coreTopology.lastIsMaster()?null:(this.s.sCapabilities=new u(this.s.coreTopology.lastIsMaster()),this.s.sCapabilities)}command(e,t,n,i){this.s.coreTopology.command(e.toString(),t,s.translate(n),i)}insert(e,t,n,i){this.s.coreTopology.insert(e.toString(),t,n,i)}update(e,t,n,i){this.s.coreTopology.update(e.toString(),t,n,i)}remove(e,t,n,i){this.s.coreTopology.remove(e.toString(),t,n,i)}isConnected(e){return e=e||{},e=s.translate(e),this.s.coreTopology.isConnected(e)}isDestroyed(){return this.s.coreTopology.isDestroyed()}cursor(e,t,n){return n=n||{},(n=s.translate(n)).disconnectHandler=this.s.store,n.topology=this,this.s.coreTopology.cursor(e,t,n)}lastIsMaster(){return this.s.coreTopology.lastIsMaster()}selectServer(e,t,n){return this.s.coreTopology.selectServer(e,t,n)}unref(){return this.s.coreTopology.unref()}connections(){return this.s.coreTopology.connections()}close(e,t){this.s.sessions.forEach(e=>e.endSession()),this.s.sessionPool&&this.s.sessionPool.endAllPooledSessions(),!0===e&&(this.s.storeOptions.force=e,this.s.store.flush()),this.s.coreTopology.destroy({force:"boolean"==typeof e&&e},t)}}Object.defineProperty(d.prototype,"bson",{enumerable:!0,get:function(){return this.s.coreTopology.s.bson}}),Object.defineProperty(d.prototype,"parserType",{enumerable:!0,get:function(){return this.s.coreTopology.parserType}}),Object.defineProperty(d.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.s.coreTopology.logicalSessionTimeoutMinutes}}),Object.defineProperty(d.prototype,"type",{enumerable:!0,get:function(){return this.s.coreTopology.type}}),t.Store=c,t.ServerCapabilities=u,t.TopologyBase=d},function(e,t){function n(e,t){if(!(this instanceof n))return new n(e,t);this._bsontype="Long",this.low_=0|e,this.high_=0|t}n.prototype.toInt=function(){return this.low_},n.prototype.toNumber=function(){return this.high_*n.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},n.prototype.toJSON=function(){return this.toString()},n.prototype.toString=function(e){var t=e||10;if(t<2||36<t)throw Error("radix out of range: "+t);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(n.MIN_VALUE)){var i=n.fromNumber(t),o=this.div(i),r=o.multiply(i).subtract(this);return o.toString(t)+r.toInt().toString(t)}return"-"+this.negate().toString(t)}var s=n.fromNumber(Math.pow(t,6));r=this;for(var a="";!r.isZero();){var c=r.div(s),l=r.subtract(c.multiply(s)).toInt().toString(t);if((r=c).isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},n.prototype.getHighBits=function(){return this.high_},n.prototype.getLowBits=function(){return this.low_},n.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:n.TWO_PWR_32_DBL_+this.low_},n.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(n.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=0!==this.high_?this.high_:this.low_,t=31;t>0&&0==(e&1<<t);t--);return 0!==this.high_?t+33:t+1},n.prototype.isZero=function(){return 0===this.high_&&0===this.low_},n.prototype.isNegative=function(){return this.high_<0},n.prototype.isOdd=function(){return 1==(1&this.low_)},n.prototype.equals=function(e){return this.high_===e.high_&&this.low_===e.low_},n.prototype.notEquals=function(e){return this.high_!==e.high_||this.low_!==e.low_},n.prototype.lessThan=function(e){return this.compare(e)<0},n.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},n.prototype.greaterThan=function(e){return this.compare(e)>0},n.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0},n.prototype.compare=function(e){if(this.equals(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.subtract(e).isNegative()?-1:1},n.prototype.negate=function(){return this.equals(n.MIN_VALUE)?n.MIN_VALUE:this.not().add(n.ONE)},n.prototype.add=function(e){var t=this.high_>>>16,i=65535&this.high_,o=this.low_>>>16,r=65535&this.low_,s=e.high_>>>16,a=65535&e.high_,c=e.low_>>>16,l=0,p=0,u=0,d=0;return u+=(d+=r+(65535&e.low_))>>>16,d&=65535,p+=(u+=o+c)>>>16,u&=65535,l+=(p+=i+a)>>>16,p&=65535,l+=t+s,l&=65535,n.fromBits(u<<16|d,l<<16|p)},n.prototype.subtract=function(e){return this.add(e.negate())},n.prototype.multiply=function(e){if(this.isZero())return n.ZERO;if(e.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE))return e.isOdd()?n.MIN_VALUE:n.ZERO;if(e.equals(n.MIN_VALUE))return this.isOdd()?n.MIN_VALUE:n.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(n.TWO_PWR_24_)&&e.lessThan(n.TWO_PWR_24_))return n.fromNumber(this.toNumber()*e.toNumber());var t=this.high_>>>16,i=65535&this.high_,o=this.low_>>>16,r=65535&this.low_,s=e.high_>>>16,a=65535&e.high_,c=e.low_>>>16,l=65535&e.low_,p=0,u=0,d=0,h=0;return d+=(h+=r*l)>>>16,h&=65535,u+=(d+=o*l)>>>16,d&=65535,u+=(d+=r*c)>>>16,d&=65535,p+=(u+=i*l)>>>16,u&=65535,p+=(u+=o*c)>>>16,u&=65535,p+=(u+=r*a)>>>16,u&=65535,p+=t*l+i*c+o*a+r*s,p&=65535,n.fromBits(d<<16|h,p<<16|u)},n.prototype.div=function(e){if(e.isZero())throw Error("division by zero");if(this.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE)){if(e.equals(n.ONE)||e.equals(n.NEG_ONE))return n.MIN_VALUE;if(e.equals(n.MIN_VALUE))return n.ONE;var t=this.shiftRight(1).div(e).shiftLeft(1);if(t.equals(n.ZERO))return e.isNegative()?n.ONE:n.NEG_ONE;var i=this.subtract(e.multiply(t));return t.add(i.div(e))}if(e.equals(n.MIN_VALUE))return n.ZERO;if(this.isNegative())return e.isNegative()?this.negate().div(e.negate()):this.negate().div(e).negate();if(e.isNegative())return this.div(e.negate()).negate();var o=n.ZERO;for(i=this;i.greaterThanOrEqual(e);){t=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var r=Math.ceil(Math.log(t)/Math.LN2),s=r<=48?1:Math.pow(2,r-48),a=n.fromNumber(t),c=a.multiply(e);c.isNegative()||c.greaterThan(i);)t-=s,c=(a=n.fromNumber(t)).multiply(e);a.isZero()&&(a=n.ONE),o=o.add(a),i=i.subtract(c)}return o},n.prototype.modulo=function(e){return this.subtract(this.div(e).multiply(e))},n.prototype.not=function(){return n.fromBits(~this.low_,~this.high_)},n.prototype.and=function(e){return n.fromBits(this.low_&e.low_,this.high_&e.high_)},n.prototype.or=function(e){return n.fromBits(this.low_|e.low_,this.high_|e.high_)},n.prototype.xor=function(e){return n.fromBits(this.low_^e.low_,this.high_^e.high_)},n.prototype.shiftLeft=function(e){if(0===(e&=63))return this;var t=this.low_;if(e<32){var i=this.high_;return n.fromBits(t<<e,i<<e|t>>>32-e)}return n.fromBits(0,t<<e-32)},n.prototype.shiftRight=function(e){if(0===(e&=63))return this;var t=this.high_;if(e<32){var i=this.low_;return n.fromBits(i>>>e|t<<32-e,t>>e)}return n.fromBits(t>>e-32,t>=0?0:-1)},n.prototype.shiftRightUnsigned=function(e){if(0===(e&=63))return this;var t=this.high_;if(e<32){var i=this.low_;return n.fromBits(i>>>e|t<<32-e,t>>>e)}return 32===e?n.fromBits(t,0):n.fromBits(t>>>e-32,0)},n.fromInt=function(e){if(-128<=e&&e<128){var t=n.INT_CACHE_[e];if(t)return t}var i=new n(0|e,e<0?-1:0);return-128<=e&&e<128&&(n.INT_CACHE_[e]=i),i},n.fromNumber=function(e){return isNaN(e)||!isFinite(e)?n.ZERO:e<=-n.TWO_PWR_63_DBL_?n.MIN_VALUE:e+1>=n.TWO_PWR_63_DBL_?n.MAX_VALUE:e<0?n.fromNumber(-e).negate():new n(e%n.TWO_PWR_32_DBL_|0,e/n.TWO_PWR_32_DBL_|0)},n.fromBits=function(e,t){return new n(e,t)},n.fromString=function(e,t){if(0===e.length)throw Error("number format error: empty string");var i=t||10;if(i<2||36<i)throw Error("radix out of range: "+i);if("-"===e.charAt(0))return n.fromString(e.substring(1),i).negate();if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+e);for(var o=n.fromNumber(Math.pow(i,8)),r=n.ZERO,s=0;s<e.length;s+=8){var a=Math.min(8,e.length-s),c=parseInt(e.substring(s,s+a),i);if(a<8){var l=n.fromNumber(Math.pow(i,a));r=r.multiply(l).add(n.fromNumber(c))}else r=(r=r.multiply(o)).add(n.fromNumber(c))}return r},n.INT_CACHE_={},n.TWO_PWR_16_DBL_=65536,n.TWO_PWR_24_DBL_=1<<24,n.TWO_PWR_32_DBL_=n.TWO_PWR_16_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_31_DBL_=n.TWO_PWR_32_DBL_/2,n.TWO_PWR_48_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_64_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_32_DBL_,n.TWO_PWR_63_DBL_=n.TWO_PWR_64_DBL_/2,n.ZERO=n.fromInt(0),n.ONE=n.fromInt(1),n.NEG_ONE=n.fromInt(-1),n.MAX_VALUE=n.fromBits(-1,2147483647),n.MIN_VALUE=n.fromBits(0,-2147483648),n.TWO_PWR_24_=n.fromInt(1<<24),e.exports=n,e.exports.Long=n},function(e,t,n){"use strict";const i=n(4).arrayStrictEqual,o=n(4).tagsStrictEqual,r=n(4).errorStrictEqual,s=n(13).ServerType,a=n(0).now,c=new Set([s.RSPrimary,s.Standalone,s.Mongos]),l=new Set([s.RSPrimary,s.RSSecondary,s.Mongos,s.Standalone]),p=["minWireVersion","maxWireVersion","maxBsonObjectSize","maxMessageSizeBytes","maxWriteBatchSize","compression","me","hosts","passives","arbiters","tags","setName","setVersion","electionId","primary","logicalSessionTimeoutMinutes","saslSupportedMechs","__nodejs_mock_server__","$clusterTime"];function u(e){return e&&e.ok?e.isreplicaset?s.RSGhost:e.msg&&"isdbgrid"===e.msg?s.Mongos:e.setName?e.hidden?s.RSOther:e.ismaster?s.RSPrimary:e.secondary?s.RSSecondary:e.arbiterOnly?s.RSArbiter:s.RSOther:s.Standalone:s.Unknown}function d(e,t){return null==e||null==t?-1:e.processId.equals(t.processId)?e.counter===t.counter?0:e.counter<t.counter?-1:1:-1}e.exports={ServerDescription:class{constructor(e,t,n){n=n||{},t=Object.assign({minWireVersion:0,maxWireVersion:0,hosts:[],passives:[],arbiters:[],tags:[]},t),this.address=e,this.error=n.error,this.roundTripTime=n.roundTripTime||-1,this.lastUpdateTime=a(),this.lastWriteDate=t.lastWrite?t.lastWrite.lastWriteDate:null,this.opTime=t.lastWrite?t.lastWrite.opTime:null,this.type=u(t),this.topologyVersion=n.topologyVersion||t.topologyVersion,p.forEach(e=>{void 0!==t[e]&&(this[e]=t[e])}),this.me&&(this.me=this.me.toLowerCase()),this.hosts=this.hosts.map(e=>e.toLowerCase()),this.passives=this.passives.map(e=>e.toLowerCase()),this.arbiters=this.arbiters.map(e=>e.toLowerCase())}get allHosts(){return this.hosts.concat(this.arbiters).concat(this.passives)}get isReadable(){return this.type===s.RSSecondary||this.isWritable}get isDataBearing(){return l.has(this.type)}get isWritable(){return c.has(this.type)}get host(){const e=(":"+this.port).length;return this.address.slice(0,-e)}get port(){const e=this.address.split(":").pop();return e?Number.parseInt(e,10):e}equals(e){const t=this.topologyVersion===e.topologyVersion||0===d(this.topologyVersion,e.topologyVersion);return null!=e&&r(this.error,e.error)&&this.type===e.type&&this.minWireVersion===e.minWireVersion&&this.me===e.me&&i(this.hosts,e.hosts)&&o(this.tags,e.tags)&&this.setName===e.setName&&this.setVersion===e.setVersion&&(this.electionId?e.electionId&&this.electionId.equals(e.electionId):this.electionId===e.electionId)&&this.primary===e.primary&&this.logicalSessionTimeoutMinutes===e.logicalSessionTimeoutMinutes&&t}},parseServerType:u,compareTopologyVersion:d}},function(e,t,n){"use strict";const i=n(19).Buffer,o=n(6).opcodes,r=n(6).databaseNamespace,s=n(11);let a=0;class c{constructor(e,t,n,i){if(null==n)throw new Error("query must be specified for query");this.bson=e,this.ns=t,this.command=n,this.command.$db=r(t),i.readPreference&&i.readPreference.mode!==s.PRIMARY&&(this.command.$readPreference=i.readPreference.toJSON()),this.options=i||{},this.requestId=i.requestId?i.requestId:c.getRequestId(),this.serializeFunctions="boolean"==typeof i.serializeFunctions&&i.serializeFunctions,this.ignoreUndefined="boolean"==typeof i.ignoreUndefined&&i.ignoreUndefined,this.checkKeys="boolean"==typeof i.checkKeys&&i.checkKeys,this.maxBsonSize=i.maxBsonSize||16777216,this.checksumPresent=!1,this.moreToCome=i.moreToCome||!1,this.exhaustAllowed="boolean"==typeof i.exhaustAllowed&&i.exhaustAllowed}toBin(){const e=[];let t=0;this.checksumPresent&&(t|=1),this.moreToCome&&(t|=2),this.exhaustAllowed&&(t|=65536);const n=i.alloc(20);e.push(n);let r=n.length;const s=this.command;return r+=this.makeDocumentSegment(e,s),n.writeInt32LE(r,0),n.writeInt32LE(this.requestId,4),n.writeInt32LE(0,8),n.writeInt32LE(o.OP_MSG,12),n.writeUInt32LE(t,16),e}makeDocumentSegment(e,t){const n=i.alloc(1);n[0]=0;const o=this.serializeBson(t);return e.push(n),e.push(o),n.length+o.length}serializeBson(e){return this.bson.serialize(e,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined})}}c.getRequestId=function(){return a=a+1&2147483647,a};e.exports={Msg:c,BinMsg:class{constructor(e,t,n,i,o){o=o||{promoteLongs:!0,promoteValues:!0,promoteBuffers:!1},this.parsed=!1,this.raw=t,this.data=i,this.bson=e,this.opts=o,this.length=n.length,this.requestId=n.requestId,this.responseTo=n.responseTo,this.opCode=n.opCode,this.fromCompressed=n.fromCompressed,this.responseFlags=i.readInt32LE(0),this.checksumPresent=0!=(1&this.responseFlags),this.moreToCome=0!=(2&this.responseFlags),this.exhaustAllowed=0!=(65536&this.responseFlags),this.promoteLongs="boolean"!=typeof o.promoteLongs||o.promoteLongs,this.promoteValues="boolean"!=typeof o.promoteValues||o.promoteValues,this.promoteBuffers="boolean"==typeof o.promoteBuffers&&o.promoteBuffers,this.documents=[]}isParsed(){return this.parsed}parse(e){if(this.parsed)return;e=e||{},this.index=4;const t=e.raw||!1,n=e.documentsReturnedIn||null,i={promoteLongs:"boolean"==typeof e.promoteLongs?e.promoteLongs:this.opts.promoteLongs,promoteValues:"boolean"==typeof e.promoteValues?e.promoteValues:this.opts.promoteValues,promoteBuffers:"boolean"==typeof e.promoteBuffers?e.promoteBuffers:this.opts.promoteBuffers};for(;this.index<this.data.length;){const e=this.data.readUInt8(this.index++);if(1===e)console.error("TYPE 1");else if(0===e){const e=this.data.readUInt32LE(this.index),n=this.data.slice(this.index,this.index+e);this.documents.push(t?n:this.bson.deserialize(n,i)),this.index+=e}}if(1===this.documents.length&&null!=n&&t){const e={};e[n]=!0,i.fieldsAsRaw=e;const t=this.bson.deserialize(this.documents[0],i);this.documents=[t]}this.parsed=!0}}}},function(e,t,n){"use strict";class i{constructor(e){null!=e&&(this.level=e)}static fromOptions(e){if(null!=e)return e.readConcern?e.readConcern instanceof i?e.readConcern:new i(e.readConcern.level):e.level?new i(e.level):void 0}static get MAJORITY(){return"majority"}static get AVAILABLE(){return"available"}static get LINEARIZABLE(){return"linearizable"}static get SNAPSHOT(){return"snapshot"}}e.exports=i},function(e,t,n){"use strict";var i=n(57),o=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=u;var r=Object.create(n(39));r.inherits=n(40);var s=n(107),a=n(110);r.inherits(u,s);for(var c=o(a.prototype),l=0;l<c.length;l++){var p=c[l];u.prototype[p]||(u.prototype[p]=a.prototype[p])}function u(e){if(!(this instanceof u))return new u(e);s.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||i.nextTick(h,this)}function h(e){e.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),u.prototype._destroy=function(e,t){this.push(null),this.end(),i.nextTick(t,e)}},function(e,t){e.exports=require("url")},function(e,t,n){if("undefined"!=typeof global)var i=n(69).Buffer;var o=n(24);function r(e,t){if(!(this instanceof r))return new r(e,t);if(!(null==e||"string"==typeof e||i.isBuffer(e)||e instanceof Uint8Array||Array.isArray(e)))throw new Error("only String, Buffer, Uint8Array or Array accepted");if(this._bsontype="Binary",e instanceof Number?(this.sub_type=e,this.position=0):(this.sub_type=null==t?s:t,this.position=0),null==e||e instanceof Number)void 0!==i?this.buffer=o.allocBuffer(r.BUFFER_SIZE):"undefined"!=typeof Uint8Array?this.buffer=new Uint8Array(new ArrayBuffer(r.BUFFER_SIZE)):this.buffer=new Array(r.BUFFER_SIZE),this.position=0;else{if("string"==typeof e)if(void 0!==i)this.buffer=o.toBuffer(e);else{if("undefined"==typeof Uint8Array&&"[object Array]"!==Object.prototype.toString.call(e))throw new Error("only String, Buffer, Uint8Array or Array accepted");this.buffer=a(e)}else this.buffer=e;this.position=e.length}}r.prototype.put=function(e){if(null!=e.length&&"number"!=typeof e&&1!==e.length)throw new Error("only accepts single character String, Uint8Array or Array");if("number"!=typeof e&&e<0||e>255)throw new Error("only accepts number in a valid unsigned byte range 0-255");var t=null;if(t="string"==typeof e?e.charCodeAt(0):null!=e.length?e[0]:e,this.buffer.length>this.position)this.buffer[this.position++]=t;else if(void 0!==i&&i.isBuffer(this.buffer)){var n=o.allocBuffer(r.BUFFER_SIZE+this.buffer.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n,this.buffer[this.position++]=t}else{n=null,n="[object Uint8Array]"===Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(r.BUFFER_SIZE+this.buffer.length)):new Array(r.BUFFER_SIZE+this.buffer.length);for(var s=0;s<this.buffer.length;s++)n[s]=this.buffer[s];this.buffer=n,this.buffer[this.position++]=t}},r.prototype.write=function(e,t){if(t="number"==typeof t?t:this.position,this.buffer.length<t+e.length){var n=null;if(void 0!==i&&i.isBuffer(this.buffer))n=o.allocBuffer(this.buffer.length+e.length),this.buffer.copy(n,0,0,this.buffer.length);else if("[object Uint8Array]"===Object.prototype.toString.call(this.buffer)){n=new Uint8Array(new ArrayBuffer(this.buffer.length+e.length));for(var r=0;r<this.position;r++)n[r]=this.buffer[r]}this.buffer=n}if(void 0!==i&&i.isBuffer(e)&&i.isBuffer(this.buffer))e.copy(this.buffer,t,0,e.length),this.position=t+e.length>this.position?t+e.length:this.position;else if(void 0!==i&&"string"==typeof e&&i.isBuffer(this.buffer))this.buffer.write(e,t,"binary"),this.position=t+e.length>this.position?t+e.length:this.position;else if("[object Uint8Array]"===Object.prototype.toString.call(e)||"[object Array]"===Object.prototype.toString.call(e)&&"string"!=typeof e){for(r=0;r<e.length;r++)this.buffer[t++]=e[r];this.position=t>this.position?t:this.position}else if("string"==typeof e){for(r=0;r<e.length;r++)this.buffer[t++]=e.charCodeAt(r);this.position=t>this.position?t:this.position}},r.prototype.read=function(e,t){if(t=t&&t>0?t:this.position,this.buffer.slice)return this.buffer.slice(e,e+t);for(var n="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(t)):new Array(t),i=0;i<t;i++)n[i]=this.buffer[e++];return n},r.prototype.value=function(e){if((e=null!=e&&e)&&void 0!==i&&i.isBuffer(this.buffer)&&this.buffer.length===this.position)return this.buffer;if(void 0!==i&&i.isBuffer(this.buffer))return e?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position);if(e){if(null!=this.buffer.slice)return this.buffer.slice(0,this.position);for(var t="[object Uint8Array]"===Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position),n=0;n<this.position;n++)t[n]=this.buffer[n];return t}return c(this.buffer,0,this.position)},r.prototype.length=function(){return this.position},r.prototype.toJSON=function(){return null!=this.buffer?this.buffer.toString("base64"):""},r.prototype.toString=function(e){return null!=this.buffer?this.buffer.slice(0,this.position).toString(e):""};var s=0,a=function(e){for(var t="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(e.length)):new Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t},c=function(e,t,n){for(var i="",o=t;o<n;o++)i+=String.fromCharCode(e[o]);return i};r.BUFFER_SIZE=256,r.SUBTYPE_DEFAULT=0,r.SUBTYPE_FUNCTION=1,r.SUBTYPE_BYTE_ARRAY=2,r.SUBTYPE_UUID_OLD=3,r.SUBTYPE_UUID=4,r.SUBTYPE_MD5=5,r.SUBTYPE_USER_DEFINED=128,e.exports=r,e.exports.Binary=r},function(e,t,n){"use strict";const i=n(2).MongoError,o=n(11),r=n(32),s=n(25);let a,c;a={NO_TRANSACTION:"NO_TRANSACTION",STARTING_TRANSACTION:"STARTING_TRANSACTION",TRANSACTION_IN_PROGRESS:"TRANSACTION_IN_PROGRESS",TRANSACTION_COMMITTED:"TRANSACTION_COMMITTED",TRANSACTION_COMMITTED_EMPTY:"TRANSACTION_COMMITTED_EMPTY",TRANSACTION_ABORTED:"TRANSACTION_ABORTED"},c={NO_TRANSACTION:["NO_TRANSACTION","STARTING_TRANSACTION"],STARTING_TRANSACTION:["TRANSACTION_IN_PROGRESS","TRANSACTION_COMMITTED","TRANSACTION_COMMITTED_EMPTY","TRANSACTION_ABORTED"],TRANSACTION_IN_PROGRESS:["TRANSACTION_IN_PROGRESS","TRANSACTION_COMMITTED","TRANSACTION_ABORTED"],TRANSACTION_COMMITTED:["TRANSACTION_COMMITTED","TRANSACTION_COMMITTED_EMPTY","STARTING_TRANSACTION","NO_TRANSACTION"],TRANSACTION_ABORTED:["STARTING_TRANSACTION","NO_TRANSACTION"],TRANSACTION_COMMITTED_EMPTY:["TRANSACTION_COMMITTED_EMPTY","NO_TRANSACTION"]};e.exports={TxnState:a,Transaction:class{constructor(e){e=e||{},this.state=a.NO_TRANSACTION,this.options={};const t=s.fromOptions(e);if(t){if(t.w<=0)throw new i("Transactions do not support unacknowledged write concern");this.options.writeConcern=t}e.readConcern&&(this.options.readConcern=r.fromOptions(e)),e.readPreference&&(this.options.readPreference=o.fromOptions(e)),e.maxCommitTimeMS&&(this.options.maxTimeMS=e.maxCommitTimeMS),this._pinnedServer=void 0,this._recoveryToken=void 0}get server(){return this._pinnedServer}get recoveryToken(){return this._recoveryToken}get isPinned(){return!!this.server}get isActive(){return-1!==[a.STARTING_TRANSACTION,a.TRANSACTION_IN_PROGRESS].indexOf(this.state)}transition(e){const t=c[this.state];if(t&&-1!==t.indexOf(e))return this.state=e,void(this.state!==a.NO_TRANSACTION&&this.state!==a.STARTING_TRANSACTION||this.unpinServer());throw new i(`Attempted illegal state transition from [${this.state}] to [${e}]`)}pinServer(e){this.isActive&&(this._pinnedServer=e)}unpinServer(){this._pinnedServer=void 0}},isTransactionCommand:function(e){return!(!e.commitTransaction&&!e.abortTransaction)}}},function(e,t,n){"use strict";const i=n(18).Query,o=n(31).Msg,r=n(2).MongoError,s=n(6).getReadPreference,a=n(6).isSharded,c=n(6).databaseNamespace,l=n(36).isTransactionCommand,p=n(27).applySession,u=n(2).MongoNetworkError,d=n(4).maxWireVersion;function h(e,t,n,d,h){const f=e.s.bson,m=e.s.pool,g=s(n,d),y=function(e){const t=e.ismaster?e.ismaster:e.description;if(null==t)return!1;return t.maxWireVersion>=6&&null==t.__nodejs_mock_server__}(e),v=d.session;let b=e.clusterTime,x=Object.assign({},n);if(function(e){if(null==e)return!1;if(e.description)return e.description.maxWireVersion>=6;return null!=e.ismaster&&e.ismaster.maxWireVersion>=6}(e)&&v){v.clusterTime&&v.clusterTime.clusterTime.greaterThan(b.clusterTime)&&(b=v.clusterTime);const e=p(v,x,d);if(e)return h(e)}b&&(x.$clusterTime=b),a(e)&&!y&&g&&"primary"!==g.mode&&(x={$query:x,$readPreference:g.toJSON()});const w=Object.assign({command:!0,numberToSkip:0,numberToReturn:-1,checkKeys:!1},d);w.slaveOk=g.slaveOk();const S=c(t)+".$cmd",_=y?new o(f,S,x,w):new i(f,S,x,w),T=v&&(v.inTransaction()||l(x))?function(e){return e&&e instanceof u&&!e.hasErrorLabel("TransientTransactionError")&&e.addErrorLabel("TransientTransactionError"),!n.commitTransaction&&e&&e instanceof r&&e.hasErrorLabel("TransientTransactionError")&&v.transaction.unpinServer(),h.apply(null,arguments)}:h;try{m.write(_,w,T)}catch(e){T(e)}}e.exports=function(e,t,n,i,o){if("function"==typeof i&&(o=i,i={}),i=i||{},null==n)return o(new r(`command ${JSON.stringify(n)} does not return a cursor`));if(!function(e){return d(e)&&e.autoEncrypter}(e))return void h(e,t,n,i,o);const s=d(e);"number"!=typeof s||s<8?o(new r("Auto-encryption requires a minimum MongoDB version of 4.2")):function(e,t,n,i,o){const r=e.autoEncrypter;function s(e,t){e||null==t?o(e,t):r.decrypt(t.result,i,(e,n)=>{e?o(e,null):(t.result=n,t.message.documents=[n],o(null,t))})}r.encrypt(t,n,i,(n,r)=>{n?o(n,null):h(e,t,r,i,s)})}(e,t,n,i,o)}},function(e,t,n){"use strict";const i=n(2).MongoError,o=n(3).Aspect,r=n(3).OperationBase,s=n(11),a=n(2).isRetryableError,c=n(4).maxWireVersion,l=n(4).isUnifiedTopology;function p(e,t,n){if(null==e)throw new TypeError("This method requires a valid topology instance");if(!(t instanceof r))throw new TypeError("This method requires a valid operation instance");if(l(e)&&e.shouldCheckForSessionSupport())return function(e,t,n){const i=e.s.promiseLibrary;let o;"function"!=typeof n&&(o=new i((e,t)=>{n=(n,i)=>{if(n)return t(n);e(i)}}));return e.selectServer(s.primaryPreferred,i=>{i?n(i):p(e,t,n)}),o}(e,t,n);const c=e.s.promiseLibrary;let d,h,f;if(e.hasSessionSupport())if(null==t.session)h=Symbol(),d=e.startSession({owner:h}),t.session=d;else if(t.session.hasEnded)throw new i("Use of expired sessions is not permitted");function m(e,i){d&&d.owner===h&&(d.endSession(),t.session===d&&t.clearSession()),n(e,i)}"function"!=typeof n&&(f=new c((e,t)=>{n=(n,i)=>{if(n)return t(n);e(i)}}));try{t.hasAspect(o.EXECUTE_WITH_SELECTION)?function(e,t,n){const r=t.readPreference||s.primary,c=t.session&&t.session.inTransaction();if(c&&!r.equals(s.primary))return void n(new i("Read preference in a transaction must be primary, not: "+r.mode));const l={readPreference:r,session:t.session};function p(i,o){return null==i?n(null,o):a(i)?void e.selectServer(l,(e,i)=>{!e&&u(i)?t.execute(i,n):n(e,null)}):n(i)}e.selectServer(l,(i,r)=>{if(i)return void n(i,null);const s=!1!==e.s.options.retryReads&&t.session&&!c&&u(r)&&t.canRetryRead;t.hasAspect(o.RETRYABLE)&&s?t.execute(r,p):t.execute(r,n)})}(e,t,m):t.execute(m)}catch(e){throw d&&d.owner===h&&(d.endSession(),t.session===d&&t.clearSession()),e}return f}function u(e){return c(e)>=6}e.exports=p},function(e,t){function n(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===n(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===n(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===n(e)},t.isError=function(e){return"[object Error]"===n(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=Buffer.isBuffer},function(e,t,n){try{var i=n(5);if("function"!=typeof i.inherits)throw"";e.exports=i.inherits}catch(t){e.exports=n(168)}},function(e,t,n){"use strict";const i=n(0).applyWriteConcern,o=n(1).BSON.Code,r=n(12).createIndex,s=n(0).decorateWithCollation,a=n(0).decorateWithReadConcern,c=n(12).ensureIndex,l=n(12).evaluate,p=n(12).executeCommand,u=n(0).handleCallback,d=n(12).indexInformation,h=n(1).BSON.Long,f=n(1).MongoError,m=n(1).ReadPreference,g=n(10).insertDocuments,y=n(10).updateDocuments;function v(e,t,n){d(e.s.db,e.collectionName,t,n)}e.exports={createIndex:function(e,t,n,i){r(e.s.db,e.collectionName,t,n,i)},createIndexes:function(e,t,n,i){const o=e.s.topology.capabilities();for(let e=0;e<t.length;e++)if(null==t[e].name){const n=[];if(t[e].collation&&o&&!o.commandsTakeCollation)return i(new f("server/primary/mongos does not support collation"));for(let i in t[e].key)n.push(`${i}_${t[e].key[i]}`);t[e].name=n.join("_")}n=Object.assign({},n,{readPreference:m.PRIMARY}),p(e.s.db,{createIndexes:e.collectionName,indexes:t},n,i)},ensureIndex:function(e,t,n,i){c(e.s.db,e.collectionName,t,n,i)},group:function(e,t,n,i,r,c,d,h,f){if(d){const l=r&&"Code"===r._bsontype?r:new o(r),d={group:{ns:e.collectionName,$reduce:l,cond:n,initial:i,out:"inline"}};if(null!=c&&(d.group.finalize=c),"function"==typeof t||t&&"Code"===t._bsontype)d.group.$keyf=t&&"Code"===t._bsontype?t:new o(t);else{const e={};t.forEach(t=>{e[t]=1}),d.group.key=e}(h=Object.assign({},h)).readPreference=m.resolve(e,h),a(d,e,h);try{s(d,e,h)}catch(e){return f(e,null)}p(e.s.db,d,h,(e,t)=>{if(e)return u(f,e,null);u(f,null,t.retval)})}else{const s=null!=r&&"Code"===r._bsontype?r.scope:{};s.ns=e.collectionName,s.keys=t,s.condition=n,s.initial=i;const a='function () {\nvar c = db[ns].find(condition);\nvar map = new Map();\nvar reduce_function = reduce;\n\nwhile (c.hasNext()) {\nvar obj = c.next();\nvar key = {};\n\nfor (var i = 0, len = keys.length; i < len; ++i) {\nvar k = keys[i];\nkey[k] = obj[k];\n}\n\nvar aggObj = map.get(key);\n\nif (aggObj == null) {\nvar newObj = Object.extend({}, key);\naggObj = Object.extend(newObj, initial);\nmap.put(key, aggObj);\n}\n\nreduce_function(obj, aggObj);\n}\n\nreturn { "result": map.values() };\n}'.replace(/ reduce;/,r.toString()+";");l(e.s.db,new o(a,s),null,h,(e,t)=>{if(e)return u(f,e,null);u(f,null,t.result||t)})}},indexes:function(e,t,n){t=Object.assign({},{full:!0},t),d(e.s.db,e.collectionName,t,n)},indexExists:function(e,t,n,i){v(e,n,(e,n)=>{if(null!=e)return u(i,e,null);if(!Array.isArray(t))return u(i,null,null!=n[t]);for(let e=0;e<t.length;e++)if(null==n[t[e]])return u(i,null,!1);return u(i,null,!0)})},indexInformation:v,parallelCollectionScan:function(e,t,n){const i={parallelCollectionScan:e.collectionName,numCursors:t.numCursors};a(i,e,t);const o=t.raw;delete t.raw,p(e.s.db,i,t,(i,r)=>{if(i)return u(n,i,null);if(null==r)return u(n,new Error("no result returned for parallelCollectionScan"),null);t=Object.assign({explicitlyIgnoreSession:!0},t);const s=[];o&&(t.raw=o);for(let n=0;n<r.cursors.length;n++){const i=r.cursors[n].cursor.id,o="number"==typeof i?h.fromNumber(i):i;s.push(e.s.topology.cursor(e.namespace,o,t))}u(n,null,s)})},save:function(e,t,n,o){const r=i(Object.assign({},n),{db:e.s.db,collection:e},n);if(null!=t._id)return r.upsert=!0,y(e,{_id:t._id},t,r,o);g(e,[t],r,(e,n)=>{if(null!=o)return null==t?u(o,null,null):e?u(o,e,null):void u(o,null,n)})}}},function(e,t,n){"use strict";const i=n(5).deprecate,o=n(0).deprecateOptions,r=n(0).checkCollectionName,s=n(1).BSON.ObjectID,a=n(1).MongoError,c=n(0).normalizeHintField,l=n(0).decorateCommand,p=n(0).decorateWithCollation,u=n(0).decorateWithReadConcern,d=n(0).formattedOrderClause,h=n(1).ReadPreference,f=n(181),m=n(182),g=n(76),y=n(0).executeLegacyOperation,v=n(25),b=n(32),x=n(0).MongoDBNamespace,w=n(79),S=n(80),_=n(41).ensureIndex,T=n(41).group,E=n(41).parallelCollectionScan,O=n(10).removeDocuments,k=n(41).save,C=n(10).updateDocuments,A=n(61),I=n(114),N=n(183),M=n(115),B=n(184),R=n(185),P=n(186),L=n(81).DropCollectionOperation,D=n(116),j=n(187),z=n(188),U=n(189),q=n(190),H=n(62),F=n(191),W=n(192),$=n(193),V=n(194),K=n(195),G=n(196),Y=n(117),X=n(197),J=n(198),Q=n(199),Z=n(200),ee=n(201),te=n(118),ne=n(122),ie=n(210),oe=n(211),re=n(212),se=n(213),ae=n(214),ce=n(38),le=["ignoreUndefined"];function pe(e,t,n,i,o,a){r(i);const c=null==a||null==a.slaveOk?e.slaveOk:a.slaveOk,l=null==a||null==a.serializeFunctions?e.s.options.serializeFunctions:a.serializeFunctions,p=null==a||null==a.raw?e.s.options.raw:a.raw,u=null==a||null==a.promoteLongs?e.s.options.promoteLongs:a.promoteLongs,d=null==a||null==a.promoteValues?e.s.options.promoteValues:a.promoteValues,f=null==a||null==a.promoteBuffers?e.s.options.promoteBuffers:a.promoteBuffers,m=new x(n,i),g=a.promiseLibrary||Promise;o=null==o?s:o,this.s={pkFactory:o,db:e,topology:t,options:a,namespace:m,readPreference:h.fromOptions(a),slaveOk:c,serializeFunctions:l,raw:p,promoteLongs:u,promoteValues:d,promoteBuffers:f,internalHint:null,collectionHint:null,promiseLibrary:g,readConcern:b.fromOptions(a),writeConcern:v.fromOptions(a)}}Object.defineProperty(pe.prototype,"dbName",{enumerable:!0,get:function(){return this.s.namespace.db}}),Object.defineProperty(pe.prototype,"collectionName",{enumerable:!0,get:function(){return this.s.namespace.collection}}),Object.defineProperty(pe.prototype,"namespace",{enumerable:!0,get:function(){return this.s.namespace.toString()}}),Object.defineProperty(pe.prototype,"readConcern",{enumerable:!0,get:function(){return null==this.s.readConcern?this.s.db.readConcern:this.s.readConcern}}),Object.defineProperty(pe.prototype,"readPreference",{enumerable:!0,get:function(){return null==this.s.readPreference?this.s.db.readPreference:this.s.readPreference}}),Object.defineProperty(pe.prototype,"writeConcern",{enumerable:!0,get:function(){return null==this.s.writeConcern?this.s.db.writeConcern:this.s.writeConcern}}),Object.defineProperty(pe.prototype,"hint",{enumerable:!0,get:function(){return this.s.collectionHint},set:function(e){this.s.collectionHint=c(e)}});const ue=["maxScan","fields","snapshot","oplogReplay"];function de(e,t,n,i,o){const r=Array.prototype.slice.call(arguments,1);return o="function"==typeof r[r.length-1]?r.pop():void 0,t=r.length&&r.shift()||[],n=r.length?r.shift():null,i=r.length&&r.shift()||{},(i=Object.assign({},i)).readPreference=h.PRIMARY,ce(this.s.topology,new H(this,e,t,n,i),o)}pe.prototype.find=o({name:"collection.find",deprecatedOptions:ue,optionsIndex:1},(function(e,t,n){"object"==typeof n&&console.warn("Third parameter to `find()` must be a callback or undefined");let i=e;"function"!=typeof n&&("function"==typeof t?(n=t,t=void 0):null==t&&(n="function"==typeof i?i:void 0,i="object"==typeof i?i:void 0)),i=null==i?{}:i;const o=i;if(Buffer.isBuffer(o)){const e=o[0]|o[1]<<8|o[2]<<16|o[3]<<24;if(e!==o.length){const t=new Error("query selector raw message size does not match message header size ["+o.length+"] != ["+e+"]");throw t.name="MongoError",t}}null!=i&&"ObjectID"===i._bsontype&&(i={_id:i}),t||(t={});let r=t.projection||t.fields;r&&!Buffer.isBuffer(r)&&Array.isArray(r)&&(r=r.length?r.reduce((e,t)=>(e[t]=1,e),{}):{_id:1});let s=Object.assign({},t);for(let e in this.s.options)-1!==le.indexOf(e)&&(s[e]=this.s.options[e]);if(s.skip=t.skip?t.skip:0,s.limit=t.limit?t.limit:0,s.raw="boolean"==typeof t.raw?t.raw:this.s.raw,s.hint=null!=t.hint?c(t.hint):this.s.collectionHint,s.timeout=void 0===t.timeout?void 0:t.timeout,s.slaveOk=null!=t.slaveOk?t.slaveOk:this.s.db.slaveOk,s.readPreference=h.resolve(this,s),null==s.readPreference||"primary"===s.readPreference&&"primary"===s.readPreference.mode||(s.slaveOk=!0),null!=i&&"object"!=typeof i)throw a.create({message:"query selector must be an object",driver:!0});const f={find:this.s.namespace.toString(),limit:s.limit,skip:s.skip,query:i};"boolean"==typeof t.allowDiskUse&&(f.allowDiskUse=t.allowDiskUse),"boolean"==typeof s.awaitdata&&(s.awaitData=s.awaitdata),"boolean"==typeof s.timeout&&(s.noCursorTimeout=s.timeout),l(f,s,["session","collation"]),r&&(f.fields=r),s.db=this.s.db,s.promiseLibrary=this.s.promiseLibrary,null==s.raw&&"boolean"==typeof this.s.raw&&(s.raw=this.s.raw),null==s.promoteLongs&&"boolean"==typeof this.s.promoteLongs&&(s.promoteLongs=this.s.promoteLongs),null==s.promoteValues&&"boolean"==typeof this.s.promoteValues&&(s.promoteValues=this.s.promoteValues),null==s.promoteBuffers&&"boolean"==typeof this.s.promoteBuffers&&(s.promoteBuffers=this.s.promoteBuffers),f.sort&&(f.sort=d(f.sort)),u(f,this,t);try{p(f,this,t)}catch(e){if("function"==typeof n)return n(e,null);throw e}const m=this.s.topology.cursor(new U(this,this.s.namespace,f,s),s);if("function"!=typeof n)return m;n(null,m)})),pe.prototype.insertOne=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||{},this.s.options.ignoreUndefined&&((t=Object.assign({},t)).ignoreUndefined=this.s.options.ignoreUndefined);const i=new J(this,e,t);return ce(this.s.topology,i,n)},pe.prototype.insertMany=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=t?Object.assign({},t):{ordered:!0};const i=new X(this,e,t);return ce(this.s.topology,i,n)},pe.prototype.bulkWrite=function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{ordered:!0},!Array.isArray(e))throw a.create({message:"operations must be an array of documents",driver:!0});const i=new I(this,e,t);return ce(this.s.topology,i,n)},pe.prototype.insert=i((function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{ordered:!1},e=Array.isArray(e)?e:[e],!0===t.keepGoing&&(t.ordered=!1),this.insertMany(e,t,n)}),"collection.insert is deprecated. Use insertOne, insertMany or bulkWrite instead."),pe.prototype.updateOne=function(e,t,n,i){return"function"==typeof n&&(i=n,n={}),n=Object.assign({},n),this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined),ce(this.s.topology,new ae(this,e,t,n),i)},pe.prototype.replaceOne=function(e,t,n,i){return"function"==typeof n&&(i=n,n={}),n=Object.assign({},n),this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined),ce(this.s.topology,new oe(this,e,t,n),i)},pe.prototype.updateMany=function(e,t,n,i){return"function"==typeof n&&(i=n,n={}),n=Object.assign({},n),this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined),ce(this.s.topology,new se(this,e,t,n),i)},pe.prototype.update=i((function(e,t,n,i){return"function"==typeof n&&(i=n,n={}),n=n||{},this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined),y(this.s.topology,C,[this,e,t,n,i])}),"collection.update is deprecated. Use updateOne, updateMany, or bulkWrite instead."),pe.prototype.deleteOne=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=Object.assign({},t),this.s.options.ignoreUndefined&&((t=Object.assign({},t)).ignoreUndefined=this.s.options.ignoreUndefined);const i=new R(this,e,t);return ce(this.s.topology,i,n)},pe.prototype.removeOne=pe.prototype.deleteOne,pe.prototype.deleteMany=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=Object.assign({},t),this.s.options.ignoreUndefined&&((t=Object.assign({},t)).ignoreUndefined=this.s.options.ignoreUndefined);const i=new B(this,e,t);return ce(this.s.topology,i,n)},pe.prototype.removeMany=pe.prototype.deleteMany,pe.prototype.remove=i((function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},this.s.options.ignoreUndefined&&((t=Object.assign({},t)).ignoreUndefined=this.s.options.ignoreUndefined),y(this.s.topology,O,[this,e,t,n])}),"collection.remove is deprecated. Use deleteOne, deleteMany, or bulkWrite instead."),pe.prototype.save=i((function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},this.s.options.ignoreUndefined&&((t=Object.assign({},t)).ignoreUndefined=this.s.options.ignoreUndefined),y(this.s.topology,k,[this,e,t,n])}),"collection.save is deprecated. Use insertOne, insertMany, updateOne, or updateMany instead."),pe.prototype.findOne=o({name:"collection.find",deprecatedOptions:ue,optionsIndex:1},(function(e,t,n){"object"==typeof n&&console.warn("Third parameter to `findOne()` must be a callback or undefined"),"function"==typeof e&&(n=e,e={},t={}),"function"==typeof t&&(n=t,t={});const i=new q(this,e=e||{},t=t||{});return ce(this.s.topology,i,n)})),pe.prototype.rename=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=Object.assign({},t,{readPreference:h.PRIMARY});const i=new ne(this,e,t);return ce(this.s.topology,i,n)},pe.prototype.drop=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};const n=new L(this.s.db,this.collectionName,e);return ce(this.s.topology,n,t)},pe.prototype.options=function(e,t){"function"==typeof e&&(t=e,e={});const n=new te(this,e=e||{});return ce(this.s.topology,n,t)},pe.prototype.isCapped=function(e,t){"function"==typeof e&&(t=e,e={});const n=new Q(this,e=e||{});return ce(this.s.topology,n,t)},pe.prototype.createIndex=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||{};const i=new M(this,this.collectionName,e,t);return ce(this.s.topology,i,n)},pe.prototype.createIndexes=function(e,t,n){"function"==typeof t&&(n=t,t={}),"number"!=typeof(t=t?Object.assign({},t):{}).maxTimeMS&&delete t.maxTimeMS;const i=new M(this,this.collectionName,e,t);return ce(this.s.topology,i,n)},pe.prototype.dropIndex=function(e,t,n){const i=Array.prototype.slice.call(arguments,1);n="function"==typeof i[i.length-1]?i.pop():void 0,(t=i.length&&i.shift()||{}).readPreference=h.PRIMARY;const o=new D(this,e,t);return ce(this.s.topology,o,n)},pe.prototype.dropIndexes=function(e,t){"function"==typeof e&&(t=e,e={}),"number"!=typeof(e=e?Object.assign({},e):{}).maxTimeMS&&delete e.maxTimeMS;const n=new j(this,e);return ce(this.s.topology,n,t)},pe.prototype.dropAllIndexes=i(pe.prototype.dropIndexes,"collection.dropAllIndexes is deprecated. Use dropIndexes instead."),pe.prototype.reIndex=i((function(e,t){"function"==typeof e&&(t=e,e={});const n=new ie(this,e=e||{});return ce(this.s.topology,n,t)}),"collection.reIndex is deprecated. Use db.command instead."),pe.prototype.listIndexes=function(e){return new S(this.s.topology,new Z(this,e),e)},pe.prototype.ensureIndex=i((function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},y(this.s.topology,_,[this,e,t,n])}),"collection.ensureIndex is deprecated. Use createIndexes instead."),pe.prototype.indexExists=function(e,t,n){"function"==typeof t&&(n=t,t={});const i=new G(this,e,t=t||{});return ce(this.s.topology,i,n)},pe.prototype.indexInformation=function(e,t){const n=Array.prototype.slice.call(arguments,0);t="function"==typeof n[n.length-1]?n.pop():void 0,e=n.length&&n.shift()||{};const i=new Y(this.s.db,this.collectionName,e);return ce(this.s.topology,i,t)},pe.prototype.count=i((function(e,t,n){const i=Array.prototype.slice.call(arguments,0);return n="function"==typeof i[i.length-1]?i.pop():void 0,e=i.length&&i.shift()||{},"function"==typeof(t=i.length&&i.shift()||{})&&(n=t,t={}),t=t||{},ce(this.s.topology,new z(this,e,t),n)}),"collection.count is deprecated, and will be removed in a future version. Use Collection.countDocuments or Collection.estimatedDocumentCount instead"),pe.prototype.estimatedDocumentCount=function(e,t){"function"==typeof e&&(t=e,e={});const n=new z(this,e=e||{});return ce(this.s.topology,n,t)},pe.prototype.countDocuments=function(e,t,n){const i=Array.prototype.slice.call(arguments,0);n="function"==typeof i[i.length-1]?i.pop():void 0,e=i.length&&i.shift()||{},t=i.length&&i.shift()||{};const o=new N(this,e,t);return ce(this.s.topology,o,n)},pe.prototype.distinct=function(e,t,n,i){const o=Array.prototype.slice.call(arguments,1);i="function"==typeof o[o.length-1]?o.pop():void 0;const r=o.length&&o.shift()||{},s=o.length&&o.shift()||{},a=new P(this,e,r,s);return ce(this.s.topology,a,i)},pe.prototype.indexes=function(e,t){"function"==typeof e&&(t=e,e={});const n=new K(this,e=e||{});return ce(this.s.topology,n,t)},pe.prototype.stats=function(e,t){const n=Array.prototype.slice.call(arguments,0);t="function"==typeof n[n.length-1]?n.pop():void 0,e=n.length&&n.shift()||{};const i=new re(this,e);return ce(this.s.topology,i,t)},pe.prototype.findOneAndDelete=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},ce(this.s.topology,new F(this,e,t),n)},pe.prototype.findOneAndReplace=function(e,t,n,i){return"function"==typeof n&&(i=n,n={}),n=n||{},ce(this.s.topology,new W(this,e,t,n),i)},pe.prototype.findOneAndUpdate=function(e,t,n,i){return"function"==typeof n&&(i=n,n={}),n=n||{},ce(this.s.topology,new $(this,e,t,n),i)},pe.prototype.findAndModify=i(de,"collection.findAndModify is deprecated. Use findOneAndUpdate, findOneAndReplace or findOneAndDelete instead."),pe.prototype._findAndModify=de,pe.prototype.findAndRemove=i((function(e,t,n,i){const o=Array.prototype.slice.call(arguments,1);return i="function"==typeof o[o.length-1]?o.pop():void 0,t=o.length&&o.shift()||[],(n=o.length&&o.shift()||{}).remove=!0,ce(this.s.topology,new H(this,e,t,null,n),i)}),"collection.findAndRemove is deprecated. Use findOneAndDelete instead."),pe.prototype.aggregate=function(e,t,n){if(Array.isArray(e))"function"==typeof t&&(n=t,t={}),null==t&&null==n&&(t={});else{const i=Array.prototype.slice.call(arguments,0);n=i.pop();const o=i[i.length-1];t=o&&(o.readPreference||o.explain||o.cursor||o.out||o.maxTimeMS||o.hint||o.allowDiskUse)?i.pop():{},e=i}const i=new w(this.s.topology,new A(this,e,t),t);if("function"!=typeof n)return i;n(null,i)},pe.prototype.watch=function(e,t){return e=e||[],t=t||{},Array.isArray(e)||(t=e,e=[]),new g(this,e,t)},pe.prototype.parallelCollectionScan=i((function(e,t){return"function"==typeof e&&(t=e,e={numCursors:1}),e.numCursors=e.numCursors||1,e.batchSize=e.batchSize||1e3,(e=Object.assign({},e)).readPreference=h.resolve(this,e),e.promiseLibrary=this.s.promiseLibrary,e.session&&(e.session=void 0),y(this.s.topology,E,[this,e,t],{skipSessions:!0})}),"parallelCollectionScan is deprecated in MongoDB v4.1"),pe.prototype.geoHaystackSearch=i((function(e,t,n,i){const o=Array.prototype.slice.call(arguments,2);i="function"==typeof o[o.length-1]?o.pop():void 0,n=o.length&&o.shift()||{};const r=new V(this,e,t,n);return ce(this.s.topology,r,i)}),"geoHaystackSearch is deprecated, and will be removed in a future version."),pe.prototype.group=i((function(e,t,n,i,o,r,s,a){const c=Array.prototype.slice.call(arguments,3);return a="function"==typeof c[c.length-1]?c.pop():void 0,i=c.length?c.shift():null,o=c.length?c.shift():null,r=c.length?c.shift():null,s=c.length&&c.shift()||{},"function"!=typeof o&&(r=o,o=null),!Array.isArray(e)&&e instanceof Object&&"function"!=typeof e&&"Code"!==e._bsontype&&(e=Object.keys(e)),"function"==typeof i&&(i=i.toString()),"function"==typeof o&&(o=o.toString()),r=null==r||r,y(this.s.topology,T,[this,e,t,n,i,o,r,s,a])}),"MongoDB 3.6 or higher no longer supports the group command. We recommend rewriting using the aggregation framework."),pe.prototype.mapReduce=function(e,t,n,i){if("function"==typeof n&&(i=n,n={}),null==n.out)throw new Error("the out option parameter must be defined, see mongodb docs for possible values");"function"==typeof e&&(e=e.toString()),"function"==typeof t&&(t=t.toString()),"function"==typeof n.finalize&&(n.finalize=n.finalize.toString());const o=new ee(this,e,t,n);return ce(this.s.topology,o,i)},pe.prototype.initializeUnorderedBulkOp=function(e){return null==(e=e||{}).ignoreUndefined&&(e.ignoreUndefined=this.s.options.ignoreUndefined),e.promiseLibrary=this.s.promiseLibrary,f(this.s.topology,this,e)},pe.prototype.initializeOrderedBulkOp=function(e){return null==(e=e||{}).ignoreUndefined&&(e.ignoreUndefined=this.s.options.ignoreUndefined),e.promiseLibrary=this.s.promiseLibrary,m(this.s.topology,this,e)},pe.prototype.getLogger=function(){return this.s.db.s.logger},e.exports=pe},function(e,t){var n=function(e){return e&&e.Math==Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof global&&global)||function(){return this}()||Function("return this")()},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("dns")},function(e,t){function n(e){if(!(this instanceof n))return new n(e);this._bsontype="Double",this.value=e}n.prototype.valueOf=function(){return this.value},n.prototype.toJSON=function(){return this.value},e.exports=n,e.exports.Double=n},function(e,t){function n(e,t){if(!(this instanceof n))return new n(e,t);this._bsontype="Timestamp",this.low_=0|e,this.high_=0|t}n.prototype.toInt=function(){return this.low_},n.prototype.toNumber=function(){return this.high_*n.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},n.prototype.toJSON=function(){return this.toString()},n.prototype.toString=function(e){var t=e||10;if(t<2||36<t)throw Error("radix out of range: "+t);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(n.MIN_VALUE)){var i=n.fromNumber(t),o=this.div(i),r=o.multiply(i).subtract(this);return o.toString(t)+r.toInt().toString(t)}return"-"+this.negate().toString(t)}var s=n.fromNumber(Math.pow(t,6));r=this;for(var a="";!r.isZero();){var c=r.div(s),l=r.subtract(c.multiply(s)).toInt().toString(t);if((r=c).isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},n.prototype.getHighBits=function(){return this.high_},n.prototype.getLowBits=function(){return this.low_},n.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:n.TWO_PWR_32_DBL_+this.low_},n.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(n.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=0!==this.high_?this.high_:this.low_,t=31;t>0&&0==(e&1<<t);t--);return 0!==this.high_?t+33:t+1},n.prototype.isZero=function(){return 0===this.high_&&0===this.low_},n.prototype.isNegative=function(){return this.high_<0},n.prototype.isOdd=function(){return 1==(1&this.low_)},n.prototype.equals=function(e){return this.high_===e.high_&&this.low_===e.low_},n.prototype.notEquals=function(e){return this.high_!==e.high_||this.low_!==e.low_},n.prototype.lessThan=function(e){return this.compare(e)<0},n.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},n.prototype.greaterThan=function(e){return this.compare(e)>0},n.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0},n.prototype.compare=function(e){if(this.equals(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.subtract(e).isNegative()?-1:1},n.prototype.negate=function(){return this.equals(n.MIN_VALUE)?n.MIN_VALUE:this.not().add(n.ONE)},n.prototype.add=function(e){var t=this.high_>>>16,i=65535&this.high_,o=this.low_>>>16,r=65535&this.low_,s=e.high_>>>16,a=65535&e.high_,c=e.low_>>>16,l=0,p=0,u=0,d=0;return u+=(d+=r+(65535&e.low_))>>>16,d&=65535,p+=(u+=o+c)>>>16,u&=65535,l+=(p+=i+a)>>>16,p&=65535,l+=t+s,l&=65535,n.fromBits(u<<16|d,l<<16|p)},n.prototype.subtract=function(e){return this.add(e.negate())},n.prototype.multiply=function(e){if(this.isZero())return n.ZERO;if(e.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE))return e.isOdd()?n.MIN_VALUE:n.ZERO;if(e.equals(n.MIN_VALUE))return this.isOdd()?n.MIN_VALUE:n.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(n.TWO_PWR_24_)&&e.lessThan(n.TWO_PWR_24_))return n.fromNumber(this.toNumber()*e.toNumber());var t=this.high_>>>16,i=65535&this.high_,o=this.low_>>>16,r=65535&this.low_,s=e.high_>>>16,a=65535&e.high_,c=e.low_>>>16,l=65535&e.low_,p=0,u=0,d=0,h=0;return d+=(h+=r*l)>>>16,h&=65535,u+=(d+=o*l)>>>16,d&=65535,u+=(d+=r*c)>>>16,d&=65535,p+=(u+=i*l)>>>16,u&=65535,p+=(u+=o*c)>>>16,u&=65535,p+=(u+=r*a)>>>16,u&=65535,p+=t*l+i*c+o*a+r*s,p&=65535,n.fromBits(d<<16|h,p<<16|u)},n.prototype.div=function(e){if(e.isZero())throw Error("division by zero");if(this.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE)){if(e.equals(n.ONE)||e.equals(n.NEG_ONE))return n.MIN_VALUE;if(e.equals(n.MIN_VALUE))return n.ONE;var t=this.shiftRight(1).div(e).shiftLeft(1);if(t.equals(n.ZERO))return e.isNegative()?n.ONE:n.NEG_ONE;var i=this.subtract(e.multiply(t));return t.add(i.div(e))}if(e.equals(n.MIN_VALUE))return n.ZERO;if(this.isNegative())return e.isNegative()?this.negate().div(e.negate()):this.negate().div(e).negate();if(e.isNegative())return this.div(e.negate()).negate();var o=n.ZERO;for(i=this;i.greaterThanOrEqual(e);){t=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var r=Math.ceil(Math.log(t)/Math.LN2),s=r<=48?1:Math.pow(2,r-48),a=n.fromNumber(t),c=a.multiply(e);c.isNegative()||c.greaterThan(i);)t-=s,c=(a=n.fromNumber(t)).multiply(e);a.isZero()&&(a=n.ONE),o=o.add(a),i=i.subtract(c)}return o},n.prototype.modulo=function(e){return this.subtract(this.div(e).multiply(e))},n.prototype.not=function(){return n.fromBits(~this.low_,~this.high_)},n.prototype.and=function(e){return n.fromBits(this.low_&e.low_,this.high_&e.high_)},n.prototype.or=function(e){return n.fromBits(this.low_|e.low_,this.high_|e.high_)},n.prototype.xor=function(e){return n.fromBits(this.low_^e.low_,this.high_^e.high_)},n.prototype.shiftLeft=function(e){if(0===(e&=63))return this;var t=this.low_;if(e<32){var i=this.high_;return n.fromBits(t<<e,i<<e|t>>>32-e)}return n.fromBits(0,t<<e-32)},n.prototype.shiftRight=function(e){if(0===(e&=63))return this;var t=this.high_;if(e<32){var i=this.low_;return n.fromBits(i>>>e|t<<32-e,t>>e)}return n.fromBits(t>>e-32,t>=0?0:-1)},n.prototype.shiftRightUnsigned=function(e){if(0===(e&=63))return this;var t=this.high_;if(e<32){var i=this.low_;return n.fromBits(i>>>e|t<<32-e,t>>>e)}return 32===e?n.fromBits(t,0):n.fromBits(t>>>e-32,0)},n.fromInt=function(e){if(-128<=e&&e<128){var t=n.INT_CACHE_[e];if(t)return t}var i=new n(0|e,e<0?-1:0);return-128<=e&&e<128&&(n.INT_CACHE_[e]=i),i},n.fromNumber=function(e){return isNaN(e)||!isFinite(e)?n.ZERO:e<=-n.TWO_PWR_63_DBL_?n.MIN_VALUE:e+1>=n.TWO_PWR_63_DBL_?n.MAX_VALUE:e<0?n.fromNumber(-e).negate():new n(e%n.TWO_PWR_32_DBL_|0,e/n.TWO_PWR_32_DBL_|0)},n.fromBits=function(e,t){return new n(e,t)},n.fromString=function(e,t){if(0===e.length)throw Error("number format error: empty string");var i=t||10;if(i<2||36<i)throw Error("radix out of range: "+i);if("-"===e.charAt(0))return n.fromString(e.substring(1),i).negate();if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+e);for(var o=n.fromNumber(Math.pow(i,8)),r=n.ZERO,s=0;s<e.length;s+=8){var a=Math.min(8,e.length-s),c=parseInt(e.substring(s,s+a),i);if(a<8){var l=n.fromNumber(Math.pow(i,a));r=r.multiply(l).add(n.fromNumber(c))}else r=(r=r.multiply(o)).add(n.fromNumber(c))}return r},n.INT_CACHE_={},n.TWO_PWR_16_DBL_=65536,n.TWO_PWR_24_DBL_=1<<24,n.TWO_PWR_32_DBL_=n.TWO_PWR_16_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_31_DBL_=n.TWO_PWR_32_DBL_/2,n.TWO_PWR_48_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_64_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_32_DBL_,n.TWO_PWR_63_DBL_=n.TWO_PWR_64_DBL_/2,n.ZERO=n.fromInt(0),n.ONE=n.fromInt(1),n.NEG_ONE=n.fromInt(-1),n.MAX_VALUE=n.fromBits(-1,2147483647),n.MIN_VALUE=n.fromBits(0,-2147483648),n.TWO_PWR_24_=n.fromInt(1<<24),e.exports=n,e.exports.Timestamp=n},function(e,t,n){var i="inspect",o=n(24),r=parseInt(16777215*Math.random(),10),s=new RegExp("^[0-9a-fA-F]{24}$");try{if(Buffer&&Buffer.from){var a=!0;i=n(5).inspect.custom||"inspect"}}catch(e){a=!1}for(var c=function e(t){if(t instanceof e)return t;if(!(this instanceof e))return new e(t);if(this._bsontype="ObjectID",null==t||"number"==typeof t)return this.id=this.generate(t),void(e.cacheHexString&&(this.__id=this.toString("hex")));var n=e.isValid(t);if(!n&&null!=t)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(n&&"string"==typeof t&&24===t.length&&a)return new e(o.toBuffer(t,"hex"));if(n&&"string"==typeof t&&24===t.length)return e.createFromHexString(t);if(null==t||12!==t.length){if(null!=t&&"function"==typeof t.toHexString)return t;throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}this.id=t,e.cacheHexString&&(this.__id=this.toString("hex"))},l=[],p=0;p<256;p++)l[p]=(p<=15?"0":"")+p.toString(16);c.prototype.toHexString=function(){if(c.cacheHexString&&this.__id)return this.__id;var e="";if(!this.id||!this.id.length)throw new Error("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]");if(this.id instanceof d)return e=h(this.id),c.cacheHexString&&(this.__id=e),e;for(var t=0;t<this.id.length;t++)e+=l[this.id.charCodeAt(t)];return c.cacheHexString&&(this.__id=e),e},c.prototype.get_inc=function(){return c.index=(c.index+1)%16777215},c.prototype.getInc=function(){return this.get_inc()},c.prototype.generate=function(e){"number"!=typeof e&&(e=~~(Date.now()/1e3));var t=("undefined"==typeof process||1===process.pid?Math.floor(1e5*Math.random()):process.pid)%65535,n=this.get_inc(),i=o.allocBuffer(12);return i[3]=255&e,i[2]=e>>8&255,i[1]=e>>16&255,i[0]=e>>24&255,i[6]=255&r,i[5]=r>>8&255,i[4]=r>>16&255,i[8]=255&t,i[7]=t>>8&255,i[11]=255&n,i[10]=n>>8&255,i[9]=n>>16&255,i},c.prototype.toString=function(e){return this.id&&this.id.copy?this.id.toString("string"==typeof e?e:"hex"):this.toHexString()},c.prototype[i]=c.prototype.toString,c.prototype.toJSON=function(){return this.toHexString()},c.prototype.equals=function(e){return e instanceof c?this.toString()===e.toString():"string"==typeof e&&c.isValid(e)&&12===e.length&&this.id instanceof d?e===this.id.toString("binary"):"string"==typeof e&&c.isValid(e)&&24===e.length?e.toLowerCase()===this.toHexString():"string"==typeof e&&c.isValid(e)&&12===e.length?e===this.id:!(null==e||!(e instanceof c||e.toHexString))&&e.toHexString()===this.toHexString()},c.prototype.getTimestamp=function(){var e=new Date,t=this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24;return e.setTime(1e3*Math.floor(t)),e},c.index=~~(16777215*Math.random()),c.createPk=function(){return new c},c.createFromTime=function(e){var t=o.toBuffer([0,0,0,0,0,0,0,0,0,0,0,0]);return t[3]=255&e,t[2]=e>>8&255,t[1]=e>>16&255,t[0]=e>>24&255,new c(t)};var u=[];for(p=0;p<10;)u[48+p]=p++;for(;p<16;)u[55+p]=u[87+p]=p++;var d=Buffer,h=function(e){return e.toString("hex")};c.createFromHexString=function(e){if(void 0===e||null!=e&&24!==e.length)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(a)return new c(o.toBuffer(e,"hex"));for(var t=new d(12),n=0,i=0;i<24;)t[n++]=u[e.charCodeAt(i++)]<<4|u[e.charCodeAt(i++)];return new c(t)},c.isValid=function(e){return null!=e&&("number"==typeof e||("string"==typeof e?12===e.length||24===e.length&&s.test(e):e instanceof c||(e instanceof d||"function"==typeof e.toHexString&&(e.id instanceof d||"string"==typeof e.id)&&(12===e.id.length||24===e.id.length&&s.test(e.id)))))},Object.defineProperty(c.prototype,"generationTime",{enumerable:!0,get:function(){return this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24},set:function(e){this.id[3]=255&e,this.id[2]=e>>8&255,this.id[1]=e>>16&255,this.id[0]=e>>24&255}}),e.exports=c,e.exports.ObjectID=c,e.exports.ObjectId=c},function(e,t){function n(e,t){if(!(this instanceof n))return new n;this._bsontype="BSONRegExp",this.pattern=e||"",this.options=t||"";for(var i=0;i<this.options.length;i++)if("i"!==this.options[i]&&"m"!==this.options[i]&&"x"!==this.options[i]&&"l"!==this.options[i]&&"s"!==this.options[i]&&"u"!==this.options[i])throw new Error("the regular expression options ["+this.options[i]+"] is not supported")}e.exports=n,e.exports.BSONRegExp=n},function(e,t,n){var i=Buffer&&n(5).inspect.custom||"inspect";function o(e){if(!(this instanceof o))return new o(e);this._bsontype="Symbol",this.value=e}o.prototype.valueOf=function(){return this.value},o.prototype.toString=function(){return this.value},o.prototype[i]=function(){return this.value},o.prototype.toJSON=function(){return this.value},e.exports=o,e.exports.Symbol=o},function(e,t){var n=function e(t,n){if(!(this instanceof e))return new e(t,n);this._bsontype="Code",this.code=t,this.scope=n};n.prototype.toJSON=function(){return{scope:this.scope,code:this.code}},e.exports=n,e.exports.Code=n},function(e,t,n){"use strict";var i=n(29),o=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,r=/^(\+|-)?(Infinity|inf)$/i,s=/^(\+|-)?NaN$/i,a=6176,c=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),l=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),p=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),u=/^([-+])?(\d+)?$/,d=n(24),h=function(e){return!isNaN(parseInt(e,10))},f=function(e){var t=i.fromNumber(1e9),n=i.fromNumber(0),o=0;if(!(e.parts[0]||e.parts[1]||e.parts[2]||e.parts[3]))return{quotient:e,rem:n};for(o=0;o<=3;o++)n=(n=n.shiftLeft(32)).add(new i(e.parts[o],0)),e.parts[o]=n.div(t).low_,n=n.modulo(t);return{quotient:e,rem:n}},m=function(e){this._bsontype="Decimal128",this.bytes=e};m.fromString=function(e){var t,n=!1,f=!1,g=!1,y=0,v=0,b=0,x=0,w=0,S=[0],_=0,T=0,E=0,O=0,k=0,C=0,A=[0,0],I=[0,0],N=0;if((e=e.trim()).length>=7e3)throw new Error(e+" not a valid Decimal128 string");var M=e.match(o),B=e.match(r),R=e.match(s);if(!M&&!B&&!R||0===e.length)throw new Error(e+" not a valid Decimal128 string");if(M&&M[4]&&void 0===M[2])throw new Error(e+" not a valid Decimal128 string");if("+"!==e[N]&&"-"!==e[N]||(n="-"===e[N++]),!h(e[N])&&"."!==e[N]){if("i"===e[N]||"I"===e[N])return new m(d.toBuffer(n?l:p));if("N"===e[N])return new m(d.toBuffer(c))}for(;h(e[N])||"."===e[N];)if("."!==e[N])_<34&&("0"!==e[N]||g)&&(g||(w=v),g=!0,S[T++]=parseInt(e[N],10),_+=1),g&&(b+=1),f&&(x+=1),v+=1,N+=1;else{if(f)return new m(d.toBuffer(c));f=!0,N+=1}if(f&&!v)throw new Error(e+" not a valid Decimal128 string");if("e"===e[N]||"E"===e[N]){var P=e.substr(++N).match(u);if(!P||!P[2])return new m(d.toBuffer(c));k=parseInt(P[0],10),N+=P[0].length}if(e[N])return new m(d.toBuffer(c));if(E=0,_){if(O=_-1,y=b,0!==k&&1!==y)for(;"0"===e[w+y-1];)y-=1}else E=0,O=0,S[0]=0,b=1,_=1,y=0;for(k<=x&&x-k>16384?k=-6176:k-=x;k>6111;){if((O+=1)-E>34){var L=S.join("");if(L.match(/^0+$/)){k=6111;break}return new m(d.toBuffer(n?l:p))}k-=1}for(;k<-6176||_<b;){if(0===O){k=-6176,y=0;break}if(_<b?b-=1:O-=1,!(k<6111)){if((L=S.join("")).match(/^0+$/)){k=6111;break}return new m(d.toBuffer(n?l:p))}k+=1}if(O-E+1<y&&"0"!==e[y]){var D=v;f&&-6176===k&&(w+=1,D+=1);var j=parseInt(e[w+O+1],10),z=0;if(j>=5&&(z=1,5===j))for(z=S[O]%2==1,C=w+O+2;C<D;C++)if(parseInt(e[C],10)){z=1;break}if(z)for(var U=O;U>=0&&++S[U]>9;U--)if(S[U]=0,0===U){if(!(k<6111))return new m(d.toBuffer(n?l:p));k+=1,S[U]=1}}if(A=i.fromNumber(0),I=i.fromNumber(0),0===y)A=i.fromNumber(0),I=i.fromNumber(0);else if(O-E<17)for(U=E,I=i.fromNumber(S[U++]),A=new i(0,0);U<=O;U++)I=(I=I.multiply(i.fromNumber(10))).add(i.fromNumber(S[U]));else{for(U=E,A=i.fromNumber(S[U++]);U<=O-17;U++)A=(A=A.multiply(i.fromNumber(10))).add(i.fromNumber(S[U]));for(I=i.fromNumber(S[U++]);U<=O;U++)I=(I=I.multiply(i.fromNumber(10))).add(i.fromNumber(S[U]))}var q,H,F,W,$=function(e,t){if(!e&&!t)return{high:i.fromNumber(0),low:i.fromNumber(0)};var n=e.shiftRightUnsigned(32),o=new i(e.getLowBits(),0),r=t.shiftRightUnsigned(32),s=new i(t.getLowBits(),0),a=n.multiply(r),c=n.multiply(s),l=o.multiply(r),p=o.multiply(s);return a=a.add(c.shiftRightUnsigned(32)),c=new i(c.getLowBits(),0).add(l).add(p.shiftRightUnsigned(32)),{high:a=a.add(c.shiftRightUnsigned(32)),low:p=c.shiftLeft(32).add(new i(p.getLowBits(),0))}}(A,i.fromString("100000000000000000"));$.low=$.low.add(I),q=$.low,H=I,F=q.high_>>>0,W=H.high_>>>0,(F<W||F===W&&q.low_>>>0<H.low_>>>0)&&($.high=$.high.add(i.fromNumber(1))),t=k+a;var V={low:i.fromNumber(0),high:i.fromNumber(0)};$.high.shiftRightUnsigned(49).and(i.fromNumber(1)).equals(i.fromNumber)?(V.high=V.high.or(i.fromNumber(3).shiftLeft(61)),V.high=V.high.or(i.fromNumber(t).and(i.fromNumber(16383).shiftLeft(47))),V.high=V.high.or($.high.and(i.fromNumber(0x7fffffffffff)))):(V.high=V.high.or(i.fromNumber(16383&t).shiftLeft(49)),V.high=V.high.or($.high.and(i.fromNumber(562949953421311)))),V.low=$.low,n&&(V.high=V.high.or(i.fromString("9223372036854775808")));var K=d.allocBuffer(16);return N=0,K[N++]=255&V.low.low_,K[N++]=V.low.low_>>8&255,K[N++]=V.low.low_>>16&255,K[N++]=V.low.low_>>24&255,K[N++]=255&V.low.high_,K[N++]=V.low.high_>>8&255,K[N++]=V.low.high_>>16&255,K[N++]=V.low.high_>>24&255,K[N++]=255&V.high.low_,K[N++]=V.high.low_>>8&255,K[N++]=V.high.low_>>16&255,K[N++]=V.high.low_>>24&255,K[N++]=255&V.high.high_,K[N++]=V.high.high_>>8&255,K[N++]=V.high.high_>>16&255,K[N++]=V.high.high_>>24&255,new m(K)};a=6176,m.prototype.toString=function(){for(var e,t,n,o,r,s,c=0,l=new Array(36),p=0;p<l.length;p++)l[p]=0;var u,d,h,m,g,y=0,v=!1,b={parts:new Array(4)},x=[];y=0;var w=this.bytes;if(o=w[y++]|w[y++]<<8|w[y++]<<16|w[y++]<<24,n=w[y++]|w[y++]<<8|w[y++]<<16|w[y++]<<24,t=w[y++]|w[y++]<<8|w[y++]<<16|w[y++]<<24,e=w[y++]|w[y++]<<8|w[y++]<<16|w[y++]<<24,y=0,{low:new i(o,n),high:new i(t,e)}.high.lessThan(i.ZERO)&&x.push("-"),(r=e>>26&31)>>3==3){if(30===r)return x.join("")+"Infinity";if(31===r)return"NaN";s=e>>15&16383,h=8+(e>>14&1)}else h=e>>14&7,s=e>>17&16383;if(u=s-a,b.parts[0]=(16383&e)+((15&h)<<14),b.parts[1]=t,b.parts[2]=n,b.parts[3]=o,0===b.parts[0]&&0===b.parts[1]&&0===b.parts[2]&&0===b.parts[3])v=!0;else for(g=3;g>=0;g--){var S=0,_=f(b);if(b=_.quotient,S=_.rem.low_)for(m=8;m>=0;m--)l[9*g+m]=S%10,S=Math.floor(S/10)}if(v)c=1,l[y]=0;else for(c=36,p=0;!l[y];)p++,c-=1,y+=1;if((d=c-1+u)>=34||d<=-7||u>0){for(x.push(l[y++]),(c-=1)&&x.push("."),p=0;p<c;p++)x.push(l[y++]);x.push("E"),d>0?x.push("+"+d):x.push(d)}else if(u>=0)for(p=0;p<c;p++)x.push(l[y++]);else{var T=c+u;if(T>0)for(p=0;p<T;p++)x.push(l[y++]);else x.push("0");for(x.push(".");T++<0;)x.push("0");for(p=0;p<c-Math.max(T-1,0);p++)x.push(l[y++])}return x.join("")},m.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},e.exports=m,e.exports.Decimal128=m},function(e,t){function n(){if(!(this instanceof n))return new n;this._bsontype="MinKey"}e.exports=n,e.exports.MinKey=n},function(e,t){function n(){if(!(this instanceof n))return new n;this._bsontype="MaxKey"}e.exports=n,e.exports.MaxKey=n},function(e,t){function n(e,t,i){if(!(this instanceof n))return new n(e,t,i);this._bsontype="DBRef",this.namespace=e,this.oid=t,this.db=i}n.prototype.toJSON=function(){return{$ref:this.namespace,$id:this.oid,$db:null==this.db?"":this.db}},e.exports=n,e.exports.DBRef=n},function(e,t,n){"use strict";const i=n(17),o=n(19).Buffer,r=n(9).retrieveBSON,s=n(2).MongoError,a=n(26).AuthProvider,c=r().Binary;let l;try{l=n(147)}catch(e){}class p extends a{constructor(e,t){super(e),this.cryptoMethod=t||"sha1"}prepare(e,t,n){const o=this.cryptoMethod;"sha256"===o&&null==l&&console.warn("Warning: no saslprep library specified. Passwords will not be sanitized"),i.randomBytes(24,(i,r)=>{if(i)return n(i);Object.assign(t,{nonce:r});const s=t.credentials,a=Object.assign({},e,{speculativeAuthenticate:Object.assign(h(o,s,r),{db:s.source})});n(void 0,a)})}auth(e,t){const n=e.response;n&&n.speculativeAuthenticate?f(this.cryptoMethod,n.speculativeAuthenticate,e,t):function(e,t,n){const i=t.connection,o=t.credentials,r=t.nonce,s=o.source,a=h(e,o,r);i.command(s+".$cmd",a,(i,o)=>{const r=x(i,o);if(r)return n(r);f(e,o.result,t,n)})}(this.cryptoMethod,e,t)}}function u(e){return e.replace("=","=3D").replace(",","=2C")}function d(e,t){return o.concat([o.from("n=","utf8"),o.from(e,"utf8"),o.from(",r=","utf8"),o.from(t.toString("base64"),"utf8")])}function h(e,t,n){const i=u(t.username);return{saslStart:1,mechanism:"sha1"===e?"SCRAM-SHA-1":"SCRAM-SHA-256",payload:new c(o.concat([o.from("n,,","utf8"),d(i,n)])),autoAuthorize:1,options:{skipEmptyExchange:!0}}}function f(e,t,n,r){const a=n.connection,p=n.credentials,h=n.nonce,f=p.source,w=u(p.username),S=p.password;let _;if("sha256"===e)_=l?l(S):S;else try{_=function(e,t){if("string"!=typeof e)throw new s("username must be a string");if("string"!=typeof t)throw new s("password must be a string");if(0===t.length)throw new s("password cannot be empty");const n=i.createHash("md5");return n.update(`${e}:mongo:${t}`,"utf8"),n.digest("hex")}(w,S)}catch(e){return r(e)}const T=o.isBuffer(t.payload)?new c(t.payload):t.payload,E=m(T.value()),O=parseInt(E.i,10);if(O&&O<4096)return void r(new s("Server returned an invalid iteration count "+O),!1);const k=E.s,C=E.r;if(C.startsWith("nonce"))return void r(new s("Server returned an invalid nonce: "+C),!1);const A="c=biws,r="+C,I=function(e,t,n,o){const r=[e,t.toString("base64"),n].join("_");if(void 0!==y[r])return y[r];const s=i.pbkdf2Sync(e,t,n,b[o],o);v>=200&&(y={},v=0);return y[r]=s,v+=1,s}(_,o.from(k,"base64"),O,e),N=g(e,I,"Client Key"),M=g(e,I,"Server Key"),B=(R=e,P=N,i.createHash(R).update(P).digest());var R,P;const L=[d(w,h),T.value().toString("base64"),A].join(","),D=[A,"p="+function(e,t){o.isBuffer(e)||(e=o.from(e));o.isBuffer(t)||(t=o.from(t));const n=Math.max(e.length,t.length),i=[];for(let o=0;o<n;o+=1)i.push(e[o]^t[o]);return o.from(i).toString("base64")}(N,g(e,B,L))].join(","),j=g(e,M,L),z={saslContinue:1,conversationId:t.conversationId,payload:new c(o.from(D))};a.command(f+".$cmd",z,(e,t)=>{const n=x(e,t);if(n)return r(n);const c=t.result,l=m(c.payload.value());if(!function(e,t){if(e.length!==t.length)return!1;if("function"==typeof i.timingSafeEqual)return i.timingSafeEqual(e,t);let n=0;for(let i=0;i<e.length;i++)n|=e[i]^t[i];return 0===n}(o.from(l.v,"base64"),j))return void r(new s("Server returned an invalid signature"));if(!c||!1!==c.done)return r(n,c);const p={saslContinue:1,conversationId:c.conversationId,payload:o.alloc(0)};a.command(f+".$cmd",p,r)})}function m(e){const t={},n=e.split(",");for(let e=0;e<n.length;e++){const i=n[e].split("=");t[i[0]]=i[1]}return t}function g(e,t,n){return i.createHmac(e,t).update(n).digest()}let y={},v=0;const b={sha256:32,sha1:20};function x(e,t){if(e)return e;const n=t.result;return n.$err||n.errmsg?new s(n):void 0}e.exports={ScramSHA1:class extends p{constructor(e){super(e,"sha1")}},ScramSHA256:class extends p{constructor(e){super(e,"sha256")}}}},function(e,t,n){"use strict";"undefined"==typeof process||!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?e.exports={nextTick:function(e,t,n,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var o,r,s=arguments.length;switch(s){case 0:case 1:return process.nextTick(e);case 2:return process.nextTick((function(){e.call(null,t)}));case 3:return process.nextTick((function(){e.call(null,t,n)}));case 4:return process.nextTick((function(){e.call(null,t,n,i)}));default:for(o=new Array(s-1),r=0;r<o.length;)o[r++]=arguments[r];return process.nextTick((function(){e.apply(null,o)}))}}}:e.exports=process},function(e,t,n){var i=n(69),o=i.Buffer;function r(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return o(e,t,n)}o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?e.exports=i:(r(i,t),t.Buffer=s),r(o,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return o(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=o(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},function(e,t,n){"use strict";class i{constructor(e){this.time=new Date,this.address=e.address}}e.exports={CMAP_EVENT_NAMES:["connectionPoolCreated","connectionPoolClosed","connectionCreated","connectionReady","connectionClosed","connectionCheckOutStarted","connectionCheckOutFailed","connectionCheckedOut","connectionCheckedIn","connectionPoolCleared"],ConnectionPoolCreatedEvent:class extends i{constructor(e){super(e),this.options=e.options}},ConnectionPoolClosedEvent:class extends i{constructor(e){super(e)}},ConnectionCreatedEvent:class extends i{constructor(e,t){super(e),this.connectionId=t.id}},ConnectionReadyEvent:class extends i{constructor(e,t){super(e),this.connectionId=t.id}},ConnectionClosedEvent:class extends i{constructor(e,t,n){super(e),this.connectionId=t.id,this.reason=n||"unknown"}},ConnectionCheckOutStartedEvent:class extends i{constructor(e){super(e)}},ConnectionCheckOutFailedEvent:class extends i{constructor(e,t){super(e),this.reason=t}},ConnectionCheckedOutEvent:class extends i{constructor(e,t){super(e),this.connectionId=t.id}},ConnectionCheckedInEvent:class extends i{constructor(e,t){super(e),this.connectionId=t.id}},ConnectionPoolClearedEvent:class extends i{constructor(e){super(e)}}}},function(e,t,n){"use strict";const i=n(76),o=n(63),r=n(8).EventEmitter,s=n(5).inherits,a=n(1).MongoError,c=n(5).deprecate,l=n(25),p=n(0).MongoDBNamespace,u=n(11),d=n(0).maybePromise,h=n(124),f=n(125).connect,m=n(125).validOptions;function g(e,t){if(!(this instanceof g))return new g(e,t);r.call(this),this.s={url:e,options:t||{},promiseLibrary:t&&t.promiseLibrary||Promise,dbCache:new Map,sessions:new Set,writeConcern:l.fromOptions(t),readPreference:u.fromOptions(t)||u.primary,namespace:new p("admin")}}s(g,r),Object.defineProperty(g.prototype,"writeConcern",{enumerable:!0,get:function(){return this.s.writeConcern}}),Object.defineProperty(g.prototype,"readPreference",{enumerable:!0,get:function(){return this.s.readPreference}}),g.prototype.connect=function(e){if("string"==typeof e)throw new TypeError("`connect` only accepts a callback");const t=this;return d(this,e,e=>{const n=m(t.s.options);if(n)return e(n);f(t,t.s.url,t.s.options,n=>{if(n)return e(n);e(null,t)})})},g.prototype.logout=c((function(e,t){"function"==typeof e&&(t=e,e={}),"function"==typeof t&&t(null,!0)}),"Multiple authentication is prohibited on a connected client, please only authenticate once per MongoClient"),g.prototype.close=function(e,t){"function"==typeof e&&(t=e,e=!1);const n=this;return d(this,t,t=>{const i=e=>{if(n.emit("close",n),!(n.topology instanceof h))for(const e of n.s.dbCache)e[1].emit("close",n);n.removeAllListeners("close"),t(e)};null!=n.topology?n.topology.close(e,t=>{const o=n.topology.s.options.autoEncrypter;o?o.teardown(e,e=>i(t||e)):i(t)}):i()})},g.prototype.db=function(e,t){t=t||{},e||(e=this.s.options.dbName);const n=Object.assign({},this.s.options,t);if(this.s.dbCache.has(e)&&!0!==n.returnNonCachedInstance)return this.s.dbCache.get(e);if(n.promiseLibrary=this.s.promiseLibrary,!this.topology)throw new a("MongoClient must be connected before calling MongoClient.prototype.db");const i=new o(e,this.topology,n);return this.s.dbCache.set(e,i),i},g.prototype.isConnected=function(e){return e=e||{},!!this.topology&&this.topology.isConnected(e)},g.connect=function(e,t,n){const i=Array.prototype.slice.call(arguments,1);n="function"==typeof i[i.length-1]?i.pop():void 0;const o=new g(e,t=(t=i.length?i.shift():null)||{});return o.connect(n)},g.prototype.startSession=function(e){if(e=Object.assign({explicit:!0},e),!this.topology)throw new a("Must connect to a server before calling this method");if(!this.topology.hasSessionSupport())throw new a("Current topology does not support sessions");return this.topology.startSession(e,this.s.options)},g.prototype.withSession=function(e,t){"function"==typeof e&&(t=e,e=void 0);const n=this.startSession(e);let i=(e,t,o)=>{if(i=()=>{throw new ReferenceError("cleanupHandler was called too many times")},o=Object.assign({throw:!0},o),n.endSession(),e){if(o.throw)throw e;return Promise.reject(e)}};try{const e=t(n);return Promise.resolve(e).then(e=>i(null,e)).catch(e=>i(e,null,{throw:!0}))}catch(e){return i(e,null,{throw:!1})}},g.prototype.watch=function(e,t){return e=e||[],t=t||{},Array.isArray(e)||(t=e,e=[]),new i(this,e,t)},g.prototype.getLogger=function(){return this.s.options.logger},e.exports=g},function(e,t,n){"use strict";const i=n(22),o=n(1).MongoError,r=n(4).maxWireVersion,s=n(1).ReadPreference,a=n(3).Aspect,c=n(3).defineAspects;class l extends i{constructor(e,t,n){if(super(e,n,{fullResponse:!0}),this.target=e.s.namespace&&e.s.namespace.collection?e.s.namespace.collection:1,this.pipeline=t,this.hasWriteStage=!1,"string"==typeof n.out)this.pipeline=this.pipeline.concat({$out:n.out}),this.hasWriteStage=!0;else if(t.length>0){const e=t[t.length-1];(e.$out||e.$merge)&&(this.hasWriteStage=!0)}if(this.hasWriteStage&&(this.readPreference=s.primary),n.explain&&(this.readConcern||this.writeConcern))throw new o('"explain" cannot be used on an aggregate call with readConcern/writeConcern');if(null!=n.cursor&&"object"!=typeof n.cursor)throw new o("cursor options must be an object")}get canRetryRead(){return!this.hasWriteStage}addToPipeline(e){this.pipeline.push(e)}execute(e,t){const n=this.options,i=r(e),o={aggregate:this.target,pipeline:this.pipeline};this.hasWriteStage&&i<8&&(this.readConcern=null),i>=5&&this.hasWriteStage&&this.writeConcern&&Object.assign(o,{writeConcern:this.writeConcern}),!0===n.bypassDocumentValidation&&(o.bypassDocumentValidation=n.bypassDocumentValidation),"boolean"==typeof n.allowDiskUse&&(o.allowDiskUse=n.allowDiskUse),n.hint&&(o.hint=n.hint),n.explain&&(n.full=!1,o.explain=n.explain),o.cursor=n.cursor||{},n.batchSize&&!this.hasWriteStage&&(o.cursor.batchSize=n.batchSize),super.executeCommand(e,o,t)}}c(l,[a.READ_OPERATION,a.RETRYABLE,a.EXECUTE_WITH_SELECTION]),e.exports=l},function(e,t,n){"use strict";const i=n(3).OperationBase,o=n(0).applyRetryableWrites,r=n(0).applyWriteConcern,s=n(0).decorateWithCollation,a=n(12).executeCommand,c=n(0).formattedOrderClause,l=n(0).handleCallback,p=n(1).ReadPreference,u=n(4).maxWireVersion,d=n(113).MongoError;e.exports=class extends i{constructor(e,t,n,i,o){super(o),this.collection=e,this.query=t,this.sort=n,this.doc=i}execute(e){const t=this.collection,n=this.query,i=c(this.sort),h=this.doc;let f=this.options;const m={findAndModify:t.collectionName,query:n};i&&(m.sort=i),m.new=!!f.new,m.remove=!!f.remove,m.upsert=!!f.upsert;const g=f.projection||f.fields;g&&(m.fields=g),f.arrayFilters&&(m.arrayFilters=f.arrayFilters),h&&!f.remove&&(m.update=h),f.maxTimeMS&&(m.maxTimeMS=f.maxTimeMS),f.serializeFunctions=f.serializeFunctions||t.s.serializeFunctions,f.checkKeys=!1,f=o(f,t.s.db),f=r(f,{db:t.s.db,collection:t},f),f.writeConcern&&(m.writeConcern=f.writeConcern),!0===f.bypassDocumentValidation&&(m.bypassDocumentValidation=f.bypassDocumentValidation),f.readPreference=p.primary;try{s(m,t,f)}catch(t){return e(t,null)}if(f.hint){if(f.writeConcern&&0===f.writeConcern.w||u(t.s.topology)<8)return void e(new d("The current topology does not support a hint on findAndModify commands"));m.hint=f.hint}a(t.s.db,m,f,(t,n)=>t?l(e,t,null):l(e,null,n))}}},function(e,t,n){"use strict";const i=n(8).EventEmitter,o=n(5).inherits,r=n(0).getSingleProperty,s=n(80),a=n(0).handleCallback,c=n(0).filterOptions,l=n(0).toError,p=n(1).ReadPreference,u=n(1).MongoError,d=n(1).ObjectID,h=n(1).Logger,f=n(42),m=n(0).mergeOptionsAndWriteConcern,g=n(0).executeLegacyOperation,y=n(76),v=n(5).deprecate,b=n(0).deprecateOptions,x=n(0).MongoDBNamespace,w=n(77),S=n(25),_=n(32),T=n(79),E=n(12).createListener,O=n(12).ensureIndex,k=n(12).evaluate,C=n(12).profilingInfo,A=n(12).validateDatabaseName,I=n(61),N=n(119),M=n(202),B=n(20),R=n(203),P=n(204),L=n(115),D=n(81).DropCollectionOperation,j=n(81).DropDatabaseOperation,z=n(120),U=n(117),q=n(205),H=n(206),F=n(121),W=n(122),$=n(207),V=n(38),K=["w","wtimeout","fsync","j","readPreference","readPreferenceTags","native_parser","forceServerObjectId","pkFactory","serializeFunctions","raw","bufferMaxEntries","authSource","ignoreUndefined","promoteLongs","promiseLibrary","readConcern","retryMiliSeconds","numberOfRetries","parentDb","noListener","loggerLevel","logger","promoteBuffers","promoteLongs","promoteValues","compression","retryWrites"];function G(e,t,n){if(n=n||{},!(this instanceof G))return new G(e,t,n);i.call(this);const o=n.promiseLibrary||Promise;(n=c(n,K)).promiseLibrary=o,this.s={dbCache:{},children:[],topology:t,options:n,logger:h("Db",n),bson:t?t.bson:null,readPreference:p.fromOptions(n),bufferMaxEntries:"number"==typeof n.bufferMaxEntries?n.bufferMaxEntries:-1,parentDb:n.parentDb||null,pkFactory:n.pkFactory||d,nativeParser:n.nativeParser||n.native_parser,promiseLibrary:o,noListener:"boolean"==typeof n.noListener&&n.noListener,readConcern:_.fromOptions(n),writeConcern:S.fromOptions(n),namespace:new x(e)},A(e),r(this,"serverConfig",this.s.topology),r(this,"bufferMaxEntries",this.s.bufferMaxEntries),r(this,"databaseName",this.s.namespace.db),n.parentDb||this.s.noListener||(t.on("error",E(this,"error",this)),t.on("timeout",E(this,"timeout",this)),t.on("close",E(this,"close",this)),t.on("parseError",E(this,"parseError",this)),t.once("open",E(this,"open",this)),t.once("fullsetup",E(this,"fullsetup",this)),t.once("all",E(this,"all",this)),t.on("reconnect",E(this,"reconnect",this)))}o(G,i),Object.defineProperty(G.prototype,"topology",{enumerable:!0,get:function(){return this.s.topology}}),Object.defineProperty(G.prototype,"options",{enumerable:!0,get:function(){return this.s.options}}),Object.defineProperty(G.prototype,"slaveOk",{enumerable:!0,get:function(){return null!=this.s.options.readPreference&&("primary"!==this.s.options.readPreference||"primary"!==this.s.options.readPreference.mode)}}),Object.defineProperty(G.prototype,"readConcern",{enumerable:!0,get:function(){return this.s.readConcern}}),Object.defineProperty(G.prototype,"readPreference",{enumerable:!0,get:function(){return null==this.s.readPreference?p.primary:this.s.readPreference}}),Object.defineProperty(G.prototype,"writeConcern",{enumerable:!0,get:function(){return this.s.writeConcern}}),Object.defineProperty(G.prototype,"namespace",{enumerable:!0,get:function(){return this.s.namespace.toString()}}),G.prototype.command=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=Object.assign({},t);const i=new R(this,e,t);return V(this.s.topology,i,n)},G.prototype.aggregate=function(e,t,n){"function"==typeof t&&(n=t,t={}),null==t&&null==n&&(t={});const i=new T(this.s.topology,new I(this,e,t),t);if("function"!=typeof n)return i;n(null,i)},G.prototype.admin=function(){return new(n(123))(this,this.s.topology,this.s.promiseLibrary)};const Y=["pkFactory","readPreference","serializeFunctions","strict","readConcern","ignoreUndefined","promoteValues","promoteBuffers","promoteLongs"];G.prototype.collection=function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{},(t=Object.assign({},t)).promiseLibrary=this.s.promiseLibrary,t.readConcern=t.readConcern?new _(t.readConcern.level):this.readConcern,this.s.options.ignoreUndefined&&(t.ignoreUndefined=this.s.options.ignoreUndefined),null==(t=m(t,this.s.options,Y,!0))||!t.strict)try{const i=new f(this,this.s.topology,this.databaseName,e,this.s.pkFactory,t);return n&&n(null,i),i}catch(e){if(e instanceof u&&n)return n(e);throw e}if("function"!=typeof n)throw l("A callback is required in strict mode. While getting collection "+e);if(this.serverConfig&&this.serverConfig.isDestroyed())return n(new u("topology was destroyed"));const i=Object.assign({},t,{nameOnly:!0});this.listCollections({name:e},i).toArray((i,o)=>{if(null!=i)return a(n,i,null);if(0===o.length)return a(n,l(`Collection ${e} does not exist. Currently in strict mode.`),null);try{return a(n,null,new f(this,this.s.topology,this.databaseName,e,this.s.pkFactory,t))}catch(i){return a(n,i,null)}})},G.prototype.createCollection=b({name:"Db.createCollection",deprecatedOptions:["autoIndexId","strict"],optionsIndex:1},(function(e,t,n){"function"==typeof t&&(n=t,t={}),(t=t||{}).promiseLibrary=t.promiseLibrary||this.s.promiseLibrary,t.readConcern=t.readConcern?new _(t.readConcern.level):this.readConcern;const i=new P(this,e,t);return V(this.s.topology,i,n)})),G.prototype.stats=function(e,t){"function"==typeof e&&(t=e,e={});const n={dbStats:!0};null!=(e=e||{}).scale&&(n.scale=e.scale),null==e.readPreference&&this.s.readPreference&&(e.readPreference=this.s.readPreference);const i=new B(this,e,null,n);return V(this.s.topology,i,t)},G.prototype.listCollections=function(e,t){return e=e||{},t=t||{},new s(this.s.topology,new q(this,e,t),t)},G.prototype.eval=v((function(e,t,n,i){const o=Array.prototype.slice.call(arguments,1);return i="function"==typeof o[o.length-1]?o.pop():void 0,t=o.length?o.shift():t,n=o.length&&o.shift()||{},g(this.s.topology,k,[this,e,t,n,i])}),"Db.eval is deprecated as of MongoDB version 3.2"),G.prototype.renameCollection=function(e,t,n,i){"function"==typeof n&&(i=n,n={}),(n=Object.assign({},n,{readPreference:p.PRIMARY})).new_collection=!0;const o=new W(this.collection(e),t,n);return V(this.s.topology,o,i)},G.prototype.dropCollection=function(e,t,n){"function"==typeof t&&(n=t,t={});const i=new D(this,e,t=t||{});return V(this.s.topology,i,n)},G.prototype.dropDatabase=function(e,t){"function"==typeof e&&(t=e,e={});const n=new j(this,e=e||{});return V(this.s.topology,n,t)},G.prototype.collections=function(e,t){"function"==typeof e&&(t=e,e={});const n=new M(this,e=e||{});return V(this.s.topology,n,t)},G.prototype.executeDbAdminCommand=function(e,t,n){"function"==typeof t&&(n=t,t={}),(t=t||{}).readPreference=p.resolve(this,t);const i=new z(this,e,t);return V(this.s.topology,i,n)},G.prototype.createIndex=function(e,t,n,i){"function"==typeof n&&(i=n,n={}),n=n?Object.assign({},n):{};const o=new L(this,e,t,n);return V(this.s.topology,o,i)},G.prototype.ensureIndex=v((function(e,t,n,i){return"function"==typeof n&&(i=n,n={}),n=n||{},g(this.s.topology,O,[this,e,t,n,i])}),"Db.ensureIndex is deprecated as of MongoDB version 3.0 / driver version 2.0"),G.prototype.addChild=function(e){if(this.s.parentDb)return this.s.parentDb.addChild(e);this.s.children.push(e)},G.prototype.addUser=function(e,t,n,i){"function"==typeof n&&(i=n,n={}),n=n||{},"string"==typeof e&&null!=t&&"object"==typeof t&&(n=t,t=null);const o=new N(this,e,t,n);return V(this.s.topology,o,i)},G.prototype.removeUser=function(e,t,n){"function"==typeof t&&(n=t,t={});const i=new F(this,e,t=t||{});return V(this.s.topology,i,n)},G.prototype.setProfilingLevel=function(e,t,n){"function"==typeof t&&(n=t,t={});const i=new $(this,e,t=t||{});return V(this.s.topology,i,n)},G.prototype.profilingInfo=v((function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},g(this.s.topology,C,[this,e,t])}),"Db.profilingInfo is deprecated. Query the system.profile collection directly."),G.prototype.profilingLevel=function(e,t){"function"==typeof e&&(t=e,e={});const n=new H(this,e=e||{});return V(this.s.topology,n,t)},G.prototype.indexInformation=function(e,t,n){"function"==typeof t&&(n=t,t={});const i=new U(this,e,t=t||{});return V(this.s.topology,i,n)},G.prototype.unref=function(){this.s.topology.unref()},G.prototype.watch=function(e,t){return e=e||[],t=t||{},Array.isArray(e)||(t=e,e=[]),new y(this,e,t)},G.prototype.getLogger=function(){return this.s.logger},G.SYSTEM_NAMESPACE_COLLECTION=w.SYSTEM_NAMESPACE_COLLECTION,G.SYSTEM_INDEX_COLLECTION=w.SYSTEM_INDEX_COLLECTION,G.SYSTEM_PROFILE_COLLECTION=w.SYSTEM_PROFILE_COLLECTION,G.SYSTEM_USER_COLLECTION=w.SYSTEM_USER_COLLECTION,G.SYSTEM_COMMAND_COLLECTION=w.SYSTEM_COMMAND_COLLECTION,G.SYSTEM_JS_COLLECTION=w.SYSTEM_JS_COLLECTION,e.exports=G},function(e,t,n){"use strict";const i=n(1).Server,o=n(21),r=n(28).TopologyBase,s=n(28).Store,a=n(1).MongoError,c=n(0).MAX_JS_INT,l=n(0).translateOptions,p=n(0).filterOptions,u=n(0).mergeOptions;var d=["ha","haInterval","acceptableLatencyMS","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCRL","sslCert","ciphers","ecdhCurve","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","family","loggerLevel","logger","reconnectTries","reconnectInterval","monitoring","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","compression","promiseLibrary","monitorCommands"];class h extends r{constructor(e,t,n){super();const r=(n=p(n,d)).promiseLibrary;var h={force:!1,bufferMaxEntries:"number"==typeof n.bufferMaxEntries?n.bufferMaxEntries:c},f=n.store||new s(this,h);if(-1!==e.indexOf("/"))null!=t&&"object"==typeof t&&(n=t,t=null);else if(null==t)throw a.create({message:"port must be specified",driver:!0});var m="boolean"!=typeof n.auto_reconnect||n.auto_reconnect;m="boolean"==typeof n.autoReconnect?n.autoReconnect:m;var g=u({},{host:e,port:t,disconnectHandler:f,cursorFactory:o,reconnect:m,emitError:"boolean"!=typeof n.emitError||n.emitError,size:"number"==typeof n.poolSize?n.poolSize:5,monitorCommands:"boolean"==typeof n.monitorCommands&&n.monitorCommands});g=l(g,n);var y=n.socketOptions&&Object.keys(n.socketOptions).length>0?n.socketOptions:n;g=l(g,y),this.s={coreTopology:new i(g),sCapabilities:null,clonedOptions:g,reconnect:g.reconnect,emitError:g.emitError,poolSize:g.size,storeOptions:h,store:f,host:e,port:t,options:n,sessionPool:null,sessions:new Set,promiseLibrary:r||Promise}}connect(e,t){var n=this;"function"==typeof e&&(t=e,e={}),null==e&&(e=this.s.clonedOptions),"function"!=typeof t&&(t=null),e=Object.assign({},this.s.clonedOptions,e),n.s.options=e,n.s.storeOptions.bufferMaxEntries="number"==typeof e.bufferMaxEntries?e.bufferMaxEntries:-1;var i=function(){return function(e){["timeout","error","close"].forEach((function(e){n.s.coreTopology.removeListener(e,a[e])})),n.s.coreTopology.removeListener("connect",i);try{t(e)}catch(e){process.nextTick((function(){throw e}))}}},o=function(e){return function(t){"error"!==e&&n.emit(e,t)}},r=function(){n.s.store.flush()},s=function(e){return function(t,i){n.emit(e,t,i)}},a={timeout:i("timeout"),error:i("error"),close:i("close")};["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed"].forEach((function(e){n.s.coreTopology.removeAllListeners(e)})),n.s.coreTopology.once("timeout",a.timeout),n.s.coreTopology.once("error",a.error),n.s.coreTopology.once("close",a.close),n.s.coreTopology.once("connect",(function(){["timeout","error","close","destroy"].forEach((function(e){n.s.coreTopology.removeAllListeners(e)})),n.s.coreTopology.on("timeout",o("timeout")),n.s.coreTopology.once("error",o("error")),n.s.coreTopology.on("close",o("close")),n.s.coreTopology.on("destroy",r),n.emit("open",null,n);try{t(null,n)}catch(e){process.nextTick((function(){throw e}))}})),n.s.coreTopology.on("reconnect",(function(){n.emit("reconnect",n),n.s.store.execute()})),n.s.coreTopology.on("reconnectFailed",(function(e){n.emit("reconnectFailed",e),n.s.store.flush(e)})),n.s.coreTopology.on("serverDescriptionChanged",s("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",s("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",s("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",s("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",s("serverOpening")),n.s.coreTopology.on("serverClosed",s("serverClosed")),n.s.coreTopology.on("topologyOpening",s("topologyOpening")),n.s.coreTopology.on("topologyClosed",s("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",s("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",s("commandStarted")),n.s.coreTopology.on("commandSucceeded",s("commandSucceeded")),n.s.coreTopology.on("commandFailed",s("commandFailed")),n.s.coreTopology.on("attemptReconnect",s("attemptReconnect")),n.s.coreTopology.on("monitoring",s("monitoring")),n.s.coreTopology.connect(e)}}Object.defineProperty(h.prototype,"poolSize",{enumerable:!0,get:function(){return this.s.coreTopology.connections().length}}),Object.defineProperty(h.prototype,"autoReconnect",{enumerable:!0,get:function(){return this.s.reconnect}}),Object.defineProperty(h.prototype,"host",{enumerable:!0,get:function(){return this.s.host}}),Object.defineProperty(h.prototype,"port",{enumerable:!0,get:function(){return this.s.port}}),e.exports=h},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";if(void 0!==global.Map)e.exports=global.Map,e.exports.Map=global.Map;else{var i=function(e){this._keys=[],this._values={};for(var t=0;t<e.length;t++)if(null!=e[t]){var n=e[t],i=n[0],o=n[1];this._keys.push(i),this._values[i]={v:o,i:this._keys.length-1}}};i.prototype.clear=function(){this._keys=[],this._values={}},i.prototype.delete=function(e){var t=this._values[e];return null!=t&&(delete this._values[e],this._keys.splice(t.i,1),!0)},i.prototype.entries=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?[n,e._values[n].v]:void 0,done:void 0===n}}}},i.prototype.forEach=function(e,t){t=t||this;for(var n=0;n<this._keys.length;n++){var i=this._keys[n];e.call(t,this._values[i].v,i,t)}},i.prototype.get=function(e){return this._values[e]?this._values[e].v:void 0},i.prototype.has=function(e){return null!=this._values[e]},i.prototype.keys=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?n:void 0,done:void 0===n}}}},i.prototype.set=function(e,t){return this._values[e]?(this._values[e].v=t,this):(this._keys.push(e),this._values[e]={v:t,i:this._keys.length-1},this)},i.prototype.values=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?e._values[n].v:void 0,done:void 0===n}}}},Object.defineProperty(i.prototype,"size",{enumerable:!0,get:function(){return this._keys.length}}),e.exports=i,e.exports.Map=i}},function(e,t){var n=function(e){if(!(this instanceof n))return new n(e);this._bsontype="Int32",this.value=e};n.prototype.valueOf=function(){return this.value},n.prototype.toJSON=function(){return this.value},e.exports=n,e.exports.Int32=n},function(e,t){e.exports=require("buffer")},function(e,t,n){(function(e){var t=n(66),i=n(44),o=n(5).format,r=n(142),s=n(144),a=i.existsSync||t.existsSync,c=function(e){for(var n=!1;!n;)if(a(e+"/package.json"))n=e;else{if("/"===e)return!1;e=t.dirname(e)}return e},l=function(t,a){(a=a||{}).strict="boolean"!=typeof a.strict||a.strict;var l=function(t){for(var n=e,r=!1;n;){s=n.filename;var s=c(s);if(s){var a=JSON.parse(i.readFileSync(o("%s/package.json",s))),l=t.split(/\//);if(a.peerOptionalDependencies&&(!a.peerOptionalDependencies||a.peerOptionalDependencies[l[0]])){r=!0;break}n=n.parent}else n=n.parent}if(!r)throw new Error(o("no optional dependency [%s] defined in peerOptionalDependencies in any package.json",l[0]));return{object:a,parts:l}}(t),p=l.object,u=l.parts,d=p.peerOptionalDependencies[u[0]],h=void 0,f=t;try{h=n(71)(f)}catch(e){try{if(null==(f=r(process.cwd(),t)))return;h=n(71)(f)}catch(e){if("MODULE_NOT_FOUND"===e.code)return}}var m=c(n(71).resolve(f));if(!m)throw new Error("package.json can not be located");var g=JSON.parse(i.readFileSync(o("%s/package.json",m))).version;if(0==s.satisfies(g,d)&&a.strict){var y=new Error(o("optional dependency [%s] found but version [%s] did not satisfy constraint [%s]",u[0],g,d));throw y.code="OPTIONAL_MODULE_NOT_FOUND",y}return h};l.exists=function(e){try{return void 0!==l(e)}catch(e){return!1}},e.exports=l}).call(this,n(141)(e))},function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=71},function(e,t,n){"use strict";var i=function(e,t,n){this.result=e,this.connection=t,this.message=n};i.prototype.toJSON=function(){let e=Object.assign({},this,this.result);return delete e.message,e},i.prototype.toString=function(){return JSON.stringify(this.toJSON())},e.exports=i},function(e,t,n){"use strict";var i=n(5).inherits,o=n(5).format,r=n(8).EventEmitter,s=n(11),a=n(15),c=n(9).debugOptions,l=n(9).retrieveBSON,p=n(146),u=n(2).MongoError,d=n(2).MongoNetworkError,h=n(104),f=n(16).CoreCursor,m=n(7),g=n(7).createCompressionInfo,y=n(7).resolveClusterTime,v=n(7).SessionMixins,b=n(4).relayEvents;const x=n(4).collationNotSupported,w=n(4).makeClientMetadata;var S=["reconnect","reconnectTries","reconnectInterval","emitError","cursorFactory","host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","checkServerIdentity","socketTimeout","ssl","ca","crl","cert","key","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","servername"],_=0,T=!1,E={},O=l();function k(e){return null==e.s.parent?e.id:e.s.parent.id}var C=function(e){e=e||{},r.call(this),this.id=_++,this.s={options:Object.assign({metadata:w(e)},e),logger:a("Server",e),Cursor:e.cursorFactory||f,bson:e.bson||new O([O.Binary,O.Code,O.DBRef,O.Decimal128,O.Double,O.Int32,O.Long,O.Map,O.MaxKey,O.MinKey,O.ObjectId,O.BSONRegExp,O.Symbol,O.Timestamp]),pool:null,disconnectHandler:e.disconnectHandler,monitoring:"boolean"!=typeof e.monitoring||e.monitoring,inTopology:!!e.parent,monitoringInterval:"number"==typeof e.monitoringInterval?e.monitoringInterval:5e3,compression:{compressors:g(e)},parent:e.parent},this.s.parent||(this.s.clusterTime=null),this.ismaster=null,this.lastIsMasterMS=-1,this.monitoringProcessId=null,this.initialConnect=!0,this._type="server",this.lastUpdateTime=0,this.lastWriteDate=0,this.staleness=0};function A(e,t,n,i,r,s){return e.s.pool.isConnected()||!e.s.options.reconnect||null==e.s.disconnectHandler||r.monitoring?e.s.pool.isConnected()?void 0:(s(new u(o("no connection available to server %s",e.name))),!0):(e.s.disconnectHandler.add(t,n,i,r,s),!0)}i(C,r),Object.assign(C.prototype,v),Object.defineProperty(C.prototype,"type",{enumerable:!0,get:function(){return this._type}}),Object.defineProperty(C.prototype,"parserType",{enumerable:!0,get:function(){return O.native?"c++":"js"}}),Object.defineProperty(C.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.ismaster&&this.ismaster.logicalSessionTimeoutMinutes||null}}),Object.defineProperty(C.prototype,"clientMetadata",{enumerable:!0,get:function(){return this.s.options.metadata}}),Object.defineProperty(C.prototype,"clusterTime",{enumerable:!0,set:function(e){const t=this.s.parent?this.s.parent:this.s;y(t,e)},get:function(){return(this.s.parent?this.s.parent:this.s).clusterTime||null}}),C.enableServerAccounting=function(){T=!0,E={}},C.disableServerAccounting=function(){T=!1},C.servers=function(){return E},Object.defineProperty(C.prototype,"name",{enumerable:!0,get:function(){return this.s.options.host+":"+this.s.options.port}});var I=function(e,t){return function(n,i){if(e.s.logger.isInfo()){var r=n instanceof u?JSON.stringify(n):{};e.s.logger.info(o("server %s fired event %s out with message %s",e.name,t,r))}if("connect"===t){if(e.initialConnect=!1,e.ismaster=i.ismaster,e.lastIsMasterMS=i.lastIsMasterMS,i.agreedCompressor&&(e.s.pool.options.agreedCompressor=i.agreedCompressor),i.zlibCompressionLevel&&(e.s.pool.options.zlibCompressionLevel=i.zlibCompressionLevel),i.ismaster.$clusterTime){const t=i.ismaster.$clusterTime;e.clusterTime=t}"isdbgrid"===e.ismaster.msg&&(e._type="mongos"),e.s.monitoring&&(e.monitoringProcessId=setTimeout(function e(t){return function(){if(!t.s.pool.isDestroyed()){t.emit("monitoring",t);var n=(new Date).getTime();t.command("admin.$cmd",{ismaster:!0},{socketTimeout:"number"!=typeof t.s.options.connectionTimeout?2e3:t.s.options.connectionTimeout,monitoring:!0},(i,o)=>{t.lastIsMasterMS=(new Date).getTime()-n,t.s.pool.isDestroyed()||(o&&(t.ismaster=o.result),t.monitoringProcessId=setTimeout(e(t),t.s.monitoringInterval))})}}}(e),e.s.monitoringInterval)),m.emitServerDescriptionChanged(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:m.getTopologyType(e)}),e.s.inTopology||m.emitTopologyDescriptionChanged(e,{topologyType:"Single",servers:[{address:e.name,arbiters:[],hosts:[],passives:[],type:m.getTopologyType(e)}]}),e.s.logger.isInfo()&&e.s.logger.info(o("server %s connected with ismaster [%s]",e.name,JSON.stringify(e.ismaster))),e.emit("connect",e)}else if("error"===t||"parseError"===t||"close"===t||"timeout"===t||"reconnect"===t||"attemptReconnect"===t||"reconnectFailed"===t){if(T&&-1!==["close","timeout","error","parseError","reconnectFailed"].indexOf(t)&&(e.s.inTopology||e.emit("topologyOpening",{topologyId:e.id}),delete E[e.id]),"close"===t&&m.emitServerDescriptionChanged(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}),"reconnectFailed"===t)return e.emit("reconnectFailed",n),void(e.listeners("error").length>0&&e.emit("error",n));if(-1!==["disconnected","connecting"].indexOf(e.s.pool.state)&&e.initialConnect&&-1!==["close","timeout","error","parseError"].indexOf(t))return e.initialConnect=!1,e.emit("error",new d(o("failed to connect to server [%s] on first connect [%s]",e.name,n)));if("reconnect"===t)return m.emitServerDescriptionChanged(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:m.getTopologyType(e)}),e.emit(t,e);e.emit(t,n)}}};function N(e){return e.s.pool?e.s.pool.isDestroyed()?new u("server instance pool was destroyed"):void 0:new u("server instance is not connected")}C.prototype.connect=function(e){if(e=e||{},T&&(E[this.id]=this),this.s.pool&&!this.s.pool.isDisconnected()&&!this.s.pool.isDestroyed())throw new u(o("server instance in invalid state %s",this.s.pool.state));this.s.pool=new p(this,Object.assign(this.s.options,e,{bson:this.s.bson})),this.s.pool.on("close",I(this,"close")),this.s.pool.on("error",I(this,"error")),this.s.pool.on("timeout",I(this,"timeout")),this.s.pool.on("parseError",I(this,"parseError")),this.s.pool.on("connect",I(this,"connect")),this.s.pool.on("reconnect",I(this,"reconnect")),this.s.pool.on("reconnectFailed",I(this,"reconnectFailed")),b(this.s.pool,this,["commandStarted","commandSucceeded","commandFailed"]),this.s.inTopology||this.emit("topologyOpening",{topologyId:k(this)}),this.emit("serverOpening",{topologyId:k(this),address:this.name}),this.s.pool.connect()},C.prototype.auth=function(e,t){"function"==typeof t&&t(null,null)},C.prototype.getDescription=function(){var e=this.ismaster||{},t={type:m.getTopologyType(this),address:this.name};return e.hosts&&(t.hosts=e.hosts),e.arbiters&&(t.arbiters=e.arbiters),e.passives&&(t.passives=e.passives),e.setName&&(t.setName=e.setName),t},C.prototype.lastIsMaster=function(){return this.ismaster},C.prototype.unref=function(){this.s.pool.unref()},C.prototype.isConnected=function(){return!!this.s.pool&&this.s.pool.isConnected()},C.prototype.isDestroyed=function(){return!!this.s.pool&&this.s.pool.isDestroyed()},C.prototype.command=function(e,t,n,i){"function"==typeof n&&(i=n,n=(n={})||{});var r=function(e,t){if(N(e),t.readPreference&&!(t.readPreference instanceof s))throw new Error("readPreference must be an instance of ReadPreference")}(this,n);return r?i(r):(n=Object.assign({},n,{wireProtocolCommand:!1}),this.s.logger.isDebug()&&this.s.logger.debug(o("executing command [%s] against %s",JSON.stringify({ns:e,cmd:t,options:c(S,n)}),this.name)),A(this,"command",e,t,n,i)?void 0:x(this,t)?i(new u(`server ${this.name} does not support collation`)):void h.command(this,e,t,n,i))},C.prototype.query=function(e,t,n,i,o){h.query(this,e,t,n,i,o)},C.prototype.getMore=function(e,t,n,i,o){h.getMore(this,e,t,n,i,o)},C.prototype.killCursors=function(e,t,n){h.killCursors(this,e,t,n)},C.prototype.insert=function(e,t,n,i){"function"==typeof n&&(i=n,n=(n={})||{});var o=N(this);return o?i(o):A(this,"insert",e,t,n,i)?void 0:(t=Array.isArray(t)?t:[t],h.insert(this,e,t,n,i))},C.prototype.update=function(e,t,n,i){"function"==typeof n&&(i=n,n=(n={})||{});var o=N(this);return o?i(o):A(this,"update",e,t,n,i)?void 0:x(this,n)?i(new u(`server ${this.name} does not support collation`)):(t=Array.isArray(t)?t:[t],h.update(this,e,t,n,i))},C.prototype.remove=function(e,t,n,i){"function"==typeof n&&(i=n,n=(n={})||{});var o=N(this);return o?i(o):A(this,"remove",e,t,n,i)?void 0:x(this,n)?i(new u(`server ${this.name} does not support collation`)):(t=Array.isArray(t)?t:[t],h.remove(this,e,t,n,i))},C.prototype.cursor=function(e,t,n){const i=(n=n||{}).topology||this;return new(n.cursorFactory||this.s.Cursor)(i,e,t,n)},C.prototype.equals=function(e){return"string"==typeof e?this.name.toLowerCase()===e.toLowerCase():!!e.name&&this.name.toLowerCase()===e.name.toLowerCase()},C.prototype.connections=function(){return this.s.pool.allConnections()},C.prototype.selectServer=function(e,t,n){"function"==typeof e&&void 0===n&&(n=e,e=void 0,t={}),"function"==typeof t&&(n=t,t=e,e=void 0),n(null,this)};var M=["close","error","timeout","parseError","connect"];C.prototype.destroy=function(e,t){if(this._destroyed)"function"==typeof t&&t(null,null);else{"function"==typeof e&&(t=e,e={}),e=e||{};var n=this;if(T&&delete E[this.id],this.monitoringProcessId&&clearTimeout(this.monitoringProcessId),!n.s.pool)return this._destroyed=!0,void("function"==typeof t&&t(null,null));e.emitClose&&n.emit("close",n),e.emitDestroy&&n.emit("destroy",n),M.forEach((function(e){n.s.pool.removeAllListeners(e)})),n.listeners("serverClosed").length>0&&n.emit("serverClosed",{topologyId:k(n),address:n.name}),n.listeners("topologyClosed").length>0&&!n.s.inTopology&&n.emit("topologyClosed",{topologyId:k(n)}),n.s.logger.isDebug()&&n.s.logger.debug(o("destroy called on server %s",n.name)),this.s.pool.destroy(e.force,t),this._destroyed=!0}},e.exports=C},function(e,t,n){"use strict";const i=n(96),o=n(132),r=n(91),s=n(2).MongoError,a=n(2).MongoNetworkError,c=n(2).MongoNetworkTimeoutError,l=n(97).defaultAuthProviders,p=n(26).AuthContext,u=n(94),d=n(4).makeClientMetadata,h=u.MAX_SUPPORTED_WIRE_VERSION,f=u.MAX_SUPPORTED_SERVER_VERSION,m=u.MIN_SUPPORTED_WIRE_VERSION,g=u.MIN_SUPPORTED_SERVER_VERSION;let y;const v=["pfx","key","passphrase","cert","ca","ciphers","NPNProtocols","ALPNProtocols","servername","ecdhCurve","secureProtocol","secureContext","session","minDHSize","crl","rejectUnauthorized"];function b(e,t){const n="string"==typeof t.host?t.host:"localhost";if(-1!==n.indexOf("/"))return{path:n};return{family:e,host:n,port:"number"==typeof t.port?t.port:27017,rejectUnauthorized:!1}}const x=new Set(["error","close","timeout","parseError"]);e.exports=function(e,t,n){"function"==typeof t&&(n=t,t=void 0);const u=e&&e.connectionType?e.connectionType:r;null==y&&(y=l(e.bson)),function(e,t,n,r){const s="boolean"==typeof t.ssl&&t.ssl,l="boolean"!=typeof t.keepAlive||t.keepAlive;let p="number"==typeof t.keepAliveInitialDelay?t.keepAliveInitialDelay:12e4;const u="boolean"!=typeof t.noDelay||t.noDelay,d="number"==typeof t.connectionTimeout?t.connectionTimeout:"number"==typeof t.connectTimeoutMS?t.connectTimeoutMS:3e4,h="number"==typeof t.socketTimeout?t.socketTimeout:0,f="boolean"!=typeof t.rejectUnauthorized||t.rejectUnauthorized;p>h&&(p=Math.round(h/2));let m;const g=function(e,t){e&&m&&m.destroy(),r(e,t)};try{s?(m=o.connect(function(e,t){const n=b(e,t);for(const e in t)null!=t[e]&&-1!==v.indexOf(e)&&(n[e]=t[e]);!1===t.checkServerIdentity?n.checkServerIdentity=function(){}:"function"==typeof t.checkServerIdentity&&(n.checkServerIdentity=t.checkServerIdentity);null==n.servername&&(n.servername=n.host);return n}(e,t)),"function"==typeof m.disableRenegotiation&&m.disableRenegotiation()):m=i.createConnection(b(e,t))}catch(e){return g(e)}m.setKeepAlive(l,p),m.setTimeout(d),m.setNoDelay(u);const y=s?"secureConnect":"connect";let w;function S(e){return t=>{x.forEach(e=>m.removeAllListeners(e)),w&&n.removeListener("cancel",w),m.removeListener(y,_),g(function(e,t){switch(e){case"error":return new a(t);case"timeout":return new c("connection timed out");case"close":return new a("connection closed");case"cancel":return new a("connection establishment was cancelled");default:return new a("unknown network error")}}(e,t))}}function _(){if(x.forEach(e=>m.removeAllListeners(e)),w&&n.removeListener("cancel",w),m.authorizationError&&f)return g(m.authorizationError);m.setTimeout(h),g(null,m)}x.forEach(e=>m.once(e,S(e))),n&&(w=S("cancel"),n.once("cancel",w));m.once(y,_)}(void 0!==e.family?e.family:0,e,t,(t,i)=>{t?n(t,i):function(e,t,n){const i=function(t,i){t&&e&&e.destroy(),n(t,i)},o=t.credentials;if(o&&!o.mechanism.match(/DEFAULT/i)&&!y[o.mechanism])return void i(new s(`authMechanism '${o.mechanism}' not supported`));const a=new p(e,o,t);!function(e,t){const n=e.options,i=n.compression&&n.compression.compressors?n.compression.compressors:[],o={ismaster:!0,client:n.metadata||d(n),compression:i},r=e.credentials;if(r){if(r.mechanism.match(/DEFAULT/i)&&r.username)return Object.assign(o,{saslSupportedMechs:`${r.source}.${r.username}`}),void y["scram-sha-256"].prepare(o,e,t);return void y[r.mechanism].prepare(o,e,t)}t(void 0,o)}(a,(n,c)=>{if(n)return i(n);const l=Object.assign({},t);(t.connectTimeoutMS||t.connectionTimeout)&&(l.socketTimeout=t.connectTimeoutMS||t.connectionTimeout);const p=(new Date).getTime();e.command("admin.$cmd",c,l,(n,l)=>{if(n)return void i(n);const u=l.result;if(0===u.ok)return void i(new s(u));const d=function(e,t){const n=e&&"number"==typeof e.maxWireVersion&&e.maxWireVersion>=m,i=e&&"number"==typeof e.minWireVersion&&e.minWireVersion<=h;if(n){if(i)return null;const n=`Server at ${t.host}:${t.port} reports minimum wire version ${e.minWireVersion}, but this version of the Node.js Driver requires at most ${h} (MongoDB ${f})`;return new s(n)}const o=`Server at ${t.host}:${t.port} reports maximum wire version ${e.maxWireVersion||0}, but this version of the Node.js Driver requires at least ${m} (MongoDB ${g})`;return new s(o)}(u,t);if(d)i(d);else{if(!function(e){return!(e instanceof r)}(e)&&u.compression){const n=c.compression.filter(e=>-1!==u.compression.indexOf(e));n.length&&(e.agreedCompressor=n[0]),t.compression&&t.compression.zlibCompressionLevel&&(e.zlibCompressionLevel=t.compression.zlibCompressionLevel)}if(e.ismaster=u,e.lastIsMasterMS=(new Date).getTime()-p,u.arbiterOnly||!o)i(void 0,e);else{Object.assign(a,{response:u});const t=o.resolveAuthMechanism(u);y[t.mechanism].auth(a,t=>{if(t)return i(t);i(void 0,e)})}}})})}(new u(i,e),e,n)})}},function(e,t,n){"use strict";function i(e){this._head=0,this._tail=0,this._capacityMask=3,this._list=new Array(4),Array.isArray(e)&&this._fromArray(e)}i.prototype.peekAt=function(e){var t=e;if(t===(0|t)){var n=this.size();if(!(t>=n||t<-n))return t<0&&(t+=n),t=this._head+t&this._capacityMask,this._list[t]}},i.prototype.get=function(e){return this.peekAt(e)},i.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},i.prototype.peekFront=function(){return this.peek()},i.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(i.prototype,"length",{get:function(){return this.size()}}),i.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},i.prototype.unshift=function(e){if(void 0===e)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},i.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}},i.prototype.push=function(e){if(void 0===e)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},i.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),n}},i.prototype.removeOne=function(e){var t=e;if(t===(0|t)&&this._head!==this._tail){var n=this.size(),i=this._list.length;if(!(t>=n||t<-n)){t<0&&(t+=n),t=this._head+t&this._capacityMask;var o,r=this._list[t];if(e<n/2){for(o=e;o>0;o--)this._list[t]=this._list[t=t-1+i&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(o=n-1-e;o>0;o--)this._list[t]=this._list[t=t+1+i&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+i&this._capacityMask}return r}}},i.prototype.remove=function(e,t){var n,i=e,o=t;if(i===(0|i)&&this._head!==this._tail){var r=this.size(),s=this._list.length;if(!(i>=r||i<-r||t<1)){if(i<0&&(i+=r),1===t||!t)return(n=new Array(1))[0]=this.removeOne(i),n;if(0===i&&i+t>=r)return n=this.toArray(),this.clear(),n;var a;for(i+t>r&&(t=r-i),n=new Array(t),a=0;a<t;a++)n[a]=this._list[this._head+i+a&this._capacityMask];if(i=this._head+i&this._capacityMask,e+t===r){for(this._tail=this._tail-t+s&this._capacityMask,a=t;a>0;a--)this._list[i=i+1+s&this._capacityMask]=void 0;return n}if(0===e){for(this._head=this._head+t+s&this._capacityMask,a=t-1;a>0;a--)this._list[i=i+1+s&this._capacityMask]=void 0;return n}if(i<r/2){for(this._head=this._head+e+t+s&this._capacityMask,a=e;a>0;a--)this.unshift(this._list[i=i-1+s&this._capacityMask]);for(i=this._head-1+s&this._capacityMask;o>0;)this._list[i=i-1+s&this._capacityMask]=void 0,o--;e<0&&(this._tail=i)}else{for(this._tail=i,i=i+t+s&this._capacityMask,a=r-(t+e);a>0;a--)this.push(this._list[i++]);for(i=this._tail;o>0;)this._list[i=i+1+s&this._capacityMask]=void 0,o--}return this._head<2&&this._tail>1e4&&this._tail<=s>>>2&&this._shrinkArray(),n}}},i.prototype.splice=function(e,t){var n=e;if(n===(0|n)){var i=this.size();if(n<0&&(n+=i),!(n>i)){if(arguments.length>2){var o,r,s,a=arguments.length,c=this._list.length,l=2;if(!i||n<i/2){for(r=new Array(n),o=0;o<n;o++)r[o]=this._list[this._head+o&this._capacityMask];for(0===t?(s=[],n>0&&(this._head=this._head+n+c&this._capacityMask)):(s=this.remove(n,t),this._head=this._head+n+c&this._capacityMask);a>l;)this.unshift(arguments[--a]);for(o=n;o>0;o--)this.unshift(r[o-1])}else{var p=(r=new Array(i-(n+t))).length;for(o=0;o<p;o++)r[o]=this._list[this._head+n+t+o&this._capacityMask];for(0===t?(s=[],n!=i&&(this._tail=this._head+n+c&this._capacityMask)):(s=this.remove(n,t),this._tail=this._tail-p+c&this._capacityMask);l<a;)this.push(arguments[l++]);for(o=0;o<p;o++)this.push(r[o])}return s}return this.remove(n,t)}}},i.prototype.clear=function(){this._head=0,this._tail=0},i.prototype.isEmpty=function(){return this._head===this._tail},i.prototype.toArray=function(){return this._copyArray(!1)},i.prototype._fromArray=function(e){for(var t=0;t<e.length;t++)this.push(e[t])},i.prototype._copyArray=function(e){var t,n=[],i=this._list,o=i.length;if(e||this._head>this._tail){for(t=this._head;t<o;t++)n.push(i[t]);for(t=0;t<this._tail;t++)n.push(i[t])}else for(t=this._head;t<this._tail;t++)n.push(i[t]);return n},i.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length*=2,this._capacityMask=this._capacityMask<<1|1},i.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},e.exports=i},function(e,t,n){"use strict";const i=n(75),o=n(8),r=n(113).isResumableError,s=n(1).MongoError,a=n(21),c=n(4).relayEvents,l=n(4).maxWireVersion,p=n(0).maybePromise,u=n(0).now,d=n(0).calculateDurationInMs,h=n(61),f=Symbol("resumeQueue"),m=["resumeAfter","startAfter","startAtOperationTime","fullDocument"],g=["batchSize","maxAwaitTimeMS","collation","readPreference"].concat(m),y={COLLECTION:Symbol("Collection"),DATABASE:Symbol("Database"),CLUSTER:Symbol("Cluster")};class v extends a{constructor(e,t,n){super(e,t,n),n=n||{},this._resumeToken=null,this.startAtOperationTime=n.startAtOperationTime,n.startAfter?this.resumeToken=n.startAfter:n.resumeAfter&&(this.resumeToken=n.resumeAfter)}set resumeToken(e){this._resumeToken=e,this.emit("resumeTokenChanged",e)}get resumeToken(){return this._resumeToken}get resumeOptions(){const e={};for(const t of g)this.options[t]&&(e[t]=this.options[t]);if(this.resumeToken||this.startAtOperationTime)if(["resumeAfter","startAfter","startAtOperationTime"].forEach(t=>delete e[t]),this.resumeToken){const t=this.options.startAfter&&!this.hasReceived?"startAfter":"resumeAfter";e[t]=this.resumeToken}else this.startAtOperationTime&&l(this.server)>=7&&(e.startAtOperationTime=this.startAtOperationTime);return e}cacheResumeToken(e){0===this.bufferedCount()&&this.cursorState.postBatchResumeToken?this.resumeToken=this.cursorState.postBatchResumeToken:this.resumeToken=e,this.hasReceived=!0}_processBatch(e,t){const n=t.cursor;n.postBatchResumeToken&&(this.cursorState.postBatchResumeToken=n.postBatchResumeToken,0===n[e].length&&(this.resumeToken=n.postBatchResumeToken))}_initializeCursor(e){super._initializeCursor((t,n)=>{if(t||null==n)return void e(t,n);const i=n.documents[0];null==this.startAtOperationTime&&null==this.resumeAfter&&null==this.startAfter&&l(this.server)>=7&&(this.startAtOperationTime=i.operationTime),this._processBatch("firstBatch",i),this.emit("init",n),this.emit("response"),e(t,n)})}_getMore(e){super._getMore((t,n)=>{t?e(t):(this._processBatch("nextBatch",n),this.emit("more",n),this.emit("response"),e(t,n))})}}function b(e,t){const n={fullDocument:t.fullDocument||"default"};x(n,t,m),e.type===y.CLUSTER&&(n.allChangesForCluster=!0);const i=[{$changeStream:n}].concat(e.pipeline),o=x({},t,g),r=new v(e.topology,new h(e.parent,i,t),o);if(c(r,e,["resumeTokenChanged","end","close"]),e.listenerCount("change")>0&&r.on("data",(function(t){w(e,t)})),r.on("error",(function(t){S(e,t)})),e.pipeDestinations){const t=r.stream(e.streamOptions);for(let n of e.pipeDestinations)t.pipe(n)}return r}function x(e,t,n){return n.forEach(n=>{t[n]&&(e[n]=t[n])}),e}function w(e,t,n){const i=e.cursor;if(null==t&&(e.closed=!0),!e.closed){if(t&&!t._id){const t=new Error("A change stream document has been received that lacks a resume token (_id).");return n?n(t):e.emit("error",t)}return i.cacheResumeToken(t._id),e.options.startAtOperationTime=void 0,n?n(void 0,t):e.emit("change",t)}n&&n(new s("ChangeStream is closed"))}function S(e,t,n){const i=e.topology,o=e.cursor;if(!e.closed)return o&&r(t,l(o.server))?(e.cursor=void 0,["data","close","end","error"].forEach(e=>o.removeAllListeners(e)),o.close(),void function e(t,n,i){setTimeout(()=>{n&&null==n.start&&(n.start=u());const o=n.start||u(),r=n.timeout||3e4,a=n.readPreference;return t.isConnected({readPreference:a})?i():d(o)>r?i(new s("Timed out waiting for connection")):void e(t,n,i)},500)}(i,{readPreference:o.options.readPreference},t=>{if(t)return c(t);const i=b(e,o.resumeOptions);if(!n)return a(i);i.hasNext(e=>{if(e)return c(e);a(i)})})):n?n(t):e.emit("error",t);function a(t){e.cursor=t,T(e)}function c(t){n||(e.emit("error",t),e.emit("close")),T(e,t),e.closed=!0}n&&n(new s("ChangeStream is closed"))}function _(e,t){e.isClosed()?t(new s("ChangeStream is closed.")):e.cursor?t(void 0,e.cursor):e[f].push(t)}function T(e,t){for(;e[f].length;){const n=e[f].pop();if(e.isClosed()&&!t)return void n(new s("Change Stream is not open."));n(t,e.cursor)}}e.exports=class extends o{constructor(e,t,o){super();const r=n(42),s=n(63),a=n(60);if(this.pipeline=t||[],this.options=o||{},this.parent=e,this.namespace=e.s.namespace,e instanceof r)this.type=y.COLLECTION,this.topology=e.s.db.serverConfig;else if(e instanceof s)this.type=y.DATABASE,this.topology=e.serverConfig;else{if(!(e instanceof a))throw new TypeError("parent provided to ChangeStream constructor is not an instance of Collection, Db, or MongoClient");this.type=y.CLUSTER,this.topology=e.topology}this.promiseLibrary=e.s.promiseLibrary,!this.options.readPreference&&e.s.readPreference&&(this.options.readPreference=e.s.readPreference),this[f]=new i,this.cursor=b(this,o),this.closed=!1,this.on("newListener",e=>{"change"===e&&this.cursor&&0===this.listenerCount("change")&&this.cursor.on("data",e=>w(this,e))}),this.on("removeListener",e=>{"change"===e&&0===this.listenerCount("change")&&this.cursor&&this.cursor.removeAllListeners("data")})}get resumeToken(){return this.cursor.resumeToken}hasNext(e){return p(this.parent,e,e=>{_(this,(t,n)=>{if(t)return e(t);n.hasNext(e)})})}next(e){return p(this.parent,e,e=>{_(this,(t,n)=>{if(t)return e(t);n.next((t,n)=>{if(t)return this[f].push(()=>this.next(e)),void S(this,t,e);w(this,n,e)})})})}isClosed(){return this.closed||this.cursor&&this.cursor.isClosed()}close(e){return p(this.parent,e,e=>{if(this.closed)return e();if(this.closed=!0,!this.cursor)return e();const t=this.cursor;return t.close(n=>(["data","close","end","error"].forEach(e=>t.removeAllListeners(e)),this.cursor=void 0,e(n)))})}pipe(e,t){return this.pipeDestinations||(this.pipeDestinations=[]),this.pipeDestinations.push(e),this.cursor.pipe(e,t)}unpipe(e){return this.pipeDestinations&&this.pipeDestinations.indexOf(e)>-1&&this.pipeDestinations.splice(this.pipeDestinations.indexOf(e),1),this.cursor.unpipe(e)}stream(e){return this.streamOptions=e,this.cursor.stream(e)}pause(){return this.cursor.pause()}resume(){return this.cursor.resume()}}},function(e,t,n){"use strict";e.exports={SYSTEM_NAMESPACE_COLLECTION:"system.namespaces",SYSTEM_INDEX_COLLECTION:"system.indexes",SYSTEM_PROFILE_COLLECTION:"system.profile",SYSTEM_USER_COLLECTION:"system.users",SYSTEM_COMMAND_COLLECTION:"$cmd",SYSTEM_JS_COLLECTION:"system.js"}},function(e,t,n){"use strict";const i=n(1).BSON.Long,o=n(1).MongoError,r=n(1).BSON.ObjectID,s=n(1).BSON,a=n(1).MongoWriteConcernError,c=n(0).toError,l=n(0).handleCallback,p=n(0).applyRetryableWrites,u=n(0).applyWriteConcern,d=n(0).executeLegacyOperation,h=n(0).isPromiseLike,f=n(0).hasAtomicOperators,m=n(4).maxWireVersion,g=new s([s.Binary,s.Code,s.DBRef,s.Decimal128,s.Double,s.Int32,s.Long,s.Map,s.MaxKey,s.MinKey,s.ObjectId,s.BSONRegExp,s.Symbol,s.Timestamp]);class y{constructor(e){this.result=e}get ok(){return this.result.ok}get nInserted(){return this.result.nInserted}get nUpserted(){return this.result.nUpserted}get nMatched(){return this.result.nMatched}get nModified(){return this.result.nModified}get nRemoved(){return this.result.nRemoved}getInsertedIds(){return this.result.insertedIds}getUpsertedIds(){return this.result.upserted}getUpsertedIdAt(e){return this.result.upserted[e]}getRawResponse(){return this.result}hasWriteErrors(){return this.result.writeErrors.length>0}getWriteErrorCount(){return this.result.writeErrors.length}getWriteErrorAt(e){return e<this.result.writeErrors.length?this.result.writeErrors[e]:null}getWriteErrors(){return this.result.writeErrors}getLastOp(){return this.result.lastOp}getWriteConcernError(){if(0===this.result.writeConcernErrors.length)return null;if(1===this.result.writeConcernErrors.length)return this.result.writeConcernErrors[0];{let e="";for(let t=0;t<this.result.writeConcernErrors.length;t++){e+=this.result.writeConcernErrors[t].errmsg,0===t&&(e+=" and ")}return new v({errmsg:e,code:64})}}toJSON(){return this.result}toString(){return`BulkWriteResult(${this.toJSON(this.result)})`}isOk(){return 1===this.result.ok}}class v{constructor(e){this.err=e}get code(){return this.err.code}get errmsg(){return this.err.errmsg}toJSON(){return{code:this.err.code,errmsg:this.err.errmsg}}toString(){return`WriteConcernError(${this.err.errmsg})`}}class b{constructor(e){this.err=e}get code(){return this.err.code}get index(){return this.err.index}get errmsg(){return this.err.errmsg}getOperation(){return this.err.op}toJSON(){return{code:this.err.code,index:this.err.index,errmsg:this.err.errmsg,op:this.err.op}}toString(){return`WriteError(${JSON.stringify(this.toJSON())})`}}function x(e,t,n,o){if(n)o=n;else if(o&&o.result)o=o.result;else if(null==o)return;if(0===o.ok&&1===t.ok){t.ok=0;const n={index:0,code:o.code||0,errmsg:o.message,op:e.operations[0]};return void t.writeErrors.push(new b(n))}if(0===o.ok&&0===t.ok)return;if(o.opTime||o.lastOp){const e=o.lastOp||o.opTime;let n=null,r=null;if(e&&"Timestamp"===e._bsontype)(null==t.lastOp||e.greaterThan(t.lastOp))&&(t.lastOp=e);else{t.lastOp&&(n="number"==typeof t.lastOp.ts?i.fromNumber(t.lastOp.ts):t.lastOp.ts,r="number"==typeof t.lastOp.t?i.fromNumber(t.lastOp.t):t.lastOp.t);const o="number"==typeof e.ts?i.fromNumber(e.ts):e.ts,s="number"==typeof e.t?i.fromNumber(e.t):e.t;(null==t.lastOp||o.greaterThan(n)||o.equals(n)&&s.greaterThan(r))&&(t.lastOp=e)}}1===e.batchType&&o.n&&(t.nInserted=t.nInserted+o.n),3===e.batchType&&o.n&&(t.nRemoved=t.nRemoved+o.n);let r=0;if(Array.isArray(o.upserted)){r=o.upserted.length;for(let n=0;n<o.upserted.length;n++)t.upserted.push({index:o.upserted[n].index+e.originalZeroIndex,_id:o.upserted[n]._id})}else o.upserted&&(r=1,t.upserted.push({index:e.originalZeroIndex,_id:o.upserted}));if(2===e.batchType&&o.n){const e=o.nModified;t.nUpserted=t.nUpserted+r,t.nMatched=t.nMatched+(o.n-r),t.nModified="number"==typeof e?t.nModified+e:null}if(Array.isArray(o.writeErrors))for(let n=0;n<o.writeErrors.length;n++){const i={index:e.originalIndexes[o.writeErrors[n].index],code:o.writeErrors[n].code,errmsg:o.writeErrors[n].errmsg,op:e.operations[o.writeErrors[n].index]};t.writeErrors.push(new b(i))}o.writeConcernError&&t.writeConcernErrors.push(new v(o.writeConcernError))}function w(e,t,n){if(0===e.s.batches.length)return l(n,null,new y(e.s.bulkResult));const i=e.s.batches.shift();e.finalOptionsHandler({options:t,batch:i,resultHandler:function(o,r){if((o&&o.driver||o&&o.message)&&!(o instanceof a))return l(n,o);if(o&&(o.ok=0),o instanceof a)return function(e,t,n,i){x(e,t,null,n.result);const o=new v({errmsg:n.result.writeConcernError.errmsg,code:n.result.writeConcernError.result});return l(i,new S(c(o),new y(t)),null)}(i,e.s.bulkResult,o,n);const s=new y(e.s.bulkResult);if(null!=x(i,e.s.bulkResult,o,r))return l(n,null,s);e.handleWriteError(n,s)||w(e,t,n)}},n)}class S extends o{constructor(e,t){super(e.err||e.errmsg||e.errMessage||e),Object.assign(this,e),this.name="BulkWriteError",this.result=t}}class _{constructor(e){this.s=e.s}update(e){const t="boolean"==typeof this.s.currentOp.upsert&&this.s.currentOp.upsert,n={q:this.s.currentOp.selector,u:e,multi:!0,upsert:t};return e.hint&&(n.hint=e.hint),this.s.currentOp=null,this.s.options.addToOperationsList(this,2,n)}updateOne(e){const t="boolean"==typeof this.s.currentOp.upsert&&this.s.currentOp.upsert,n={q:this.s.currentOp.selector,u:e,multi:!1,upsert:t};if(e.hint&&(n.hint=e.hint),!f(e))throw new TypeError("Update document requires atomic operators");return this.s.currentOp=null,this.s.options.addToOperationsList(this,2,n)}replaceOne(e){const t="boolean"==typeof this.s.currentOp.upsert&&this.s.currentOp.upsert,n={q:this.s.currentOp.selector,u:e,multi:!1,upsert:t};if(e.hint&&(n.hint=e.hint),f(e))throw new TypeError("Replacement document must not use atomic operators");return this.s.currentOp=null,this.s.options.addToOperationsList(this,2,n)}upsert(){return this.s.currentOp.upsert=!0,this}deleteOne(){const e={q:this.s.currentOp.selector,limit:1};return this.s.currentOp=null,this.s.options.addToOperationsList(this,3,e)}delete(){const e={q:this.s.currentOp.selector,limit:0};return this.s.currentOp=null,this.s.options.addToOperationsList(this,3,e)}removeOne(){return this.deleteOne()}remove(){return this.delete()}}class T{constructor(e,t,n,i){this.isOrdered=i,n=null==n?{}:n;const o=t.s.namespace,r=e.bson,s=e.lastIsMaster(),a=!(!e.s.options||!e.s.options.autoEncrypter),c=s&&s.maxBsonObjectSize?s.maxBsonObjectSize:16777216,l=a?2097152:c,d=s&&s.maxWriteBatchSize?s.maxWriteBatchSize:1e3,h=(d-1).toString(10).length+2;let f=Object.assign({},n);f=p(f,t.s.db),f=u(f,{collection:t},n);const m=f.writeConcern,g=n.promiseLibrary||Promise;this.s={bulkResult:{ok:1,writeErrors:[],writeConcernErrors:[],insertedIds:[],nInserted:0,nUpserted:0,nMatched:0,nModified:0,nRemoved:0,upserted:[]},currentBatch:null,currentIndex:0,currentBatchSize:0,currentBatchSizeBytes:0,currentInsertBatch:null,currentUpdateBatch:null,currentRemoveBatch:null,batches:[],writeConcern:m,maxBsonObjectSize:c,maxBatchSizeBytes:l,maxWriteBatchSize:d,maxKeySize:h,namespace:o,bson:r,topology:e,options:f,currentOp:null,executed:!1,collection:t,promiseLibrary:g,err:null,checkKeys:"boolean"!=typeof n.checkKeys||n.checkKeys},!0===n.bypassDocumentValidation&&(this.s.bypassDocumentValidation=!0)}insert(e){return!0!==this.s.collection.s.db.options.forceServerObjectId&&null==e._id&&(e._id=new r),this.s.options.addToOperationsList(this,1,e)}find(e){if(!e)throw c("Bulk find operation must specify a selector");return this.s.currentOp={selector:e},new _(this)}raw(e){const t=Object.keys(e)[0],n="boolean"==typeof this.s.options.forceServerObjectId?this.s.options.forceServerObjectId:this.s.collection.s.db.options.forceServerObjectId;if(e.updateOne&&e.updateOne.q||e.updateMany&&e.updateMany.q||e.replaceOne&&e.replaceOne.q)return e[t].multi=!e.updateOne&&!e.replaceOne,this.s.options.addToOperationsList(this,2,e[t]);if(e.updateOne||e.updateMany||e.replaceOne){if(e.replaceOne&&f(e[t].replacement))throw new TypeError("Replacement document must not use atomic operators");if((e.updateOne||e.updateMany)&&!f(e[t].update))throw new TypeError("Update document requires atomic operators");const n=!e.updateOne&&!e.replaceOne,i={q:e[t].filter,u:e[t].update||e[t].replacement,multi:n};if(e[t].hint&&(i.hint=e[t].hint),this.isOrdered?(i.upsert=!!e[t].upsert,e.collation&&(i.collation=e.collation)):e[t].upsert&&(i.upsert=!0),e[t].arrayFilters){if(m(this.s.topology)<6)throw new TypeError("arrayFilters are only supported on MongoDB 3.6+");i.arrayFilters=e[t].arrayFilters}return this.s.options.addToOperationsList(this,2,i)}if(e.removeOne||e.removeMany||e.deleteOne&&e.deleteOne.q||e.deleteMany&&e.deleteMany.q)return e[t].limit=e.removeOne?1:0,this.s.options.addToOperationsList(this,3,e[t]);if(e.deleteOne||e.deleteMany){const n=e.deleteOne?1:0,i={q:e[t].filter,limit:n};return e[t].hint&&(i.hint=e[t].hint),this.isOrdered&&e.collation&&(i.collation=e.collation),this.s.options.addToOperationsList(this,3,i)}if(e.insertOne&&null==e.insertOne.document)return!0!==n&&null==e.insertOne._id&&(e.insertOne._id=new r),this.s.options.addToOperationsList(this,1,e.insertOne);if(e.insertOne&&e.insertOne.document)return!0!==n&&null==e.insertOne.document._id&&(e.insertOne.document._id=new r),this.s.options.addToOperationsList(this,1,e.insertOne.document);if(!e.insertMany)throw c("bulkWrite only supports insertOne, insertMany, updateOne, updateMany, removeOne, removeMany, deleteOne, deleteMany");for(let t=0;t<e.insertMany.length;t++)!0!==n&&null==e.insertMany[t]._id&&(e.insertMany[t]._id=new r),this.s.options.addToOperationsList(this,1,e.insertMany[t])}_handleEarlyError(e,t){if("function"!=typeof t)return this.s.promiseLibrary.reject(e);t(e,null)}bulkExecute(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{},"function"==typeof e?n=e:e&&"object"==typeof e&&(this.s.writeConcern=e),this.s.executed){const e=c("batch cannot be re-executed");return this._handleEarlyError(e,n)}if(this.isOrdered?this.s.currentBatch&&this.s.batches.push(this.s.currentBatch):(this.s.currentInsertBatch&&this.s.batches.push(this.s.currentInsertBatch),this.s.currentUpdateBatch&&this.s.batches.push(this.s.currentUpdateBatch),this.s.currentRemoveBatch&&this.s.batches.push(this.s.currentRemoveBatch)),0===this.s.batches.length){const e=c("Invalid Operation, no operations specified");return this._handleEarlyError(e,n)}return{options:t,callback:n}}execute(e,t,n){const i=this.bulkExecute(e,t,n);return!i||h(i)?i:(t=i.options,n=i.callback,d(this.s.topology,w,[this,t,n]))}finalOptionsHandler(e,t){const n=Object.assign({ordered:this.isOrdered},e.options);null!=this.s.writeConcern&&(n.writeConcern=this.s.writeConcern),!0!==n.bypassDocumentValidation&&delete n.bypassDocumentValidation,this.operationId&&(e.resultHandler.operationId=this.operationId),this.s.options.serializeFunctions&&(n.serializeFunctions=!0),this.s.options.ignoreUndefined&&(n.ignoreUndefined=!0),!0===this.s.bypassDocumentValidation&&(n.bypassDocumentValidation=!0),!1===this.s.checkKeys&&(n.checkKeys=!1),n.retryWrites&&(2===e.batch.batchType&&(n.retryWrites=n.retryWrites&&!e.batch.operations.some(e=>e.multi)),3===e.batch.batchType&&(n.retryWrites=n.retryWrites&&!e.batch.operations.some(e=>0===e.limit)));try{1===e.batch.batchType?this.s.topology.insert(this.s.namespace,e.batch.operations,n,e.resultHandler):2===e.batch.batchType?this.s.topology.update(this.s.namespace,e.batch.operations,n,e.resultHandler):3===e.batch.batchType&&this.s.topology.remove(this.s.namespace,e.batch.operations,n,e.resultHandler)}catch(n){n.ok=0,l(t,null,x(e.batch,this.s.bulkResult,n,null))}}handleWriteError(e,t){if(this.s.bulkResult.writeErrors.length>0){const n=this.s.bulkResult.writeErrors[0].errmsg?this.s.bulkResult.writeErrors[0].errmsg:"write operation failed";return l(e,new S(c({message:n,code:this.s.bulkResult.writeErrors[0].code,writeErrors:this.s.bulkResult.writeErrors}),t),null),!0}if(t.getWriteConcernError())return l(e,new S(c(t.getWriteConcernError()),t),null),!0}}Object.defineProperty(T.prototype,"length",{enumerable:!0,get:function(){return this.s.currentIndex}}),e.exports={Batch:class{constructor(e,t){this.originalZeroIndex=t,this.currentIndex=0,this.originalIndexes=[],this.batchType=e,this.operations=[],this.size=0,this.sizeBytes=0}},BulkOperationBase:T,bson:g,INSERT:1,UPDATE:2,REMOVE:3,BulkWriteError:S}},function(e,t,n){"use strict";const i=n(1).MongoError,o=n(21),r=n(16).CursorState;class s extends o{constructor(e,t,n){super(e,t,n)}batchSize(e){if(this.s.state===r.CLOSED||this.isDead())throw i.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw i.create({message:"batchSize requires an integer",driver:!0});return this.operation.options.batchSize=e,this.setCursorBatchSize(e),this}geoNear(e){return this.operation.addToPipeline({$geoNear:e}),this}group(e){return this.operation.addToPipeline({$group:e}),this}limit(e){return this.operation.addToPipeline({$limit:e}),this}match(e){return this.operation.addToPipeline({$match:e}),this}maxTimeMS(e){return this.operation.options.maxTimeMS=e,this}out(e){return this.operation.addToPipeline({$out:e}),this}project(e){return this.operation.addToPipeline({$project:e}),this}lookup(e){return this.operation.addToPipeline({$lookup:e}),this}redact(e){return this.operation.addToPipeline({$redact:e}),this}skip(e){return this.operation.addToPipeline({$skip:e}),this}sort(e){return this.operation.addToPipeline({$sort:e}),this}unwind(e){return this.operation.addToPipeline({$unwind:e}),this}getLogger(){return this.logger}}s.prototype.get=s.prototype.toArray,e.exports=s},function(e,t,n){"use strict";const i=n(1).ReadPreference,o=n(1).MongoError,r=n(21),s=n(16).CursorState;class a extends r{constructor(e,t,n,i){super(e,t,n,i)}setReadPreference(e){if(this.s.state===s.CLOSED||this.isDead())throw o.create({message:"Cursor is closed",driver:!0});if(this.s.state!==s.INIT)throw o.create({message:"cannot change cursor readPreference after cursor has been accessed",driver:!0});if(e instanceof i)this.options.readPreference=e;else{if("string"!=typeof e)throw new TypeError("Invalid read preference: "+e);this.options.readPreference=new i(e)}return this}batchSize(e){if(this.s.state===s.CLOSED||this.isDead())throw o.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw o.create({message:"batchSize requires an integer",driver:!0});return this.cmd.cursor&&(this.cmd.cursor.batchSize=e),this.setCursorBatchSize(e),this}maxTimeMS(e){return this.topology.lastIsMaster().minWireVersion>2&&(this.cmd.maxTimeMS=e),this}getLogger(){return this.logger}}a.prototype.get=a.prototype.toArray,e.exports=a},function(e,t,n){"use strict";const i=n(3).Aspect,o=n(20),r=n(3).defineAspects,s=n(0).handleCallback;class a extends o{constructor(e,t){const n=Object.assign({},t,e.s.options);t.session&&(n.session=t.session),super(e,n)}execute(e){super.execute((t,n)=>t?s(e,t):n.ok?s(e,null,!0):void s(e,null,!1))}}r(a,i.WRITE_OPERATION);e.exports={DropOperation:a,DropCollectionOperation:class extends a{constructor(e,t,n){super(e,n),this.name=t,this.namespace=`${e.namespace}.${t}`}_buildCommand(){return{drop:this.name}}},DropDatabaseOperation:class extends a{_buildCommand(){return{dropDatabase:1}}}}},function(e,t,n){"use strict";let i,o,r;e.exports={loadCollection:function(){return i||(i=n(42)),i},loadCursor:function(){return o||(o=n(21)),o},loadDb:function(){return r||(r=n(63)),r}}},function(e,t,n){var i=n(65);e.exports=!i((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){"use strict";const i=n(34),o=n(5),r=n(44),s=n(249),a=n(45),c=n(96),l=(e,t,n)=>{a["resolve"+e](t,(e,t)=>{if(e){switch(e.code){case a.NODATA:case a.NOTFOUND:case a.NOTIMP:case a.SERVFAIL:case a.CONNREFUSED:case"EAI_AGAIN":return n(null,[])}return n(e)}return n(null,Array.isArray(t)?t:[].concat(t||[]))})},p=e.exports.dnsCache=new Map;function u(e,t){let n=!1,i=[],o=0;e.on("error",e=>{n||(n=!0,t(e))}),e.on("readable",()=>{let t;for(;null!==(t=e.read());)i.push(t),o+=t.length}),e.on("end",()=>{if(n)return;let e;n=!0;try{e=Buffer.concat(i,o)}catch(e){return t(e)}t(null,e)})}e.exports.resolveHostname=(e,t)=>{if(!(e=e||{}).host||c.isIP(e.host)){let n={host:e.host,servername:e.servername||!1};return t(null,n)}let n;if(p.has(e.host)&&(n=p.get(e.host),!n.expires||n.expires>=Date.now()))return t(null,{host:n.value.host,servername:n.value.servername,_cached:!0});l(4,e.host,(i,o)=>{if(i)return n?t(null,n.value):t(i);if(o&&o.length){let n={host:o[0]||e.host,servername:e.servername||e.host};return p.set(e.host,{value:n,expires:Date.now()+3e5}),t(null,n)}l(6,e.host,(i,o)=>{if(i)return n?t(null,n.value):t(i);if(o&&o.length){let n={host:o[0]||e.host,servername:e.servername||e.host};return p.set(e.host,{value:n,expires:Date.now()+3e5}),t(null,n)}try{a.lookup(e.host,{},(i,o)=>{if(i)return n?t(null,n.value):t(i);if(!o&&n)return t(null,n.value);let r={host:o||e.host,servername:e.servername||e.host};return p.set(e.host,{value:r,expires:Date.now()+3e5}),t(null,r)})}catch(i){return n?t(null,n.value):t(i)}})})},e.exports.parseConnectionUrl=e=>{e=e||"";let t={};return[i.parse(e,!0)].forEach(e=>{let n;switch(e.protocol){case"smtp:":t.secure=!1;break;case"smtps:":t.secure=!0;break;case"direct:":t.direct=!0}!isNaN(e.port)&&Number(e.port)&&(t.port=Number(e.port)),e.hostname&&(t.host=e.hostname),e.auth&&(n=e.auth.split(":"),t.auth||(t.auth={}),t.auth.user=n.shift(),t.auth.pass=n.join(":")),Object.keys(e.query||{}).forEach(n=>{let i=t,o=n,r=e.query[n];switch(isNaN(r)||(r=Number(r)),r){case"true":r=!0;break;case"false":r=!1}if(0===n.indexOf("tls."))o=n.substr(4),t.tls||(t.tls={}),i=t.tls;else if(n.indexOf(".")>=0)return;o in i||(i[o]=r)})}),t},e.exports._logFunc=(e,t,n,i,o,...r)=>{let s={};Object.keys(n||{}).forEach(e=>{"level"!==e&&(s[e]=n[e])}),Object.keys(i||{}).forEach(e=>{"level"!==e&&(s[e]=i[e])}),e[t](s,o,...r)},e.exports.getLogger=(t,n)=>{let i={},r=["trace","debug","info","warn","error","fatal"];if(!(t=t||{}).logger)return r.forEach(e=>{i[e]=()=>!1}),i;let s=t.logger;return!0===t.logger&&(s=function(e){let t=0,n=new Map;e.forEach(e=>{e.length>t&&(t=e.length)}),e.forEach(e=>{let i=e.toUpperCase();i.length<t&&(i+=" ".repeat(t-i.length)),n.set(e,i)});let i=(e,t,i,...r)=>{let s="";t&&("server"===t.tnx?s="S: ":"client"===t.tnx&&(s="C: "),t.sid&&(s="["+t.sid+"] "+s),t.cid&&(s="[#"+t.cid+"] "+s)),(i=o.format(i,...r)).split(/\r?\n/).forEach(t=>{console.log("[%s] %s %s",(new Date).toISOString().substr(0,19).replace(/T/," "),n.get(e),s+t)})},r={};return e.forEach(e=>{r[e]=i.bind(null,e)}),r}(r)),r.forEach(t=>{i[t]=(i,o,...r)=>{e.exports._logFunc(s,t,n,i,o,...r)}}),i},e.exports.callbackPromise=(e,t)=>function(){let n=Array.from(arguments),i=n.shift();i?t(i):e(...n)},e.exports.resolveContent=(t,n,i)=>{let o;i||(o=new Promise((t,n)=>{i=e.exports.callbackPromise(t,n)}));let a,c=t&&t[n]&&t[n].content||t[n],l=("object"==typeof t[n]&&t[n].encoding||"utf8").toString().toLowerCase().replace(/[-_\s]/g,"");if(!c)return i(null,c);if("object"==typeof c){if("function"==typeof c.pipe)return u(c,(e,o)=>{if(e)return i(e);t[n]=o,i(null,o)});if(/^https?:\/\//i.test(c.path||c.href))return a=s(c.path||c.href),u(a,i);if(/^data:/i.test(c.path||c.href)){let e=(c.path||c.href).match(/^data:((?:[^;]*;)*(?:[^,]*)),(.*)$/i);return i(null,e?/\bbase64$/i.test(e[1])?Buffer.from(e[2],"base64"):Buffer.from(decodeURIComponent(e[2])):Buffer.from(0))}if(c.path)return u(r.createReadStream(c.path),i)}return"string"!=typeof t[n].content||["utf8","usascii","ascii"].includes(l)||(c=Buffer.from(t[n].content,l)),setImmediate(()=>i(null,c)),o},e.exports.assign=function(){let e=Array.from(arguments),t=e.shift()||{};return e.forEach(e=>{Object.keys(e||{}).forEach(n=>{["tls","auth"].includes(n)&&e[n]&&"object"==typeof e[n]?(t[n]||(t[n]={}),Object.keys(e[n]).forEach(i=>{t[n][i]=e[n][i]})):t[n]=e[n]})}),t},e.exports.encodeXText=e=>{if(!/[^\x21-\x2A\x2C-\x3C\x3E-\x7E]/.test(e))return e;let t=Buffer.from(e),n="";for(let e=0,i=t.length;e<i;e++){let i=t[e];n+=i<33||i>126||43===i||61===i?"+"+(i<16?"0":"")+i.toString(16).toUpperCase():String.fromCharCode(i)}return n}},function(e,t,n){var i=n(83),o=n(231),r=n(88),s=n(226),a=Object.defineProperty;t.f=i?a:function(e,t,n){if(r(e),t=s(t,!0),r(n),o)try{return a(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var i=n(84);e.exports=function(e){if(!i(e))throw TypeError(String(e)+" is not an object");return e}},function(e,t,n){"use strict";const i=n(1),o=n(178),r=n(60).connect;r.MongoError=i.MongoError,r.MongoNetworkError=i.MongoNetworkError,r.MongoTimeoutError=i.MongoTimeoutError,r.MongoServerSelectionError=i.MongoServerSelectionError,r.MongoParseError=i.MongoParseError,r.MongoWriteConcernError=i.MongoWriteConcernError,r.MongoBulkWriteError=n(78).BulkWriteError,r.BulkWriteError=r.MongoBulkWriteError,r.Admin=n(123),r.MongoClient=n(60),r.Db=n(63),r.Collection=n(42),r.Server=n(64),r.ReplSet=n(127),r.Mongos=n(126),r.ReadPreference=i.ReadPreference,r.GridStore=n(216),r.Chunk=n(128),r.Logger=i.Logger,r.AggregationCursor=n(79),r.CommandCursor=n(80),r.Cursor=n(21),r.GridFSBucket=n(217),r.CoreServer=i.Server,r.CoreConnection=i.Connection,r.Binary=i.BSON.Binary,r.Code=i.BSON.Code,r.Map=i.BSON.Map,r.DBRef=i.BSON.DBRef,r.Double=i.BSON.Double,r.Int32=i.BSON.Int32,r.Long=i.BSON.Long,r.MinKey=i.BSON.MinKey,r.MaxKey=i.BSON.MaxKey,r.ObjectID=i.BSON.ObjectID,r.ObjectId=i.BSON.ObjectID,r.Symbol=i.BSON.Symbol,r.Timestamp=i.BSON.Timestamp,r.BSONRegExp=i.BSON.BSONRegExp,r.Decimal128=i.BSON.Decimal128,r.connect=r,r.instrument=function(e,t){"function"==typeof e&&(t=e,e={});const n=new o;return n.instrument(r.MongoClient,t),n},e.exports=r},function(e,t,n){var i=n(136),o=n(35),r=n(51),s=n(55),a=n(52),c=n(46),l=n(68),p=n(29),u=n(67),d=n(54),h=n(53),f=n(48),m=n(49),g=n(50),y=n(47);i.BSON_INT32_MAX=2147483647,i.BSON_INT32_MIN=-2147483648,i.BSON_INT64_MAX=Math.pow(2,63)-1,i.BSON_INT64_MIN=-Math.pow(2,63),i.JS_INT_MAX=9007199254740992,i.JS_INT_MIN=-9007199254740992,i.Binary=o,i.Code=r,i.DBRef=s,i.Decimal128=a,i.Double=c,i.Int32=l,i.Long=p,i.Map=u,i.MaxKey=d,i.MinKey=h,i.ObjectId=f,i.ObjectID=f,i.BSONRegExp=m,i.Symbol=g,i.Timestamp=y,e.exports=i},function(e,t,n){"use strict";const i=n(8).EventEmitter,o=n(17),r=n(9).debugOptions,s=n(6).parseHeader,a=n(23).decompress,c=n(18).Response,l=n(31).BinMsg,p=n(2).MongoNetworkError,u=n(2).MongoNetworkTimeoutError,d=n(2).MongoError,h=n(15),f=n(6).opcodes.OP_COMPRESSED,m=n(6).opcodes.OP_MSG,g=n(6).MESSAGE_HEADER_SIZE,y=n(19).Buffer,v=n(18).Query,b=n(72);let x=0;const w=["host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","socketTimeout","ssl","ca","crl","cert","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","checkServerIdentity"];let S=void 0,_=!1,T={};const E=["error","close","timeout","parseError"];function O(e){delete T[e],S&&S.deleteConnection(e)}function k(e,t){const n=s(t);if(n.opCode!==f){const i=n.opCode===m?l:c;return void e.emit("message",new i(e.bson,t,n,t.slice(g),e.responseOptions),e)}n.fromCompressed=!0;let i=g;n.opCode=t.readInt32LE(i),i+=4,n.length=t.readInt32LE(i),i+=4;const o=t[i];i++,a(o,t.slice(i),(i,o)=>{if(i)return void e.emit("error",i);if(o.length!==n.length)return void e.emit("error",new d("Decompressing a compressed message from the server failed. The message is corrupt."));const r=n.opCode===m?l:c;e.emit("message",new r(e.bson,t,n,o,e.responseOptions),e)})}e.exports=class extends i{constructor(e,t){if(super(),!(t=t||{}).bson)throw new TypeError("must pass in valid bson parser");this.id=x++,this.options=t,this.logger=h("Connection",t),this.bson=t.bson,this.tag=t.tag,this.maxBsonMessageSize=t.maxBsonMessageSize||67108864,this.port=t.port||27017,this.host=t.host||"localhost",this.socketTimeout="number"==typeof t.socketTimeout?t.socketTimeout:0,this.keepAlive="boolean"!=typeof t.keepAlive||t.keepAlive,this.keepAliveInitialDelay="number"==typeof t.keepAliveInitialDelay?t.keepAliveInitialDelay:12e4,this.connectionTimeout="number"==typeof t.connectionTimeout?t.connectionTimeout:3e4,this.keepAliveInitialDelay>this.socketTimeout&&(this.keepAliveInitialDelay=Math.round(this.socketTimeout/2)),this.logger.isDebug()&&this.logger.debug(`creating connection ${this.id} with options [${JSON.stringify(r(w,t))}]`),this.responseOptions={promoteLongs:"boolean"!=typeof t.promoteLongs||t.promoteLongs,promoteValues:"boolean"!=typeof t.promoteValues||t.promoteValues,promoteBuffers:"boolean"==typeof t.promoteBuffers&&t.promoteBuffers},this.flushing=!1,this.queue=[],this.writeStream=null,this.destroyed=!1,this.timedOut=!1;const n=o.createHash("sha1");var i,s,a;n.update(this.address),this.hashedName=n.digest("hex"),this.workItems=[],this.socket=e,this.socket.once("error",(i=this,function(e){_&&O(i.id),i.logger.isDebug()&&i.logger.debug(`connection ${i.id} for [${i.address}] errored out with [${JSON.stringify(e)}]`),i.emit("error",new p(e),i)})),this.socket.once("timeout",function(e){return function(){_&&O(e.id),e.logger.isDebug()&&e.logger.debug(`connection ${e.id} for [${e.address}] timed out`),e.timedOut=!0,e.emit("timeout",new u(`connection ${e.id} to ${e.address} timed out`,{beforeHandshake:null==e.ismaster}),e)}}(this)),this.socket.once("close",function(e){return function(t){_&&O(e.id),e.logger.isDebug()&&e.logger.debug(`connection ${e.id} with for [${e.address}] closed`),t||e.emit("close",new p(`connection ${e.id} to ${e.address} closed`),e)}}(this)),this.socket.on("data",function(e){return function(t){for(;t.length>0;)if(e.bytesRead>0&&e.sizeOfMessage>0){const n=e.sizeOfMessage-e.bytesRead;if(n>t.length)t.copy(e.buffer,e.bytesRead),e.bytesRead=e.bytesRead+t.length,t=y.alloc(0);else{t.copy(e.buffer,e.bytesRead,0,n),t=t.slice(n);const i=e.buffer;e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,k(e,i)}}else if(null!=e.stubBuffer&&e.stubBuffer.length>0)if(e.stubBuffer.length+t.length>4){const n=y.alloc(e.stubBuffer.length+t.length);e.stubBuffer.copy(n,0),t.copy(n,e.stubBuffer.length),t=n,e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null}else{const n=y.alloc(e.stubBuffer.length+t.length);e.stubBuffer.copy(n,0),t.copy(n,e.stubBuffer.length),t=y.alloc(0)}else if(t.length>4){const n=t[0]|t[1]<<8|t[2]<<16|t[3]<<24;if(n<0||n>e.maxBsonMessageSize){const t={err:"socketHandler",trace:"",bin:e.buffer,parseState:{sizeOfMessage:n,bytesRead:e.bytesRead,stubBuffer:e.stubBuffer}};return void e.emit("parseError",t,e)}if(n>4&&n<e.maxBsonMessageSize&&n>t.length)e.buffer=y.alloc(n),t.copy(e.buffer,0),e.bytesRead=t.length,e.sizeOfMessage=n,e.stubBuffer=null,t=y.alloc(0);else if(n>4&&n<e.maxBsonMessageSize&&n===t.length){const n=t;e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,t=y.alloc(0),k(e,n)}else if(n<=4||n>e.maxBsonMessageSize){const i={err:"socketHandler",trace:null,bin:t,parseState:{sizeOfMessage:n,bytesRead:0,buffer:null,stubBuffer:null}};e.emit("parseError",i,e),e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,t=y.alloc(0)}else{const i=t.slice(0,n);e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,t=t.slice(n),k(e,i)}}else e.stubBuffer=y.alloc(t.length),t.copy(e.stubBuffer,0),t=y.alloc(0)}}(this)),_&&(s=this.id,a=this,T[s]=a,S&&S.addConnection(s,a))}setSocketTimeout(e){this.socket&&this.socket.setTimeout(e)}resetSocketTimeout(){this.socket&&this.socket.setTimeout(this.socketTimeout)}static enableConnectionAccounting(e){e&&(S=e),_=!0,T={}}static disableConnectionAccounting(){_=!1,S=void 0}static connections(){return T}get address(){return`${this.host}:${this.port}`}unref(){null!=this.socket?this.socket.unref():this.once("connect",()=>this.socket.unref())}flush(e){for(;this.workItems.length>0;){const t=this.workItems.shift();t.cb&&t.cb(e)}}destroy(e,t){if("function"==typeof e&&(t=e,e={}),e=Object.assign({force:!1},e),_&&O(this.id),null!=this.socket)return e.force||this.timedOut?(this.socket.destroy(),this.destroyed=!0,void("function"==typeof t&&t(null,null))):void this.socket.end(e=>{this.destroyed=!0,"function"==typeof t&&t(e,null)});this.destroyed=!0}write(e){if(this.logger.isDebug())if(Array.isArray(e))for(let t=0;t<e.length;t++)this.logger.debug(`writing buffer [${e[t].toString("hex")}] to ${this.address}`);else this.logger.debug(`writing buffer [${e.toString("hex")}] to ${this.address}`);if(!1===this.socket.destroyed){if(!Array.isArray(e))return this.socket.write(e,"binary"),!0;for(let t=0;t<e.length;t++)this.socket.write(e[t],"binary");return!0}return!1}toString(){return""+this.id}toJSON(){return{id:this.id,host:this.host,port:this.port}}isConnected(){return!this.destroyed&&(!this.socket.destroyed&&this.socket.writable)}command(e,t,n,i){"function"==typeof n&&(i=n,n={});const o=this,r="number"==typeof n.socketTimeout?n.socketTimeout:0,s=o.options.bson,a=new v(s,e,t,{numberToSkip:0,numberToReturn:1}),c=()=>{};function l(e,t){i(e,t),i=c}function p(e){o.resetSocketTimeout(),E.forEach(e=>o.removeListener(e,p)),o.removeListener("message",u),null==e&&(e=new d(`runCommand failed for connection to '${o.address}'`)),o.on("error",c),l(e)}function u(e){if(e.responseTo!==a.requestId)return;o.resetSocketTimeout(),E.forEach(e=>o.removeListener(e,p)),o.removeListener("message",u),e.parse({promoteValues:!0});const t=e.documents[0];0===t.ok||t.$err||t.errmsg||t.code?l(new d(t)):l(void 0,new b(t,this,e))}o.setSocketTimeout(r),E.forEach(e=>o.once(e,p)),o.on("message",u),o.write(a.toBin())}}},function(e,t,n){"use strict";const i=n(13).ServerType,o=n(30).ServerDescription,r=n(94),s=n(13).TopologyType,a=r.MIN_SUPPORTED_SERVER_VERSION,c=r.MAX_SUPPORTED_SERVER_VERSION,l=r.MIN_SUPPORTED_WIRE_VERSION,p=r.MAX_SUPPORTED_WIRE_VERSION;class u{constructor(e,t,n,o,r,u,d){d=d||{},this.type=e||s.Unknown,this.setName=n||null,this.maxSetVersion=o||null,this.maxElectionId=r||null,this.servers=t||new Map,this.stale=!1,this.compatible=!0,this.compatibilityError=null,this.logicalSessionTimeoutMinutes=null,this.heartbeatFrequencyMS=d.heartbeatFrequencyMS||0,this.localThresholdMS=d.localThresholdMS||0,this.commonWireVersion=u||null,Object.defineProperty(this,"options",{value:d,enumberable:!1});for(const e of this.servers.values())if(e.type!==i.Unknown&&(e.minWireVersion>p&&(this.compatible=!1,this.compatibilityError=`Server at ${e.address} requires wire version ${e.minWireVersion}, but this version of the driver only supports up to ${p} (MongoDB ${c})`),e.maxWireVersion<l)){this.compatible=!1,this.compatibilityError=`Server at ${e.address} reports wire version ${e.maxWireVersion}, but this version of the driver requires at least ${l} (MongoDB ${a}).`;break}const h=Array.from(this.servers.values()).filter(e=>e.isReadable);this.logicalSessionTimeoutMinutes=h.reduce((e,t)=>null==t.logicalSessionTimeoutMinutes?null:null==e?t.logicalSessionTimeoutMinutes:Math.min(e,t.logicalSessionTimeoutMinutes),null)}updateFromSrvPollingEvent(e){const t=e.addresses(),n=new Map(this.servers);for(const e of this.servers)t.has(e[0])?t.delete(e[0]):n.delete(e[0]);if(n.size===this.servers.size&&0===t.size)return this;for(const e of t)n.set(e,new o(e));return new u(this.type,n,this.setName,this.maxSetVersion,this.maxElectionId,this.commonWireVersion,this.options,null)}update(e){const t=e.address;let n=this.type,r=this.setName,a=this.maxSetVersion,c=this.maxElectionId,l=this.commonWireVersion;e.setName&&r&&e.setName!==r&&(e=new o(t,null));const p=e.type;let f=new Map(this.servers);if(0!==e.maxWireVersion&&(l=null==l?e.maxWireVersion:Math.min(l,e.maxWireVersion)),f.set(t,e),n===s.Single)return new u(s.Single,f,r,a,c,l,this.options);if(n===s.Unknown&&(p===i.Standalone&&1!==this.servers.size?f.delete(t):n=function(e){if(e===i.Standalone)return s.Single;if(e===i.Mongos)return s.Sharded;if(e===i.RSPrimary)return s.ReplicaSetWithPrimary;if(e===i.RSGhost||e===i.Unknown)return s.Unknown;return s.ReplicaSetNoPrimary}(p)),n===s.Sharded&&-1===[i.Mongos,i.Unknown].indexOf(p)&&f.delete(t),n===s.ReplicaSetNoPrimary)if([i.Standalone,i.Mongos].indexOf(p)>=0&&f.delete(t),p===i.RSPrimary){const t=d(f,r,e,a,c);n=t[0],r=t[1],a=t[2],c=t[3]}else if([i.RSSecondary,i.RSArbiter,i.RSOther].indexOf(p)>=0){const t=function(e,t,n){let i=s.ReplicaSetNoPrimary;if((t=t||n.setName)!==n.setName)return e.delete(n.address),[i,t];n.allHosts.forEach(t=>{e.has(t)||e.set(t,new o(t))}),n.me&&n.address!==n.me&&e.delete(n.address);return[i,t]}(f,r,e);n=t[0],r=t[1]}if(n===s.ReplicaSetWithPrimary)if([i.Standalone,i.Mongos].indexOf(p)>=0)f.delete(t),n=h(f);else if(p===i.RSPrimary){const t=d(f,r,e,a,c);n=t[0],r=t[1],a=t[2],c=t[3]}else n=[i.RSSecondary,i.RSArbiter,i.RSOther].indexOf(p)>=0?function(e,t,n){if(null==t)throw new TypeError("setName is required");(t!==n.setName||n.me&&n.address!==n.me)&&e.delete(n.address);return h(e)}(f,r,e):h(f);return new u(n,f,r,a,c,l,this.options)}get error(){const e=Array.from(this.servers.values()).filter(e=>e.error);if(e.length>0)return e[0].error}get hasKnownServers(){return Array.from(this.servers.values()).some(e=>e.type!==i.Unknown)}get hasDataBearingServers(){return Array.from(this.servers.values()).some(e=>e.isDataBearing)}hasServer(e){return this.servers.has(e)}}function d(e,t,n,r,s){if((t=t||n.setName)!==n.setName)return e.delete(n.address),[h(e),t,r,s];const a=n.electionId?n.electionId:null;if(n.setVersion&&a){if(r&&s&&(r>n.setVersion||function(e,t){if(null==e)return-1;if(null==t)return 1;if(e.id instanceof Buffer&&t.id instanceof Buffer){const n=e.id,i=t.id;return n.compare(i)}const n=e.toString(),i=t.toString();return n.localeCompare(i)}(s,a)>0))return e.set(n.address,new o(n.address)),[h(e),t,r,s];s=n.electionId}null!=n.setVersion&&(null==r||n.setVersion>r)&&(r=n.setVersion);for(const t of e.keys()){const r=e.get(t);if(r.type===i.RSPrimary&&r.address!==n.address){e.set(t,new o(r.address));break}}n.allHosts.forEach(t=>{e.has(t)||e.set(t,new o(t))});const c=Array.from(e.keys()),l=n.allHosts;return c.filter(e=>-1===l.indexOf(e)).forEach(t=>{e.delete(t)}),[h(e),t,r,s]}function h(e){for(const t of e.keys())if(e.get(t).type===i.RSPrimary)return s.ReplicaSetWithPrimary;return s.ReplicaSetNoPrimary}e.exports={TopologyDescription:u}},function(e,t,n){"use strict";t.asyncIterator=function(){const e=this;return{next:function(){return Promise.resolve().then(()=>e.next()).then(t=>t?{value:t,done:!1}:e.close().then(()=>({value:t,done:!0})))}}}},function(e,t,n){"use strict";e.exports={MIN_SUPPORTED_SERVER_VERSION:"2.6",MAX_SUPPORTED_SERVER_VERSION:"4.4",MIN_SUPPORTED_WIRE_VERSION:2,MAX_SUPPORTED_WIRE_VERSION:9}},function(e,t,n){"use strict";const i=n(31).Msg,o=n(18).KillCursor,r=n(18).GetMore,s=n(0).calculateDurationInMs,a=new Set(["authenticate","saslStart","saslContinue","getnonce","createUser","updateUser","copydbgetnonce","copydbsaslstart","copydb"]),c=e=>Object.keys(e)[0],l=e=>e.ns,p=e=>e.ns.split(".")[0],u=e=>e.ns.split(".")[1],d=e=>e.options?`${e.options.host}:${e.options.port}`:e.address,h=(e,t)=>a.has(e)?{}:t,f={$query:"filter",$orderby:"sort",$hint:"hint",$comment:"comment",$maxScan:"maxScan",$max:"max",$min:"min",$returnKey:"returnKey",$showDiskLoc:"showRecordId",$maxTimeMS:"maxTimeMS",$snapshot:"snapshot"},m={numberToSkip:"skip",numberToReturn:"batchSize",returnFieldsSelector:"projection"},g=["tailable","oplogReplay","noCursorTimeout","awaitData","partial","exhaust"],y=e=>{if(e instanceof r)return{getMore:e.cursorId,collection:u(e),batchSize:e.numberToReturn};if(e instanceof o)return{killCursors:u(e),cursors:e.cursorIds};if(e instanceof i)return e.command;if(e.query&&e.query.$query){let t;return"admin.$cmd"===e.ns?t=Object.assign({},e.query.$query):(t={find:u(e)},Object.keys(f).forEach(n=>{void 0!==e.query[n]&&(t[f[n]]=e.query[n])})),Object.keys(m).forEach(n=>{void 0!==e[n]&&(t[m[n]]=e[n])}),g.forEach(n=>{e[n]&&(t[n]=e[n])}),void 0!==e.pre32Limit&&(t.limit=e.pre32Limit),e.query.$explain?{explain:t}:t}return e.query?e.query:e},v=(e,t)=>e instanceof r?{ok:1,cursor:{id:t.message.cursorId,ns:l(e),nextBatch:t.message.documents}}:e instanceof o?{ok:1,cursorsUnknown:e.cursorIds}:e.query&&void 0!==e.query.$query?{ok:1,cursor:{id:t.message.cursorId,ns:l(e),firstBatch:t.message.documents}}:t&&t.result?t.result:t,b=e=>{if((e=>e.s&&e.queue)(e))return{connectionId:d(e)};const t=e;return{address:t.address,connectionId:t.id}};e.exports={CommandStartedEvent:class{constructor(e,t){const n=y(t),i=c(n),o=b(e);a.has(i)&&(this.commandObj={},this.commandObj[i]=!0),Object.assign(this,o,{requestId:t.requestId,databaseName:p(t),commandName:i,command:n})}},CommandSucceededEvent:class{constructor(e,t,n,i){const o=y(t),r=c(o),a=b(e);Object.assign(this,a,{requestId:t.requestId,commandName:r,duration:s(i),reply:h(r,v(t,n))})}},CommandFailedEvent:class{constructor(e,t,n,i){const o=y(t),r=c(o),a=b(e);Object.assign(this,a,{requestId:t.requestId,commandName:r,duration:s(i),failure:h(r,n)})}}}},function(e,t){e.exports=require("net")},function(e,t,n){"use strict";const i=n(98),o=n(99),r=n(100),s=n(101),a=n(56).ScramSHA1,c=n(56).ScramSHA256,l=n(151);e.exports={defaultAuthProviders:function(e){return{"mongodb-aws":new l(e),mongocr:new i(e),x509:new o(e),plain:new r(e),gssapi:new s(e),"scram-sha-1":new a(e),"scram-sha-256":new c(e)}}}},function(e,t,n){"use strict";const i=n(17),o=n(26).AuthProvider;e.exports=class extends o{auth(e,t){const n=e.connection,o=e.credentials,r=o.username,s=o.password,a=o.source;n.command(a+".$cmd",{getnonce:1},(e,o)=>{let c=null,l=null;if(null==e){c=o.result.nonce;let e=i.createHash("md5");e.update(r+":mongo:"+s,"utf8");const t=e.digest("hex");e=i.createHash("md5"),e.update(c+r+t,"utf8"),l=e.digest("hex")}const p={authenticate:1,user:r,nonce:c,key:l};n.command(a+".$cmd",p,t)})}}},function(e,t,n){"use strict";const i=n(26).AuthProvider;function o(e){const t={authenticate:1,mechanism:"MONGODB-X509"};return e.username&&Object.assign(t,{user:e.username}),t}e.exports=class extends i{prepare(e,t,n){const i=t.credentials;Object.assign(e,{speculativeAuthenticate:o(i)}),n(void 0,e)}auth(e,t){const n=e.connection,i=e.credentials;if(e.response.speculativeAuthenticate)return t();n.command("$external.$cmd",o(i),t)}}},function(e,t,n){"use strict";const i=n(9).retrieveBSON,o=n(26).AuthProvider,r=i().Binary;e.exports=class extends o{auth(e,t){const n=e.connection,i=e.credentials,o=i.username,s=i.password,a={saslStart:1,mechanism:"PLAIN",payload:new r(`\0${o}\0${s}`),autoAuthorize:1};n.command("$external.$cmd",a,t)}}},function(e,t,n){"use strict";const i=n(45),o=n(26).AuthProvider,r=n(4).retrieveKerberos,s=n(2).MongoError;let a;e.exports=class extends o{auth(e,t){const n=e.connection,o=e.credentials;if(null==o)return t(new s("credentials required"));const c=o.username;function l(e,t){return n.command("$external.$cmd",e,t)}!function(e,t){const n=e.options.host,o=e.options.port,c=e.credentials;if(!n||!o||!c)return t(new s(`Connection must specify: ${n?"host":""}, ${o?"port":""}, ${c?"host":"credentials"}.`));if(null==a)try{a=r()}catch(e){return t(e)}const l=c.username,p=c.password,u=c.mechanismProperties,d=u.gssapiservicename||u.gssapiServiceName||"mongodb";!function(e,t,n){if("boolean"!=typeof t.gssapiCanonicalizeHostName||!t.gssapiCanonicalizeHostName)return n(void 0,e);i.resolveCname(e,(t,i)=>t?n(t):Array.isArray(i)&&i.length>0?n(void 0,i[0]):void n(void 0,e))}(n,u,(e,n)=>{if(e)return t(e);const i={};null!=p&&Object.assign(i,{user:l,password:p}),a.initializeClient(`${d}${"win32"===process.platform?"/":"@"}${n}`,i,(e,n)=>{if(e)return t(new s(e));t(null,n)})})}(e,(e,n)=>e?t(e):null==n?t(new s("gssapi client missing")):void n.step("",(e,i)=>{if(e)return t(e);l(function(e){return{saslStart:1,mechanism:"GSSAPI",payload:e,autoAuthorize:1}}(i),(e,i)=>{if(e)return t(e);const o=i.result;!function e(t,n,i,o){t.step(i,(r,s)=>r&&0===n?o(r):r?e(t,n-1,i,o):void o(void 0,s||""))}(n,10,o.payload,(e,i)=>{if(e)return t(e);l(function(e,t){return{saslContinue:1,conversationId:t,payload:e}}(i,o.conversationId),(e,i)=>{if(e)return t(e);const o=i.result;!function(e,t,n,i){e.unwrap(n,(n,o)=>{if(n)return i(n);e.wrap(o||"",{user:t},(e,t)=>{if(e)return i(e);i(void 0,t)})})}(n,c,o.payload,(e,n)=>{if(e)return t(e);l({saslContinue:1,conversationId:o.conversationId,payload:n},(e,n)=>{if(e)return t(e);t(void 0,n)})})})})})}))}}},function(e,t,n){"use strict";function i(e){if(e){if(Array.isArray(e.saslSupportedMechs))return e.saslSupportedMechs.indexOf("SCRAM-SHA-256")>=0?"scram-sha-256":"scram-sha-1";if(e.maxWireVersion>=3)return"scram-sha-1"}return"mongocr"}class o{constructor(e){e=e||{},this.username=e.username,this.password=e.password,this.source=e.source||e.db,this.mechanism=e.mechanism||"default",this.mechanismProperties=e.mechanismProperties||{},this.mechanism.match(/MONGODB-AWS/i)&&(null==this.username&&process.env.AWS_ACCESS_KEY_ID&&(this.username=process.env.AWS_ACCESS_KEY_ID),null==this.password&&process.env.AWS_SECRET_ACCESS_KEY&&(this.password=process.env.AWS_SECRET_ACCESS_KEY),null==this.mechanismProperties.AWS_SESSION_TOKEN&&process.env.AWS_SESSION_TOKEN&&(this.mechanismProperties.AWS_SESSION_TOKEN=process.env.AWS_SESSION_TOKEN)),Object.freeze(this.mechanismProperties),Object.freeze(this)}equals(e){return this.mechanism===e.mechanism&&this.username===e.username&&this.password===e.password&&this.source===e.source}resolveAuthMechanism(e){return this.mechanism.match(/DEFAULT/i)?new o({username:this.username,password:this.password,source:this.source,mechanism:i(e),mechanismProperties:this.mechanismProperties}):this}}e.exports={MongoCredentials:o}},function(e,t){e.exports=require("querystring")},function(e,t,n){"use strict";const i=n(154);e.exports={insert:function(e,t,n,o,r){i(e,"insert","documents",t,n,o,r)},update:function(e,t,n,o,r){i(e,"update","updates",t,n,o,r)},remove:function(e,t,n,o,r){i(e,"delete","deletes",t,n,o,r)},killCursors:n(155),getMore:n(156),query:n(157),command:n(37)}},function(e,t,n){"use strict";e.exports={ServerDescriptionChangedEvent:class{constructor(e,t,n,i){Object.assign(this,{topologyId:e,address:t,previousDescription:n,newDescription:i})}},ServerOpeningEvent:class{constructor(e,t){Object.assign(this,{topologyId:e,address:t})}},ServerClosedEvent:class{constructor(e,t){Object.assign(this,{topologyId:e,address:t})}},TopologyDescriptionChangedEvent:class{constructor(e,t,n){Object.assign(this,{topologyId:e,previousDescription:t,newDescription:n})}},TopologyOpeningEvent:class{constructor(e){Object.assign(this,{topologyId:e})}},TopologyClosedEvent:class{constructor(e){Object.assign(this,{topologyId:e})}},ServerHeartbeatStartedEvent:class{constructor(e){Object.assign(this,{connectionId:e})}},ServerHeartbeatSucceededEvent:class{constructor(e,t,n){Object.assign(this,{connectionId:n,duration:e,reply:t})}},ServerHeartbeatFailedEvent:class{constructor(e,t,n){Object.assign(this,{connectionId:n,duration:e,failure:t})}}}},function(e,t,n){"use strict";const i=n(8),o=n(164),r=n(2).MongoError,s=n(2).MongoNetworkError,a=n(2).MongoNetworkTimeoutError,c=n(2).MongoWriteConcernError,l=n(72),p=n(172).StreamDescription,u=n(104),d=n(95),h=n(27).updateSessionFromResponse,f=n(4).uuidV4,m=n(0).now,g=n(0).calculateDurationInMs,y=Symbol("stream"),v=Symbol("queue"),b=Symbol("messageStream"),x=Symbol("generation"),w=Symbol("lastUseTime"),S=Symbol("clusterTime"),_=Symbol("description"),T=Symbol("ismaster"),E=Symbol("autoEncrypter");function O(e){const t={description:e.description,clusterTime:e[S],s:{bson:e.bson,pool:{write:k.bind(e),isConnected:()=>!0}}};return e[E]&&(t.autoEncrypter=e[E]),t}function k(e,t,n){"function"==typeof t&&(n=t),t=t||{};const i={requestId:e.requestId,cb:n,session:t.session,fullResult:"boolean"==typeof t.fullResult&&t.fullResult,noResponse:"boolean"==typeof t.noResponse&&t.noResponse,documentsReturnedIn:t.documentsReturnedIn,command:!!t.command,promoteLongs:"boolean"!=typeof t.promoteLongs||t.promoteLongs,promoteValues:"boolean"!=typeof t.promoteValues||t.promoteValues,promoteBuffers:"boolean"==typeof t.promoteBuffers&&t.promoteBuffers,raw:"boolean"==typeof t.raw&&t.raw};this[_]&&this[_].compressor&&(i.agreedCompressor=this[_].compressor,this[_].zlibCompressionLevel&&(i.zlibCompressionLevel=this[_].zlibCompressionLevel)),"number"==typeof t.socketTimeout&&(i.socketTimeoutOverride=!0,this[y].setTimeout(t.socketTimeout)),this.monitorCommands&&(this.emit("commandStarted",new d.CommandStartedEvent(this,e)),i.started=m(),i.cb=(t,o)=>{t?this.emit("commandFailed",new d.CommandFailedEvent(this,e,t,i.started)):o&&o.result&&(0===o.result.ok||o.result.$err)?this.emit("commandFailed",new d.CommandFailedEvent(this,e,o.result,i.started)):this.emit("commandSucceeded",new d.CommandSucceededEvent(this,e,o,i.started)),"function"==typeof n&&n(t,o)}),i.noResponse||this[v].set(i.requestId,i);try{this[b].writeCommand(e,i)}catch(e){if(!i.noResponse)return this[v].delete(i.requestId),void i.cb(e)}i.noResponse&&i.cb()}e.exports={Connection:class extends i{constructor(e,t){var n;super(t),this.id=t.id,this.address=function(e){if("function"==typeof e.address)return`${e.remoteAddress}:${e.remotePort}`;return f().toString("hex")}(e),this.bson=t.bson,this.socketTimeout="number"==typeof t.socketTimeout?t.socketTimeout:0,this.host=t.host||"localhost",this.port=t.port||27017,this.monitorCommands="boolean"==typeof t.monitorCommands&&t.monitorCommands,this.closed=!1,this.destroyed=!1,this[_]=new p(this.address,t),this[x]=t.generation,this[w]=m(),t.autoEncrypter&&(this[E]=t.autoEncrypter),this[v]=new Map,this[b]=new o(t),this[b].on("message",(n=this,function(e){if(n.emit("message",e),!n[v].has(e.responseTo))return;const t=n[v].get(e.responseTo),i=t.cb;n[v].delete(e.responseTo),e.moreToCome?n[v].set(e.requestId,t):t.socketTimeoutOverride&&n[y].setTimeout(n.socketTimeout);try{e.parse(t)}catch(e){return void i(new r(e))}if(e.documents[0]){const o=e.documents[0],s=t.session;if(s&&h(s,o),o.$clusterTime&&(n[S]=o.$clusterTime,n.emit("clusterTimeReceived",o.$clusterTime)),t.command){if(o.writeConcernError)return void i(new c(o.writeConcernError,o));if(0===o.ok||o.$err||o.errmsg||o.code)return void i(new r(o))}}i(void 0,new l(t.fullResult?e:e.documents[0],n,e))})),this[y]=e,e.on("error",()=>{}),e.on("close",()=>{this.closed||(this.closed=!0,this[v].forEach(e=>e.cb(new s(`connection ${this.id} to ${this.address} closed`))),this[v].clear(),this.emit("close"))}),e.on("timeout",()=>{this.closed||(e.destroy(),this.closed=!0,this[v].forEach(e=>e.cb(new a(`connection ${this.id} to ${this.address} timed out`,{beforeHandshake:null==this[T]}))),this[v].clear(),this.emit("close"))}),e.pipe(this[b]),this[b].pipe(e)}get description(){return this[_]}get ismaster(){return this[T]}set ismaster(e){this[_].receiveResponse(e),this[T]=e}get generation(){return this[x]||0}get idleTime(){return g(this[w])}get clusterTime(){return this[S]}get stream(){return this[y]}markAvailable(){this[w]=m()}destroy(e,t){return"function"==typeof e&&(t=e,e={}),e=Object.assign({force:!1},e),null==this[y]||this.destroyed?(this.destroyed=!0,void("function"==typeof t&&t())):e.force?(this[y].destroy(),this.destroyed=!0,void("function"==typeof t&&t())):void this[y].end(e=>{this.destroyed=!0,"function"==typeof t&&t(e)})}command(e,t,n,i){u.command(O(this),e,t,n,i)}query(e,t,n,i,o){u.query(O(this),e,t,n,i,o)}getMore(e,t,n,i,o){u.getMore(O(this),e,t,n,i,o)}killCursors(e,t,n){u.killCursors(O(this),e,t,n)}insert(e,t,n,i){u.insert(O(this),e,t,n,i)}update(e,t,n,i){u.update(O(this),e,t,n,i)}remove(e,t,n,i){u.remove(O(this),e,t,n,i)}}}},function(e,t,n){"use strict";var i=n(57);e.exports=v;var o,r=n(167);v.ReadableState=y;n(8).EventEmitter;var s=function(e,t){return e.listeners(t).length},a=n(108),c=n(58).Buffer,l=global.Uint8Array||function(){};var p=Object.create(n(39));p.inherits=n(40);var u=n(5),d=void 0;d=u&&u.debuglog?u.debuglog("stream"):function(){};var h,f=n(169),m=n(109);p.inherits(v,a);var g=["error","close","destroy","pause","resume"];function y(e,t){e=e||{};var i=t instanceof(o=o||n(33));this.objectMode=!!e.objectMode,i&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,s=e.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new f,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(h||(h=n(111).StringDecoder),this.decoder=new h(e.encoding),this.encoding=e.encoding)}function v(e){if(o=o||n(33),!(this instanceof v))return new v(e);this._readableState=new y(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),a.call(this)}function b(e,t,n,i,o){var r,s=e._readableState;null===t?(s.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,S(e)}(e,s)):(o||(r=function(e,t){var n;i=t,c.isBuffer(i)||i instanceof l||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk"));var i;return n}(s,t)),r?e.emit("error",r):s.objectMode||t&&t.length>0?("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===c.prototype||(t=function(e){return c.from(e)}(t)),i?s.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):x(e,s,t,!0):s.ended?e.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!n?(t=s.decoder.write(t),s.objectMode||0!==t.length?x(e,s,t,!1):T(e,s)):x(e,s,t,!1))):i||(s.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(s)}function x(e,t,n,i){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&S(e)),T(e,t)}Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),v.prototype.destroy=m.destroy,v.prototype._undestroy=m.undestroy,v.prototype._destroy=function(e,t){this.push(null),t(e)},v.prototype.push=function(e,t){var n,i=this._readableState;return i.objectMode?n=!0:"string"==typeof e&&((t=t||i.defaultEncoding)!==i.encoding&&(e=c.from(e,t),t=""),n=!0),b(this,e,t,!1,n)},v.prototype.unshift=function(e){return b(this,e,null,!0,!1)},v.prototype.isPaused=function(){return!1===this._readableState.flowing},v.prototype.setEncoding=function(e){return h||(h=n(111).StringDecoder),this._readableState.decoder=new h(e),this._readableState.encoding=e,this};function w(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=8388608?e=8388608:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function S(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(d("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(_,e):_(e))}function _(e){d("emit readable"),e.emit("readable"),C(e)}function T(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(E,e,t))}function E(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(d("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function O(e){d("readable nexttick read 0"),e.read(0)}function k(e,t){t.reading||(d("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),C(e),t.flowing&&!t.reading&&e.read(0)}function C(e){var t=e._readableState;for(d("flow",t.flowing);t.flowing&&null!==e.read(););}function A(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var i;e<t.head.data.length?(i=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):i=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,i=1,o=n.data;e-=o.length;for(;n=n.next;){var r=n.data,s=e>r.length?r.length:e;if(s===r.length?o+=r:o+=r.slice(0,e),0===(e-=s)){s===r.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=r.slice(s));break}++i}return t.length-=i,o}(e,t):function(e,t){var n=c.allocUnsafe(e),i=t.head,o=1;i.data.copy(n),e-=i.data.length;for(;i=i.next;){var r=i.data,s=e>r.length?r.length:e;if(r.copy(n,n.length-e,0,s),0===(e-=s)){s===r.length?(++o,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i,i.data=r.slice(s));break}++o}return t.length-=o,n}(e,t);return i}(e,t.buffer,t.decoder),n);var n}function I(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(N,t,e))}function N(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function M(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}v.prototype.read=function(e){d("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return d("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?I(this):S(this),null;if(0===(e=w(e,t))&&t.ended)return 0===t.length&&I(this),null;var i,o=t.needReadable;return d("need readable",o),(0===t.length||t.length-e<t.highWaterMark)&&d("length less than watermark",o=!0),t.ended||t.reading?d("reading or ended",o=!1):o&&(d("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=w(n,t))),null===(i=e>0?A(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&I(this)),null!==i&&this.emit("data",i),i},v.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},v.prototype.pipe=function(e,t){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,d("pipe count=%d opts=%j",o.pipesCount,t);var a=(!t||!1!==t.end)&&e!==process.stdout&&e!==process.stderr?l:v;function c(t,i){d("onunpipe"),t===n&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,d("cleanup"),e.removeListener("close",g),e.removeListener("finish",y),e.removeListener("drain",p),e.removeListener("error",m),e.removeListener("unpipe",c),n.removeListener("end",l),n.removeListener("end",v),n.removeListener("data",f),u=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||p())}function l(){d("onend"),e.end()}o.endEmitted?i.nextTick(a):n.once("end",a),e.on("unpipe",c);var p=function(e){return function(){var t=e._readableState;d("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,C(e))}}(n);e.on("drain",p);var u=!1;var h=!1;function f(t){d("ondata"),h=!1,!1!==e.write(t)||h||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==M(o.pipes,e))&&!u&&(d("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,h=!0),n.pause())}function m(t){d("onerror",t),v(),e.removeListener("error",m),0===s(e,"error")&&e.emit("error",t)}function g(){e.removeListener("finish",y),v()}function y(){d("onfinish"),e.removeListener("close",g),v()}function v(){d("unpipe"),n.unpipe(e)}return n.on("data",f),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?r(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",m),e.once("close",g),e.once("finish",y),e.emit("pipe",n),o.flowing||(d("pipe resume"),n.resume()),e},v.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var i=t.pipes,o=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var r=0;r<o;r++)i[r].emit("unpipe",this,n);return this}var s=M(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},v.prototype.on=function(e,t){var n=a.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var o=this._readableState;o.endEmitted||o.readableListening||(o.readableListening=o.needReadable=!0,o.emittedReadable=!1,o.reading?o.length&&S(this):i.nextTick(O,this))}return n},v.prototype.addListener=v.prototype.on,v.prototype.resume=function(){var e=this._readableState;return e.flowing||(d("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(k,e,t))}(this,e)),this},v.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this},v.prototype.wrap=function(e){var t=this,n=this._readableState,i=!1;for(var o in e.on("end",(function(){if(d("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(o){(d("wrapped data"),n.decoder&&(o=n.decoder.write(o)),n.objectMode&&null==o)||(n.objectMode||o&&o.length)&&(t.push(o)||(i=!0,e.pause()))})),e)void 0===this[o]&&"function"==typeof e[o]&&(this[o]=function(t){return function(){return e[t].apply(e,arguments)}}(o));for(var r=0;r<g.length;r++)e.on(g[r],this.emit.bind(this,g[r]));return this._read=function(t){d("wrapped _read",t),i&&(i=!1,e.resume())},this},Object.defineProperty(v.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),v._fromList=A},function(e,t,n){e.exports=n(14)},function(e,t,n){"use strict";var i=n(57);function o(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,r=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return r||s?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||i.nextTick(o,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(i.nextTick(o,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){"use strict";var i=n(57);function o(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var i=e.entry;e.entry=null;for(;i;){var o=i.callback;t.pendingcb--,o(n),i=i.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=g;var r,s=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:i.nextTick;g.WritableState=m;var a=Object.create(n(39));a.inherits=n(40);var c={deprecate:n(170)},l=n(108),p=n(58).Buffer,u=global.Uint8Array||function(){};var d,h=n(109);function f(){}function m(e,t){r=r||n(33),e=e||{};var a=t instanceof r;this.objectMode=!!e.objectMode,a&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var c=e.highWaterMark,l=e.writableHighWaterMark,p=this.objectMode?16:16384;this.highWaterMark=c||0===c?c:a&&(l||0===l)?l:p,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var u=!1===e.decodeStrings;this.decodeStrings=!u,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,o=n.sync,r=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,o,r){--t.pendingcb,n?(i.nextTick(r,o),i.nextTick(S,e,t),e._writableState.errorEmitted=!0,e.emit("error",o)):(r(o),e._writableState.errorEmitted=!0,e.emit("error",o),S(e,t))}(e,n,o,t,r);else{var a=x(n);a||n.corked||n.bufferProcessing||!n.bufferedRequest||b(e,n),o?s(v,e,n,a,r):v(e,n,a,r)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function g(e){if(r=r||n(33),!(d.call(g,this)||this instanceof r))return new g(e);this._writableState=new m(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),l.call(this)}function y(e,t,n,i,o,r,s){t.writelen=i,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(o,t.onwrite):e._write(o,r,t.onwrite),t.sync=!1}function v(e,t,n,i){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,i(),S(e,t)}function b(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var i=t.bufferedRequestCount,r=new Array(i),s=t.corkedRequestsFree;s.entry=n;for(var a=0,c=!0;n;)r[a]=n,n.isBuf||(c=!1),n=n.next,a+=1;r.allBuffers=c,y(e,t,!0,t.length,r,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new o(t),t.bufferedRequestCount=0}else{for(;n;){var l=n.chunk,p=n.encoding,u=n.callback;if(y(e,t,!1,t.objectMode?1:l.length,l,p,u),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function x(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function w(e,t){e._final((function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),S(e,t)}))}function S(e,t){var n=x(t);return n&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,i.nextTick(w,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}a.inherits(g,l),m.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(m.prototype,"buffer",{get:c.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(d=Function.prototype[Symbol.hasInstance],Object.defineProperty(g,Symbol.hasInstance,{value:function(e){return!!d.call(this,e)||this===g&&(e&&e._writableState instanceof m)}})):d=function(e){return e instanceof this},g.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},g.prototype.write=function(e,t,n){var o,r=this._writableState,s=!1,a=!r.objectMode&&(o=e,p.isBuffer(o)||o instanceof u);return a&&!p.isBuffer(e)&&(e=function(e){return p.from(e)}(e)),"function"==typeof t&&(n=t,t=null),a?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=f),r.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),i.nextTick(t,n)}(this,n):(a||function(e,t,n,o){var r=!0,s=!1;return null===n?s=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),i.nextTick(o,s),r=!1),r}(this,r,e,n))&&(r.pendingcb++,s=function(e,t,n,i,o,r){if(!n){var s=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=p.from(t,n));return t}(t,i,o);i!==s&&(n=!0,o="buffer",i=s)}var a=t.objectMode?1:i.length;t.length+=a;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:i,encoding:o,isBuf:n,callback:r,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else y(e,t,!1,a,i,o,r);return c}(this,r,a,e,t,n)),s},g.prototype.cork=function(){this._writableState.corked++},g.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||b(this,e))},g.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(g.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),g.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},g.prototype._writev=null,g.prototype.end=function(e,t,n){var o=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),o.corked&&(o.corked=1,this.uncork()),o.ending||o.finished||function(e,t,n){t.ending=!0,S(e,t),n&&(t.finished?i.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,o,n)},Object.defineProperty(g.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),g.prototype.destroy=h.destroy,g.prototype._undestroy=h.undestroy,g.prototype._destroy=function(e,t){this.end(),t(e)}},function(e,t,n){"use strict";var i=n(58).Buffer,o=i.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function r(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(i.isEncoding===o||!o(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=l,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=p,this.end=u,t=3;break;default:return this.write=d,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=i.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var i=n.charCodeAt(n.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function l(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function p(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function u(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function h(e){return e&&e.length?this.write(e):""}t.StringDecoder=r,r.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},r.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},r.prototype.text=function(e,t){var n=function(e,t,n){var i=t.length-1;if(i<n)return 0;var o=s(t[i]);if(o>=0)return o>0&&(e.lastNeed=o-1),o;if(--i<n||-2===o)return 0;if((o=s(t[i]))>=0)return o>0&&(e.lastNeed=o-2),o;if(--i<n||-2===o)return 0;if((o=s(t[i]))>=0)return o>0&&(2===o?o=0:e.lastNeed=o-3),o;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var i=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,i),e.toString("utf8",t,i)},r.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){"use strict";e.exports=s;var i=n(33),o=Object.create(n(39));function r(e,t){var n=this._transformState;n.transforming=!1;var i=n.writecb;if(!i)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),i(e);var o=this._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&this._read(o.highWaterMark)}function s(e){if(!(this instanceof s))return new s(e);i.call(this,e),this._transformState={afterTransform:r.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",a)}function a(){var e=this;"function"==typeof this._flush?this._flush((function(t,n){c(e,t,n)})):c(this,null,null)}function c(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}o.inherits=n(40),o.inherits(s,i),s.prototype.push=function(e,t){return this._transformState.needTransform=!1,i.prototype.push.call(this,e,t)},s.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},s.prototype._write=function(e,t,n){var i=this._transformState;if(i.writecb=n,i.writechunk=e,i.writeencoding=t,!i.transforming){var o=this._readableState;(i.needTransform||o.needReadable||o.length<o.highWaterMark)&&this._read(o.highWaterMark)}},s.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},s.prototype._destroy=function(e,t){var n=this;i.prototype._destroy.call(this,e,(function(e){t(e),n.emit("close")}))}},function(e,t,n){"use strict";const i=n(1).MongoNetworkError,o=new Set([6,7,89,91,189,262,9001,10107,11600,11602,13435,13436,63,150,13388,234,133,43]);e.exports={GET_MORE_RESUMABLE_CODES:o,isResumableError:function(e,t){return e instanceof i||(t>=9?43===e.code||e.hasErrorLabel("ResumableChangeStreamError"):o.has(e.code))}}},function(e,t,n){"use strict";const i=n(0).applyRetryableWrites,o=n(0).applyWriteConcern,r=n(1).MongoError,s=n(3).OperationBase;e.exports=class extends s{constructor(e,t,n){super(n),this.collection=e,this.operations=t}execute(e){const t=this.collection,n=this.operations;let s=this.options;t.s.options.ignoreUndefined&&(s=Object.assign({},s),s.ignoreUndefined=t.s.options.ignoreUndefined);const a=!0===s.ordered||null==s.ordered?t.initializeOrderedBulkOp(s):t.initializeUnorderedBulkOp(s);let c=!1;try{for(let e=0;e<n.length;e++){const t=Object.keys(n[e])[0];n[e][t].collation&&(c=!0),a.raw(n[e])}}catch(t){return e(t,null)}let l=Object.assign({},s);l=i(l,t.s.db),l=o(l,{db:t.s.db,collection:t},s);const p=l.writeConcern?l.writeConcern:{},u=t.s.topology.capabilities();if(c&&u&&!u.commandsTakeCollation)return e(new r("server/primary/mongos does not support collation"));a.execute(p,l,(t,n)=>{if(!n&&t)return e(t,null);n.insertedCount=n.nInserted,n.matchedCount=n.nMatched,n.modifiedCount=n.nModified||0,n.deletedCount=n.nRemoved,n.upsertedCount=n.getUpsertedIds().length,n.upsertedIds={},n.insertedIds={},n.n=n.insertedCount;const i=n.getInsertedIds();for(let e=0;e<i.length;e++)n.insertedIds[i[e].index]=i[e]._id;const o=n.getUpsertedIds();for(let e=0;e<o.length;e++)n.upsertedIds[o[e].index]=o[e]._id;e(null,n)})}}},function(e,t,n){"use strict";const i=n(3).Aspect,o=n(3).defineAspects,r=n(22),s=n(1).MongoError,a=n(0).parseIndexOptions,c=n(4).maxWireVersion,l=new Set(["background","unique","name","partialFilterExpression","sparse","expireAfterSeconds","storageEngine","collation","weights","default_language","language_override","textIndexVersion","2dsphereIndexVersion","bits","min","max","bucketSize","wildcardProjection"]);class p extends r{constructor(e,t,n,i){if(super(e,i),this.collection=t,Array.isArray(n)&&!Array.isArray(n[0]))this.indexes=n;else{this.onlyReturnNameOfCreatedIndex=!0;const e=a(n),t={name:"string"==typeof i.name?i.name:e.name,key:e.fieldHash};for(let e in i)l.has(e)&&(t[e]=i[e]);this.indexes=[t]}}execute(e,t){const n=this.options,i=this.indexes,o=c(e);for(let n=0;n<i.length;n++){if(i[n].collation&&o<5)return void t(new s(`Server ${e.name}, which reports wire version ${o}, does not support collation`));if(null==i[n].name){const e=[];for(let t in i[n].key)e.push(`${t}_${i[n].key[t]}`);i[n].name=e.join("_")}}const r={createIndexes:this.collection,indexes:i};if(null!=n.commitQuorum){if(o<9)return void t(new s("`commitQuorum` option for `createIndexes` not supported on servers < 4.4"));r.commitQuorum=n.commitQuorum}this.options.collation=void 0,super.executeCommand(e,r,(e,n)=>{e?t(e):t(null,this.onlyReturnNameOfCreatedIndex?i[0].name:n)})}}o(p,[i.WRITE_OPERATION,i.EXECUTE_WITH_SELECTION]),e.exports=p},function(e,t,n){"use strict";const i=n(3).Aspect,o=n(3).defineAspects,r=n(20),s=n(0).applyWriteConcern,a=n(0).handleCallback;class c extends r{constructor(e,t,n){super(e.s.db,n,e),this.collection=e,this.indexName=t}_buildCommand(){const e=this.collection,t=this.indexName,n=this.options;let i={dropIndexes:e.collectionName,index:t};return i=s(i,{db:e.s.db,collection:e},n),i}execute(e){super.execute((t,n)=>{if("function"==typeof e)return t?a(e,t,null):void a(e,null,n)})}}o(c,i.WRITE_OPERATION),e.exports=c},function(e,t,n){"use strict";const i=n(3).OperationBase,o=n(10).indexInformation;e.exports=class extends i{constructor(e,t,n){super(n),this.db=e,this.name=t}execute(e){const t=this.db,n=this.name,i=this.options;o(t,n,i,e)}}},function(e,t,n){"use strict";const i=n(3).OperationBase,o=n(0).handleCallback,r=n(1).MongoError;e.exports=class extends i{constructor(e,t){super(t),this.collection=e}execute(e){const t=this.collection,n=this.options;t.s.db.listCollections({name:t.collectionName},n).toArray((n,i)=>n?o(e,n):0===i.length?o(e,r.create({message:`collection ${t.namespace} not found`,driver:!0})):void o(e,n,i[0].options||null))}}},function(e,t,n){"use strict";const i=n(3).Aspect,o=n(20),r=n(3).defineAspects,s=n(17),a=n(0).handleCallback,c=n(0).toError;class l extends o{constructor(e,t,n,i){super(e,i),this.username=t,this.password=n}_buildCommand(){const e=this.db,t=this.username,n=this.password,i=this.options;let o=[];Array.isArray(i.roles)&&(o=i.roles),"string"==typeof i.roles&&(o=[i.roles]),0===o.length&&console.log("Creating a user without roles is deprecated in MongoDB >= 2.6"),"admin"!==e.databaseName.toLowerCase()&&"admin"!==i.dbName||Array.isArray(i.roles)?Array.isArray(i.roles)||(o=["dbOwner"]):o=["root"];const r=e.s.topology.lastIsMaster().maxWireVersion>=7;let a=n;if(!r){const e=s.createHash("md5");e.update(t+":mongo:"+n),a=e.digest("hex")}const c={createUser:t,customData:i.customData||{},roles:o,digestPassword:r};return"string"==typeof n&&(c.pwd=a),c}execute(e){if(null!=this.options.digestPassword)return e(c("The digestPassword option is not supported via add_user. Please use db.command('createUser', ...) instead for this option."));super.execute((t,n)=>a(e,t,t?null:n))}}r(l,i.WRITE_OPERATION),e.exports=l},function(e,t,n){"use strict";const i=n(3).OperationBase,o=n(0).handleCallback,r=n(1).MongoError,s=n(0).MongoDBNamespace;e.exports=class extends i{constructor(e,t,n){super(n),this.db=e,this.selector=t}execute(e){const t=this.db,n=this.selector,i=this.options,a=new s("admin","$cmd");t.s.topology.command(a,n,i,(n,i)=>t.serverConfig&&t.serverConfig.isDestroyed()?e(new r("topology was destroyed")):n?o(e,n):void o(e,null,i.result))}}},function(e,t,n){"use strict";const i=n(3).Aspect,o=n(20),r=n(3).defineAspects,s=n(0).handleCallback,a=n(25);class c extends o{constructor(e,t,n){const i={},o=a.fromOptions(n);null!=o&&(i.writeConcern=o),n.dbName&&(i.dbName=n.dbName),"number"==typeof n.maxTimeMS&&(i.maxTimeMS=n.maxTimeMS),super(e,i),this.username=t}_buildCommand(){return{dropUser:this.username}}execute(e){super.execute((t,n)=>{if(t)return s(e,t,null);s(e,t,!!n.ok)})}}r(c,i.WRITE_OPERATION),e.exports=c},function(e,t,n){"use strict";const i=n(3).OperationBase,o=n(0).applyWriteConcern,r=n(0).checkCollectionName,s=n(12).executeDbAdminCommand,a=n(0).handleCallback,c=n(82).loadCollection,l=n(0).toError;e.exports=class extends i{constructor(e,t,n){super(n),this.collection=e,this.newName=t}execute(e){const t=this.collection,n=this.newName,i=this.options;let p=c();r(n);const u={renameCollection:t.namespace,to:t.s.namespace.withCollection(n).toString(),dropTarget:"boolean"==typeof i.dropTarget&&i.dropTarget};o(u,{db:t.s.db,collection:t},i),s(t.s.db.admin().s.db,u,i,(i,o)=>{if(i)return a(e,i,null);if(o.errmsg)return a(e,l(o),null);try{return a(e,null,new p(t.s.db,t.s.topology,t.s.namespace.db,n,t.s.pkFactory,t.s.options))}catch(i){return a(e,l(i),null)}})}}},function(e,t,n){"use strict";const i=n(0).applyWriteConcern,o=n(119),r=n(120),s=n(121),a=n(208),c=n(209),l=n(38);function p(e,t,n){if(!(this instanceof p))return new p(e,t);this.s={db:e,topology:t,promiseLibrary:n}}p.prototype.command=function(e,t,n){const i=Array.prototype.slice.call(arguments,1);n="function"==typeof i[i.length-1]?i.pop():void 0,t=i.length?i.shift():{};const o=new r(this.s.db,e,t);return l(this.s.db.s.topology,o,n)},p.prototype.buildInfo=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};const n=new r(this.s.db,{buildinfo:1},e);return l(this.s.db.s.topology,n,t)},p.prototype.serverInfo=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};const n=new r(this.s.db,{buildinfo:1},e);return l(this.s.db.s.topology,n,t)},p.prototype.serverStatus=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};const n=new r(this.s.db,{serverStatus:1},e);return l(this.s.db.s.topology,n,t)},p.prototype.ping=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};const n=new r(this.s.db,{ping:1},e);return l(this.s.db.s.topology,n,t)},p.prototype.addUser=function(e,t,n,r){const s=Array.prototype.slice.call(arguments,2);r="function"==typeof s[s.length-1]?s.pop():void 0,"string"==typeof e&&null!=t&&"object"==typeof t&&(n=t,t=null),n=s.length?s.shift():{},n=Object.assign({},n),(n=i(n,{db:this.s.db})).dbName="admin";const a=new o(this.s.db,e,t,n);return l(this.s.db.s.topology,a,r)},p.prototype.removeUser=function(e,t,n){const o=Array.prototype.slice.call(arguments,1);n="function"==typeof o[o.length-1]?o.pop():void 0,t=o.length?o.shift():{},t=Object.assign({},t),(t=i(t,{db:this.s.db})).dbName="admin";const r=new s(this.s.db,e,t);return l(this.s.db.s.topology,r,n)},p.prototype.validateCollection=function(e,t,n){"function"==typeof t&&(n=t,t={});const i=new a(this,e,t=t||{});return l(this.s.db.s.topology,i,n)},p.prototype.listDatabases=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},l(this.s.db.s.topology,new c(this.s.db,e),t)},p.prototype.replSetGetStatus=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};const n=new r(this.s.db,{replSetGetStatus:1},e);return l(this.s.db.s.topology,n,t)},e.exports=p},function(e,t,n){"use strict";const i=n(1).Topology,o=n(28).ServerCapabilities,r=n(21),s=n(0).translateOptions;e.exports=class extends i{constructor(e,t){t=t||{};let n=Object.assign({},{cursorFactory:r,reconnect:!1,emitError:"boolean"!=typeof t.emitError||t.emitError,maxPoolSize:"number"==typeof t.maxPoolSize?t.maxPoolSize:"number"==typeof t.poolSize?t.poolSize:10,minPoolSize:"number"==typeof t.minPoolSize?t.minPoolSize:"number"==typeof t.minSize?t.minSize:0,monitorCommands:"boolean"==typeof t.monitorCommands&&t.monitorCommands});n=s(n,t);var i=t.socketOptions&&Object.keys(t.socketOptions).length>0?t.socketOptions:t;n=s(n,i),super(e,n)}capabilities(){return this.s.sCapabilities?this.s.sCapabilities:null==this.lastIsMaster()?null:(this.s.sCapabilities=new o(this.lastIsMaster()),this.s.sCapabilities)}command(e,t,n,i){super.command(e.toString(),t,n,i)}insert(e,t,n,i){super.insert(e.toString(),t,n,i)}update(e,t,n,i){super.update(e.toString(),t,n,i)}remove(e,t,n,i){super.remove(e.toString(),t,n,i)}}},function(e,t,n){"use strict";const i=n(5).deprecate,o=n(1).Logger,r=n(1).MongoCredentials,s=n(1).MongoError,a=n(126),c=n(124),l=n(1).parseConnectionString,p=n(32),u=n(1).ReadPreference,d=n(127),h=n(64),f=n(1).Sessions.ServerSessionPool,m=n(0).emitDeprecationWarning,g=n(44),y=n(9).retrieveBSON(),v=n(59).CMAP_EVENT_NAMES;let b;const x=i(n(215),"current URL string parser is deprecated, and will be removed in a future version. To use the new parser, pass option { useNewUrlParser: true } to MongoClient.connect."),w={DEFAULT:"default",PLAIN:"plain",GSSAPI:"gssapi","MONGODB-CR":"mongocr","MONGODB-X509":"x509","MONGODB-AWS":"mongodb-aws","SCRAM-SHA-1":"scram-sha-1","SCRAM-SHA-256":"scram-sha-256"},S=["timeout","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed","joined","left","ping","ha","all","fullsetup","open"],_=new Set(["DEFAULT","PLAIN","GSSAPI","MONGODB-CR","MONGODB-X509","MONGODB-AWS","SCRAM-SHA-1","SCRAM-SHA-256"]),T=["poolSize","ssl","sslValidate","sslCA","sslCert","sslKey","sslPass","sslCRL","autoReconnect","noDelay","keepAlive","keepAliveInitialDelay","connectTimeoutMS","family","socketTimeoutMS","reconnectTries","reconnectInterval","ha","haInterval","replicaSet","secondaryAcceptableLatencyMS","acceptableLatencyMS","connectWithNoPrimary","authSource","w","wtimeout","j","forceServerObjectId","serializeFunctions","ignoreUndefined","raw","bufferMaxEntries","readPreference","pkFactory","promiseLibrary","readConcern","maxStalenessSeconds","loggerLevel","logger","promoteValues","promoteBuffers","promoteLongs","domainsEnabled","checkServerIdentity","validateOptions","appname","auth","user","password","authMechanism","compression","fsync","readPreferenceTags","numberOfRetries","auto_reconnect","minSize","monitorCommands","retryWrites","retryReads","useNewUrlParser","useUnifiedTopology","serverSelectionTimeoutMS","useRecoveryToken","autoEncryption","driverInfo","tls","tlsInsecure","tlsinsecure","tlsAllowInvalidCertificates","tlsAllowInvalidHostnames","tlsCAFile","tlsCertificateFile","tlsCertificateKeyFile","tlsCertificateKeyFilePassword","minHeartbeatFrequencyMS","heartbeatFrequencyMS","directConnection","appName","maxPoolSize","minPoolSize","maxIdleTimeMS","waitQueueTimeoutMS"],E=["native_parser"],O=["server","replset","replSet","mongos","db"];const k=T.reduce((e,t)=>(e[t.toLowerCase()]=t,e),{});function C(e,t){t.on("authenticated",M(e,"authenticated")),t.on("error",M(e,"error")),t.on("timeout",M(e,"timeout")),t.on("close",M(e,"close")),t.on("parseError",M(e,"parseError")),t.once("open",M(e,"open")),t.once("fullsetup",M(e,"fullsetup")),t.once("all",M(e,"all")),t.on("reconnect",M(e,"reconnect"))}function A(e,t){e.topology=t,t instanceof c||(t.s.sessionPool=new f(t.s.coreTopology))}function I(e,t){let i=(b||(b=n(60)),b);const o=[];return e instanceof i&&S.forEach(n=>{t.on(n,(t,i)=>{"open"===n?o.push({event:n,object1:e}):o.push({event:n,object1:t,object2:i})})}),o}const N=i(()=>{},"current Server Discovery and Monitoring engine is deprecated, and will be removed in a future version. To use the new Server Discover and Monitoring engine, pass option { useUnifiedTopology: true } to the MongoClient constructor.");function M(e,t){const n=new Set(["all","fullsetup","open","reconnect"]);return(i,o)=>{if(n.has(t))return e.emit(t,e);e.emit(t,i,o)}}const B=new Set(["reconnect","reconnectFailed","attemptReconnect","joined","left","ping","ha","all","fullsetup","open"]);function R(e,t,i,o){i.promiseLibrary=e.s.promiseLibrary;const r={};"unified"===t&&(r.createServers=!1);const l=q(i,r);if(null!=i.autoEncryption){let t;try{!function(){var e=new Error("Cannot find module 'mongodb-client-encryption'");throw e.code="MODULE_NOT_FOUND",e}()}catch(e){return void o(new s("Auto-encryption requested, but the module is not installed. Please add `mongodb-client-encryption` as a dependency of your project"))}try{let e=n(!function(){var e=new Error("Cannot find module 'mongodb-client-encryption'");throw e.code="MODULE_NOT_FOUND",e}());"function"!=typeof e.extension&&o(new s("loaded version of `mongodb-client-encryption` does not have property `extension`. Please make sure you are loading the correct version of `mongodb-client-encryption`")),t=e.extension(n(89)).AutoEncrypter}catch(e){return void o(e)}const r=Object.assign({bson:i.bson||new y([y.Binary,y.Code,y.DBRef,y.Decimal128,y.Double,y.Int32,y.Long,y.Map,y.MaxKey,y.MinKey,y.ObjectId,y.BSONRegExp,y.Symbol,y.Timestamp])},i.autoEncryption);i.autoEncrypter=new t(e,r)}let p;"mongos"===t?p=new a(l,i):"replicaset"===t?p=new d(l,i):"unified"===t&&(p=new c(i.servers,i),function(e){e.on("newListener",e=>{B.has(e)&&m(`The \`${e}\` event is no longer supported by the unified topology, please read more by visiting http://bit.ly/2D8WfT6`,"DeprecationWarning")})}(e)),C(e,p),z(e,p),A(e,p),i.autoEncrypter?i.autoEncrypter.init(e=>{e?o(e):p.connect(i,e=>{if(e)return p.close(!0),void o(e);o(void 0,p)})}):p.connect(i,e=>{if(e)return p.close(!0),o(e);o(void 0,p)})}function P(e,t){const n=["mongos","server","db","replset","db_options","server_options","rs_options","mongos_options"],i=["readconcern","compression","autoencryption"];for(const o in t)-1!==i.indexOf(o.toLowerCase())?e[o]=t[o]:-1!==n.indexOf(o.toLowerCase())?e=j(e,t[o],!1):!t[o]||"object"!=typeof t[o]||Buffer.isBuffer(t[o])||Array.isArray(t[o])?e[o]=t[o]:e=j(e,t[o],!0);return e}function L(e,t,n,i){const o=(i=Object.assign({},i)).authSource||i.authdb||i.dbName,a=i.authMechanism||"DEFAULT",c=a.toUpperCase(),l=i.authMechanismProperties;if(!_.has(c))throw s.create({message:`authentication mechanism ${a} not supported', options.authMechanism`,driver:!0});return new r({mechanism:w[c],mechanismProperties:l,source:o,username:t,password:n})}function D(e){return j(P({},e),e,!1)}function j(e,t,n){for(const i in t)t[i]&&"object"==typeof t[i]&&n?e=j(e,t[i],n):e[i]=t[i];return e}function z(e,t){["commandStarted","commandSucceeded","commandFailed","serverOpening","serverClosed","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","topologyOpening","topologyClosed","topologyDescriptionChanged","joined","left","ping","ha"].concat(v).forEach(n=>{t.on(n,(t,i)=>{e.emit(n,t,i)})})}function U(e){let t=Object.assign({servers:e.hosts},e.options);for(let e in t){const n=k[e];n&&(t[n]=t[e])}const n=e.auth&&e.auth.username,i=e.options&&e.options.authMechanism;return(n||i)&&(t.auth=Object.assign({},e.auth),t.auth.db&&(t.authSource=t.authSource||t.auth.db),t.auth.username&&(t.auth.user=t.auth.username)),e.defaultDatabase&&(t.dbName=e.defaultDatabase),t.maxPoolSize&&(t.poolSize=t.maxPoolSize),t.readConcernLevel&&(t.readConcern=new p(t.readConcernLevel)),t.wTimeoutMS&&(t.wtimeout=t.wTimeoutMS),e.srvHost&&(t.srvHost=e.srvHost),t}function q(e,t){if(t=Object.assign({},{createServers:!0},t),"string"!=typeof e.readPreference&&"string"!=typeof e.read_preference||(e.readPreference=new u(e.readPreference||e.read_preference)),e.readPreference&&(e.readPreferenceTags||e.read_preference_tags)&&(e.readPreference.tags=e.readPreferenceTags||e.read_preference_tags),e.maxStalenessSeconds&&(e.readPreference.maxStalenessSeconds=e.maxStalenessSeconds),null==e.socketTimeoutMS&&(e.socketTimeoutMS=0),null==e.connectTimeoutMS&&(e.connectTimeoutMS=1e4),t.createServers)return e.servers.map(t=>t.domain_socket?new h(t.domain_socket,27017,e):new h(t.host,t.port,e))}e.exports={validOptions:function(e){const t=T.concat(O);for(const n in e)if(-1===E.indexOf(n)){if(-1===t.indexOf(n)){if(e.validateOptions)return new s(`option ${n} is not supported`);console.warn(`the options [${n}] is not supported`)}-1!==O.indexOf(n)&&console.warn(`the server/replset/mongos/db options are deprecated, all their options are supported at the top level of the options object [${T}]`)}},connect:function(e,t,n,i){if(n=Object.assign({},n),null==i)throw new Error("no callback function provided");let r=!1;const c=o("MongoClient",n);if(t instanceof h||t instanceof d||t instanceof a)return function(e,t,n,i){A(e,t),C(e,t),z(e,t);let o=Object.assign({},n);"string"!=typeof n.readPreference&&"string"!=typeof n.read_preference||(o.readPreference=new u(n.readPreference||n.read_preference));if((o.user||o.password||o.authMechanism)&&!o.credentials)try{o.credentials=L(e,o.user,o.password,o)}catch(e){return i(e,t)}return t.connect(o,i)}(e,t,n,m);const p=!1!==n.useNewUrlParser,f=p?U:D;function m(t,n){const o="seed list contains no mongos proxies, replicaset connections requires the parameter replicaSet to be supplied in the URI or options object, mongodb://server:port/db?replicaSet=name";if(t&&"no mongos proxies found in seed list"===t.message)return c.isWarn()&&c.warn(o),i(new s(o));r&&e.emit("authenticated",null,!0),i(t,n)}(p?l:x)(t,n,(t,o)=>{if(t)return i(t);const s=f(o),a=P(s,n);if(null==a.socketTimeoutMS&&(a.socketTimeoutMS=0),null==a.connectTimeoutMS&&(a.connectTimeoutMS=1e4),null==a.retryWrites&&(a.retryWrites=!0),null==a.useRecoveryToken&&(a.useRecoveryToken=!0),null==a.readPreference&&(a.readPreference="primary"),a.db_options&&a.db_options.auth&&delete a.db_options.auth,null!=a.journal&&(a.j=a.journal,a.journal=void 0),function(e){null!=e.tls&&["sslCA","sslKey","sslCert"].forEach(t=>{e[t]&&(e[t]=g.readFileSync(e[t]))})}(a),e.s.options=a,0===s.servers.length)return i(new Error("connection string must contain at least one seed host"));if(a.auth&&!a.credentials)try{r=!0,a.credentials=L(e,a.auth.user,a.auth.password,a)}catch(t){return i(t)}return a.useUnifiedTopology?R(e,"unified",a,m):(N(),a.replicaSet||a.rs_name?R(e,"replicaset",a,m):s.servers.length>1?R(e,"mongos",a,m):function(e,t,n){t.promiseLibrary=e.s.promiseLibrary;const i=q(t)[0],o=I(e,i);i.connect(t,(r,s)=>{if(r)return i.close(!0),n(r);!function(e){S.forEach(t=>e.removeAllListeners(t))}(i),z(e,i),C(e,i);const a=s.lastIsMaster();if(A(e,s),a&&"isdbgrid"===a.msg)return s.close(),R(e,"mongos",t,n);!function(e,t){for(let n=0;n<t.length;n++)e.emit(t[n].event,t[n].object1,t[n].object2)}(e,o),n(r,s)})}(e,a,m))})}}},function(e,t,n){"use strict";const i=n(28).TopologyBase,o=n(1).MongoError,r=n(1).Mongos,s=n(21),a=n(64),c=n(28).Store,l=n(0).MAX_JS_INT,p=n(0).translateOptions,u=n(0).filterOptions,d=n(0).mergeOptions;var h=["ha","haInterval","acceptableLatencyMS","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCRL","sslCert","ciphers","ecdhCurve","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","loggerLevel","logger","reconnectTries","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","promiseLibrary","monitorCommands"];class f extends i{constructor(e,t){super();t=u(t=t||{},h);for(var n=0;n<e.length;n++)if(!(e[n]instanceof a))throw o.create({message:"all seed list instances must be of the Server type",driver:!0});var i={force:!1,bufferMaxEntries:"number"==typeof t.bufferMaxEntries?t.bufferMaxEntries:l},f=t.store||new c(this,i),m=e.map((function(e){return{host:e.host,port:e.port}})),g="boolean"!=typeof t.auto_reconnect||t.auto_reconnect;g="boolean"==typeof t.autoReconnect?t.autoReconnect:g;var y=d({},{disconnectHandler:f,cursorFactory:s,reconnect:g,emitError:"boolean"!=typeof t.emitError||t.emitError,size:"number"==typeof t.poolSize?t.poolSize:5,monitorCommands:"boolean"==typeof t.monitorCommands&&t.monitorCommands});y=p(y,t);var v=t.socketOptions&&Object.keys(t.socketOptions).length>0?t.socketOptions:t;y=p(y,v),this.s={coreTopology:new r(m,y),sCapabilities:null,debug:y.debug,storeOptions:i,clonedOptions:y,store:f,options:t,sessionPool:null,sessions:new Set,promiseLibrary:t.promiseLibrary||Promise}}connect(e,t){var n=this;"function"==typeof e&&(t=e,e={}),null==e&&(e={}),"function"!=typeof t&&(t=null),e=Object.assign({},this.s.clonedOptions,e),n.s.options=e,n.s.storeOptions.bufferMaxEntries="number"==typeof e.bufferMaxEntries?e.bufferMaxEntries:-1;var i=function(){return function(e){["timeout","error","close"].forEach((function(e){n.removeListener(e,i)})),n.s.coreTopology.removeListener("connect",i),n.close(!0);try{t(e)}catch(e){process.nextTick((function(){throw e}))}}},o=function(e){return function(t){"error"!==e&&n.emit(e,t)}},r=function(e){return function(t,i){n.emit(e,t,i)}};["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed"].forEach((function(e){n.s.coreTopology.removeAllListeners(e)})),n.s.coreTopology.on("serverDescriptionChanged",r("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",r("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",r("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",r("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",r("serverOpening")),n.s.coreTopology.on("serverClosed",r("serverClosed")),n.s.coreTopology.on("topologyOpening",r("topologyOpening")),n.s.coreTopology.on("topologyClosed",r("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",r("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",r("commandStarted")),n.s.coreTopology.on("commandSucceeded",r("commandSucceeded")),n.s.coreTopology.on("commandFailed",r("commandFailed")),n.s.coreTopology.once("timeout",i("timeout")),n.s.coreTopology.once("error",i("error")),n.s.coreTopology.once("close",i("close")),n.s.coreTopology.once("connect",(function(){["timeout","error","close","fullsetup"].forEach((function(e){n.s.coreTopology.removeAllListeners(e)})),n.s.coreTopology.on("timeout",o("timeout")),n.s.coreTopology.on("error",o("error")),n.s.coreTopology.on("close",o("close")),n.s.coreTopology.on("fullsetup",(function(){n.emit("fullsetup",n)})),n.emit("open",null,n);try{t(null,n)}catch(e){process.nextTick((function(){throw e}))}})),n.s.coreTopology.on("joined",r("joined")),n.s.coreTopology.on("left",r("left")),n.s.coreTopology.on("reconnect",(function(){n.emit("reconnect"),n.s.store.execute()})),n.s.coreTopology.connect(e)}}Object.defineProperty(f.prototype,"haInterval",{enumerable:!0,get:function(){return this.s.coreTopology.s.haInterval}}),e.exports=f},function(e,t,n){"use strict";const i=n(64),o=n(21),r=n(1).MongoError,s=n(28).TopologyBase,a=n(28).Store,c=n(1).ReplSet,l=n(0).MAX_JS_INT,p=n(0).translateOptions,u=n(0).filterOptions,d=n(0).mergeOptions;var h=["ha","haInterval","replicaSet","rs_name","secondaryAcceptableLatencyMS","connectWithNoPrimary","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCert","ciphers","ecdhCurve","sslCRL","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","strategy","debug","family","loggerLevel","logger","reconnectTries","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","maxStalenessSeconds","promiseLibrary","minSize","monitorCommands"];class f extends s{constructor(e,t){super();var n=this;t=u(t=t||{},h);for(var s=0;s<e.length;s++)if(!(e[s]instanceof i))throw r.create({message:"all seed list instances must be of the Server type",driver:!0});var f={force:!1,bufferMaxEntries:"number"==typeof t.bufferMaxEntries?t.bufferMaxEntries:l},m=t.store||new a(n,f),g=e.map((function(e){return{host:e.host,port:e.port}})),y=d({},{disconnectHandler:m,cursorFactory:o,reconnect:!1,emitError:"boolean"!=typeof t.emitError||t.emitError,size:"number"==typeof t.poolSize?t.poolSize:5,monitorCommands:"boolean"==typeof t.monitorCommands&&t.monitorCommands});y=p(y,t);var v=t.socketOptions&&Object.keys(t.socketOptions).length>0?t.socketOptions:t;y=p(y,v);var b=new c(g,y);b.on("reconnect",(function(){n.emit("reconnect"),m.execute()})),this.s={coreTopology:b,sCapabilities:null,tag:t.tag,storeOptions:f,clonedOptions:y,store:m,options:t,sessionPool:null,sessions:new Set,promiseLibrary:t.promiseLibrary||Promise},y.debug&&Object.defineProperty(this,"replset",{enumerable:!0,get:function(){return b}})}connect(e,t){var n=this;"function"==typeof e&&(t=e,e={}),null==e&&(e={}),"function"!=typeof t&&(t=null),e=Object.assign({},this.s.clonedOptions,e),n.s.options=e,n.s.storeOptions.bufferMaxEntries="number"==typeof e.bufferMaxEntries?e.bufferMaxEntries:-1;var i=function(e){return function(t){"error"!==e&&n.emit(e,t)}};["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed","joined","left","ping","ha"].forEach((function(e){n.s.coreTopology.removeAllListeners(e)}));var o,r=function(e){return function(t,i){n.emit(e,t,i)}};n.s.coreTopology.on("joined",(o="joined",function(e,t){n.emit(o,e,t.lastIsMaster(),t)})),n.s.coreTopology.on("left",r("left")),n.s.coreTopology.on("ping",r("ping")),n.s.coreTopology.on("ha",(function(e,t){n.emit("ha",e,t),"start"===e?n.emit("ha_connect",e,t):"end"===e&&n.emit("ha_ismaster",e,t)})),n.s.coreTopology.on("serverDescriptionChanged",r("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",r("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",r("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",r("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",r("serverOpening")),n.s.coreTopology.on("serverClosed",r("serverClosed")),n.s.coreTopology.on("topologyOpening",r("topologyOpening")),n.s.coreTopology.on("topologyClosed",r("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",r("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",r("commandStarted")),n.s.coreTopology.on("commandSucceeded",r("commandSucceeded")),n.s.coreTopology.on("commandFailed",r("commandFailed")),n.s.coreTopology.on("fullsetup",(function(){n.emit("fullsetup",n,n)})),n.s.coreTopology.on("all",(function(){n.emit("all",null,n)}));var s=function(){return function(e){["timeout","error","close"].forEach((function(e){n.s.coreTopology.removeListener(e,s)})),n.s.coreTopology.removeListener("connect",s),n.s.coreTopology.destroy();try{t(e)}catch(e){n.s.coreTopology.isConnected()||process.nextTick((function(){throw e}))}}};n.s.coreTopology.once("timeout",s("timeout")),n.s.coreTopology.once("error",s("error")),n.s.coreTopology.once("close",s("close")),n.s.coreTopology.once("connect",(function(){n.s.coreTopology.once("timeout",i("timeout")),n.s.coreTopology.once("error",i("error")),n.s.coreTopology.once("close",i("close")),n.emit("open",null,n);try{t(null,n)}catch(e){process.nextTick((function(){throw e}))}})),n.s.coreTopology.connect(e)}close(e,t){["timeout","error","close","joined","left"].forEach(e=>this.removeAllListeners(e)),super.close(e,t)}}Object.defineProperty(f.prototype,"haInterval",{enumerable:!0,get:function(){return this.s.coreTopology.s.haInterval}}),e.exports=f},function(e,t,n){"use strict";var i=n(1).BSON.Binary,o=n(1).BSON.ObjectID,r=n(19).Buffer,s=function(e,t,n){if(!(this instanceof s))return new s(e,t);this.file=e;var a=null==t?{}:t;if(this.writeConcern=n||{w:1},this.objectId=null==a._id?new o:a._id,this.chunkNumber=null==a.n?0:a.n,this.data=new i,"string"==typeof a.data){var c=r.alloc(a.data.length);c.write(a.data,0,a.data.length,"binary"),this.data=new i(c)}else if(Array.isArray(a.data)){c=r.alloc(a.data.length);var l=a.data.join("");c.write(l,0,l.length,"binary"),this.data=new i(c)}else if(a.data&&"Binary"===a.data._bsontype)this.data=a.data;else if(!r.isBuffer(a.data)&&null!=a.data)throw Error("Illegal chunk format");this.internalPosition=0};s.prototype.write=function(e,t){return this.data.write(e,this.internalPosition,e.length,"binary"),this.internalPosition=this.data.length(),null!=t?t(null,this):this},s.prototype.read=function(e){if(e=null==e||0===e?this.length():e,this.length()-this.internalPosition+1>=e){var t=this.data.read(this.internalPosition,e);return this.internalPosition=this.internalPosition+e,t}return""},s.prototype.readSlice=function(e){if(this.length()-this.internalPosition>=e){var t=null;return null!=this.data.buffer?t=this.data.buffer.slice(this.internalPosition,this.internalPosition+e):(t=r.alloc(e),e=this.data.readInto(t,this.internalPosition)),this.internalPosition=this.internalPosition+e,t}return null},s.prototype.eof=function(){return this.internalPosition===this.length()},s.prototype.getc=function(){return this.read(1)},s.prototype.rewind=function(){this.internalPosition=0,this.data=new i},s.prototype.save=function(e,t){var n=this;"function"==typeof e&&(t=e,e={}),n.file.chunkCollection((function(i,o){if(i)return t(i);var r={upsert:!0};for(var s in e)r[s]=e[s];for(s in n.writeConcern)r[s]=n.writeConcern[s];n.data.length()>0?n.buildMongoObject((function(e){var i={forceServerObjectId:!0};for(var s in n.writeConcern)i[s]=n.writeConcern[s];o.replaceOne({_id:n.objectId},e,r,(function(e){t(e,n)}))})):t(null,n)}))},s.prototype.buildMongoObject=function(e){var t={files_id:this.file.fileId,n:this.chunkNumber,data:this.data};null!=this.objectId&&(t._id=this.objectId),e(t)},s.prototype.length=function(){return this.data.length()},Object.defineProperty(s.prototype,"position",{enumerable:!0,get:function(){return this.internalPosition},set:function(e){this.internalPosition=e}}),s.DEFAULT_CHUNK_SIZE=261120,e.exports=s},function(e,t,n){var i=n(43),o=n(233),r=n(85),s=n(234),a=n(238),c=n(262),l=o("wks"),p=i.Symbol,u=c?p:p&&p.withoutSetter||s;e.exports=function(e){return r(l,e)||(a&&r(p,e)?l[e]=p[e]:l[e]=u("Symbol."+e)),l[e]}},function(e){e.exports=JSON.parse('{"name":"nodemailer","version":"6.4.17","description":"Easy as cake e-mail sending from your Node.js applications","main":"lib/nodemailer.js","scripts":{"test":"grunt"},"repository":{"type":"git","url":"https://github.com/nodemailer/nodemailer.git"},"keywords":["Nodemailer"],"author":"Andris Reinman","license":"MIT","bugs":{"url":"https://github.com/nodemailer/nodemailer/issues"},"homepage":"https://nodemailer.com/","devDependencies":{"bunyan":"1.8.14","chai":"4.2.0","eslint-config-nodemailer":"1.2.0","eslint-config-prettier":"7.0.0","grunt":"1.3.0","grunt-cli":"1.3.2","grunt-eslint":"23.0.0","grunt-mocha-test":"0.13.3","libbase64":"1.2.1","libmime":"5.0.0","libqp":"1.1.0","mocha":"8.2.1","nodemailer-ntlm-auth":"1.0.1","proxy":"1.0.2","proxy-test-server":"1.0.0","sinon":"9.2.1","smtp-server":"3.8.0"},"engines":{"node":">=6.0.0"},"dependencies":{}}')},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("tls")},function(e,t,n){var i=n(83),o=n(87),r=n(225);e.exports=i?function(e,t,n){return o.f(e,t,r(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t){e.exports=require("zlib")},function(e,t){e.exports=require("http")},function(e,t,n){"use strict";var i=n(67),o=n(29),r=n(46),s=n(47),a=n(48),c=n(49),l=n(50),p=n(68),u=n(51),d=n(52),h=n(53),f=n(54),m=n(55),g=n(35),y=n(137),v=n(138),b=n(140),x=n(24),w=x.allocBuffer(17825792),S=function(){};S.prototype.serialize=function(e,t){var n="boolean"==typeof(t=t||{}).checkKeys&&t.checkKeys,i="boolean"==typeof t.serializeFunctions&&t.serializeFunctions,o="boolean"!=typeof t.ignoreUndefined||t.ignoreUndefined,r="number"==typeof t.minInternalBufferSize?t.minInternalBufferSize:17825792;w.length<r&&(w=x.allocBuffer(r));var s=v(w,e,n,0,0,i,o,[]),a=x.allocBuffer(s);return w.copy(a,0,0,a.length),a},S.prototype.serializeWithBufferAndIndex=function(e,t,n){var i="boolean"==typeof(n=n||{}).checkKeys&&n.checkKeys,o="boolean"==typeof n.serializeFunctions&&n.serializeFunctions,r="boolean"!=typeof n.ignoreUndefined||n.ignoreUndefined,s="number"==typeof n.index?n.index:0;return v(t,e,i,s||0,0,o,r)-1},S.prototype.deserialize=function(e,t){return y(e,t)},S.prototype.calculateObjectSize=function(e,t){var n="boolean"==typeof(t=t||{}).serializeFunctions&&t.serializeFunctions,i="boolean"!=typeof t.ignoreUndefined||t.ignoreUndefined;return b(e,n,i)},S.prototype.deserializeStream=function(e,t,n,i,o,r){r=null!=r?r:{};for(var s=t,a=0;a<n;a++){var c=e[s]|e[s+1]<<8|e[s+2]<<16|e[s+3]<<24;r.index=s,i[o+a]=this.deserialize(e,r),s+=c}return s},S.BSON_INT32_MAX=2147483647,S.BSON_INT32_MIN=-2147483648,S.BSON_INT64_MAX=Math.pow(2,63)-1,S.BSON_INT64_MIN=-Math.pow(2,63),S.JS_INT_MAX=9007199254740992,S.JS_INT_MIN=-9007199254740992,S.BSON_DATA_NUMBER=1,S.BSON_DATA_STRING=2,S.BSON_DATA_OBJECT=3,S.BSON_DATA_ARRAY=4,S.BSON_DATA_BINARY=5,S.BSON_DATA_OID=7,S.BSON_DATA_BOOLEAN=8,S.BSON_DATA_DATE=9,S.BSON_DATA_NULL=10,S.BSON_DATA_REGEXP=11,S.BSON_DATA_CODE=13,S.BSON_DATA_SYMBOL=14,S.BSON_DATA_CODE_W_SCOPE=15,S.BSON_DATA_INT=16,S.BSON_DATA_TIMESTAMP=17,S.BSON_DATA_LONG=18,S.BSON_DATA_MIN_KEY=255,S.BSON_DATA_MAX_KEY=127,S.BSON_BINARY_SUBTYPE_DEFAULT=0,S.BSON_BINARY_SUBTYPE_FUNCTION=1,S.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,S.BSON_BINARY_SUBTYPE_UUID=3,S.BSON_BINARY_SUBTYPE_MD5=4,S.BSON_BINARY_SUBTYPE_USER_DEFINED=128,e.exports=S,e.exports.Code=u,e.exports.Map=i,e.exports.Symbol=l,e.exports.BSON=S,e.exports.DBRef=m,e.exports.Binary=g,e.exports.ObjectID=a,e.exports.Long=o,e.exports.Timestamp=s,e.exports.Double=r,e.exports.Int32=p,e.exports.MinKey=h,e.exports.MaxKey=f,e.exports.BSONRegExp=c,e.exports.Decimal128=d},function(module,exports,__webpack_require__){"use strict";var Long=__webpack_require__(29).Long,Double=__webpack_require__(46).Double,Timestamp=__webpack_require__(47).Timestamp,ObjectID=__webpack_require__(48).ObjectID,Symbol=__webpack_require__(50).Symbol,Code=__webpack_require__(51).Code,MinKey=__webpack_require__(53).MinKey,MaxKey=__webpack_require__(54).MaxKey,Decimal128=__webpack_require__(52),Int32=__webpack_require__(68),DBRef=__webpack_require__(55).DBRef,BSONRegExp=__webpack_require__(49).BSONRegExp,Binary=__webpack_require__(35).Binary,utils=__webpack_require__(24),deserialize=function(e,t,n){var i=(t=null==t?{}:t)&&t.index?t.index:0,o=e[i]|e[i+1]<<8|e[i+2]<<16|e[i+3]<<24;if(o<5||e.length<o||o+i>e.length)throw new Error("corrupt bson message");if(0!==e[i+o-1])throw new Error("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return deserializeObject(e,i,t,n)},deserializeObject=function(e,t,n,i){var o=null!=n.evalFunctions&&n.evalFunctions,r=null!=n.cacheFunctions&&n.cacheFunctions,s=null!=n.cacheFunctionsCrc32&&n.cacheFunctionsCrc32;if(!s)var a=null;var c=null==n.fieldsAsRaw?null:n.fieldsAsRaw,l=null!=n.raw&&n.raw,p="boolean"==typeof n.bsonRegExp&&n.bsonRegExp,u=null!=n.promoteBuffers&&n.promoteBuffers,d=null==n.promoteLongs||n.promoteLongs,h=null==n.promoteValues||n.promoteValues,f=t;if(e.length<5)throw new Error("corrupt bson message < 5 bytes long");var m=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(m<5||m>e.length)throw new Error("corrupt bson message");for(var g=i?[]:{},y=0;;){var v=e[t++];if(0===v)break;for(var b=t;0!==e[b]&&b<e.length;)b++;if(b>=e.length)throw new Error("Bad BSON Document: illegal CString");var x=i?y++:e.toString("utf8",t,b);if(t=b+1,v===BSON.BSON_DATA_STRING){var w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(w<=0||w>e.length-t||0!==e[t+w-1])throw new Error("bad string length in bson");g[x]=e.toString("utf8",t,t+w-1),t+=w}else if(v===BSON.BSON_DATA_OID){var S=utils.allocBuffer(12);e.copy(S,0,t,t+12),g[x]=new ObjectID(S),t+=12}else if(v===BSON.BSON_DATA_INT&&!1===h)g[x]=new Int32(e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24);else if(v===BSON.BSON_DATA_INT)g[x]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;else if(v===BSON.BSON_DATA_NUMBER&&!1===h)g[x]=new Double(e.readDoubleLE(t)),t+=8;else if(v===BSON.BSON_DATA_NUMBER)g[x]=e.readDoubleLE(t),t+=8;else if(v===BSON.BSON_DATA_DATE){var _=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,T=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;g[x]=new Date(new Long(_,T).toNumber())}else if(v===BSON.BSON_DATA_BOOLEAN){if(0!==e[t]&&1!==e[t])throw new Error("illegal boolean type value");g[x]=1===e[t++]}else if(v===BSON.BSON_DATA_OBJECT){var E=t,O=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24;if(O<=0||O>e.length-t)throw new Error("bad embedded document length in bson");g[x]=l?e.slice(t,t+O):deserializeObject(e,E,n,!1),t+=O}else if(v===BSON.BSON_DATA_ARRAY){E=t;var k=n,C=t+(O=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24);if(c&&c[x]){for(var A in k={},n)k[A]=n[A];k.raw=!0}if(g[x]=deserializeObject(e,E,k,!0),0!==e[(t+=O)-1])throw new Error("invalid array terminator byte");if(t!==C)throw new Error("corrupted array bson")}else if(v===BSON.BSON_DATA_UNDEFINED)g[x]=void 0;else if(v===BSON.BSON_DATA_NULL)g[x]=null;else if(v===BSON.BSON_DATA_LONG){_=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,T=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var I=new Long(_,T);g[x]=d&&!0===h&&I.lessThanOrEqual(JS_INT_MAX_LONG)&&I.greaterThanOrEqual(JS_INT_MIN_LONG)?I.toNumber():I}else if(v===BSON.BSON_DATA_DECIMAL128){var N=utils.allocBuffer(16);e.copy(N,0,t,t+16),t+=16;var M=new Decimal128(N);g[x]=M.toObject?M.toObject():M}else if(v===BSON.BSON_DATA_BINARY){var B=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,R=B,P=e[t++];if(B<0)throw new Error("Negative binary type element size found");if(B>e.length)throw new Error("Binary type size larger than document size");if(null!=e.slice){if(P===Binary.SUBTYPE_BYTE_ARRAY){if((B=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<0)throw new Error("Negative binary type element size found for subtype 0x02");if(B>R-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(B<R-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}g[x]=u&&h?e.slice(t,t+B):new Binary(e.slice(t,t+B),P)}else{var L="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(B)):new Array(B);if(P===Binary.SUBTYPE_BYTE_ARRAY){if((B=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<0)throw new Error("Negative binary type element size found for subtype 0x02");if(B>R-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(B<R-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}for(b=0;b<B;b++)L[b]=e[t+b];g[x]=u&&h?L:new Binary(L,P)}t+=B}else if(v===BSON.BSON_DATA_REGEXP&&!1===p){for(b=t;0!==e[b]&&b<e.length;)b++;if(b>=e.length)throw new Error("Bad BSON Document: illegal CString");var D=e.toString("utf8",t,b);for(b=t=b+1;0!==e[b]&&b<e.length;)b++;if(b>=e.length)throw new Error("Bad BSON Document: illegal CString");var j=e.toString("utf8",t,b);t=b+1;var z=new Array(j.length);for(b=0;b<j.length;b++)switch(j[b]){case"m":z[b]="m";break;case"s":z[b]="g";break;case"i":z[b]="i"}g[x]=new RegExp(D,z.join(""))}else if(v===BSON.BSON_DATA_REGEXP&&!0===p){for(b=t;0!==e[b]&&b<e.length;)b++;if(b>=e.length)throw new Error("Bad BSON Document: illegal CString");for(D=e.toString("utf8",t,b),b=t=b+1;0!==e[b]&&b<e.length;)b++;if(b>=e.length)throw new Error("Bad BSON Document: illegal CString");j=e.toString("utf8",t,b),t=b+1,g[x]=new BSONRegExp(D,j)}else if(v===BSON.BSON_DATA_SYMBOL){if((w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||w>e.length-t||0!==e[t+w-1])throw new Error("bad string length in bson");g[x]=new Symbol(e.toString("utf8",t,t+w-1)),t+=w}else if(v===BSON.BSON_DATA_TIMESTAMP)_=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,T=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,g[x]=new Timestamp(_,T);else if(v===BSON.BSON_DATA_MIN_KEY)g[x]=new MinKey;else if(v===BSON.BSON_DATA_MAX_KEY)g[x]=new MaxKey;else if(v===BSON.BSON_DATA_CODE){if((w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||w>e.length-t||0!==e[t+w-1])throw new Error("bad string length in bson");var U=e.toString("utf8",t,t+w-1);if(o)if(r){var q=s?a(U):U;g[x]=isolateEvalWithHash(functionCache,q,U,g)}else g[x]=isolateEval(U);else g[x]=new Code(U);t+=w}else if(v===BSON.BSON_DATA_CODE_W_SCOPE){var H=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(H<13)throw new Error("code_w_scope total size shorter minimum expected length");if((w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||w>e.length-t||0!==e[t+w-1])throw new Error("bad string length in bson");U=e.toString("utf8",t,t+w-1),E=t+=w,O=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24;var F=deserializeObject(e,E,n,!1);if(t+=O,H<8+O+w)throw new Error("code_w_scope total size is to short, truncating scope");if(H>8+O+w)throw new Error("code_w_scope total size is to long, clips outer document");o?(r?(q=s?a(U):U,g[x]=isolateEvalWithHash(functionCache,q,U,g)):g[x]=isolateEval(U),g[x].scope=F):g[x]=new Code(U,F)}else{if(v!==BSON.BSON_DATA_DBPOINTER)throw new Error("Detected unknown BSON type "+v.toString(16)+' for fieldname "'+x+'", are you using the latest BSON parser');if((w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||w>e.length-t||0!==e[t+w-1])throw new Error("bad string length in bson");var W=e.toString("utf8",t,t+w-1);t+=w;var $=utils.allocBuffer(12);e.copy($,0,t,t+12),S=new ObjectID($),t+=12;var V=W.split("."),K=V.shift(),G=V.join(".");g[x]=new DBRef(G,S,K)}}if(m!==t-f){if(i)throw new Error("corrupt array bson");throw new Error("corrupt object bson")}return null!=g.$id&&(g=new DBRef(g.$ref,g.$id,g.$db)),g},isolateEvalWithHash=function(functionCache,hash,functionString,object){var value=null;return null==functionCache[hash]&&(eval("value = "+functionString),functionCache[hash]=value),functionCache[hash].bind(object)},isolateEval=function(functionString){var value=null;return eval("value = "+functionString),value},BSON={},functionCache=BSON.functionCache={};BSON.BSON_DATA_NUMBER=1,BSON.BSON_DATA_STRING=2,BSON.BSON_DATA_OBJECT=3,BSON.BSON_DATA_ARRAY=4,BSON.BSON_DATA_BINARY=5,BSON.BSON_DATA_UNDEFINED=6,BSON.BSON_DATA_OID=7,BSON.BSON_DATA_BOOLEAN=8,BSON.BSON_DATA_DATE=9,BSON.BSON_DATA_NULL=10,BSON.BSON_DATA_REGEXP=11,BSON.BSON_DATA_DBPOINTER=12,BSON.BSON_DATA_CODE=13,BSON.BSON_DATA_SYMBOL=14,BSON.BSON_DATA_CODE_W_SCOPE=15,BSON.BSON_DATA_INT=16,BSON.BSON_DATA_TIMESTAMP=17,BSON.BSON_DATA_LONG=18,BSON.BSON_DATA_DECIMAL128=19,BSON.BSON_DATA_MIN_KEY=255,BSON.BSON_DATA_MAX_KEY=127,BSON.BSON_BINARY_SUBTYPE_DEFAULT=0,BSON.BSON_BINARY_SUBTYPE_FUNCTION=1,BSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,BSON.BSON_BINARY_SUBTYPE_UUID=3,BSON.BSON_BINARY_SUBTYPE_MD5=4,BSON.BSON_BINARY_SUBTYPE_USER_DEFINED=128,BSON.BSON_INT32_MAX=2147483647,BSON.BSON_INT32_MIN=-2147483648,BSON.BSON_INT64_MAX=Math.pow(2,63)-1,BSON.BSON_INT64_MIN=-Math.pow(2,63),BSON.JS_INT_MAX=9007199254740992,BSON.JS_INT_MIN=-9007199254740992;var JS_INT_MAX_LONG=Long.fromNumber(9007199254740992),JS_INT_MIN_LONG=Long.fromNumber(-9007199254740992);module.exports=deserialize},function(e,t,n){"use strict";var i=n(139).writeIEEE754,o=n(29).Long,r=n(67),s=n(35).Binary,a=n(24).normalizedFunctionString,c=/\x00/,l=["$db","$ref","$id","$clusterTime"],p=function(e){return"object"==typeof e&&"[object Date]"===Object.prototype.toString.call(e)},u=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},d=function(e,t,n,i,o){e[i++]=B.BSON_DATA_STRING;var r=o?e.write(t,i,"ascii"):e.write(t,i,"utf8");e[(i=i+r+1)-1]=0;var s=e.write(n,i+4,"utf8");return e[i+3]=s+1>>24&255,e[i+2]=s+1>>16&255,e[i+1]=s+1>>8&255,e[i]=s+1&255,i=i+4+s,e[i++]=0,i},h=function(e,t,n,r,s){if(Math.floor(n)===n&&n>=B.JS_INT_MIN&&n<=B.JS_INT_MAX)if(n>=B.BSON_INT32_MIN&&n<=B.BSON_INT32_MAX){e[r++]=B.BSON_DATA_INT;var a=s?e.write(t,r,"ascii"):e.write(t,r,"utf8");r+=a,e[r++]=0,e[r++]=255&n,e[r++]=n>>8&255,e[r++]=n>>16&255,e[r++]=n>>24&255}else if(n>=B.JS_INT_MIN&&n<=B.JS_INT_MAX)e[r++]=B.BSON_DATA_NUMBER,r+=a=s?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,i(e,n,r,"little",52,8),r+=8;else{e[r++]=B.BSON_DATA_LONG,r+=a=s?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var c=o.fromNumber(n),l=c.getLowBits(),p=c.getHighBits();e[r++]=255&l,e[r++]=l>>8&255,e[r++]=l>>16&255,e[r++]=l>>24&255,e[r++]=255&p,e[r++]=p>>8&255,e[r++]=p>>16&255,e[r++]=p>>24&255}else e[r++]=B.BSON_DATA_NUMBER,r+=a=s?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,i(e,n,r,"little",52,8),r+=8;return r},f=function(e,t,n,i,o){return e[i++]=B.BSON_DATA_NULL,i+=o?e.write(t,i,"ascii"):e.write(t,i,"utf8"),e[i++]=0,i},m=function(e,t,n,i,o){return e[i++]=B.BSON_DATA_BOOLEAN,i+=o?e.write(t,i,"ascii"):e.write(t,i,"utf8"),e[i++]=0,e[i++]=n?1:0,i},g=function(e,t,n,i,r){e[i++]=B.BSON_DATA_DATE,i+=r?e.write(t,i,"ascii"):e.write(t,i,"utf8"),e[i++]=0;var s=o.fromNumber(n.getTime()),a=s.getLowBits(),c=s.getHighBits();return e[i++]=255&a,e[i++]=a>>8&255,e[i++]=a>>16&255,e[i++]=a>>24&255,e[i++]=255&c,e[i++]=c>>8&255,e[i++]=c>>16&255,e[i++]=c>>24&255,i},y=function(e,t,n,i,o){if(e[i++]=B.BSON_DATA_REGEXP,i+=o?e.write(t,i,"ascii"):e.write(t,i,"utf8"),e[i++]=0,n.source&&null!=n.source.match(c))throw Error("value "+n.source+" must not contain null bytes");return i+=e.write(n.source,i,"utf8"),e[i++]=0,n.global&&(e[i++]=115),n.ignoreCase&&(e[i++]=105),n.multiline&&(e[i++]=109),e[i++]=0,i},v=function(e,t,n,i,o){if(e[i++]=B.BSON_DATA_REGEXP,i+=o?e.write(t,i,"ascii"):e.write(t,i,"utf8"),e[i++]=0,null!=n.pattern.match(c))throw Error("pattern "+n.pattern+" must not contain null bytes");return i+=e.write(n.pattern,i,"utf8"),e[i++]=0,i+=e.write(n.options.split("").sort().join(""),i,"utf8"),e[i++]=0,i},b=function(e,t,n,i,o){return null===n?e[i++]=B.BSON_DATA_NULL:"MinKey"===n._bsontype?e[i++]=B.BSON_DATA_MIN_KEY:e[i++]=B.BSON_DATA_MAX_KEY,i+=o?e.write(t,i,"ascii"):e.write(t,i,"utf8"),e[i++]=0,i},x=function(e,t,n,i,o){if(e[i++]=B.BSON_DATA_OID,i+=o?e.write(t,i,"ascii"):e.write(t,i,"utf8"),e[i++]=0,"string"==typeof n.id)e.write(n.id,i,"binary");else{if(!n.id||!n.id.copy)throw new Error("object ["+JSON.stringify(n)+"] is not a valid ObjectId");n.id.copy(e,i,0,12)}return i+12},w=function(e,t,n,i,o){e[i++]=B.BSON_DATA_BINARY,i+=o?e.write(t,i,"ascii"):e.write(t,i,"utf8"),e[i++]=0;var r=n.length;return e[i++]=255&r,e[i++]=r>>8&255,e[i++]=r>>16&255,e[i++]=r>>24&255,e[i++]=B.BSON_BINARY_SUBTYPE_DEFAULT,n.copy(e,i,0,r),i+=r},S=function(e,t,n,i,o,r,s,a,c,l){for(var p=0;p<l.length;p++)if(l[p]===n)throw new Error("cyclic dependency detected");l.push(n),e[i++]=Array.isArray(n)?B.BSON_DATA_ARRAY:B.BSON_DATA_OBJECT,i+=c?e.write(t,i,"ascii"):e.write(t,i,"utf8"),e[i++]=0;var u=M(e,n,o,i,r+1,s,a,l);return l.pop(),u},_=function(e,t,n,i,o){return e[i++]=B.BSON_DATA_DECIMAL128,i+=o?e.write(t,i,"ascii"):e.write(t,i,"utf8"),e[i++]=0,n.bytes.copy(e,i,0,16),i+16},T=function(e,t,n,i,o){e[i++]="Long"===n._bsontype?B.BSON_DATA_LONG:B.BSON_DATA_TIMESTAMP,i+=o?e.write(t,i,"ascii"):e.write(t,i,"utf8"),e[i++]=0;var r=n.getLowBits(),s=n.getHighBits();return e[i++]=255&r,e[i++]=r>>8&255,e[i++]=r>>16&255,e[i++]=r>>24&255,e[i++]=255&s,e[i++]=s>>8&255,e[i++]=s>>16&255,e[i++]=s>>24&255,i},E=function(e,t,n,i,o){return e[i++]=B.BSON_DATA_INT,i+=o?e.write(t,i,"ascii"):e.write(t,i,"utf8"),e[i++]=0,e[i++]=255&n,e[i++]=n>>8&255,e[i++]=n>>16&255,e[i++]=n>>24&255,i},O=function(e,t,n,o,r){return e[o++]=B.BSON_DATA_NUMBER,o+=r?e.write(t,o,"ascii"):e.write(t,o,"utf8"),e[o++]=0,i(e,n,o,"little",52,8),o+=8},k=function(e,t,n,i,o,r,s){e[i++]=B.BSON_DATA_CODE,i+=s?e.write(t,i,"ascii"):e.write(t,i,"utf8"),e[i++]=0;var c=a(n),l=e.write(c,i+4,"utf8")+1;return e[i]=255&l,e[i+1]=l>>8&255,e[i+2]=l>>16&255,e[i+3]=l>>24&255,i=i+4+l-1,e[i++]=0,i},C=function(e,t,n,i,o,r,s,a,c){if(n.scope&&"object"==typeof n.scope){e[i++]=B.BSON_DATA_CODE_W_SCOPE;var l=c?e.write(t,i,"ascii"):e.write(t,i,"utf8");i+=l,e[i++]=0;var p=i,u="string"==typeof n.code?n.code:n.code.toString();i+=4;var d=e.write(u,i+4,"utf8")+1;e[i]=255&d,e[i+1]=d>>8&255,e[i+2]=d>>16&255,e[i+3]=d>>24&255,e[i+4+d-1]=0,i=i+d+4;var h=M(e,n.scope,o,i,r+1,s,a);i=h-1;var f=h-p;e[p++]=255&f,e[p++]=f>>8&255,e[p++]=f>>16&255,e[p++]=f>>24&255,e[i++]=0}else{e[i++]=B.BSON_DATA_CODE,i+=l=c?e.write(t,i,"ascii"):e.write(t,i,"utf8"),e[i++]=0,u=n.code.toString();var m=e.write(u,i+4,"utf8")+1;e[i]=255&m,e[i+1]=m>>8&255,e[i+2]=m>>16&255,e[i+3]=m>>24&255,i=i+4+m-1,e[i++]=0}return i},A=function(e,t,n,i,o){e[i++]=B.BSON_DATA_BINARY,i+=o?e.write(t,i,"ascii"):e.write(t,i,"utf8"),e[i++]=0;var r=n.value(!0),a=n.position;return n.sub_type===s.SUBTYPE_BYTE_ARRAY&&(a+=4),e[i++]=255&a,e[i++]=a>>8&255,e[i++]=a>>16&255,e[i++]=a>>24&255,e[i++]=n.sub_type,n.sub_type===s.SUBTYPE_BYTE_ARRAY&&(a-=4,e[i++]=255&a,e[i++]=a>>8&255,e[i++]=a>>16&255,e[i++]=a>>24&255),r.copy(e,i,0,n.position),i+=n.position},I=function(e,t,n,i,o){e[i++]=B.BSON_DATA_SYMBOL,i+=o?e.write(t,i,"ascii"):e.write(t,i,"utf8"),e[i++]=0;var r=e.write(n.value,i+4,"utf8")+1;return e[i]=255&r,e[i+1]=r>>8&255,e[i+2]=r>>16&255,e[i+3]=r>>24&255,i=i+4+r-1,e[i++]=0,i},N=function(e,t,n,i,o,r,s){e[i++]=B.BSON_DATA_OBJECT,i+=s?e.write(t,i,"ascii"):e.write(t,i,"utf8"),e[i++]=0;var a,c=i,l=(a=null!=n.db?M(e,{$ref:n.namespace,$id:n.oid,$db:n.db},!1,i,o+1,r):M(e,{$ref:n.namespace,$id:n.oid},!1,i,o+1,r))-c;return e[c++]=255&l,e[c++]=l>>8&255,e[c++]=l>>16&255,e[c++]=l>>24&255,a},M=function(e,t,n,i,o,s,a,M){i=i||0,(M=M||[]).push(t);var B=i+4;if(Array.isArray(t))for(var R=0;R<t.length;R++){var P=""+R,L=t[R];if(L&&L.toBSON){if("function"!=typeof L.toBSON)throw new Error("toBSON is not a function");L=L.toBSON()}var D=typeof L;if("string"===D)B=d(e,P,L,B,!0);else if("number"===D)B=h(e,P,L,B,!0);else if("boolean"===D)B=m(e,P,L,B,!0);else if(L instanceof Date||p(L))B=g(e,P,L,B,!0);else if(void 0===L)B=f(e,P,0,B,!0);else if(null===L)B=f(e,P,0,B,!0);else if("ObjectID"===L._bsontype||"ObjectId"===L._bsontype)B=x(e,P,L,B,!0);else if(Buffer.isBuffer(L))B=w(e,P,L,B,!0);else if(L instanceof RegExp||u(L))B=y(e,P,L,B,!0);else if("object"===D&&null==L._bsontype)B=S(e,P,L,B,n,o,s,a,!0,M);else if("object"===D&&"Decimal128"===L._bsontype)B=_(e,P,L,B,!0);else if("Long"===L._bsontype||"Timestamp"===L._bsontype)B=T(e,P,L,B,!0);else if("Double"===L._bsontype)B=O(e,P,L,B,!0);else if("function"==typeof L&&s)B=k(e,P,L,B,0,0,s);else if("Code"===L._bsontype)B=C(e,P,L,B,n,o,s,a,!0);else if("Binary"===L._bsontype)B=A(e,P,L,B,!0);else if("Symbol"===L._bsontype)B=I(e,P,L,B,!0);else if("DBRef"===L._bsontype)B=N(e,P,L,B,o,s,!0);else if("BSONRegExp"===L._bsontype)B=v(e,P,L,B,!0);else if("Int32"===L._bsontype)B=E(e,P,L,B,!0);else if("MinKey"===L._bsontype||"MaxKey"===L._bsontype)B=b(e,P,L,B,!0);else if(void 0!==L._bsontype)throw new TypeError("Unrecognized or invalid _bsontype: "+L._bsontype)}else if(t instanceof r)for(var j=t.entries(),z=!1;!z;){var U=j.next();if(!(z=U.done)){if(P=U.value[0],D=typeof(L=U.value[1]),"string"==typeof P&&-1===l.indexOf(P)){if(null!=P.match(c))throw Error("key "+P+" must not contain null bytes");if(n){if("$"===P[0])throw Error("key "+P+" must not start with '$'");if(~P.indexOf("."))throw Error("key "+P+" must not contain '.'")}}if("string"===D)B=d(e,P,L,B);else if("number"===D)B=h(e,P,L,B);else if("boolean"===D)B=m(e,P,L,B);else if(L instanceof Date||p(L))B=g(e,P,L,B);else if(null===L||void 0===L&&!1===a)B=f(e,P,0,B);else if("ObjectID"===L._bsontype||"ObjectId"===L._bsontype)B=x(e,P,L,B);else if(Buffer.isBuffer(L))B=w(e,P,L,B);else if(L instanceof RegExp||u(L))B=y(e,P,L,B);else if("object"===D&&null==L._bsontype)B=S(e,P,L,B,n,o,s,a,!1,M);else if("object"===D&&"Decimal128"===L._bsontype)B=_(e,P,L,B);else if("Long"===L._bsontype||"Timestamp"===L._bsontype)B=T(e,P,L,B);else if("Double"===L._bsontype)B=O(e,P,L,B);else if("Code"===L._bsontype)B=C(e,P,L,B,n,o,s,a);else if("function"==typeof L&&s)B=k(e,P,L,B,0,0,s);else if("Binary"===L._bsontype)B=A(e,P,L,B);else if("Symbol"===L._bsontype)B=I(e,P,L,B);else if("DBRef"===L._bsontype)B=N(e,P,L,B,o,s);else if("BSONRegExp"===L._bsontype)B=v(e,P,L,B);else if("Int32"===L._bsontype)B=E(e,P,L,B);else if("MinKey"===L._bsontype||"MaxKey"===L._bsontype)B=b(e,P,L,B);else if(void 0!==L._bsontype)throw new TypeError("Unrecognized or invalid _bsontype: "+L._bsontype)}}else{if(t.toBSON){if("function"!=typeof t.toBSON)throw new Error("toBSON is not a function");if(null!=(t=t.toBSON())&&"object"!=typeof t)throw new Error("toBSON function did not return an object")}for(P in t){if((L=t[P])&&L.toBSON){if("function"!=typeof L.toBSON)throw new Error("toBSON is not a function");L=L.toBSON()}if(D=typeof L,"string"==typeof P&&-1===l.indexOf(P)){if(null!=P.match(c))throw Error("key "+P+" must not contain null bytes");if(n){if("$"===P[0])throw Error("key "+P+" must not start with '$'");if(~P.indexOf("."))throw Error("key "+P+" must not contain '.'")}}if("string"===D)B=d(e,P,L,B);else if("number"===D)B=h(e,P,L,B);else if("boolean"===D)B=m(e,P,L,B);else if(L instanceof Date||p(L))B=g(e,P,L,B);else if(void 0===L)!1===a&&(B=f(e,P,0,B));else if(null===L)B=f(e,P,0,B);else if("ObjectID"===L._bsontype||"ObjectId"===L._bsontype)B=x(e,P,L,B);else if(Buffer.isBuffer(L))B=w(e,P,L,B);else if(L instanceof RegExp||u(L))B=y(e,P,L,B);else if("object"===D&&null==L._bsontype)B=S(e,P,L,B,n,o,s,a,!1,M);else if("object"===D&&"Decimal128"===L._bsontype)B=_(e,P,L,B);else if("Long"===L._bsontype||"Timestamp"===L._bsontype)B=T(e,P,L,B);else if("Double"===L._bsontype)B=O(e,P,L,B);else if("Code"===L._bsontype)B=C(e,P,L,B,n,o,s,a);else if("function"==typeof L&&s)B=k(e,P,L,B,0,0,s);else if("Binary"===L._bsontype)B=A(e,P,L,B);else if("Symbol"===L._bsontype)B=I(e,P,L,B);else if("DBRef"===L._bsontype)B=N(e,P,L,B,o,s);else if("BSONRegExp"===L._bsontype)B=v(e,P,L,B);else if("Int32"===L._bsontype)B=E(e,P,L,B);else if("MinKey"===L._bsontype||"MaxKey"===L._bsontype)B=b(e,P,L,B);else if(void 0!==L._bsontype)throw new TypeError("Unrecognized or invalid _bsontype: "+L._bsontype)}}M.pop(),e[B++]=0;var q=B-i;return e[i++]=255&q,e[i++]=q>>8&255,e[i++]=q>>16&255,e[i++]=q>>24&255,B},B={BSON_DATA_NUMBER:1,BSON_DATA_STRING:2,BSON_DATA_OBJECT:3,BSON_DATA_ARRAY:4,BSON_DATA_BINARY:5,BSON_DATA_UNDEFINED:6,BSON_DATA_OID:7,BSON_DATA_BOOLEAN:8,BSON_DATA_DATE:9,BSON_DATA_NULL:10,BSON_DATA_REGEXP:11,BSON_DATA_CODE:13,BSON_DATA_SYMBOL:14,BSON_DATA_CODE_W_SCOPE:15,BSON_DATA_INT:16,BSON_DATA_TIMESTAMP:17,BSON_DATA_LONG:18,BSON_DATA_DECIMAL128:19,BSON_DATA_MIN_KEY:255,BSON_DATA_MAX_KEY:127,BSON_BINARY_SUBTYPE_DEFAULT:0,BSON_BINARY_SUBTYPE_FUNCTION:1,BSON_BINARY_SUBTYPE_BYTE_ARRAY:2,BSON_BINARY_SUBTYPE_UUID:3,BSON_BINARY_SUBTYPE_MD5:4,BSON_BINARY_SUBTYPE_USER_DEFINED:128,BSON_INT32_MAX:2147483647,BSON_INT32_MIN:-2147483648};B.BSON_INT64_MAX=Math.pow(2,63)-1,B.BSON_INT64_MIN=-Math.pow(2,63),B.JS_INT_MAX=9007199254740992,B.JS_INT_MIN=-9007199254740992,e.exports=M},function(e,t){t.readIEEE754=function(e,t,n,i,o){var r,s,a="big"===n,c=8*o-i-1,l=(1<<c)-1,p=l>>1,u=-7,d=a?0:o-1,h=a?1:-1,f=e[t+d];for(d+=h,r=f&(1<<-u)-1,f>>=-u,u+=c;u>0;r=256*r+e[t+d],d+=h,u-=8);for(s=r&(1<<-u)-1,r>>=-u,u+=i;u>0;s=256*s+e[t+d],d+=h,u-=8);if(0===r)r=1-p;else{if(r===l)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,i),r-=p}return(f?-1:1)*s*Math.pow(2,r-i)},t.writeIEEE754=function(e,t,n,i,o,r){var s,a,c,l="big"===i,p=8*r-o-1,u=(1<<p)-1,d=u>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,f=l?r-1:0,m=l?-1:1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+d>=1?h/c:h*Math.pow(2,1-d))*c>=2&&(s++,c/=2),s+d>=u?(a=0,s=u):s+d>=1?(a=(t*c-1)*Math.pow(2,o),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,o),s=0));o>=8;e[n+f]=255&a,f+=m,a/=256,o-=8);for(s=s<<o|a,p+=o;p>0;e[n+f]=255&s,f+=m,s/=256,p-=8);e[n+f-m]|=128*g}},function(e,t,n){"use strict";var i=n(29).Long,o=n(46).Double,r=n(47).Timestamp,s=n(48).ObjectID,a=n(50).Symbol,c=n(49).BSONRegExp,l=n(51).Code,p=n(52),u=n(53).MinKey,d=n(54).MaxKey,h=n(55).DBRef,f=n(35).Binary,m=n(24).normalizedFunctionString,g=function(e,t,n){var i=5;if(Array.isArray(e))for(var o=0;o<e.length;o++)i+=y(o.toString(),e[o],t,!0,n);else for(var r in e.toBSON&&(e=e.toBSON()),e)i+=y(r,e[r],t,!1,n);return i};function y(e,t,n,y,b){switch(t&&t.toBSON&&(t=t.toBSON()),typeof t){case"string":return 1+Buffer.byteLength(e,"utf8")+1+4+Buffer.byteLength(t,"utf8")+1;case"number":return Math.floor(t)===t&&t>=v.JS_INT_MIN&&t<=v.JS_INT_MAX&&t>=v.BSON_INT32_MIN&&t<=v.BSON_INT32_MAX?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+5:(null!=e?Buffer.byteLength(e,"utf8")+1:0)+9;case"undefined":return y||!b?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1:0;case"boolean":return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+2;case"object":if(null==t||t instanceof u||t instanceof d||"MinKey"===t._bsontype||"MaxKey"===t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1;if(t instanceof s||"ObjectID"===t._bsontype||"ObjectId"===t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+13;if(t instanceof Date||"object"==typeof(w=t)&&"[object Date]"===Object.prototype.toString.call(w))return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+9;if("undefined"!=typeof Buffer&&Buffer.isBuffer(t))return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+6+t.length;if(t instanceof i||t instanceof o||t instanceof r||"Long"===t._bsontype||"Double"===t._bsontype||"Timestamp"===t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+9;if(t instanceof p||"Decimal128"===t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+17;if(t instanceof l||"Code"===t._bsontype)return null!=t.scope&&Object.keys(t.scope).length>0?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+4+4+Buffer.byteLength(t.code.toString(),"utf8")+1+g(t.scope,n,b):(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+4+Buffer.byteLength(t.code.toString(),"utf8")+1;if(t instanceof f||"Binary"===t._bsontype)return t.sub_type===f.SUBTYPE_BYTE_ARRAY?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+(t.position+1+4+1+4):(null!=e?Buffer.byteLength(e,"utf8")+1:0)+(t.position+1+4+1);if(t instanceof a||"Symbol"===t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+Buffer.byteLength(t.value,"utf8")+4+1+1;if(t instanceof h||"DBRef"===t._bsontype){var x={$ref:t.namespace,$id:t.oid};return null!=t.db&&(x.$db=t.db),(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+g(x,n,b)}return t instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(t)?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1:t instanceof c||"BSONRegExp"===t._bsontype?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.pattern,"utf8")+1+Buffer.byteLength(t.options,"utf8")+1:(null!=e?Buffer.byteLength(e,"utf8")+1:0)+g(t,n,b)+1;case"function":if(t instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(t)||"[object RegExp]"===String.call(t))return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1;if(n&&null!=t.scope&&Object.keys(t.scope).length>0)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+4+4+Buffer.byteLength(m(t),"utf8")+1+g(t.scope,n,b);if(n)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+4+Buffer.byteLength(m(t),"utf8")+1}var w;return 0}var v={BSON_INT32_MAX:2147483647,BSON_INT32_MIN:-2147483648,JS_INT_MAX:9007199254740992,JS_INT_MIN:-9007199254740992};e.exports=g},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";var i=n(66),o=n(143);e.exports=function(e,t){if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected `fromDir` and `moduleId` to be a string");e=i.resolve(e);var n=i.join(e,"noop.js");try{return o._resolveFilename(t,{id:n,filename:n,paths:o._nodeModulePaths(e)})}catch(e){return null}}},function(e,t){e.exports=require("module")},function(e,t){var n;t=e.exports=V,n="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:function(){},t.SEMVER_SPEC_VERSION="2.0.0";var i=Number.MAX_SAFE_INTEGER||9007199254740991,o=t.re=[],r=t.src=[],s=0,a=s++;r[a]="0|[1-9]\\d*";var c=s++;r[c]="[0-9]+";var l=s++;r[l]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var p=s++;r[p]="("+r[a]+")\\.("+r[a]+")\\.("+r[a]+")";var u=s++;r[u]="("+r[c]+")\\.("+r[c]+")\\.("+r[c]+")";var d=s++;r[d]="(?:"+r[a]+"|"+r[l]+")";var h=s++;r[h]="(?:"+r[c]+"|"+r[l]+")";var f=s++;r[f]="(?:-("+r[d]+"(?:\\."+r[d]+")*))";var m=s++;r[m]="(?:-?("+r[h]+"(?:\\."+r[h]+")*))";var g=s++;r[g]="[0-9A-Za-z-]+";var y=s++;r[y]="(?:\\+("+r[g]+"(?:\\."+r[g]+")*))";var v=s++,b="v?"+r[p]+r[f]+"?"+r[y]+"?";r[v]="^"+b+"$";var x="[v=\\s]*"+r[u]+r[m]+"?"+r[y]+"?",w=s++;r[w]="^"+x+"$";var S=s++;r[S]="((?:<|>)?=?)";var _=s++;r[_]=r[c]+"|x|X|\\*";var T=s++;r[T]=r[a]+"|x|X|\\*";var E=s++;r[E]="[v=\\s]*("+r[T]+")(?:\\.("+r[T]+")(?:\\.("+r[T]+")(?:"+r[f]+")?"+r[y]+"?)?)?";var O=s++;r[O]="[v=\\s]*("+r[_]+")(?:\\.("+r[_]+")(?:\\.("+r[_]+")(?:"+r[m]+")?"+r[y]+"?)?)?";var k=s++;r[k]="^"+r[S]+"\\s*"+r[E]+"$";var C=s++;r[C]="^"+r[S]+"\\s*"+r[O]+"$";var A=s++;r[A]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var I=s++;r[I]="(?:~>?)";var N=s++;r[N]="(\\s*)"+r[I]+"\\s+",o[N]=new RegExp(r[N],"g");var M=s++;r[M]="^"+r[I]+r[E]+"$";var B=s++;r[B]="^"+r[I]+r[O]+"$";var R=s++;r[R]="(?:\\^)";var P=s++;r[P]="(\\s*)"+r[R]+"\\s+",o[P]=new RegExp(r[P],"g");var L=s++;r[L]="^"+r[R]+r[E]+"$";var D=s++;r[D]="^"+r[R]+r[O]+"$";var j=s++;r[j]="^"+r[S]+"\\s*("+x+")$|^$";var z=s++;r[z]="^"+r[S]+"\\s*("+b+")$|^$";var U=s++;r[U]="(\\s*)"+r[S]+"\\s*("+x+"|"+r[E]+")",o[U]=new RegExp(r[U],"g");var q=s++;r[q]="^\\s*("+r[E]+")\\s+-\\s+("+r[E]+")\\s*$";var H=s++;r[H]="^\\s*("+r[O]+")\\s+-\\s+("+r[O]+")\\s*$";var F=s++;r[F]="(<|>)?=?\\s*\\*";for(var W=0;W<35;W++)n(W,r[W]),o[W]||(o[W]=new RegExp(r[W]));function $(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof V)return e;if("string"!=typeof e)return null;if(e.length>256)return null;if(!(t.loose?o[w]:o[v]).test(e))return null;try{return new V(e,t)}catch(e){return null}}function V(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof V){if(e.loose===t.loose)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>256)throw new TypeError("version is longer than 256 characters");if(!(this instanceof V))return new V(e,t);n("SemVer",e,t),this.options=t,this.loose=!!t.loose;var r=e.trim().match(t.loose?o[w]:o[v]);if(!r)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>i||this.major<0)throw new TypeError("Invalid major version");if(this.minor>i||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>i||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map((function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<i)return t}return e})):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}t.parse=$,t.valid=function(e,t){var n=$(e,t);return n?n.version:null},t.clean=function(e,t){var n=$(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null},t.SemVer=V,V.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},V.prototype.toString=function(){return this.version},V.prototype.compare=function(e){return n("SemVer.compare",this.version,this.options,e),e instanceof V||(e=new V(e,this.options)),this.compareMain(e)||this.comparePre(e)},V.prototype.compareMain=function(e){return e instanceof V||(e=new V(e,this.options)),G(this.major,e.major)||G(this.minor,e.minor)||G(this.patch,e.patch)},V.prototype.comparePre=function(e){if(e instanceof V||(e=new V(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var i=this.prerelease[t],o=e.prerelease[t];if(n("prerelease compare",t,i,o),void 0===i&&void 0===o)return 0;if(void 0===o)return 1;if(void 0===i)return-1;if(i!==o)return G(i,o)}while(++t)},V.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var n=this.prerelease.length;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);-1===n&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},t.inc=function(e,t,n,i){"string"==typeof n&&(i=n,n=void 0);try{return new V(e,n).inc(t,i).version}catch(e){return null}},t.diff=function(e,t){if(Q(e,t))return null;var n=$(e),i=$(t),o="";if(n.prerelease.length||i.prerelease.length){o="pre";var r="prerelease"}for(var s in n)if(("major"===s||"minor"===s||"patch"===s)&&n[s]!==i[s])return o+s;return r},t.compareIdentifiers=G;var K=/^[0-9]+$/;function G(e,t){var n=K.test(e),i=K.test(t);return n&&i&&(e=+e,t=+t),e===t?0:n&&!i?-1:i&&!n?1:e<t?-1:1}function Y(e,t,n){return new V(e,n).compare(new V(t,n))}function X(e,t,n){return Y(e,t,n)>0}function J(e,t,n){return Y(e,t,n)<0}function Q(e,t,n){return 0===Y(e,t,n)}function Z(e,t,n){return 0!==Y(e,t,n)}function ee(e,t,n){return Y(e,t,n)>=0}function te(e,t,n){return Y(e,t,n)<=0}function ne(e,t,n,i){switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return Q(e,n,i);case"!=":return Z(e,n,i);case">":return X(e,n,i);case">=":return ee(e,n,i);case"<":return J(e,n,i);case"<=":return te(e,n,i);default:throw new TypeError("Invalid operator: "+t)}}function ie(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof ie){if(e.loose===!!t.loose)return e;e=e.value}if(!(this instanceof ie))return new ie(e,t);n("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===oe?this.value="":this.value=this.operator+this.semver.version,n("comp",this)}t.rcompareIdentifiers=function(e,t){return G(t,e)},t.major=function(e,t){return new V(e,t).major},t.minor=function(e,t){return new V(e,t).minor},t.patch=function(e,t){return new V(e,t).patch},t.compare=Y,t.compareLoose=function(e,t){return Y(e,t,!0)},t.rcompare=function(e,t,n){return Y(t,e,n)},t.sort=function(e,n){return e.sort((function(e,i){return t.compare(e,i,n)}))},t.rsort=function(e,n){return e.sort((function(e,i){return t.rcompare(e,i,n)}))},t.gt=X,t.lt=J,t.eq=Q,t.neq=Z,t.gte=ee,t.lte=te,t.cmp=ne,t.Comparator=ie;var oe={};function re(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof re)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new re(e.raw,t);if(e instanceof ie)return new re(e.value,t);if(!(this instanceof re))return new re(e,t);if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map((function(e){return this.parseRange(e.trim())}),this).filter((function(e){return e.length})),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function se(e){return!e||"x"===e.toLowerCase()||"*"===e}function ae(e,t,n,i,o,r,s,a,c,l,p,u,d){return((t=se(n)?"":se(i)?">="+n+".0.0":se(o)?">="+n+"."+i+".0":">="+t)+" "+(a=se(c)?"":se(l)?"<"+(+c+1)+".0.0":se(p)?"<"+c+"."+(+l+1)+".0":u?"<="+c+"."+l+"."+p+"-"+u:"<="+a)).trim()}function ce(e,t,i){for(var o=0;o<e.length;o++)if(!e[o].test(t))return!1;if(t.prerelease.length&&!i.includePrerelease){for(o=0;o<e.length;o++)if(n(e[o].semver),e[o].semver!==oe&&e[o].semver.prerelease.length>0){var r=e[o].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0}function le(e,t,n){try{t=new re(t,n)}catch(e){return!1}return t.test(e)}function pe(e,t,n,i){var o,r,s,a,c;switch(e=new V(e,i),t=new re(t,i),n){case">":o=X,r=te,s=J,a=">",c=">=";break;case"<":o=J,r=ee,s=X,a="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(le(e,t,i))return!1;for(var l=0;l<t.set.length;++l){var p=t.set[l],u=null,d=null;if(p.forEach((function(e){e.semver===oe&&(e=new ie(">=0.0.0")),u=u||e,d=d||e,o(e.semver,u.semver,i)?u=e:s(e.semver,d.semver,i)&&(d=e)})),u.operator===a||u.operator===c)return!1;if((!d.operator||d.operator===a)&&r(e,d.semver))return!1;if(d.operator===c&&s(e,d.semver))return!1}return!0}ie.prototype.parse=function(e){var t=this.options.loose?o[j]:o[z],n=e.match(t);if(!n)throw new TypeError("Invalid comparator: "+e);this.operator=n[1],"="===this.operator&&(this.operator=""),n[2]?this.semver=new V(n[2],this.options.loose):this.semver=oe},ie.prototype.toString=function(){return this.value},ie.prototype.test=function(e){return n("Comparator.test",e,this.options.loose),this.semver===oe||("string"==typeof e&&(e=new V(e,this.options)),ne(e,this.operator,this.semver,this.options))},ie.prototype.intersects=function(e,t){if(!(e instanceof ie))throw new TypeError("a Comparator is required");var n;if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return n=new re(e.value,t),le(this.value,n,t);if(""===e.operator)return n=new re(this.value,t),le(e.semver,n,t);var i=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),o=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),r=this.semver.version===e.semver.version,s=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),a=ne(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),c=ne(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return i||o||r&&s||a||c},t.Range=re,re.prototype.format=function(){return this.range=this.set.map((function(e){return e.join(" ").trim()})).join("||").trim(),this.range},re.prototype.toString=function(){return this.range},re.prototype.parseRange=function(e){var t=this.options.loose;e=e.trim();var i=t?o[H]:o[q];e=e.replace(i,ae),n("hyphen replace",e),e=e.replace(o[U],"$1$2$3"),n("comparator trim",e,o[U]),e=(e=(e=e.replace(o[N],"$1~")).replace(o[P],"$1^")).split(/\s+/).join(" ");var r=t?o[j]:o[z],s=e.split(" ").map((function(e){return function(e,t){return n("comp",e,t),e=function(e,t){return e.trim().split(/\s+/).map((function(e){return function(e,t){n("caret",e,t);var i=t.loose?o[D]:o[L];return e.replace(i,(function(t,i,o,r,s){var a;return n("caret",e,t,i,o,r,s),se(i)?a="":se(o)?a=">="+i+".0.0 <"+(+i+1)+".0.0":se(r)?a="0"===i?">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0":">="+i+"."+o+".0 <"+(+i+1)+".0.0":s?(n("replaceCaret pr",s),a="0"===i?"0"===o?">="+i+"."+o+"."+r+"-"+s+" <"+i+"."+o+"."+(+r+1):">="+i+"."+o+"."+r+"-"+s+" <"+i+"."+(+o+1)+".0":">="+i+"."+o+"."+r+"-"+s+" <"+(+i+1)+".0.0"):(n("no pr"),a="0"===i?"0"===o?">="+i+"."+o+"."+r+" <"+i+"."+o+"."+(+r+1):">="+i+"."+o+"."+r+" <"+i+"."+(+o+1)+".0":">="+i+"."+o+"."+r+" <"+(+i+1)+".0.0"),n("caret return",a),a}))}(e,t)})).join(" ")}(e,t),n("caret",e),e=function(e,t){return e.trim().split(/\s+/).map((function(e){return function(e,t){var i=t.loose?o[B]:o[M];return e.replace(i,(function(t,i,o,r,s){var a;return n("tilde",e,t,i,o,r,s),se(i)?a="":se(o)?a=">="+i+".0.0 <"+(+i+1)+".0.0":se(r)?a=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0":s?(n("replaceTilde pr",s),a=">="+i+"."+o+"."+r+"-"+s+" <"+i+"."+(+o+1)+".0"):a=">="+i+"."+o+"."+r+" <"+i+"."+(+o+1)+".0",n("tilde return",a),a}))}(e,t)})).join(" ")}(e,t),n("tildes",e),e=function(e,t){return n("replaceXRanges",e,t),e.split(/\s+/).map((function(e){return function(e,t){e=e.trim();var i=t.loose?o[C]:o[k];return e.replace(i,(function(t,i,o,r,s,a){n("xRange",e,t,i,o,r,s,a);var c=se(o),l=c||se(r),p=l||se(s);return"="===i&&p&&(i=""),c?t=">"===i||"<"===i?"<0.0.0":"*":i&&p?(l&&(r=0),s=0,">"===i?(i=">=",l?(o=+o+1,r=0,s=0):(r=+r+1,s=0)):"<="===i&&(i="<",l?o=+o+1:r=+r+1),t=i+o+"."+r+"."+s):l?t=">="+o+".0.0 <"+(+o+1)+".0.0":p&&(t=">="+o+"."+r+".0 <"+o+"."+(+r+1)+".0"),n("xRange return",t),t}))}(e,t)})).join(" ")}(e,t),n("xrange",e),e=function(e,t){return n("replaceStars",e,t),e.trim().replace(o[F],"")}(e,t),n("stars",e),e}(e,this.options)}),this).join(" ").split(/\s+/);return this.options.loose&&(s=s.filter((function(e){return!!e.match(r)}))),s=s.map((function(e){return new ie(e,this.options)}),this)},re.prototype.intersects=function(e,t){if(!(e instanceof re))throw new TypeError("a Range is required");return this.set.some((function(n){return n.every((function(n){return e.set.some((function(e){return e.every((function(e){return n.intersects(e,t)}))}))}))}))},t.toComparators=function(e,t){return new re(e,t).set.map((function(e){return e.map((function(e){return e.value})).join(" ").trim().split(" ")}))},re.prototype.test=function(e){if(!e)return!1;"string"==typeof e&&(e=new V(e,this.options));for(var t=0;t<this.set.length;t++)if(ce(this.set[t],e,this.options))return!0;return!1},t.satisfies=le,t.maxSatisfying=function(e,t,n){var i=null,o=null;try{var r=new re(t,n)}catch(e){return null}return e.forEach((function(e){r.test(e)&&(i&&-1!==o.compare(e)||(o=new V(i=e,n)))})),i},t.minSatisfying=function(e,t,n){var i=null,o=null;try{var r=new re(t,n)}catch(e){return null}return e.forEach((function(e){r.test(e)&&(i&&1!==o.compare(e)||(o=new V(i=e,n)))})),i},t.minVersion=function(e,t){e=new re(e,t);var n=new V("0.0.0");if(e.test(n))return n;if(n=new V("0.0.0-0"),e.test(n))return n;n=null;for(var i=0;i<e.set.length;++i){e.set[i].forEach((function(e){var t=new V(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":n&&!X(n,t)||(n=t);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+e.operator)}}))}if(n&&e.test(n))return n;return null},t.validRange=function(e,t){try{return new re(e,t).range||"*"}catch(e){return null}},t.ltr=function(e,t,n){return pe(e,t,"<",n)},t.gtr=function(e,t,n){return pe(e,t,">",n)},t.outside=pe,t.prerelease=function(e,t){var n=$(e,t);return n&&n.prerelease.length?n.prerelease:null},t.intersects=function(e,t,n){return e=new re(e,n),t=new re(t,n),e.intersects(t)},t.coerce=function(e){if(e instanceof V)return e;if("string"!=typeof e)return null;var t=e.match(o[A]);if(null==t)return null;return $(t[1]+"."+(t[2]||"0")+"."+(t[3]||"0"))}},function(e){e.exports=JSON.parse('{"name":"mongodb","version":"3.6.3","description":"The official MongoDB driver for Node.js","main":"index.js","files":["index.js","lib"],"repository":{"type":"git","url":"git@github.com:mongodb/node-mongodb-native.git"},"keywords":["mongodb","driver","official"],"peerOptionalDependencies":{"kerberos":"^1.1.0","mongodb-client-encryption":"^1.0.0","mongodb-extjson":"^2.1.2","snappy":"^6.3.4","bson-ext":"^2.0.0"},"peerDependenciesMeta":{"kerberos":{"optional":true},"mongodb-client-encryption":{"optional":true},"mongodb-extjson":{"optional":true},"snappy":{"optional":true},"bson-ext":{"optional":true},"aws4":{"optional":true}},"dependencies":{"bl":"^2.2.1","bson":"^1.1.4","denque":"^1.4.1","require_optional":"^1.0.1","safe-buffer":"^5.1.2"},"devDependencies":{"chai":"^4.1.1","chai-subset":"^1.6.0","chalk":"^2.4.2","co":"4.6.0","coveralls":"^2.11.6","eslint":"^7.10.0","eslint-config-prettier":"^6.11.0","eslint-plugin-es":"^3.0.1","eslint-plugin-prettier":"^3.1.3","istanbul":"^0.4.5","jsdoc":"3.5.5","lodash.camelcase":"^4.3.0","mocha":"5.2.0","mocha-sinon":"^2.1.0","mongodb-extjson":"^2.1.1","mongodb-mock-server":"^1.0.1","prettier":"^1.19.1","semver":"^5.5.0","sinon":"^4.3.0","sinon-chai":"^3.2.0","snappy":"^6.3.4","standard-version":"^4.4.0","util.promisify":"^1.0.1","worker-farm":"^1.5.0","wtfnode":"^0.8.0","yargs":"^14.2.0"},"license":"Apache-2.0","engines":{"node":">=4"},"bugs":{"url":"https://github.com/mongodb/node-mongodb-native/issues"},"scripts":{"atlas":"mocha --opts \'{}\' ./test/manual/atlas_connectivity.test.js","check:kerberos":"mocha --opts \'{}\' -t 60000 test/manual/kerberos.test.js","check:ldap":"mocha --opts \'{}\' test/manual/ldap.test.js","check:tls":"mocha --opts \'{}\' test/manual/tls_support.test.js","test":"npm run lint && mocha --recursive test/functional test/unit","test-nolint":"mocha --recursive test/functional test/unit","coverage":"istanbul cover mongodb-test-runner -- -t 60000 test/unit test/functional","lint":"eslint -v && eslint lib test","format":"npm run lint -- --fix","bench":"node test/benchmarks/driverBench/","generate-evergreen":"node .evergreen/generate_evergreen_tasks.js","release":"standard-version -i HISTORY.md"},"homepage":"https://github.com/mongodb/node-mongodb-native","optionalDependencies":{"saslprep":"^1.0.0"}}')},function(e,t,n){"use strict";const i=n(5).inherits,o=n(8).EventEmitter,r=n(2).MongoError,s=n(2).MongoTimeoutError,a=n(2).MongoWriteConcernError,c=n(15),l=n(5).format,p=n(31).Msg,u=n(72),d=n(6).MESSAGE_HEADER_SIZE,h=n(6).COMPRESSION_DETAILS_SIZE,f=n(6).opcodes,m=n(23).compress,g=n(23).compressorIDs,y=n(23).uncompressibleCommands,v=n(95),b=n(19).Buffer,x=n(74),w=n(27).updateSessionFromResponse,S=n(4).eachAsync,_=n(4).makeStateMachine,T=n(0).now,E="destroying",O="destroyed",k=_({disconnected:["connecting","draining","disconnected"],connecting:["connecting","connected","draining","disconnected"],connected:["connected","disconnected","draining"],draining:["draining",E,O],[E]:[E,O],[O]:[O]}),C=new Set(["error","close","timeout","parseError","connect","message"]);var A=0,I=function(e,t){if(o.call(this),this.topology=e,this.s={state:"disconnected",cancellationToken:new o},this.s.cancellationToken.setMaxListeners(1/0),this.options=Object.assign({host:"localhost",port:27017,size:5,minSize:0,connectionTimeout:3e4,socketTimeout:0,keepAlive:!0,keepAliveInitialDelay:12e4,noDelay:!0,ssl:!1,checkServerIdentity:!0,ca:null,crl:null,cert:null,key:null,passphrase:null,rejectUnauthorized:!1,promoteLongs:!0,promoteValues:!0,promoteBuffers:!1,reconnect:!0,reconnectInterval:1e3,reconnectTries:30,domainsEnabled:!1,legacyCompatMode:!0},t),this.id=A++,this.retriesLeft=this.options.reconnectTries,this.reconnectId=null,this.reconnectError=null,!t.bson||t.bson&&("function"!=typeof t.bson.serialize||"function"!=typeof t.bson.deserialize))throw new Error("must pass in valid bson parser");this.logger=c("Pool",t),this.availableConnections=[],this.inUseConnections=[],this.connectingConnections=0,this.executing=!1,this.queue=[],this.numberOfConsecutiveTimeouts=0,this.connectionIndex=0;const n=this;this._messageHandler=function(e){return function(t,n){for(var i=null,o=0;o<n.workItems.length;o++)n.workItems[o].requestId===t.responseTo&&(i=n.workItems[o],n.workItems.splice(o,1));function s(e,t,n,i){if(!e.options.domainsEnabled)return process.nextTick((function(){return t(n,i)}));t(n,i)}if(i&&i.monitoring&&R(n,e.inUseConnections,e.availableConnections),e.numberOfConsecutiveTimeouts=0,i&&i.socketTimeout&&n.resetSocketTimeout(),e.logger.isDebug()&&e.logger.debug(l("message [%s] received from %s:%s",t.raw.toString("hex"),e.options.host,e.options.port)),e.executing||process.nextTick((function(){H(e)()})),i&&!i.immediateRelease){try{t.parse(i)}catch(t){return s(e,i.cb,new r(t))}if(t.documents[0]){const n=t.documents[0],o=i.session;o&&w(o,n),e.topology&&n.$clusterTime&&(e.topology.clusterTime=n.$clusterTime)}if(i.command&&t.documents[0]){const n=t.documents[0];if(n.writeConcernError){const t=new a(n.writeConcernError,n);return s(e,i.cb,t)}if(0===n.ok||n.$err||n.errmsg||n.code)return s(e,i.cb,new r(n))}t.hashedName=n.hashedName,s(e,i.cb,null,new u(i.fullResult?t:t.documents[0],n,t))}}}(this),this._connectionCloseHandler=function(e){M(n,"close",e,this)},this._connectionErrorHandler=function(e){M(n,"error",e,this)},this._connectionTimeoutHandler=function(e){M(n,"timeout",e,this)},this._connectionParseErrorHandler=function(e){M(n,"parseError",e,this)}};function N(e){e.inUseConnections=[],e.availableConnections=[],e.connectingConnections=0,e.executing=!1,e.numberOfConsecutiveTimeouts=0,e.connectionIndex=0,e.retriesLeft=e.options.reconnectTries,e.reconnectId=null}function M(e,t,n,i){if(i){if(i._connectionFailHandled)return;i._connectionFailHandled=!0,i.destroy(),z(e,i),i.flush(n)}if("timeout"===t&&(e.numberOfConsecutiveTimeouts=e.numberOfConsecutiveTimeouts+1,e.numberOfConsecutiveTimeouts>e.options.reconnectTries))return e.numberOfConsecutiveTimeouts=0,e.destroy(!0),e.emit("close",e);0===e.socketCount()&&(e.state!==O&&e.state!==E&&"draining"!==e.state&&e.options.reconnect&&k(e,"disconnected"),t="error"===t?"close":t,e.emit(t,n)),!e.reconnectId&&e.options.reconnect&&(e.reconnectError=n,e.reconnectId=setTimeout(B(e),e.options.reconnectInterval));P(e)<e.minSize&&U(e)}function B(e,t){return function(){if(e.emit("attemptReconnect",e),e.state!==O&&e.state!==E){if(e.retriesLeft=e.retriesLeft-1,e.retriesLeft<=0){e.destroy();const n=new s(`failed to reconnect after ${e.options.reconnectTries} attempts with interval ${e.options.reconnectInterval} ms`,e.reconnectError);return e.emit("reconnectFailed",n),void("function"==typeof t&&t(n))}e.reconnectId=null,U(e,(n,i)=>{null==n&&(e.reconnectId=null,e.retriesLeft=e.options.reconnectTries,e.emit("reconnect",e)),"function"==typeof t&&t(n,i)})}else"function"==typeof t&&t(new r("Cannot create connection when pool is destroyed"))}}function R(e,t,n){var i=t.indexOf(e);-1!==i&&(t.splice(i,1),n.push(e))}function P(e){return e.availableConnections.length+e.inUseConnections.length+e.connectingConnections}function L(e,t,n,i){k(e,E),e.s.cancellationToken.emit("cancel"),S(t,(e,t)=>{for(const t of C)e.removeAllListeners(t);e.on("error",()=>{}),e.destroy(n,t)},t=>{t?"function"==typeof i&&i(t,null):(N(e),e.queue=[],k(e,O),"function"==typeof i&&i(null,null))})}function D(e,t,n){const i=t.toBin();if(!!!e.options.agreedCompressor||!function(e){const t=e instanceof p?e.command:e.query,n=Object.keys(t)[0];return!y.has(n)}(t))return n(null,i);const o=b.concat(i),r=o.slice(d),s=o.readInt32LE(12);m(e,r,(function(i,o){if(i)return n(i,null);const a=b.alloc(d);a.writeInt32LE(d+h+o.length,0),a.writeInt32LE(t.requestId,4),a.writeInt32LE(0,8),a.writeInt32LE(f.OP_COMPRESSED,12);const c=b.alloc(h);return c.writeInt32LE(s,0),c.writeInt32LE(r.length,4),c.writeUInt8(g[e.options.agreedCompressor],8),n(null,[a,c,o])}))}function j(e,t){for(var n=0;n<t.length;n++)if(t[n]===e)return t.splice(n,1),!0}function z(e,t){j(t,e.availableConnections)||j(t,e.inUseConnections)}function U(e,t){e.state!==O&&e.state!==E?(e.connectingConnections++,x(e.options,e.s.cancellationToken,(n,i)=>(e.connectingConnections--,n?(e.logger.isDebug()&&e.logger.debug(`connection attempt failed with error [${JSON.stringify(n)}]`),!e.reconnectId&&e.options.reconnect?"connecting"===e.state&&e.options.legacyCompatMode?void t(n):(e.reconnectError=n,void(e.reconnectId=setTimeout(B(e,t),e.options.reconnectInterval))):void("function"==typeof t&&t(n))):e.state===O||e.state===E?("function"==typeof t&&t(new r("Pool was destroyed after connection creation")),void i.destroy()):(i.on("error",e._connectionErrorHandler),i.on("close",e._connectionCloseHandler),i.on("timeout",e._connectionTimeoutHandler),i.on("parseError",e._connectionParseErrorHandler),i.on("message",e._messageHandler),e.availableConnections.push(i),"function"==typeof t&&t(null,i),void H(e)())))):"function"==typeof t&&t(new r("Cannot create connection when pool is destroyed"))}function q(e){for(var t=0;t<e.length;t++)if(e[t].monitoring){var n=e[t];e.splice(t,1),n.cb(new r({message:"no connection available for monitoring",driver:!0}))}}function H(e){return function(){if(e.state!==O&&!e.executing)if(e.executing=!0,e.connectingConnections>0)e.executing=!1;else{for(;;){const s=P(e);if(0===e.availableConnections.length){q(e.queue),s<e.options.size&&e.queue.length>0&&U(e);break}if(0===e.queue.length)break;var t=null;const a=e.availableConnections.filter(e=>0===e.workItems.length);if(!(t=0===a.length?e.availableConnections[e.connectionIndex++%e.availableConnections.length]:a[e.connectionIndex++%a.length]).isConnected()){z(e,t),q(e.queue);break}var n=e.queue.shift();if(n.monitoring){var i=!1;for(let n=0;n<e.availableConnections.length;n++)if(e.availableConnections[n].isConnected()&&0===e.availableConnections[n].workItems.length){i=!0,t=e.availableConnections[n];break}if(!i){e.queue.unshift(n),s<e.options.size&&e.queue.length>0&&U(e),setTimeout(()=>H(e)(),10);break}}if(s<e.options.size&&t.workItems.length>0){e.queue.unshift(n),U(e);break}var o=n.buffer;n.monitoring&&R(t,e.availableConnections,e.inUseConnections),n.noResponse||t.workItems.push(n),n.immediateRelease||"number"!=typeof n.socketTimeout||t.setSocketTimeout(n.socketTimeout);var r=!0;if(Array.isArray(o))for(let e=0;e<o.length;e++)r=t.write(o[e]);else r=t.write(o);if(n.noResponse&&"function"==typeof n.cb&&n.cb(null,null),!1===r){e.queue.unshift(n),z(e,t),q(e.queue);break}}e.executing=!1}}}i(I,o),Object.defineProperty(I.prototype,"size",{enumerable:!0,get:function(){return this.options.size}}),Object.defineProperty(I.prototype,"minSize",{enumerable:!0,get:function(){return this.options.minSize}}),Object.defineProperty(I.prototype,"connectionTimeout",{enumerable:!0,get:function(){return this.options.connectionTimeout}}),Object.defineProperty(I.prototype,"socketTimeout",{enumerable:!0,get:function(){return this.options.socketTimeout}}),Object.defineProperty(I.prototype,"state",{enumerable:!0,get:function(){return this.s.state}}),I.prototype.socketCount=function(){return this.availableConnections.length+this.inUseConnections.length},I.prototype.allConnections=function(){return this.availableConnections.concat(this.inUseConnections)},I.prototype.get=function(){return this.allConnections()[0]},I.prototype.isConnected=function(){if(this.state===O||this.state===E)return!1;for(var e=this.availableConnections.concat(this.inUseConnections),t=0;t<e.length;t++)if(e[t].isConnected())return!0;return!1},I.prototype.isDestroyed=function(){return this.state===O||this.state===E},I.prototype.isDisconnected=function(){return"disconnected"===this.state},I.prototype.connect=function(e){if("disconnected"!==this.state)throw new r("connection in unlawful state "+this.state);k(this,"connecting"),U(this,(t,n)=>{if(t)return"function"==typeof e?(this.destroy(),void e(t)):("connecting"===this.state&&this.emit("error",t),void this.destroy());if(k(this,"connected"),this.minSize)for(let e=0;e<this.minSize;e++)U(this);"function"==typeof e?e(null,n):this.emit("connect",this,n)})},I.prototype.auth=function(e,t){"function"==typeof t&&t(null,null)},I.prototype.logout=function(e,t){"function"==typeof t&&t(null,null)},I.prototype.unref=function(){this.availableConnections.concat(this.inUseConnections).forEach((function(e){e.unref()}))},I.prototype.destroy=function(e,t){var n=this;if("function"==typeof e&&(t=e,e=!1),this.state!==O&&n.state!==E){if(k(this,"draining"),e){for(var i=n.availableConnections.concat(n.inUseConnections);n.queue.length>0;){var o=n.queue.shift();"function"==typeof o.cb&&o.cb(new r("Pool was force destroyed"))}return L(n,i,{force:!0},t)}this.reconnectId&&clearTimeout(this.reconnectId),function e(){if(n.state!==O&&n.state!==E)if(q(n.queue),0===n.queue.length){for(var i=n.availableConnections.concat(n.inUseConnections),o=0;o<i.length;o++)if(i[o].workItems.length>0)return setTimeout(e,1);L(n,i,{force:!1},t)}else H(n)(),setTimeout(e,1);else"function"==typeof t&&t()}()}else"function"==typeof t&&t(null,null)},I.prototype.reset=function(e){if("connected"!==this.s.state)return void("function"==typeof e&&e(new r("pool is not connected, reset aborted")));this.s.cancellationToken.emit("cancel");const t=this.availableConnections.concat(this.inUseConnections);S(t,(e,t)=>{for(const t of C)e.removeAllListeners(t);e.destroy({force:!0},t)},t=>{t&&"function"==typeof e?e(t,null):(N(this),U(this,()=>{"function"==typeof e&&e(null,null)}))})},I.prototype.write=function(e,t,n){var i=this;if("function"==typeof t&&(n=t),t=t||{},"function"!=typeof n&&!t.noResponse)throw new r("write method must provide a callback");if(this.state!==O&&this.state!==E)if("draining"!==this.state){if(this.options.domainsEnabled&&process.domain&&"function"==typeof n){var o=n;n=process.domain.bind((function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;t++)e[t]=arguments[t];process.nextTick((function(){o.apply(null,e)}))}))}var s={cb:n,raw:!1,promoteLongs:!0,promoteValues:!0,promoteBuffers:!1,fullResult:!1};s.promoteLongs="boolean"!=typeof t.promoteLongs||t.promoteLongs,s.promoteValues="boolean"!=typeof t.promoteValues||t.promoteValues,s.promoteBuffers="boolean"==typeof t.promoteBuffers&&t.promoteBuffers,s.raw="boolean"==typeof t.raw&&t.raw,s.immediateRelease="boolean"==typeof t.immediateRelease&&t.immediateRelease,s.documentsReturnedIn=t.documentsReturnedIn,s.command="boolean"==typeof t.command&&t.command,s.fullResult="boolean"==typeof t.fullResult&&t.fullResult,s.noResponse="boolean"==typeof t.noResponse&&t.noResponse,s.session=t.session||null,s.socketTimeout=t.socketTimeout,s.monitoring=t.monitoring,s.requestId=e.requestId,i.options.monitorCommands&&(this.emit("commandStarted",new v.CommandStartedEvent(this,e)),s.started=T(),s.cb=(t,o)=>{t?i.emit("commandFailed",new v.CommandFailedEvent(this,e,t,s.started)):o&&o.result&&(0===o.result.ok||o.result.$err)?i.emit("commandFailed",new v.CommandFailedEvent(this,e,o.result,s.started)):i.emit("commandSucceeded",new v.CommandSucceededEvent(this,e,o,s.started)),"function"==typeof n&&n(t,o)}),D(i,e,(e,n)=>{if(e)throw e;s.buffer=n,t.monitoring?i.queue.unshift(s):i.queue.push(s),i.executing||process.nextTick((function(){H(i)()}))})}else n(new r("pool is draining, new operations prohibited"));else n(new r("pool destroyed"))},I._execute=H,e.exports=I},function(e,t,n){"use strict";const{unassigned_code_points:i,commonly_mapped_to_nothing:o,non_ASCII_space_characters:r,prohibited_characters:s,bidirectional_r_al:a,bidirectional_l:c}=n(148);e.exports=function(e,t={}){if("string"!=typeof e)throw new TypeError("Expected string.");if(0===e.length)return"";const n=d(e).map(e=>l.get(e)?32:e).filter(e=>!p.get(e)),o=String.fromCodePoint.apply(null,n).normalize("NFKC"),r=d(o);if(r.some(e=>s.get(e)))throw new Error("Prohibited character, see https://tools.ietf.org/html/rfc4013#section-2.3");if(!0!==t.allowUnassigned){if(r.some(e=>i.get(e)))throw new Error("Unassigned code point, see https://tools.ietf.org/html/rfc4013#section-2.5")}const h=r.some(e=>a.get(e)),f=r.some(e=>c.get(e));if(h&&f)throw new Error("String must not contain RandALCat and LCat at the same time, see https://tools.ietf.org/html/rfc3454#section-6");const m=a.get(u((y=o,y[0]))),g=a.get(u((e=>e[e.length-1])(o)));var y;if(h&&(!m||!g))throw new Error("Bidirectional RandALCat character must be the first and the last character of the string, see https://tools.ietf.org/html/rfc3454#section-6");return o};const l=r,p=o,u=e=>e.codePointAt(0);function d(e){const t=[],n=e.length;for(let i=0;i<n;i+=1){const o=e.charCodeAt(i);if(o>=55296&&o<=56319&&n>i+1){const n=e.charCodeAt(i+1);if(n>=56320&&n<=57343){t.push(1024*(o-55296)+n-56320+65536),i+=1;continue}}t.push(o)}return t}},function(e,t,n){"use strict";(function(t){const i=n(44),o=n(66),r=n(149),s=i.readFileSync(o.resolve(t,"../code-points.mem"));let a=0;function c(){const e=s.readUInt32BE(a);a+=4;const t=s.slice(a,a+e);return a+=e,r({buffer:t})}const l=c(),p=c(),u=c(),d=c(),h=c(),f=c();e.exports={unassigned_code_points:l,commonly_mapped_to_nothing:p,non_ASCII_space_characters:u,prohibited_characters:d,bidirectional_r_al:h,bidirectional_l:f}}).call(this,"/")},function(e,t,n){var i=n(150);function o(e){if(!(this instanceof o))return new o(e);if(e||(e={}),Buffer.isBuffer(e)&&(e={buffer:e}),this.pageOffset=e.pageOffset||0,this.pageSize=e.pageSize||1024,this.pages=e.pages||i(this.pageSize),this.byteLength=this.pages.length*this.pageSize,this.length=8*this.byteLength,(t=this.pageSize)&t-1)throw new Error("The page size should be a power of two");var t;if(this._trackUpdates=!!e.trackUpdates,this._pageMask=this.pageSize-1,e.buffer){for(var n=0;n<e.buffer.length;n+=this.pageSize)this.pages.set(n/this.pageSize,e.buffer.slice(n,n+this.pageSize));this.byteLength=e.buffer.length,this.length=8*this.byteLength}}e.exports=o,o.prototype.get=function(e){var t=7&e,n=(e-t)/8;return!!(this.getByte(n)&128>>t)},o.prototype.getByte=function(e){var t=e&this._pageMask,n=(e-t)/this.pageSize,i=this.pages.get(n,!0);return i?i.buffer[t+this.pageOffset]:0},o.prototype.set=function(e,t){var n=7&e,i=(e-n)/8,o=this.getByte(i);return this.setByte(i,t?o|128>>n:o&(255^128>>n))},o.prototype.toBuffer=function(){for(var e=function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t}(this.pages.length*this.pageSize),t=0;t<this.pages.length;t++){var n=this.pages.get(t,!0),i=t*this.pageSize;n&&n.buffer.copy(e,i,this.pageOffset,this.pageOffset+this.pageSize)}return e},o.prototype.setByte=function(e,t){var n=e&this._pageMask,i=(e-n)/this.pageSize,o=this.pages.get(i,!1);return n+=this.pageOffset,o.buffer[n]!==t&&(o.buffer[n]=t,e>=this.byteLength&&(this.byteLength=e+1,this.length=8*this.byteLength),this._trackUpdates&&this.pages.updated(o),!0)}},function(e,t){function n(e,t){if(!(this instanceof n))return new n(e,t);this.length=0,this.updates=[],this.path=new Uint16Array(4),this.pages=new Array(32768),this.maxPages=this.pages.length,this.level=0,this.pageSize=e||1024,this.deduplicate=t?t.deduplicate:null,this.zeros=this.deduplicate?i(this.deduplicate.length):null}function i(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t}function o(e,t){this.offset=e*t.length,this.buffer=t,this.updated=!1,this.deduplicate=0}e.exports=n,n.prototype.updated=function(e){for(;this.deduplicate&&e.buffer[e.deduplicate]===this.deduplicate[e.deduplicate];)if(e.deduplicate++,e.deduplicate===this.deduplicate.length){e.deduplicate=0,e.buffer.equals&&e.buffer.equals(this.deduplicate)&&(e.buffer=this.deduplicate);break}!e.updated&&this.updates&&(e.updated=!0,this.updates.push(e))},n.prototype.lastUpdate=function(){if(!this.updates||!this.updates.length)return null;var e=this.updates.pop();return e.updated=!1,e},n.prototype._array=function(e,t){if(e>=this.maxPages){if(t)return;!function(e,t){for(;e.maxPages<t;){var n=e.pages;e.pages=new Array(32768),e.pages[0]=n,e.level++,e.maxPages*=32768}}(this,e)}var n,i;n=e,i=this.path,n=((n=(n-(i[0]=32767&n))/32768)-(i[1]=32767&n))/32768,i[3]=(n-(i[2]=32767&n))/32768&32767;for(var o=this.pages,r=this.level;r>0;r--){var s=this.path[r],a=o[s];if(!a){if(t)return;a=o[s]=new Array(32768)}o=a}return o},n.prototype.get=function(e,t){var n,r,s=this._array(e,t),a=this.path[0],c=s&&s[a];return c||t||(c=s[a]=new o(e,i(this.pageSize)),e>=this.length&&(this.length=e+1)),c&&c.buffer===this.deduplicate&&this.deduplicate&&!t&&(c.buffer=(n=c.buffer,r=Buffer.allocUnsafe?Buffer.allocUnsafe(n.length):new Buffer(n.length),n.copy(r),r),c.deduplicate=0),c},n.prototype.set=function(e,t){var n=this._array(e,!1),r=this.path[0];if(e>=this.length&&(this.length=e+1),!t||this.zeros&&t.equals&&t.equals(this.zeros))n[r]=void 0;else{this.deduplicate&&t.equals&&t.equals(this.deduplicate)&&(t=this.deduplicate);var s=n[r],a=function(e,t){if(e.length===t)return e;if(e.length>t)return e.slice(0,t);var n=i(t);return e.copy(n),n}(t,this.pageSize);s?s.buffer=a:n[r]=new o(e,a)}},n.prototype.toBuffer=function(){for(var e=new Array(this.length),t=i(this.pageSize),n=0;n<e.length;)for(var o=this._array(n,!0),r=0;r<32768&&n<e.length;r++)e[n++]=o&&o[r]?o[r].buffer:t;return Buffer.concat(e)}},function(e,t,n){"use strict";const i=n(26).AuthProvider,o=n(102).MongoCredentials,r=n(2).MongoError,s=n(17),a=n(135),c=n(4).maxWireVersion,l=n(34);let p;try{p=n(152)}catch(e){}const u="http://169.254.169.254",d="/latest/meta-data/iam/security-credentials";function h(e){const t=e.split(".");return 1===t.length||"amazonaws"===t[1]?"us-east-1":t[1]}function f(e,t,n){"function"==typeof t&&(n=t,t={}),t=Object.assign({method:"GET",timeout:1e4,json:!0},l.parse(e),t);const i=a.request(t,e=>{e.setEncoding("utf8");let i="";e.on("data",e=>i+=e),e.on("end",()=>{if(!1!==t.json)try{const e=JSON.parse(i);n(void 0,e)}catch(e){n(new r(`Invalid JSON response: "${i}"`))}else n(void 0,i)})});i.on("error",e=>n(e)),i.end()}e.exports=class extends i{auth(e,t){const n=e.connection,i=e.credentials;if(c(n)<9)return void t(new r("MONGODB-AWS authentication requires MongoDB version 4.4 or later"));if(null==p)return void t(new r("MONGODB-AWS authentication requires the `aws4` module, please install it as a dependency of your project"));if(null==i.username)return void function(e,t){function n(n){null!=n.AccessKeyId&&null!=n.SecretAccessKey&&null!=n.Token?t(void 0,new o({username:n.AccessKeyId,password:n.SecretAccessKey,source:e.source,mechanism:"MONGODB-AWS",mechanismProperties:{AWS_SESSION_TOKEN:n.Token}})):t(new r("Could not obtain temporary MONGODB-AWS credentials"))}if(process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI)return void f("http://169.254.170.2"+process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI,(e,i)=>{if(e)return t(e);n(i)});f(u+"/latest/api/token",{method:"PUT",json:!1,headers:{"X-aws-ec2-metadata-token-ttl-seconds":30}},(e,i)=>{if(e)return t(e);f(`${u}/${d}`,{json:!1,headers:{"X-aws-ec2-metadata-token":i}},(e,o)=>{if(e)return t(e);f(`${u}/${d}/${o}`,{headers:{"X-aws-ec2-metadata-token":i}},(e,i)=>{if(e)return t(e);n(i)})})})}(i,(n,i)=>{if(n)return t(n);e.credentials=i,this.auth(e,t)});const a=i.username,l=i.password,m=i.source,g=i.mechanismProperties.AWS_SESSION_TOKEN,y=this.bson;s.randomBytes(32,(e,i)=>{if(e)return void t(e);const o={saslStart:1,mechanism:"MONGODB-AWS",payload:y.serialize({r:i,p:110})};n.command(m+".$cmd",o,(e,o)=>{if(e)return t(e);const s=o.result,c=y.deserialize(s.payload.buffer),u=c.h,d=c.s.buffer;if(64!==d.length)return void t(new r(`Invalid server nonce length ${d.length}, expected 64`));if(0!==d.compare(i,0,i.length,0,i.length))return void t(new r("Server nonce does not begin with client nonce"));if(u.length<1||u.length>255||-1!==u.indexOf(".."))return void t(new r(`Server returned an invalid host: "${u}"`));const f="Action=GetCallerIdentity&Version=2011-06-15",v=p.sign({method:"POST",host:u,region:h(c.h),service:"sts",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":f.length,"X-MongoDB-Server-Nonce":d.toString("base64"),"X-MongoDB-GS2-CB-Flag":"n"},path:"/",body:f},{accessKeyId:a,secretAccessKey:l,token:g}),b={a:v.headers.Authorization,d:v.headers["X-Amz-Date"]};g&&(b.t=g);const x={saslContinue:1,conversationId:1,payload:y.serialize(b)};n.command(m+".$cmd",x,e=>{if(e)return t(e);t()})})})}}},function(e,t,n){var i=t,o=n(34),r=n(103),s=n(17),a=n(153)(1e3);function c(e,t,n){return s.createHmac("sha256",e).update(t,"utf8").digest(n)}function l(e,t){return s.createHash("sha256").update(e,"utf8").digest(t)}function p(e){return e.replace(/[!'()*]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))}function u(e){return p(encodeURIComponent(e))}var d={authorization:!0,connection:!0,"x-amzn-trace-id":!0,"user-agent":!0,expect:!0,"presigned-expires":!0,range:!0};function h(e,t){"string"==typeof e&&(e=o.parse(e));var n=e.headers=e.headers||{},i=(!this.service||!this.region)&&this.matchHost(e.hostname||e.host||n.Host||n.host);this.request=e,this.credentials=t||this.defaultCredentials(),this.service=e.service||i[0]||"",this.region=e.region||i[1]||"us-east-1","email"===this.service&&(this.service="ses"),!e.method&&e.body&&(e.method="POST"),n.Host||n.host||(n.Host=e.hostname||e.host||this.createHost(),e.port&&(n.Host+=":"+e.port)),e.hostname||e.host||(e.hostname=n.Host||n.host),this.isCodeCommitGit="codecommit"===this.service&&"GIT"===e.method}h.prototype.matchHost=function(e){var t=((e||"").match(/([^\.]+)\.(?:([^\.]*)\.)?amazonaws\.com(\.cn)?$/)||[]).slice(1,3);if("es"===t[1]&&(t=t.reverse()),"s3"==t[1])t[0]="s3",t[1]="us-east-1";else for(var n=0;n<2;n++)if(/^s3-/.test(t[n])){t[1]=t[n].slice(3),t[0]="s3";break}return t},h.prototype.isSingleRegion=function(){return["s3","sdb"].indexOf(this.service)>=0&&"us-east-1"===this.region||["cloudfront","ls","route53","iam","importexport","sts"].indexOf(this.service)>=0},h.prototype.createHost=function(){var e=this.isSingleRegion()?"":"."+this.region;return("ses"===this.service?"email":this.service)+e+".amazonaws.com"},h.prototype.prepareRequest=function(){this.parsePath();var e,t=this.request,n=t.headers;t.signQuery?(this.parsedPath.query=e=this.parsedPath.query||{},this.credentials.sessionToken&&(e["X-Amz-Security-Token"]=this.credentials.sessionToken),"s3"!==this.service||e["X-Amz-Expires"]||(e["X-Amz-Expires"]=86400),e["X-Amz-Date"]?this.datetime=e["X-Amz-Date"]:e["X-Amz-Date"]=this.getDateTime(),e["X-Amz-Algorithm"]="AWS4-HMAC-SHA256",e["X-Amz-Credential"]=this.credentials.accessKeyId+"/"+this.credentialString(),e["X-Amz-SignedHeaders"]=this.signedHeaders()):(t.doNotModifyHeaders||this.isCodeCommitGit||(!t.body||n["Content-Type"]||n["content-type"]||(n["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8"),!t.body||n["Content-Length"]||n["content-length"]||(n["Content-Length"]=Buffer.byteLength(t.body)),!this.credentials.sessionToken||n["X-Amz-Security-Token"]||n["x-amz-security-token"]||(n["X-Amz-Security-Token"]=this.credentials.sessionToken),"s3"!==this.service||n["X-Amz-Content-Sha256"]||n["x-amz-content-sha256"]||(n["X-Amz-Content-Sha256"]=l(this.request.body||"","hex")),n["X-Amz-Date"]||n["x-amz-date"]?this.datetime=n["X-Amz-Date"]||n["x-amz-date"]:n["X-Amz-Date"]=this.getDateTime()),delete n.Authorization,delete n.authorization)},h.prototype.sign=function(){return this.parsedPath||this.prepareRequest(),this.request.signQuery?this.parsedPath.query["X-Amz-Signature"]=this.signature():this.request.headers.Authorization=this.authHeader(),this.request.path=this.formatPath(),this.request},h.prototype.getDateTime=function(){if(!this.datetime){var e=this.request.headers,t=new Date(e.Date||e.date||new Date);this.datetime=t.toISOString().replace(/[:\-]|\.\d{3}/g,""),this.isCodeCommitGit&&(this.datetime=this.datetime.slice(0,-1))}return this.datetime},h.prototype.getDate=function(){return this.getDateTime().substr(0,8)},h.prototype.authHeader=function(){return["AWS4-HMAC-SHA256 Credential="+this.credentials.accessKeyId+"/"+this.credentialString(),"SignedHeaders="+this.signedHeaders(),"Signature="+this.signature()].join(", ")},h.prototype.signature=function(){var e,t,n,i=this.getDate(),o=[this.credentials.secretAccessKey,i,this.region,this.service].join(),r=a.get(o);return r||(e=c("AWS4"+this.credentials.secretAccessKey,i),t=c(e,this.region),n=c(t,this.service),r=c(n,"aws4_request"),a.set(o,r)),c(r,this.stringToSign(),"hex")},h.prototype.stringToSign=function(){return["AWS4-HMAC-SHA256",this.getDateTime(),this.credentialString(),l(this.canonicalString(),"hex")].join("\n")},h.prototype.canonicalString=function(){this.parsedPath||this.prepareRequest();var e,t=this.parsedPath.path,n=this.parsedPath.query,i=this.request.headers,o="",r="s3"!==this.service,s="s3"===this.service||this.request.doNotEncodePath,a="s3"===this.service,c="s3"===this.service;if(e="s3"===this.service&&this.request.signQuery?"UNSIGNED-PAYLOAD":this.isCodeCommitGit?"":i["X-Amz-Content-Sha256"]||i["x-amz-content-sha256"]||l(this.request.body||"","hex"),n){var p=Object.keys(n).reduce((function(e,t){return t?(e[u(t)]=Array.isArray(n[t])&&c?n[t][0]:n[t],e):e}),{}),d=[];Object.keys(p).sort().forEach((function(e){Array.isArray(p[e])?p[e].map(u).sort().forEach((function(t){d.push(e+"="+t)})):d.push(e+"="+u(p[e]))})),o=d.join("&")}return"/"!==t&&(r&&(t=t.replace(/\/{2,}/g,"/")),"/"!==(t=t.split("/").reduce((function(e,t){return r&&".."===t?e.pop():r&&"."===t||(s&&(t=decodeURIComponent(t.replace(/\+/g," "))),e.push(u(t))),e}),[]).join("/"))[0]&&(t="/"+t),a&&(t=t.replace(/%2F/g,"/"))),[this.request.method||"GET",t,o,this.canonicalHeaders()+"\n",this.signedHeaders(),e].join("\n")},h.prototype.canonicalHeaders=function(){var e=this.request.headers;return Object.keys(e).filter((function(e){return null==d[e.toLowerCase()]})).sort((function(e,t){return e.toLowerCase()<t.toLowerCase()?-1:1})).map((function(t){return t.toLowerCase()+":"+e[t].toString().trim().replace(/\s+/g," ")})).join("\n")},h.prototype.signedHeaders=function(){return Object.keys(this.request.headers).map((function(e){return e.toLowerCase()})).filter((function(e){return null==d[e]})).sort().join(";")},h.prototype.credentialString=function(){return[this.getDate(),this.region,this.service,"aws4_request"].join("/")},h.prototype.defaultCredentials=function(){var e=process.env;return{accessKeyId:e.AWS_ACCESS_KEY_ID||e.AWS_ACCESS_KEY,secretAccessKey:e.AWS_SECRET_ACCESS_KEY||e.AWS_SECRET_KEY,sessionToken:e.AWS_SESSION_TOKEN}},h.prototype.parsePath=function(){var e=this.request.path||"/";/[^0-9A-Za-z;,/?:@&=+$\-_.!~*'()#%]/.test(e)&&(e=encodeURI(decodeURI(e)));var t=e.indexOf("?"),n=null;t>=0&&(n=r.parse(e.slice(t+1)),e=e.slice(0,t)),this.parsedPath={path:e,query:n}},h.prototype.formatPath=function(){var e=this.parsedPath.path,t=this.parsedPath.query;return t?(null!=t[""]&&delete t[""],e+"?"+p(r.stringify(t))):e},i.RequestSigner=h,i.sign=function(e,t){return new h(e,t).sign()}},function(e,t){function n(e){this.capacity=0|e,this.map=Object.create(null),this.list=new i}function i(){this.firstNode=null,this.lastNode=null}function o(e,t){this.key=e,this.val=t,this.prev=null,this.next=null}e.exports=function(e){return new n(e)},n.prototype.get=function(e){var t=this.map[e];if(null!=t)return this.used(t),t.val},n.prototype.set=function(e,t){var n=this.map[e];if(null!=n)n.val=t;else{if(this.capacity||this.prune(),!this.capacity)return!1;n=new o(e,t),this.map[e]=n,this.capacity--}return this.used(n),!0},n.prototype.used=function(e){this.list.moveToFront(e)},n.prototype.prune=function(){var e=this.list.pop();null!=e&&(delete this.map[e.key],this.capacity++)},i.prototype.moveToFront=function(e){this.firstNode!=e&&(this.remove(e),null==this.firstNode?(this.firstNode=e,this.lastNode=e,e.prev=null,e.next=null):(e.prev=null,e.next=this.firstNode,e.next.prev=e,this.firstNode=e))},i.prototype.pop=function(){var e=this.lastNode;return null!=e&&this.remove(e),e},i.prototype.remove=function(e){this.firstNode==e?this.firstNode=e.next:null!=e.prev&&(e.prev.next=e.next),this.lastNode==e?this.lastNode=e.prev:null!=e.next&&(e.next.prev=e.prev)}},function(e,t,n){"use strict";const i=n(2).MongoError,o=n(6).collectionNamespace,r=n(37);e.exports=function(e,t,n,s,a,c,l){if(0===a.length)throw new i(t+" must contain at least one document");"function"==typeof c&&(l=c,c={});const p="boolean"!=typeof(c=c||{}).ordered||c.ordered,u=c.writeConcern,d={};if(d[t]=o(s),d[n]=a,d.ordered=p,u&&Object.keys(u).length>0&&(d.writeConcern=u),c.collation)for(let e=0;e<d[n].length;e++)d[n][e].collation||(d[n][e].collation=c.collation);!0===c.bypassDocumentValidation&&(d.bypassDocumentValidation=c.bypassDocumentValidation);const h=Object.assign({checkKeys:"insert"===t,numberToReturn:1},c);r(e,s,d,h,l)}},function(e,t,n){"use strict";const i=n(18).KillCursor,o=n(2).MongoError,r=n(2).MongoNetworkError,s=n(6).collectionNamespace,a=n(4).maxWireVersion,c=n(37);e.exports=function(e,t,n,l){l="function"==typeof l?l:()=>{};const p=n.cursorId;if(a(e)<4){const o=e.s.bson,r=e.s.pool,s=new i(o,t,[p]),a={immediateRelease:!0,noResponse:!0};if("object"==typeof n.session&&(a.session=n.session),r&&r.isConnected())try{r.write(s,a,l)}catch(e){"function"==typeof l?l(e,null):console.warn(e)}return}const u={killCursors:s(t),cursors:[p]},d={};"object"==typeof n.session&&(d.session=n.session),c(e,t,u,d,(e,t)=>{if(e)return l(e);const n=t.message;return n.cursorNotFound?l(new r("cursor killed or timed out"),null):Array.isArray(n.documents)&&0!==n.documents.length?void l(null,n.documents[0]):l(new o("invalid killCursors result returned for cursor id "+p))})}},function(e,t,n){"use strict";const i=n(18).GetMore,o=n(9).retrieveBSON,r=n(2).MongoError,s=n(2).MongoNetworkError,a=o().Long,c=n(6).collectionNamespace,l=n(4).maxWireVersion,p=n(6).applyCommonQueryOptions,u=n(37);e.exports=function(e,t,n,o,d,h){d=d||{};const f=l(e);function m(e,t){if(e)return h(e);const i=t.message;if(i.cursorNotFound)return h(new s("cursor killed or timed out"),null);if(f<4){const e="number"==typeof i.cursorId?a.fromNumber(i.cursorId):i.cursorId;return n.documents=i.documents,n.cursorId=e,void h(null,null,i.connection)}if(0===i.documents[0].ok)return h(new r(i.documents[0]));const o="number"==typeof i.documents[0].cursor.id?a.fromNumber(i.documents[0].cursor.id):i.documents[0].cursor.id;n.documents=i.documents[0].cursor.nextBatch,n.cursorId=o,h(null,i.documents[0],i.connection)}if(f<4){const r=e.s.bson,s=new i(r,t,n.cursorId,{numberToReturn:o}),a=p({},n);return void e.s.pool.write(s,a,m)}const g={getMore:n.cursorId instanceof a?n.cursorId:a.fromNumber(n.cursorId),collection:c(t),batchSize:Math.abs(o)};n.cmd.tailable&&"number"==typeof n.cmd.maxAwaitTimeMS&&(g.maxTimeMS=n.cmd.maxAwaitTimeMS);const y=Object.assign({returnFieldSelector:null,documentsReturnedIn:"nextBatch"},d);n.session&&(y.session=n.session),u(e,t,g,y,m)}},function(e,t,n){"use strict";const i=n(18).Query,o=n(2).MongoError,r=n(6).getReadPreference,s=n(6).collectionNamespace,a=n(6).isSharded,c=n(4).maxWireVersion,l=n(6).applyCommonQueryOptions,p=n(37);e.exports=function(e,t,n,u,d,h){if(d=d||{},null!=u.cursorId)return h();if(null==n)return h(new o(`command ${JSON.stringify(n)} does not return a cursor`));if(c(e)<4){const s=function(e,t,n,s,c){c=c||{};const l=e.s.bson,p=r(n,c);s.batchSize=n.batchSize||s.batchSize;let u=0;u=s.limit<0||0!==s.limit&&s.limit<s.batchSize||s.limit>0&&0===s.batchSize?s.limit:s.batchSize;const d=s.skip||0,h={};a(e)&&p&&(h.$readPreference=p.toJSON());n.sort&&(h.$orderby=n.sort);n.hint&&(h.$hint=n.hint);n.snapshot&&(h.$snapshot=n.snapshot);void 0!==n.returnKey&&(h.$returnKey=n.returnKey);n.maxScan&&(h.$maxScan=n.maxScan);n.min&&(h.$min=n.min);n.max&&(h.$max=n.max);void 0!==n.showDiskLoc&&(h.$showDiskLoc=n.showDiskLoc);n.comment&&(h.$comment=n.comment);n.maxTimeMS&&(h.$maxTimeMS=n.maxTimeMS);n.explain&&(u=-Math.abs(n.limit||0),h.$explain=!0);if(h.$query=n.query,n.readConcern&&"local"!==n.readConcern.level)throw new o("server find command does not support a readConcern level of "+n.readConcern.level);n.readConcern&&delete(n=Object.assign({},n)).readConcern;const f="boolean"==typeof c.serializeFunctions&&c.serializeFunctions,m="boolean"==typeof c.ignoreUndefined&&c.ignoreUndefined,g=new i(l,t,h,{numberToSkip:d,numberToReturn:u,pre32Limit:void 0!==n.limit?n.limit:void 0,checkKeys:!1,returnFieldSelector:n.fields,serializeFunctions:f,ignoreUndefined:m});"boolean"==typeof n.tailable&&(g.tailable=n.tailable);"boolean"==typeof n.oplogReplay&&(g.oplogReplay=n.oplogReplay);"boolean"==typeof n.noCursorTimeout&&(g.noCursorTimeout=n.noCursorTimeout);"boolean"==typeof n.awaitData&&(g.awaitData=n.awaitData);"boolean"==typeof n.partial&&(g.partial=n.partial);return g.slaveOk=p.slaveOk(),g}(e,t,n,u,d),c=l({},u);return"string"==typeof s.documentsReturnedIn&&(c.documentsReturnedIn=s.documentsReturnedIn),void e.s.pool.write(s,c,h)}const f=r(n,d),m=function(e,t,n,i){i.batchSize=n.batchSize||i.batchSize;let o={find:s(t)};n.query&&(n.query.$query?o.filter=n.query.$query:o.filter=n.query);let r=n.sort;if(Array.isArray(r)){const e={};if(r.length>0&&!Array.isArray(r[0])){let t=r[1];"asc"===t?t=1:"desc"===t&&(t=-1),e[r[0]]=t}else for(let t=0;t<r.length;t++){let n=r[t][1];"asc"===n?n=1:"desc"===n&&(n=-1),e[r[t][0]]=n}r=e}"boolean"==typeof n.allowDiskUse&&(o.allowDiskUse=n.allowDiskUse);n.sort&&(o.sort=r);n.fields&&(o.projection=n.fields);n.hint&&(o.hint=n.hint);n.skip&&(o.skip=n.skip);n.limit&&(o.limit=n.limit);n.limit<0&&(o.limit=Math.abs(n.limit),o.singleBatch=!0);"number"==typeof n.batchSize&&(n.batchSize<0&&(0!==n.limit&&Math.abs(n.batchSize)<Math.abs(n.limit)&&(o.limit=Math.abs(n.batchSize)),o.singleBatch=!0),o.batchSize=Math.abs(n.batchSize));n.comment&&(o.comment=n.comment);n.maxScan&&(o.maxScan=n.maxScan);n.maxTimeMS&&(o.maxTimeMS=n.maxTimeMS);n.min&&(o.min=n.min);n.max&&(o.max=n.max);o.returnKey=!!n.returnKey&&n.returnKey,o.showRecordId=!!n.showDiskLoc&&n.showDiskLoc,n.snapshot&&(o.snapshot=n.snapshot);n.tailable&&(o.tailable=n.tailable);n.oplogReplay&&(o.oplogReplay=n.oplogReplay);n.noCursorTimeout&&(o.noCursorTimeout=n.noCursorTimeout);n.awaitData&&(o.awaitData=n.awaitData);n.awaitdata&&(o.awaitData=n.awaitdata);n.partial&&(o.partial=n.partial);n.collation&&(o.collation=n.collation);n.readConcern&&(o.readConcern=n.readConcern);n.explain&&(o={explain:o});return o}(0,t,n,u);n.virtual=!1;const g=Object.assign({documentsReturnedIn:"firstBatch",numberToReturn:1,slaveOk:f.slaveOk()},d);n.readPreference&&(g.readPreference=f),u.session&&(g.session=u.session),p(e,t,m,g,h)}},function(e,t,n){"use strict";const i=n(5).inherits,o=n(5).format,r=n(8).EventEmitter,s=n(11),a=n(16).CoreCursor,c=n(9).retrieveBSON,l=n(15),p=n(2).MongoError,u=n(73),d=n(159),h=n(7).Timeout,f=n(7).Interval,m=n(7).SessionMixins,g=n(7).isRetryableWritesSupported,y=n(4).relayEvents,v=c(),b=n(7).getMMAPError,x=n(4).makeClientMetadata,w=n(7).legacyIsRetryableWriteError,S=n(0).now,_=n(0).calculateDurationInMs;var T="destroyed";function E(e,t){var n={disconnected:["connecting",T,"disconnected"],connecting:["connecting",T,"connected","disconnected"],connected:["connected","disconnected",T,"unreferenced"],unreferenced:["unreferenced",T],destroyed:[T]}[e.state];n&&-1!==n.indexOf(t)?e.state=t:e.s.logger.error(o("Pool with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",e.id,e.state,t,n))}var O=1,k=["connect","close","error","timeout","parseError"],C=function(e,t){var n=this;if(t=t||{},!Array.isArray(e))throw new p("seedlist must be an array");if(0===e.length)throw new p("seedlist must contain at least one entry");e.forEach((function(e){if("string"!=typeof e.host||"number"!=typeof e.port)throw new p("seedlist entry must contain a host and port")})),r.call(this),this.id=O++;var i=t.localThresholdMS||15;t.acceptableLatency&&(i=t.acceptableLatency);var s=l("ReplSet",t);this.s={options:Object.assign({metadata:x(t)},t),bson:t.bson||new v([v.Binary,v.Code,v.DBRef,v.Decimal128,v.Double,v.Int32,v.Long,v.Map,v.MaxKey,v.MinKey,v.ObjectId,v.BSONRegExp,v.Symbol,v.Timestamp]),Cursor:t.cursorFactory||a,logger:s,seedlist:e,replicaSetState:new d({id:this.id,setName:t.setName,acceptableLatency:i,heartbeatFrequencyMS:t.haInterval?t.haInterval:1e4,logger:s}),connectingServers:[],haInterval:t.haInterval?t.haInterval:1e4,minHeartbeatFrequencyMS:500,disconnectHandler:t.disconnectHandler,index:0,connectOptions:{},debug:"boolean"==typeof t.debug&&t.debug},this.s.replicaSetState.on("topologyDescriptionChanged",(function(e){n.emit("topologyDescriptionChanged",e)})),this.s.logger.isWarn()&&0!==this.s.options.socketTimeout&&this.s.options.socketTimeout<this.s.haInterval&&this.s.logger.warn(o("warning socketTimeout %s is less than haInterval %s. This might cause unnecessary server reconnections due to socket timeouts",this.s.options.socketTimeout,this.s.haInterval));["joined","left"].forEach((function(e){n.s.replicaSetState.on(e,(function(t,i){n.emit(e,t,i)}))})),this.initialConnectState={connect:!1,fullsetup:!1,all:!1},this.state="disconnected",this.haTimeoutId=null,this.ismaster=null,this.intervalIds=[],this.clusterTime=null};function A(e){e.s.replicaSetState.hasPrimaryAndSecondary()&&e.s.disconnectHandler?e.s.disconnectHandler.execute():e.s.replicaSetState.hasPrimary()&&e.s.disconnectHandler?e.s.disconnectHandler.execute({executePrimary:!0}):e.s.replicaSetState.hasSecondary()&&e.s.disconnectHandler&&e.s.disconnectHandler.execute({executeSecondary:!0})}function I(e,t,n){if(0===t.length)return n();var i=t.length,o=null;function r(){0===(i-=1)&&n(o)}var s=function(e,t){return function(n){if(e.state===T||"unreferenced"===e.state)return this.destroy({force:!0}),r();if("connect"===t)if(e.s.replicaSetState.update(this)){this.lastIsMaster()&&this.lastIsMaster().ismaster&&(e.ismaster=this.lastIsMaster());for(let e=0;e<k.length;e++)this.removeAllListeners(k[e]);this.on("error",R(e,"error")),this.on("close",R(e,"close")),this.on("timeout",R(e,"timeout")),this.on("parseError",R(e,"parseError")),N(this.lastIsMaster().me,e,{}),A(e)}else this.destroy({force:!0});else"error"===t&&(o=n);A(e),r()}};function a(t,n){setTimeout((function(){if(e.state===T||"unreferenced"===e.state)return;const n=e.s.connectingServers.findIndex(e=>e.name===t);if(n>=0){return e.s.connectingServers[n].destroy({force:!0}),e.s.connectingServers.splice(n,1),r()}var i=new u(Object.assign({},e.s.options,{host:t.split(":")[0],port:parseInt(t.split(":")[1],10),reconnect:!1,monitoring:!1,parent:e}));i.once("connect",s(e,"connect")),i.once("close",s(e,"close")),i.once("timeout",s(e,"timeout")),i.once("error",s(e,"error")),i.once("parseError",s(e,"parseError")),i.on("serverOpening",t=>e.emit("serverOpening",t)),i.on("serverDescriptionChanged",t=>e.emit("serverDescriptionChanged",t)),i.on("serverClosed",t=>e.emit("serverClosed",t)),y(i,e,["commandStarted","commandSucceeded","commandFailed"]),e.s.connectingServers.push(i),i.connect(e.s.connectOptions)}),n)}for(var c=0;c<t.length;c++)a(t[c],c)}i(C,r),Object.assign(C.prototype,m),Object.defineProperty(C.prototype,"type",{enumerable:!0,get:function(){return"replset"}}),Object.defineProperty(C.prototype,"parserType",{enumerable:!0,get:function(){return v.native?"c++":"js"}}),Object.defineProperty(C.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.s.replicaSetState.logicalSessionTimeoutMinutes||null}});var N=function(e,t,n){if(!n.haInterval)for(var i=0;i<t.intervalIds.length;i++)if(t.intervalIds[i].__host===e)return;var o=n.haInterval?h:f,r=n.haInterval?n.haInterval:t.s.haInterval,s=new o((function(){if(t.state!==T&&"unreferenced"!==t.state){var n=t.s.replicaSetState.get(e);return n?function(e,t,n){var i=(new Date).getTime();L(e,"serverHeartbeatStarted",{connectionId:t.name}),t.command("admin.$cmd",{ismaster:!0},{monitoring:!0,socketTimeout:e.s.options.connectionTimeout||2e3},(function(o,r){if(e.state===T||"unreferenced"===e.state)return t.destroy({force:!0}),n(o,r);var s=(new Date).getTime()-i;t.lastUpdateTime=S(),o?(L(e,"serverHeartbeatFailed",{durationMS:s,failure:o,connectionId:t.name}),e.s.replicaSetState.remove(t)):(t.ismaster=r.result,t.ismaster.lastWrite&&t.ismaster.lastWrite.lastWriteDate&&(t.lastWriteDate=t.ismaster.lastWrite.lastWriteDate.getTime()),-1===t.lastIsMasterMS?t.lastIsMasterMS=s:t.lastIsMasterMS&&(t.lastIsMasterMS=.2*s+.8*t.lastIsMasterMS),e.s.replicaSetState.update(t)&&t.lastIsMaster()&&t.lastIsMaster().ismaster&&(e.ismaster=t.lastIsMaster()),L(e,"serverHeartbeatSucceeded",{durationMS:s,reply:r.result,connectionId:t.name})),e.s.replicaSetState.updateServerMaxStaleness(t,e.s.haInterval),n(o,r)}))}(t,n,(function(e){e||(t.state!==T&&"unreferenced"!==t.state?(t.intervalIds=t.intervalIds.filter((function(e){return e.isRunning()})),o===h?"connecting"===t.state&&(t.s.replicaSetState.hasSecondary()&&t.s.options.secondaryOnlyConnectionAllowed||t.s.replicaSetState.hasPrimary())&&(t.state="connected",process.nextTick((function(){t.emit("connect",t)})),M(t,{})):"disconnected"===t.state&&(t.s.replicaSetState.hasSecondary()&&t.s.options.secondaryOnlyConnectionAllowed||t.s.replicaSetState.hasPrimary())&&(t.state="connected",A(t),process.nextTick((function(){t.emit("reconnect",t)}))),t.initialConnectState.connect&&!t.initialConnectState.fullsetup&&t.s.replicaSetState.hasPrimaryAndSecondary()&&(t.initialConnectState.fullsetup=!0,t.initialConnectState.all=!0,process.nextTick((function(){t.emit("fullsetup",t),t.emit("all",t)})))):s.stop())})):void 0}s.stop()}),r);s.start(),s.__host=e,t.intervalIds.push(s)};function M(e,t){if(e.state!==T&&"unreferenced"!==e.state){t=t||{};var n=Object.keys(e.s.replicaSetState.set),i=t.haInterval?h:f,o=t.haInterval?t.haInterval:e.s.haInterval;if(i===h)return I(e,e.s.replicaSetState.unknownServers,(function(i){if(e.state!==T&&"unreferenced"!==e.state){if(!e.s.replicaSetState.hasPrimary()&&!e.s.options.secondaryOnlyConnectionAllowed)return i?e.emit("error",i):(e.emit("error",new p("no primary found in replicaset or invalid replica set name")),e.destroy({force:!0}));if(!e.s.replicaSetState.hasSecondary()&&e.s.options.secondaryOnlyConnectionAllowed)return i?e.emit("error",i):(e.emit("error",new p("no secondary found in replicaset or invalid replica set name")),e.destroy({force:!0}));for(var o=0;o<n.length;o++)N(n[o],e,t)}}));for(var r=0;r<n.length;r++)N(n[r],e,t);var s=e.s.replicaSetState.hasPrimary()?o:e.s.minHeartbeatFrequencyMS;e.intervalIds.push(new h(function e(t){return function(){t.state!==T&&"unreferenced"!==t.state&&I(t,t.s.replicaSetState.unknownServers,(function(){var n=t.s.replicaSetState.hasPrimary()?o:t.s.minHeartbeatFrequencyMS;t.intervalIds.push(new h(e(t),n).start())}))}}(e),s).start())}}function B(e,t){for(var n=0;n<e.length;n++)if(e[n].name.toLowerCase()===t.name.toLowerCase())return!0;e.push(t)}function R(e,t){return function(){e.state!==T&&"unreferenced"!==e.state&&(e.s.logger.isDebug()&&e.s.logger.debug(o("handleEvent %s from server %s in replset with id %s",t,this.name,e.id)),e.s.replicaSetState.remove(this),e.state!==T&&"unreferenced"!==e.state&&((e.s.replicaSetState.hasPrimary()||e.s.replicaSetState.hasSecondary()||!e.s.options.secondaryOnlyConnectionAllowed)&&e.s.replicaSetState.hasPrimary()||E(e,"disconnected"),B(e.s.connectingServers,this)))}}function P(e,t){return function(){if(e.s.logger.isDebug()&&e.s.logger.debug(o("handleInitialConnectEvent %s from server %s in replset with id %s",t,this.name,e.id)),e.state===T||"unreferenced"===e.state)return this.destroy({force:!0});if("connect"===t){var n=e.s.replicaSetState.update(this);if(!0===n){this.lastIsMaster()&&this.lastIsMaster().ismaster&&(e.ismaster=this.lastIsMaster()),e.s.logger.isDebug()&&e.s.logger.debug(o("handleInitialConnectEvent %s from server %s in replset with id %s has state [%s]",t,this.name,e.id,JSON.stringify(e.s.replicaSetState.set)));for(let e=0;e<k.length;e++)this.removeAllListeners(k[e]);this.on("error",R(e,"error")),this.on("close",R(e,"close")),this.on("timeout",R(e,"timeout")),this.on("parseError",R(e,"parseError")),function(e){const t="connecting"===e.state,n=e.s.replicaSetState.hasPrimary(),i=e.s.replicaSetState.hasSecondary(),o=e.s.options.secondaryOnlyConnectionAllowed,r=e.s.connectOptions.readPreference&&e.s.connectOptions.readPreference.equals(s.secondary);return t&&(r&&i||!r&&n)||i&&o}(e)&&(e.state="connected",e.initialConnectState.connect=!0,process.nextTick((function(){e.emit("connect",e)})),M(e,{}))}else{if(n instanceof p)return this.destroy({force:!0}),e.destroy({force:!0}),e.emit("error",n);this.destroy({force:!0})}}else e.emit("failed",this),B(e.s.connectingServers,this),e.s.replicaSetState.remove(this);e.initialConnectState.connect&&!e.initialConnectState.fullsetup&&e.s.replicaSetState.hasPrimaryAndSecondary()&&(e.initialConnectState.fullsetup=!0,e.initialConnectState.all=!0,process.nextTick((function(){e.emit("fullsetup",e),e.emit("all",e)})));for(var i=0;i<e.s.connectingServers.length;i++)e.s.connectingServers[i].equals(this)&&e.s.connectingServers.splice(i,1);0===e.s.connectingServers.length&&"connecting"===e.state&&M(e,{haInterval:1})}}function L(e,t,n){e.listeners(t).length>0&&e.emit(t,n)}C.prototype.connect=function(e){var t=this;this.s.connectOptions=e||{},E(this,"connecting");var n=this.s.seedlist.map((function(n){return new u(Object.assign({},t.s.options,n,e,{reconnect:!1,monitoring:!1,parent:t}))}));if(this.s.options.socketTimeout>0&&this.s.options.socketTimeout<=this.s.options.haInterval)return t.emit("error",new p(o("haInterval [%s] MS must be set to less than socketTimeout [%s] MS",this.s.options.haInterval,this.s.options.socketTimeout)));L(this,"topologyOpening",{topologyId:this.id}),function(e,t){e.s.connectingServers=e.s.connectingServers.concat(t);var n=0;function i(t,n){setTimeout((function(){e.s.replicaSetState.update(t)&&t.lastIsMaster()&&t.lastIsMaster().ismaster&&(e.ismaster=t.lastIsMaster()),t.once("close",P(e,"close")),t.once("timeout",P(e,"timeout")),t.once("parseError",P(e,"parseError")),t.once("error",P(e,"error")),t.once("connect",P(e,"connect")),t.on("serverOpening",t=>e.emit("serverOpening",t)),t.on("serverDescriptionChanged",t=>e.emit("serverDescriptionChanged",t)),t.on("serverClosed",t=>e.emit("serverClosed",t)),y(t,e,["commandStarted","commandSucceeded","commandFailed"]),t.connect(e.s.connectOptions)}),n)}for(;t.length>0;)i(t.shift(),n++)}(t,n)},C.prototype.auth=function(e,t){"function"==typeof t&&t(null,null)},C.prototype.destroy=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};let n=this.s.connectingServers.length+1;const i=()=>{n--,n>0||(L(this,"topologyClosed",{topologyId:this.id}),E(this,T),"function"==typeof t&&t(null,null))};this.haTimeoutId&&clearTimeout(this.haTimeoutId);for(var o=0;o<this.intervalIds.length;o++)this.intervalIds[o].stop();this.intervalIds=[],0!==n?(this.s.replicaSetState.destroy(e,i),this.s.connectingServers.forEach((function(t){t.destroy(e,i)}))):i()},C.prototype.unref=function(){E(this,"unreferenced"),this.s.replicaSetState.allServers().forEach((function(e){e.unref()})),clearTimeout(this.haTimeoutId)},C.prototype.lastIsMaster=function(){return this.s.options.secondaryOnlyConnectionAllowed&&!this.s.replicaSetState.hasPrimary()&&this.s.replicaSetState.hasSecondary()?this.s.replicaSetState.secondaries[0].lastIsMaster():this.s.replicaSetState.primary?this.s.replicaSetState.primary.lastIsMaster():this.ismaster},C.prototype.connections=function(){for(var e=this.s.replicaSetState.allServers(),t=[],n=0;n<e.length;n++)t=t.concat(e[n].connections());return t},C.prototype.isConnected=function(e){return(e=e||{}).readPreference&&e.readPreference.equals(s.secondary)?this.s.replicaSetState.hasSecondary():e.readPreference&&e.readPreference.equals(s.primary)?this.s.replicaSetState.hasPrimary():e.readPreference&&e.readPreference.equals(s.primaryPreferred)||e.readPreference&&e.readPreference.equals(s.secondaryPreferred)?this.s.replicaSetState.hasSecondary()||this.s.replicaSetState.hasPrimary():!(!this.s.options.secondaryOnlyConnectionAllowed||!this.s.replicaSetState.hasSecondary())||this.s.replicaSetState.hasPrimary()},C.prototype.isDestroyed=function(){return this.state===T};function D(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||{};const i=e.self,r=e.op,s=e.ns,a=e.ops;if(i.state===T)return n(new p(o("topology was destroyed")));const c=!e.retrying&&!!t.retryWrites&&t.session&&g(i)&&!t.session.inTransaction();if(!i.s.replicaSetState.hasPrimary()){if(i.s.disconnectHandler)return i.s.disconnectHandler.add(r,s,a,t,n);if(!c)return n(new p("no primary server found"))}const l=(o,r)=>{if(!o)return n(null,r);if(!w(o,i))return o=b(o),n(o);if(c){return D(Object.assign({},e,{retrying:!0}),t,n)}return i.s.replicaSetState.primary&&(i.s.replicaSetState.primary.destroy(),i.s.replicaSetState.remove(i.s.replicaSetState.primary,{force:!0})),n(o)};n.operationId&&(l.operationId=n.operationId),c&&(t.session.incrementTransactionNumber(),t.willRetryWrite=c),i.s.replicaSetState.primary[r](s,a,t,l)}C.prototype.selectServer=function(e,t,n){let i,o;"function"==typeof e&&void 0===n&&(n=e,e=void 0,t={}),"function"==typeof t&&(n=t,t=e),t=t||{},i=e instanceof s?e:t.readPreference||s.primary;const r=S(),a=()=>{if(_(r)>=1e4)return void(null!=o?n(o,null):n(new p("Server selection timed out")));const e=this.s.replicaSetState.pickServer(i);if(null!=e){if(!(e instanceof u))return o=e,void setTimeout(a,1e3);this.s.debug&&this.emit("pickedServer",t.readPreference,e),n(null,e)}else setTimeout(a,1e3)};a()},C.prototype.getServers=function(){return this.s.replicaSetState.allServers()},C.prototype.insert=function(e,t,n,i){D({self:this,op:"insert",ns:e,ops:t},n,i)},C.prototype.update=function(e,t,n,i){D({self:this,op:"update",ns:e,ops:t},n,i)},C.prototype.remove=function(e,t,n,i){D({self:this,op:"remove",ns:e,ops:t},n,i)};const j=["findAndModify","insert","update","delete"];C.prototype.command=function(e,t,n,i){if("function"==typeof n&&(i=n,n=(n={})||{}),this.state===T)return i(new p(o("topology was destroyed")));var r=this,a=n.readPreference?n.readPreference:s.primary;if("primary"===a.preference&&!this.s.replicaSetState.hasPrimary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",e,t,n,i);if("secondary"===a.preference&&!this.s.replicaSetState.hasSecondary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",e,t,n,i);if("primary"!==a.preference&&!this.s.replicaSetState.hasSecondary()&&!this.s.replicaSetState.hasPrimary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",e,t,n,i);var c=this.s.replicaSetState.pickServer(a);if(!(c instanceof u))return i(c);if(r.s.debug&&r.emit("pickedServer",s.primary,c),null==c)return i(new p(o("no server found that matches the provided readPreference %s",a)));const l=!n.retrying&&!!n.retryWrites&&n.session&&g(r)&&!n.session.inTransaction()&&(d=t,j.some(e=>d[e]));var d;l&&(n.session.incrementTransactionNumber(),n.willRetryWrite=l),c.command(e,t,n,(o,s)=>{if(!o)return i(null,s);if(!w(o,r))return i(o);if(l){const o=Object.assign({},n,{retrying:!0});return this.command(e,t,o,i)}return this.s.replicaSetState.primary&&(this.s.replicaSetState.primary.destroy(),this.s.replicaSetState.remove(this.s.replicaSetState.primary,{force:!0})),i(o)})},C.prototype.cursor=function(e,t,n){const i=(n=n||{}).topology||this;return new(n.cursorFactory||this.s.Cursor)(i,e,t,n)},e.exports=C},function(e,t,n){"use strict";var i=n(5).inherits,o=n(5).format,r=n(7).diff,s=n(8).EventEmitter,a=n(15),c=n(11),l=n(2).MongoError,p=n(19).Buffer,u="ReplicaSetNoPrimary",d="ReplicaSetWithPrimary",h="Unknown",f="PossiblePrimary",m="RSPrimary",g="RSSecondary",y="RSArbiter",v="RSOther",b="RSGhost",x="Unknown",w=function(e){e=e||{},s.call(this),this.topologyType=u,this.setName=e.setName,this.set={},this.id=e.id,this.setName=e.setName,this.logger=e.logger||a("ReplSet",e),this.index=0,this.acceptableLatency=e.acceptableLatency||15,this.heartbeatFrequencyMS=e.heartbeatFrequencyMS||1e4,this.primary=null,this.secondaries=[],this.arbiters=[],this.passives=[],this.ghosts=[],this.unknownServers=[],this.set={},this.maxElectionId=null,this.maxSetVersion=0,this.replicasetDescription={topologyType:"Unknown",servers:[]},this.logicalSessionTimeoutMinutes=void 0};i(w,s),w.prototype.hasPrimaryAndSecondary=function(){return null!=this.primary&&this.secondaries.length>0},w.prototype.hasPrimaryOrSecondary=function(){return this.hasPrimary()||this.hasSecondary()},w.prototype.hasPrimary=function(){return null!=this.primary},w.prototype.hasSecondary=function(){return this.secondaries.length>0},w.prototype.get=function(e){for(var t=this.allServers(),n=0;n<t.length;n++)if(t[n].name.toLowerCase()===e.toLowerCase())return t[n];return null},w.prototype.allServers=function(e){e=e||{};var t=this.primary?[this.primary]:[];return t=t.concat(this.secondaries),e.ignoreArbiters||(t=t.concat(this.arbiters)),t=t.concat(this.passives)},w.prototype.destroy=function(e,t){const n=this.secondaries.concat(this.arbiters).concat(this.passives).concat(this.ghosts);this.primary&&n.push(this.primary);let i=n.length;const o=()=>{i--,i>0||(this.secondaries=[],this.arbiters=[],this.passives=[],this.ghosts=[],this.unknownServers=[],this.set={},this.primary=null,I(this),"function"==typeof t&&t(null,null))};0!==i?n.forEach(t=>t.destroy(e,o)):o()},w.prototype.remove=function(e,t){t=t||{};var n=e.name.toLowerCase(),i=this.primary?[this.primary]:[];i=(i=(i=i.concat(this.secondaries)).concat(this.arbiters)).concat(this.passives);for(var o=0;o<i.length;o++)if(!t.force&&i[o].equals(e)&&i[o].isConnected&&i[o].isConnected())return;this.set[n]&&(this.set[n].type=x,this.set[n].electionId=null,this.set[n].setName=null,this.set[n].setVersion=null);var r=null;this.primary&&this.primary.equals(e)&&(this.primary=null,this.topologyType=u,r="primary"),r=A(e,this.secondaries)?"secondary":r,r=A(e,this.arbiters)?"arbiter":r,r=A(e,this.passives)?"secondary":r,A(e,this.ghosts),A(e,this.unknownServers),this.unknownServers.push(n),r&&this.emit("left",r,e)};const S=e=>e.arbiterOnly&&e.setName;w.prototype.update=function(e){var t=e.lastIsMaster(),n=e.name.toLowerCase();if(t){var i=Array.isArray(t.hosts)?t.hosts:[];i=(i=(i=i.concat(Array.isArray(t.arbiters)?t.arbiters:[])).concat(Array.isArray(t.passives)?t.passives:[])).map((function(e){return e.toLowerCase()}));for(var r=0;r<i.length;r++)-1!==this.unknownServers.indexOf(i[r])||this.set[i[r]]&&this.set[i[r]].type!==x||this.unknownServers.push(i[r].toLowerCase()),this.set[i[r]]||(this.set[i[r]]={type:x,electionId:null,setName:null,setVersion:null})}if(!t&&!O(t,e,this.unknownServers))return this.set[n]={type:x,setVersion:null,electionId:null,setName:null},this.set[n].type=x,this.set[n].electionId=t?t.electionId:t,this.set[n].setName=t?t.setName:t,this.set[n].setVersion=t?t.setVersion:t,-1===this.unknownServers.indexOf(e.name)&&this.unknownServers.push(n),!1;if(void 0===t.logicalSessionTimeoutMinutes||S(t)||(void 0===this.logicalSessionTimeoutMinutes||null===t.logicalSessionTimeoutMinutes?this.logicalSessionTimeoutMinutes=t.logicalSessionTimeoutMinutes:this.logicalSessionTimeoutMinutes=Math.min(this.logicalSessionTimeoutMinutes,t.logicalSessionTimeoutMinutes)),t&&"isdbgrid"===t.msg)return this.primary&&this.primary.name===n&&(this.primary=null,this.topologyType=u),!1;if(t.isreplicaset)return this.set[n]={type:b,setVersion:null,electionId:null,setName:t.setName},this.primary&&this.primary.name===n&&(this.primary=null),this.topologyType=this.primary?d:u,t.setName&&(this.setName=t.setName),!1;if(t.setName&&t.hidden||t.setName&&!t.ismaster&&!t.secondary&&!t.arbiterOnly&&!t.passive)return this.set[n]={type:v,setVersion:null,electionId:null,setName:t.setName},this.topologyType=this.primary?d:u,t.setName&&(this.setName=t.setName),!1;if(t&&t.ismaster&&!t.setName)return this.topologyType=this.primary?d:h,this.remove(e,{force:!0}),!1;if(t&&!t.ismaster&&!t.secondary&&!t.arbiterOnly)return this.remove(e,{force:!0}),!1;if(t.me&&t.me.toLowerCase()!==n)return this.logger.isWarn()&&this.logger.warn(o("the seedlist server was removed due to its address %s not matching its ismaster.me address %s",e.name,t.me)),delete this.set[n],A(e,this.unknownServers),e.destroy({force:!0}),this.primary&&!this.primary.equals(e)?this.topologyType=d:this.topologyType=u,!this.primary&&t.primary&&(this.set[t.primary.toLowerCase()]={type:f,setName:null,electionId:null,setVersion:null}),!1;if(!this.primary&&t.ismaster&&t.setName){var s=e.lastIsMaster().electionId;if(this.setName&&this.setName!==t.setName)return this.topologyType=u,new l(o("setName from ismaster does not match provided connection setName [%s] != [%s]",t.setName,this.setName));if(!this.maxElectionId&&s)this.maxElectionId=s;else if(this.maxElectionId&&s){var a=C(this.maxElectionId,s),c=e.lastIsMaster().setVersion;if(1===a)return this.topologyType=u,!1;if(0===a&&c&&c<this.maxSetVersion)return this.topologyType=u,!1;this.maxSetVersion=c,this.maxElectionId=s}return-1!==t.hosts.map((function(e){return e.toLowerCase()})).indexOf(n)?(this.primary=e,this.set[n]={type:m,setVersion:t.setVersion,electionId:t.electionId,setName:t.setName},this.topologyType=d,t.setName&&(this.setName=t.setName),A(e,this.unknownServers),A(e,this.secondaries),A(e,this.passives),this.emit("joined","primary",e)):this.topologyType=u,I(this),!0}if(t.ismaster&&t.setName){var p=this.set[this.primary.name.toLowerCase()].electionId,w=this.set[this.primary.name.toLowerCase()].setVersion,_=this.set[this.primary.name.toLowerCase()].setName;s=e.lastIsMaster().electionId,c=e.lastIsMaster().setVersion;var T=e.lastIsMaster().setName;if(this.primary.equals(e)&&_===T)return!1;if(_&&_!==T)return this.primary.equals(e)?this.topologyType=u:this.topologyType=d,!1;if(p&&s){if(1===(a=C(p,s)))return!1;if(0===a&&w>c)return!1}else if(!p&&s&&c&&c<this.maxSetVersion)return!1;if(!this.maxElectionId&&s)this.maxElectionId=s;else if(this.maxElectionId&&s){if(1===(a=C(this.maxElectionId,s)))return!1;if(0===a&&w&&c){if(c<this.maxSetVersion)return!1}else if(c<this.maxSetVersion)return!1;this.maxElectionId=s,this.maxSetVersion=c}else this.maxSetVersion=c;return this.set[this.primary.name.toLowerCase()]={type:x,setVersion:null,electionId:null,setName:null},this.emit("left","primary",this.primary),this.primary.destroy({force:!0}),this.primary=e,this.set[n]={type:m,setVersion:t.setVersion,electionId:t.electionId,setName:t.setName},this.topologyType=d,t.setName&&(this.setName=t.setName),A(e,this.unknownServers),A(e,this.secondaries),A(e,this.passives),this.emit("joined","primary",e),I(this),!0}return!this.primary&&t.primary&&(this.set[t.primary.toLowerCase()]={type:f,setVersion:null,electionId:null,setName:null}),t.secondary&&t.setName&&!O(t,e,this.secondaries)&&this.setName&&this.setName===t.setName?(k(this,g,t,e,this.secondaries),this.topologyType=this.primary?d:u,t.setName&&(this.setName=t.setName),A(e,this.unknownServers),this.primary&&this.primary.name.toLowerCase()===n&&(e.destroy({force:!0}),this.primary=null,this.emit("left","primary",e)),this.emit("joined","secondary",e),I(this),!0):S(t)&&!O(t,e,this.arbiters)&&this.setName&&this.setName===t.setName?(k(this,y,t,e,this.arbiters),this.topologyType=this.primary?d:u,t.setName&&(this.setName=t.setName),A(e,this.unknownServers),this.emit("joined","arbiter",e),I(this),!0):t.passive&&t.setName&&!O(t,e,this.passives)&&this.setName&&this.setName===t.setName?(k(this,g,t,e,this.passives),this.topologyType=this.primary?d:u,t.setName&&(this.setName=t.setName),A(e,this.unknownServers),this.primary&&this.primary.name.toLowerCase()===n&&(e.destroy({force:!0}),this.primary=null,this.emit("left","primary",e)),this.emit("joined","secondary",e),I(this),!0):this.set[n]&&this.set[n].type===m?(this.emit("left","primary",this.primary),this.primary.destroy({force:!0}),this.primary=null,this.topologyType=u,!1):(this.topologyType=this.primary?d:u,!1)},w.prototype.updateServerMaxStaleness=function(e,t){for(var n=0,i=0;i<this.secondaries.length;i++)n=Math.max(n,this.secondaries[i].lastWriteDate);e.ismaster.maxWireVersion>=5&&e.ismaster.secondary&&this.hasPrimary()?e.staleness=e.lastUpdateTime-e.lastWriteDate-(this.primary.lastUpdateTime-this.primary.lastWriteDate)+t:e.ismaster.maxWireVersion>=5&&e.ismaster.secondary&&(e.staleness=n-e.lastWriteDate+t)},w.prototype.updateSecondariesMaxStaleness=function(e){for(var t=0;t<this.secondaries.length;t++)this.updateServerMaxStaleness(this.secondaries[t],e)},w.prototype.pickServer=function(e){if("primary"===(e=e||c.primary).preference&&null!=e.maxStalenessSeconds)return new l("primary readPreference incompatible with maxStalenessSeconds");var t=this.primary?[this.primary]:[];if(t=t.concat(this.secondaries),null!=e.maxStalenessSeconds)for(var n=0;n<t.length;n++)if(t[n].ismaster.maxWireVersion<5)return new l("maxStalenessSeconds not supported by at least one of the replicaset members");if("nearest"===e.preference&&null==e.maxStalenessSeconds)return E(this,e);if("nearest"===e.preference&&null!=e.maxStalenessSeconds)return T(this,e);var i=this.secondaries;if(e.equals(c.secondary)&&0===i.length)return new l("no secondary server available");if(e.equals(c.secondaryPreferred)&&0===i.length&&null==this.primary)return new l("no secondary or primary server available");if(e.equals(c.primary)&&null==this.primary)return new l("no primary server available");if(e.equals(c.secondaryPreferred)||e.equals(c.secondary)){if(i.length>0&&null==e.maxStalenessSeconds){var o=E(this,e);if(o)return o}else if(i.length>0&&null!=e.maxStalenessSeconds&&(o=T(this,e)))return o;return e.equals(c.secondaryPreferred)?this.primary:null}if(e.equals(c.primaryPreferred)){if(o=null,this.primary)return this.primary;if(i.length>0&&null==e.maxStalenessSeconds?o=E(this,e):i.length>0&&null!=e.maxStalenessSeconds&&(o=T(this,e)),o)return o}return this.primary};var _=function(e,t){if(null==e.tags)return t;for(var n=[],i=Array.isArray(e.tags)?e.tags:[e.tags],o=0;o<i.length;o++)for(var r=i[o],s=0;s<t.length;s++){var a=t[s].lastIsMaster().tags||{},c=!0;for(var l in r)a[l]!==r[l]&&(c=!1);c&&n.push(t[s])}return n};function T(e,t){var n=[],i=1e3*t.maxStalenessSeconds;if(i<9e4)return new l("maxStalenessSeconds must be set to at least 90 seconds");e.primary&&"secondary"!==t.preference&&"secondaryPreferred"!==t.preference&&n.push(e.primary);for(var o=0;o<e.secondaries.length;o++)n.push(e.secondaries[o]);if(e.primary&&0===n.length&&"secondaryPreferred"!==t.preference&&n.push(e.primary),(n=(n=_(t,n)).filter((function(e){return e.staleness<=i}))).sort((function(e,t){return e.lastIsMasterMS-t.lastIsMasterMS})),0===n.length)return null;e.index=e.index%n.length;var r=n[e.index];return e.index=e.index+1,r}function E(e,t){var n=[];e.primary&&"secondary"!==t.preference&&"secondaryPreferred"!==t.preference&&n.push(e.primary);for(var i=0;i<e.secondaries.length;i++)n.push(e.secondaries[i]);0===n.length&&e.primary&&"secondaryPreferred"!==t.preference&&n.push(e.primary),(n=_(t,n)).sort((function(e,t){return e.lastIsMasterMS-t.lastIsMasterMS}));var o=n.length>0?n[0].lastIsMasterMS:0;if(0===(n=n.filter((function(t){return t.lastIsMasterMS<=o+e.acceptableLatency}))).length)return null;e.index=e.index%n.length;var r=n[e.index];return e.index=e.index+1,r}function O(e,t,n){for(var i=0;i<n.length;i++)if(n[i]&&n[i].name&&n[i].name.toLowerCase()===t.name.toLowerCase())return!0;return!1}function k(e,t,n,i,o){var r=i.name.toLowerCase();e.set[r].type=t,e.set[r].electionId=n?n.electionId:n,e.set[r].setName=n?n.setName:n,e.set[r].setVersion=n?n.setVersion:n,o.push(i)}function C(e,t){var n=p.from(e.toHexString(),"hex"),i=p.from(t.toHexString(),"hex");if(n===i)return 0;if("function"==typeof p.compare)return p.compare(n,i);for(var o=n.length,r=i.length,s=Math.min(o,r),a=0;a<s&&n[a]===i[a];a++);return a!==s&&(o=n[a],r=i[a]),o<r?-1:r<o?1:0}function A(e,t){for(var n=0;n<t.length;n++){if(t[n].equals&&t[n].equals(e))return t.splice(n,1),!0;if("string"==typeof t[n]&&t[n].toLowerCase()===e.name.toLowerCase())return t.splice(n,1),!0}return!1}function I(e){if(e.listeners("topologyDescriptionChanged").length>0){var t="Unknown",n=e.setName;e.hasPrimaryAndSecondary()?t="ReplicaSetWithPrimary":!e.hasPrimary()&&e.hasSecondary()&&(t="ReplicaSetNoPrimary");var i={topologyType:t,setName:n,servers:[]};if(e.hasPrimary()){var o=e.primary.getDescription();o.type="RSPrimary",i.servers.push(o)}i.servers=i.servers.concat(e.secondaries.map((function(e){var t=e.getDescription();return t.type="RSSecondary",t}))),i.servers=i.servers.concat(e.arbiters.map((function(e){var t=e.getDescription();return t.type="RSArbiter",t}))),i.servers=i.servers.concat(e.passives.map((function(e){var t=e.getDescription();return t.type="RSSecondary",t})));var s=r(e.replicasetDescription,i),a={topologyId:e.id,previousDescription:e.replicasetDescription,newDescription:i,diff:s};e.emit("topologyDescriptionChanged",a),e.replicasetDescription=i}}e.exports=w},function(e,t,n){"use strict";const i=n(5).inherits,o=n(5).format,r=n(8).EventEmitter,s=n(16).CoreCursor,a=n(15),c=n(9).retrieveBSON,l=n(2).MongoError,p=n(73),u=n(7).diff,d=n(7).cloneOptions,h=n(7).SessionMixins,f=n(7).isRetryableWritesSupported,m=n(4).relayEvents,g=c(),y=n(7).getMMAPError,v=n(4).makeClientMetadata,b=n(7).legacyIsRetryableWriteError;var x="destroying",w="destroyed";function S(e,t){var n={disconnected:["connecting",x,w,"disconnected"],connecting:["connecting",x,w,"connected","disconnected"],connected:["connected","disconnected",x,w,"unreferenced"],unreferenced:["unreferenced",x,w],destroyed:[w]}[e.state];n&&-1!==n.indexOf(t)?e.state=t:e.s.logger.error(o("Mongos with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",e.id,e.state,t,n))}var _=1,T=["connect","close","error","timeout","parseError"],E=function(e,t){t=t||{},this.id=_++,Array.isArray(e)&&(e=e.reduce((e,t)=>(e.find(e=>e.host===t.host&&e.port===t.port)||e.push(t),e),[])),this.s={options:Object.assign({metadata:v(t)},t),bson:t.bson||new g([g.Binary,g.Code,g.DBRef,g.Decimal128,g.Double,g.Int32,g.Long,g.Map,g.MaxKey,g.MinKey,g.ObjectId,g.BSONRegExp,g.Symbol,g.Timestamp]),Cursor:t.cursorFactory||s,logger:a("Mongos",t),seedlist:e,haInterval:t.haInterval?t.haInterval:1e4,disconnectHandler:t.disconnectHandler,index:0,connectOptions:{},debug:"boolean"==typeof t.debug&&t.debug,localThresholdMS:t.localThresholdMS||15},this.s.logger.isWarn()&&0!==this.s.options.socketTimeout&&this.s.options.socketTimeout<this.s.haInterval&&this.s.logger.warn(o("warning socketTimeout %s is less than haInterval %s. This might cause unnecessary server reconnections due to socket timeouts",this.s.options.socketTimeout,this.s.haInterval)),this.state="disconnected",this.connectingProxies=[],this.connectedProxies=[],this.disconnectedProxies=[],this.index=0,this.haTimeoutId=null,this.ismaster=null,this.topologyDescription={topologyType:"Unknown",servers:[]},this.clusterTime=null,r.call(this)};function O(e,t,n){e.listeners(t).length>0&&e.emit(t,n)}i(E,r),Object.assign(E.prototype,h),Object.defineProperty(E.prototype,"type",{enumerable:!0,get:function(){return"mongos"}}),Object.defineProperty(E.prototype,"parserType",{enumerable:!0,get:function(){return g.native?"c++":"js"}}),Object.defineProperty(E.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.ismaster&&this.ismaster.logicalSessionTimeoutMinutes||null}});const k=["serverDescriptionChanged","error","close","timeout","parseError"];function C(e,t,n){t=t||{},k.forEach(t=>e.removeAllListeners(t)),e.destroy(t,n)}function A(e){return function(){e.state!==w&&e.state!==x&&(M(e.connectedProxies,e.disconnectedProxies,this),D(e),e.emit("left","mongos",this),e.emit("serverClosed",{topologyId:e.id,address:this.name}))}}function I(e,t){return function(){if(e.state===w)return D(e),M(e.connectingProxies,e.disconnectedProxies,this),this.destroy();if("connect"===t)if(e.ismaster=this.lastIsMaster(),"isdbgrid"===e.ismaster.msg){for(let t=0;t<e.connectedProxies.length;t++)if(e.connectedProxies[t].name===this.name)return M(e.connectingProxies,e.disconnectedProxies,this),D(e),this.destroy(),e.emit("failed",this);for(let e=0;e<T.length;e++)this.removeAllListeners(T[e]);this.on("error",A(e)),this.on("close",A(e)),this.on("timeout",A(e)),this.on("parseError",A(e)),M(e.connectingProxies,e.connectedProxies,this),e.emit("joined","mongos",this)}else{if(e.s.logger.isWarn()){var n="expected mongos proxy, but found replicaset member mongod for server %s";e.ismaster.hosts||(n="expected mongos proxy, but found standalone mongod for server %s"),e.s.logger.warn(o(n,this.name))}this.destroy(!0),B(e.connectingProxies,this),e.emit("left","server",this),e.emit("failed",this)}else M(e.connectingProxies,e.disconnectedProxies,this),e.emit("left","mongos",this),e.emit("failed",this);if(D(e),0===e.connectingProxies.length){if(e.connectedProxies.length>0&&"connecting"===e.state)S(e,"connected"),e.emit("connect",e),e.emit("fullsetup",e),e.emit("all",e);else if(0===e.disconnectedProxies.length)return e.s.logger.isWarn()&&e.s.logger.warn(o("no mongos proxies found in seed list, did you mean to connect to a replicaset")),e.emit("error",new l("no mongos proxies found in seed list"));!function e(t,n){if(n=n||{},t.state===w||t.state===x||"unreferenced"===t.state)return;t.haTimeoutId=setTimeout((function(){if(t.state!==w&&t.state!==x&&"unreferenced"!==t.state){t.isConnected()&&t.s.disconnectHandler&&t.s.disconnectHandler.execute();var i=t.connectedProxies.slice(0),o=i.length;if(0===i.length)return t.listeners("close").length>0&&"connecting"===t.state?t.emit("error",new l("no mongos proxy available")):t.emit("close",t),R(t,t.disconnectedProxies,(function(){t.state!==w&&t.state!==x&&"unreferenced"!==t.state&&("connecting"===t.state&&n.firstConnect?(t.emit("connect",t),t.emit("fullsetup",t),t.emit("all",t)):t.isConnected()?t.emit("reconnect",t):!t.isConnected()&&t.listeners("close").length>0&&t.emit("close",t),e(t))}));for(var r=0;r<i.length;r++)s(0,i[r],(function(){if(0===(o-=1)){if(t.state===w||t.state===x||"unreferenced"===t.state)return;R(t,t.disconnectedProxies,(function(){t.state!==w&&t.state!==x&&"unreferenced"!==t.state&&e(t)}))}}))}function s(e,n,i){var o=(new Date).getTime();O(t,"serverHeartbeatStarted",{connectionId:n.name}),n.command("admin.$cmd",{ismaster:!0},{monitoring:!0,socketTimeout:t.s.options.connectionTimeout||2e3},(function(e,r){if(t.state===w||t.state===x||"unreferenced"===t.state)return M(t.connectedProxies,t.disconnectedProxies,n),n.destroy(),i(e,r);var s=(new Date).getTime()-o;e?(O(t,"serverHeartbeatFailed",{durationMS:s,failure:e,connectionId:n.name}),M(t.connectedProxies,t.disconnectedProxies,n)):(n.ismaster=r.result,n.lastIsMasterMS=s,O(t,"serverHeartbeatSucceeded",{durationMS:s,reply:r.result,connectionId:n.name})),i(e,r)}))}}),t.s.haInterval)}(e,{firstConnect:!0})}}}function N(e,t){const n=t&&t.transaction;if(n&&n.server){if(n.server.isConnected())return n.server;n.unpinServer()}for(var i=e.connectedProxies.slice(0),o=Number.MAX_VALUE,r=0;r<i.length;r++)i[r].lastIsMasterMS<o&&(o=i[r].lastIsMasterMS);let s;return 0===(i=i.filter((function(t){if(t.lastIsMasterMS<=o+e.s.localThresholdMS&&t.isConnected())return!0}))).length?s=e.connectedProxies[0]:(s=i[e.index%i.length],e.index=(e.index+1)%i.length),n&&n.isActive&&s&&s.isConnected()&&n.pinServer(s),s}function M(e,t,n){for(var i=0;i<e.length;i++)e[i].name===n.name&&e.splice(i,1);for(i=0;i<t.length;i++)t[i].name===n.name&&t.splice(i,1);t.push(n)}function B(e,t){for(var n=0;n<e.length;n++)e[n].name===t.name&&e.splice(n,1)}function R(e,t,n){var i=t.length,o=function(e,t){return function(){if(i-=1,e.state===w||e.state===x||"unreferenced"===e.state)return M(e.connectingProxies,e.disconnectedProxies,this),this.destroy();if("connect"===t){if(e.state===w||e.state===x||"unreferenced"===e.state)return M(e.connectingProxies,e.disconnectedProxies,this),this.destroy();for(var o=0;o<T.length;o++)this.removeAllListeners(T[o]);this.on("error",A(e)),this.on("close",A(e)),this.on("timeout",A(e)),this.on("parseError",A(e)),M(e.connectingProxies,e.connectedProxies,this),D(e),e.emit("joined","mongos",this)}else M(e.connectingProxies,e.disconnectedProxies,this),this.destroy();0===i&&n()}};if(0===i)return n();function r(t,n){setTimeout((function(){if(e.state!==w&&e.state!==x&&"unreferenced"!==e.state){var n=new p(Object.assign({},e.s.options,{host:t.name.split(":")[0],port:parseInt(t.name.split(":")[1],10),reconnect:!1,monitoring:!1,parent:e}));C(t,{force:!0}),B(e.disconnectedProxies,t),m(n,e,["serverDescriptionChanged"]),e.emit("serverOpening",{topologyId:-1!==n.s.topologyId?n.s.topologyId:e.id,address:n.name}),n.once("connect",o(e,"connect")),n.once("close",o(e,"close")),n.once("timeout",o(e,"timeout")),n.once("error",o(e,"error")),n.once("parseError",o(e,"parseError")),m(n,e,["commandStarted","commandSucceeded","commandFailed"]),e.connectingProxies.push(n),n.connect(e.s.connectOptions)}}),n)}for(var s=0;s<t.length;s++)r(t[s],s)}function P(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||{};const i=e.self,o=e.op,r=e.ns,s=e.ops;let a=N(i,t.session);if(!a)return n(new l("no mongos proxy available"));const c=!e.retrying&&!!t.retryWrites&&t.session&&f(i)&&!t.session.inTransaction(),p=(o,r)=>{if(!o)return n(null,r);if(!b(o,i)||!c)return o=y(o),n(o);if(a=N(i,t.session),!a)return n(o);return P(Object.assign({},e,{retrying:!0}),t,n)};n.operationId&&(p.operationId=n.operationId),c&&(t.session.incrementTransactionNumber(),t.willRetryWrite=c),a[o](r,s,t,p)}E.prototype.connect=function(e){var t=this;this.s.connectOptions=e||{},S(this,"connecting");var n=this.s.seedlist.map((function(n){const i=new p(Object.assign({},t.s.options,n,e,{reconnect:!1,monitoring:!1,parent:t}));return m(i,t,["serverDescriptionChanged"]),i}));O(this,"topologyOpening",{topologyId:this.id}),function(e,t){e.connectingProxies=e.connectingProxies.concat(t);var n=0;t.forEach(t=>function(t,n){setTimeout((function(){e.emit("serverOpening",{topologyId:e.id,address:t.name}),D(e),t.once("close",I(e,"close")),t.once("timeout",I(e,"timeout")),t.once("parseError",I(e,"parseError")),t.once("error",I(e,"error")),t.once("connect",I(e,"connect")),m(t,e,["commandStarted","commandSucceeded","commandFailed"]),t.connect(e.s.connectOptions)}),n)}(t,n++))}(t,n)},E.prototype.auth=function(e,t){"function"==typeof t&&t(null,null)},E.prototype.lastIsMaster=function(){return this.ismaster},E.prototype.unref=function(){S(this,"unreferenced"),this.connectedProxies.concat(this.connectingProxies).forEach((function(e){e.unref()})),clearTimeout(this.haTimeoutId)},E.prototype.destroy=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{},S(this,x),this.haTimeoutId&&clearTimeout(this.haTimeoutId);const n=this.connectedProxies.concat(this.connectingProxies);let i=n.length;const o=()=>{i--,i>0||(D(this),O(this,"topologyClosed",{topologyId:this.id}),S(this,w),"function"==typeof t&&t(null,null))};0!==i?n.forEach(t=>{this.emit("serverClosed",{topologyId:this.id,address:t.name}),C(t,e,o),M(this.connectedProxies,this.disconnectedProxies,t)}):o()},E.prototype.isConnected=function(){return this.connectedProxies.length>0},E.prototype.isDestroyed=function(){return this.state===w},E.prototype.insert=function(e,t,n,i){return"function"==typeof n&&(i=n,n=(n={})||{}),this.state===w?i(new l(o("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void P({self:this,op:"insert",ns:e,ops:t},n,i):i(new l("no mongos proxy available")):this.s.disconnectHandler.add("insert",e,t,n,i)},E.prototype.update=function(e,t,n,i){return"function"==typeof n&&(i=n,n=(n={})||{}),this.state===w?i(new l(o("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void P({self:this,op:"update",ns:e,ops:t},n,i):i(new l("no mongos proxy available")):this.s.disconnectHandler.add("update",e,t,n,i)},E.prototype.remove=function(e,t,n,i){return"function"==typeof n&&(i=n,n=(n={})||{}),this.state===w?i(new l(o("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void P({self:this,op:"remove",ns:e,ops:t},n,i):i(new l("no mongos proxy available")):this.s.disconnectHandler.add("remove",e,t,n,i)};const L=["findAndModify","insert","update","delete"];function D(e){if(e.listeners("topologyDescriptionChanged").length>0){var t="Unknown";e.connectedProxies.length>0&&(t="Sharded");var n={topologyType:t,servers:[]},i=e.disconnectedProxies.concat(e.connectingProxies);n.servers=n.servers.concat(i.map((function(e){var t=e.getDescription();return t.type="Unknown",t}))),n.servers=n.servers.concat(e.connectedProxies.map((function(e){var t=e.getDescription();return t.type="Mongos",t})));var o=u(e.topologyDescription,n),r={topologyId:e.id,previousDescription:e.topologyDescription,newDescription:n,diff:o};o.servers.length>0&&e.emit("topologyDescriptionChanged",r),e.topologyDescription=n}}E.prototype.command=function(e,t,n,i){if("function"==typeof n&&(i=n,n=(n={})||{}),this.state===w)return i(new l(o("topology was destroyed")));var r=this,s=N(r,n.session);if((null==s||!s.isConnected())&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",e,t,n,i);if(null==s)return i(new l("no mongos proxy available"));var a=d(n);a.topology=r;const c=!n.retrying&&n.retryWrites&&n.session&&f(r)&&!n.session.inTransaction()&&(p=t,L.some(e=>p[e]));var p;c&&(a.session.incrementTransactionNumber(),a.willRetryWrite=c),s.command(e,t,a,(n,o)=>{if(!n)return i(null,o);if(!b(n,r))return i(n);if(c){const n=Object.assign({},a,{retrying:!0});return this.command(e,t,n,i)}return i(n)})},E.prototype.cursor=function(e,t,n){const i=(n=n||{}).topology||this;return new(n.cursorFactory||this.s.Cursor)(i,e,t,n)},E.prototype.selectServer=function(e,t,n){"function"==typeof e&&void 0===n&&(n=e,e=void 0,t={}),"function"==typeof t&&(n=t,t=e,e=void 0);const i=N(this,(t=t||{}).session);null!=i?(this.s.debug&&this.emit("pickedServer",null,i),n(null,i)):n(new l("server selection failed"))},E.prototype.connections=function(){for(var e=[],t=0;t<this.connectedProxies.length;t++)e=e.concat(this.connectedProxies[t].connections());return e},e.exports=E},function(e,t,n){"use strict";const i=n(75),o=n(8),r=n(30).ServerDescription,s=n(13).ServerType,a=n(92).TopologyDescription,c=n(13).TopologyType,l=n(105),p=n(162).Server,u=n(4).relayEvents,d=n(11),h=n(7).isRetryableWritesSupported,f=n(16).CoreCursor,m=n(5).deprecate,g=n(9).retrieveBSON(),y=n(7).createCompressionInfo,v=n(27).ClientSession,b=n(2).MongoError,x=n(2).MongoServerSelectionError,w=n(7).resolveClusterTime,S=n(175).SrvPoller,_=n(7).getMMAPError,T=n(4).makeStateMachine,E=n(4).eachAsync,O=n(0).emitDeprecationWarning,k=n(27).ServerSessionPool,C=n(4).makeClientMetadata,A=n(59).CMAP_EVENT_NAMES,I=n(30).compareTopologyVersion,N=n(13),M=N.drainTimerQueue,B=N.clearAndRemoveTimerFrom,R=n(176),P=R.readPreferenceServerSelector,L=R.writableServerSelector;let D=0;const j=["serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","commandStarted","commandSucceeded","commandFailed","monitoring"].concat(A),z=["connect","descriptionReceived","close","ended"],U=N.STATE_CLOSING,q=N.STATE_CLOSED,H=N.STATE_CONNECTING,F=N.STATE_CONNECTED,W=T({[q]:[q,H],[H]:[H,U,F,q],[F]:[F,U,q],[U]:[U,q]}),$=new Set(["autoReconnect","reconnectTries","reconnectInterval","bufferMaxEntries"]),V=Symbol("cancelled"),K=Symbol("waitQueue");class G extends o{constructor(e,t){super(),void 0===t&&"string"!=typeof e&&(t=e,e=[],t.host&&e.push({host:t.host,port:t.port})),"string"==typeof(e=e||[])&&(e=function(e){return e.split(",").map(e=>({host:e.split(":")[0],port:e.split(":")[1]||27017}))}(e)),t=Object.assign({},N.TOPOLOGY_DEFAULTS,t),t=Object.freeze(Object.assign(t,{metadata:C(t),compression:{compressors:y(t)}})),$.forEach(e=>{t[e]&&O(`The option \`${e}\` is incompatible with the unified topology, please read more by visiting http://bit.ly/2D8WfT6`,"DeprecationWarning")});const n=function(e,t){if(t.directConnection)return c.Single;if(null==(t.replicaSet||t.setName||t.rs_name))return c.Unknown;return c.ReplicaSetNoPrimary}(0,t),o=D++,s=e.reduce((e,t)=>{t.domain_socket&&(t.host=t.domain_socket);const n=t.port?`${t.host}:${t.port}`:t.host+":27017";return e.set(n,new r(n)),e},new Map);this[K]=new i,this.s={id:o,options:t,seedlist:e,state:q,description:new a(n,s,t.replicaSet,null,null,null,t),serverSelectionTimeoutMS:t.serverSelectionTimeoutMS,heartbeatFrequencyMS:t.heartbeatFrequencyMS,minHeartbeatFrequencyMS:t.minHeartbeatFrequencyMS,Cursor:t.cursorFactory||f,bson:t.bson||new g([g.Binary,g.Code,g.DBRef,g.Decimal128,g.Double,g.Int32,g.Long,g.Map,g.MaxKey,g.MinKey,g.ObjectId,g.BSONRegExp,g.Symbol,g.Timestamp]),servers:new Map,sessionPool:new k(this),sessions:new Set,promiseLibrary:t.promiseLibrary||Promise,credentials:t.credentials,clusterTime:null,connectionTimers:new Set},t.srvHost&&(this.s.srvPoller=t.srvPoller||new S({heartbeatFrequencyMS:this.s.heartbeatFrequencyMS,srvHost:t.srvHost,logger:t.logger,loggerLevel:t.loggerLevel}),this.s.detectTopologyDescriptionChange=e=>{const t=e.previousDescription.type,n=e.newDescription.type;var i;t!==c.Sharded&&n===c.Sharded&&(this.s.handleSrvPolling=(i=this,function(e){const t=i.s.description;i.s.description=i.s.description.updateFromSrvPollingEvent(e),i.s.description!==t&&(Q(i),i.emit("topologyDescriptionChanged",new l.TopologyDescriptionChangedEvent(i.s.id,t,i.s.description)))}),this.s.srvPoller.on("srvRecordDiscovery",this.s.handleSrvPolling),this.s.srvPoller.start())},this.on("topologyDescriptionChanged",this.s.detectTopologyDescriptionChange)),this.setMaxListeners(1/0)}get description(){return this.s.description}get parserType(){return g.native?"c++":"js"}connect(e,t){if("function"==typeof e&&(t=e,e={}),e=e||{},this.s.state===F)return void("function"==typeof t&&t());var n,i;W(this,H),this.emit("topologyOpening",new l.TopologyOpeningEvent(this.s.id)),this.emit("topologyDescriptionChanged",new l.TopologyDescriptionChangedEvent(this.s.id,new a(c.Unknown),this.s.description)),n=this,i=Array.from(this.s.description.servers.values()),n.s.servers=i.reduce((e,t)=>{const i=J(n,t);return e.set(t.address,i),e},new Map),d.translate(e);const o=e.readPreference||d.primary,r=e=>{if(e)return this.close(),void("function"==typeof t?t(e):this.emit("error",e));W(this,F),this.emit("open",e,this),this.emit("connect",this),"function"==typeof t&&t(e,this)};this.s.credentials?this.command("admin.$cmd",{ping:1},{readPreference:o},r):this.selectServer(P(o),e,r)}close(e,t){"function"==typeof e&&(t=e,e={}),"boolean"==typeof e&&(e={force:e}),e=e||{},this.s.state!==q&&this.s.state!==U?(W(this,U),te(this[K],new b("Topology closed")),M(this.s.connectionTimers),this.s.srvPoller&&(this.s.srvPoller.stop(),this.s.handleSrvPolling&&(this.s.srvPoller.removeListener("srvRecordDiscovery",this.s.handleSrvPolling),delete this.s.handleSrvPolling)),this.s.detectTopologyDescriptionChange&&(this.removeListener("topologyDescriptionChanged",this.s.detectTopologyDescriptionChange),delete this.s.detectTopologyDescriptionChange),this.s.sessions.forEach(e=>e.endSession()),this.s.sessionPool.endAllPooledSessions(()=>{E(Array.from(this.s.servers.values()),(t,n)=>X(t,this,e,n),e=>{this.s.servers.clear(),this.emit("topologyClosed",new l.TopologyClosedEvent(this.s.id)),W(this,q),this.emit("close"),"function"==typeof t&&t(e)})})):"function"==typeof t&&t()}selectServer(e,t,n){if("function"==typeof t)if(n=t,"function"!=typeof e){let n;t=e,e instanceof d?n=e:"string"==typeof e?n=new d(e):(d.translate(t),n=t.readPreference||d.primary),e=P(n)}else t={};t=Object.assign({},{serverSelectionTimeoutMS:this.s.serverSelectionTimeoutMS},t);const i=this.description.type===c.Sharded,o=t.session,r=o&&o.transaction;if(i&&r&&r.server)return void n(void 0,r.server);let s=e;if("object"==typeof e){const t=e.readPreference?e.readPreference:d.primary;s=P(t)}const a={serverSelector:s,transaction:r,callback:n},l=t.serverSelectionTimeoutMS;l&&(a.timer=setTimeout(()=>{a[V]=!0,a.timer=void 0;const e=new x(`Server selection timed out after ${l} ms`,this.description);a.callback(e)},l)),this[K].push(a),ne(this)}shouldCheckForSessionSupport(){return this.description.type===c.Single?!this.description.hasKnownServers:!this.description.hasDataBearingServers}hasSessionSupport(){return null!=this.description.logicalSessionTimeoutMinutes}startSession(e,t){const n=new v(this,this.s.sessionPool,e,t);return n.once("ended",()=>{this.s.sessions.delete(n)}),this.s.sessions.add(n),n}endSessions(e,t){Array.isArray(e)||(e=[e]),this.command("admin.$cmd",{endSessions:e},{readPreference:d.primaryPreferred,noResponse:!0},()=>{"function"==typeof t&&t()})}serverUpdateHandler(e){if(!this.s.description.hasServer(e.address))return;if(function(e,t){const n=e.servers.get(t.address).topologyVersion;return I(n,t.topologyVersion)>0}(this.s.description,e))return;const t=this.s.description,n=this.s.description.servers.get(e.address),i=e.$clusterTime;i&&w(this,i);const o=n&&n.equals(e);this.s.description=this.s.description.update(e),this.s.description.compatibilityError?this.emit("error",new b(this.s.description.compatibilityError)):(o||this.emit("serverDescriptionChanged",new l.ServerDescriptionChangedEvent(this.s.id,e.address,n,this.s.description.servers.get(e.address))),Q(this,e),this[K].length>0&&ne(this),o||this.emit("topologyDescriptionChanged",new l.TopologyDescriptionChangedEvent(this.s.id,t,this.s.description)))}auth(e,t){"function"==typeof e&&(t=e,e=null),"function"==typeof t&&t(null,!0)}logout(e){"function"==typeof e&&e(null,!0)}insert(e,t,n,i){Z({topology:this,op:"insert",ns:e,ops:t},n,i)}update(e,t,n,i){Z({topology:this,op:"update",ns:e,ops:t},n,i)}remove(e,t,n,i){Z({topology:this,op:"remove",ns:e,ops:t},n,i)}command(e,t,n,i){"function"==typeof n&&(i=n,n=(n={})||{}),d.translate(n);const o=n.readPreference||d.primary;this.selectServer(P(o),n,(o,r)=>{if(o)return void i(o);const s=!n.retrying&&!!n.retryWrites&&n.session&&h(this)&&!n.session.inTransaction()&&(a=t,Y.some(e=>a[e]));var a;s&&(n.session.incrementTransactionNumber(),n.willRetryWrite=s),r.command(e,t,n,(o,r)=>{if(!o)return i(null,r);if(!ee(o))return i(o);if(s){const o=Object.assign({},n,{retrying:!0});return this.command(e,t,o,i)}return i(o)})})}cursor(e,t,n){const i=(n=n||{}).topology||this,o=n.cursorFactory||this.s.Cursor;return d.translate(n),new o(i,e,t,n)}get clientMetadata(){return this.s.options.metadata}isConnected(){return this.s.state===F}isDestroyed(){return this.s.state===q}unref(){console.log("not implemented: `unref`")}lastIsMaster(){const e=Array.from(this.description.servers.values());if(0===e.length)return{};return e.filter(e=>e.type!==s.Unknown)[0]||{maxWireVersion:this.description.commonWireVersion}}get logicalSessionTimeoutMinutes(){return this.description.logicalSessionTimeoutMinutes}get bson(){return this.s.bson}}Object.defineProperty(G.prototype,"clusterTime",{enumerable:!0,get:function(){return this.s.clusterTime},set:function(e){this.s.clusterTime=e}}),G.prototype.destroy=m(G.prototype.close,"destroy() is deprecated, please use close() instead");const Y=["findAndModify","insert","update","delete"];function X(e,t,n,i){n=n||{},z.forEach(t=>e.removeAllListeners(t)),e.destroy(n,()=>{t.emit("serverClosed",new l.ServerClosedEvent(t.s.id,e.description.address)),j.forEach(t=>e.removeAllListeners(t)),"function"==typeof i&&i()})}function J(e,t,n){e.emit("serverOpening",new l.ServerOpeningEvent(e.s.id,t.address));const i=new p(t,e.s.options,e);if(u(i,e,j),i.on("descriptionReceived",e.serverUpdateHandler.bind(e)),n){const t=setTimeout(()=>{B(t,e.s.connectionTimers),i.connect()},n);return e.s.connectionTimers.add(t),i}return i.connect(),i}function Q(e,t){if(t&&e.s.servers.has(t.address)){e.s.servers.get(t.address).s.description=t}for(const t of e.description.servers.values())if(!e.s.servers.has(t.address)){const n=J(e,t);e.s.servers.set(t.address,n)}for(const t of e.s.servers){const n=t[0];if(e.description.hasServer(n))continue;const i=e.s.servers.get(n);e.s.servers.delete(n),X(i,e)}}function Z(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||{};const i=e.topology,o=e.op,r=e.ns,s=e.ops,a=!e.retrying&&!!t.retryWrites&&t.session&&h(i)&&!t.session.inTransaction();i.selectServer(L(),t,(i,c)=>{if(i)return void n(i,null);const l=(i,o)=>{if(!i)return n(null,o);if(!ee(i))return i=_(i),n(i);if(a){return Z(Object.assign({},e,{retrying:!0}),t,n)}return n(i)};n.operationId&&(l.operationId=n.operationId),a&&(t.session.incrementTransactionNumber(),t.willRetryWrite=a),c[o](r,s,t,l)})}function ee(e){return e instanceof b&&e.hasErrorLabel("RetryableWriteError")}function te(e,t){for(;e.length;){const n=e.shift();clearTimeout(n.timer),n[V]||n.callback(t)}}function ne(e){if(e.s.state===q)return void te(e[K],new b("Topology is closed, please connect"));const t=Array.from(e.description.servers.values()),n=e[K].length;for(let o=0;o<n&&e[K].length;++o){const n=e[K].shift();if(n[V])continue;let o;try{const i=n.serverSelector;o=i?i(e.description,t):t}catch(e){clearTimeout(n.timer),n.callback(e);continue}if(0===o.length){e[K].push(n);continue}const r=(i=o)[Math.floor(Math.random()*i.length)],s=e.s.servers.get(r.address),a=n.transaction;e.description.type===c.Sharded&&a&&a.isActive&&a.pinServer(s),clearTimeout(n.timer),n.callback(void 0,s)}var i;e[K].length>0&&e.s.servers.forEach(e=>process.nextTick(()=>e.requestCheck()))}e.exports={Topology:G}},function(e,t,n){"use strict";const i=n(8),o=n(163).ConnectionPool,r=n(59).CMAP_EVENT_NAMES,s=n(2).MongoError,a=n(4).relayEvents,c=n(9).retrieveBSON(),l=n(15),p=n(30).ServerDescription,u=n(30).compareTopologyVersion,d=n(11),h=n(174).Monitor,f=n(2).MongoNetworkError,m=n(2).MongoNetworkTimeoutError,g=n(4).collationNotSupported,y=n(9).debugOptions,v=n(2).isSDAMUnrecoverableError,b=n(2).isRetryableWriteError,x=n(2).isNodeShuttingDownError,w=n(2).isNetworkErrorBeforeHandshake,S=n(4).maxWireVersion,_=n(4).makeStateMachine,T=n(13),E=T.ServerType,O=n(36).isTransactionCommand,k=["reconnect","reconnectTries","reconnectInterval","emitError","cursorFactory","host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","checkServerIdentity","socketTimeout","ssl","ca","crl","cert","key","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","servername"],C=T.STATE_CLOSING,A=T.STATE_CLOSED,I=T.STATE_CONNECTING,N=T.STATE_CONNECTED,M=_({[A]:[A,I],[I]:[I,C,N,A],[N]:[N,C,A],[C]:[C,A]}),B=Symbol("monitor");class R extends i{constructor(e,t,n){super(),this.s={description:e,options:t,logger:l("Server",t),bson:t.bson||new c([c.Binary,c.Code,c.DBRef,c.Decimal128,c.Double,c.Int32,c.Long,c.Map,c.MaxKey,c.MinKey,c.ObjectId,c.BSONRegExp,c.Symbol,c.Timestamp]),state:A,credentials:t.credentials,topology:n};const i=Object.assign({host:this.description.host,port:this.description.port,bson:this.s.bson},t);this.s.pool=new o(i),a(this.s.pool,this,["commandStarted","commandSucceeded","commandFailed"].concat(r)),this.s.pool.on("clusterTimeReceived",e=>{this.clusterTime=e}),this[B]=new h(this,this.s.options),a(this[B],this,["serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","monitoring"]),this[B].on("resetConnectionPool",()=>{this.s.pool.clear()}),this[B].on("resetServer",e=>D(this,e)),this[B].on("serverHeartbeatSucceeded",e=>{this.emit("descriptionReceived",new p(this.description.address,e.reply,{roundTripTime:P(this.description.roundTripTime,e.duration)})),this.s.state===I&&(M(this,N),this.emit("connect",this))})}get description(){return this.s.description}get name(){return this.s.description.address}get autoEncrypter(){return this.s.options&&this.s.options.autoEncrypter?this.s.options.autoEncrypter:null}connect(){this.s.state===A&&(M(this,I),this[B].connect())}destroy(e,t){"function"==typeof e&&(t=e,e={}),e=Object.assign({},{force:!1},e),this.s.state!==A?(M(this,C),this[B].close(),this.s.pool.close(e,e=>{M(this,A),this.emit("closed"),"function"==typeof t&&t(e)})):"function"==typeof t&&t()}requestCheck(){this[B].requestCheck()}command(e,t,n,i){if("function"==typeof n&&(i=n,n=(n={})||{}),this.s.state===C||this.s.state===A)return void i(new s("server is closed"));const o=function(e,t){if(t.readPreference&&!(t.readPreference instanceof d))return new s("readPreference must be an instance of ReadPreference")}(0,n);if(o)return i(o);n=Object.assign({},n,{wireProtocolCommand:!1}),this.s.logger.isDebug()&&this.s.logger.debug(`executing command [${JSON.stringify({ns:e,cmd:t,options:y(k,n)})}] against ${this.name}`),g(this,t)?i(new s(`server ${this.name} does not support collation`)):this.s.pool.withConnection((i,o,r)=>{if(i)return D(this,i),r(i);o.command(e,t,n,z(this,o,t,n,r))},i)}query(e,t,n,i,o){this.s.state!==C&&this.s.state!==A?this.s.pool.withConnection((o,r,s)=>{if(o)return D(this,o),s(o);r.query(e,t,n,i,z(this,r,t,i,s))},o):o(new s("server is closed"))}getMore(e,t,n,i,o){this.s.state!==C&&this.s.state!==A?this.s.pool.withConnection((o,r,s)=>{if(o)return D(this,o),s(o);r.getMore(e,t,n,i,z(this,r,null,i,s))},o):o(new s("server is closed"))}killCursors(e,t,n){this.s.state!==C&&this.s.state!==A?this.s.pool.withConnection((n,i,o)=>{if(n)return D(this,n),o(n);i.killCursors(e,t,z(this,i,null,void 0,o))},n):"function"==typeof n&&n(new s("server is closed"))}insert(e,t,n,i){L({server:this,op:"insert",ns:e,ops:t},n,i)}update(e,t,n,i){L({server:this,op:"update",ns:e,ops:t},n,i)}remove(e,t,n,i){L({server:this,op:"remove",ns:e,ops:t},n,i)}}function P(e,t){if(-1===e)return t;return.2*t+.8*e}function L(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||{};const i=e.server,o=e.op,r=e.ns,a=Array.isArray(e.ops)?e.ops:[e.ops];if(i.s.state===C||i.s.state===A)return void n(new s("server is closed"));if(g(i,t))return void n(new s(`server ${i.name} does not support collation`));!(t.writeConcern&&0===t.writeConcern.w||S(i)<5)||"update"!==o&&"remove"!==o||!a.find(e=>e.hint)?i.s.pool.withConnection((e,n,s)=>{if(e)return D(i,e),s(e);n[o](r,a,t,z(i,n,a,t,s))},n):n(new s("servers < 3.4 do not support hint on "+o))}function D(e,t){t instanceof f&&!(t instanceof m)&&e[B].reset(),e.emit("descriptionReceived",new p(e.description.address,null,{error:t,topologyVersion:t&&t.topologyVersion?t.topologyVersion:e.description.topologyVersion}))}function j(e,t){return e&&e.inTransaction()&&!O(t)}function z(e,t,n,i,o){const r=i&&i.session;return function(i,s){i&&!function(e,t){return t.generation!==e.generation}(e.s.pool,t)&&(i instanceof f?(r&&!r.hasEnded&&(r.serverSession.isDirty=!0),function(e){return e.description.maxWireVersion>=6&&e.description.logicalSessionTimeoutMinutes&&e.description.type!==E.Standalone}(e)&&!j(r,n)&&i.addErrorLabel("RetryableWriteError"),i instanceof m&&!w(i)||(D(e,i),e.s.pool.clear())):(S(e)<9&&b(i)&&!j(r,n)&&i.addErrorLabel("RetryableWriteError"),v(i)&&function(e,t){const n=t.topologyVersion,i=e.description.topologyVersion;return u(i,n)<0}(e,i)&&((S(e)<=7||x(i))&&e.s.pool.clear(),D(e,i),process.nextTick(()=>e.requestCheck())))),o(i,s)}}Object.defineProperty(R.prototype,"clusterTime",{get:function(){return this.s.topology.clusterTime},set:function(e){this.s.topology.clusterTime=e}}),e.exports={Server:R}},function(e,t,n){"use strict";const i=n(75),o=n(8).EventEmitter,r=n(15),s=n(0).makeCounter,a=n(2).MongoError,c=n(106).Connection,l=n(4).eachAsync,p=n(74),u=n(4).relayEvents,d=n(173),h=d.PoolClosedError,f=d.WaitQueueTimeoutError,m=n(59),g=m.ConnectionPoolCreatedEvent,y=m.ConnectionPoolClosedEvent,v=m.ConnectionCreatedEvent,b=m.ConnectionReadyEvent,x=m.ConnectionClosedEvent,w=m.ConnectionCheckOutStartedEvent,S=m.ConnectionCheckOutFailedEvent,_=m.ConnectionCheckedOutEvent,T=m.ConnectionCheckedInEvent,E=m.ConnectionPoolClearedEvent,O=Symbol("logger"),k=Symbol("connections"),C=Symbol("permits"),A=Symbol("minPoolSizeTimer"),I=Symbol("generation"),N=Symbol("connectionCounter"),M=Symbol("cancellationToken"),B=Symbol("waitQueue"),R=Symbol("cancelled"),P=new Set(["ssl","bson","connectionType","monitorCommands","socketTimeout","credentials","compression","host","port","localAddress","localPort","family","hints","lookup","path","ca","cert","sigalgs","ciphers","clientCertEngine","crl","dhparam","ecdhCurve","honorCipherOrder","key","privateKeyEngine","privateKeyIdentifier","maxVersion","minVersion","passphrase","pfx","secureOptions","secureProtocol","sessionIdContext","allowHalfOpen","rejectUnauthorized","pskCallback","ALPNProtocols","servername","checkServerIdentity","session","minDHSize","secureContext","maxPoolSize","minPoolSize","maxIdleTimeMS","waitQueueTimeoutMS"]);function L(e,t){return t.generation!==e[I]}function D(e,t){return!!(e.options.maxIdleTimeMS&&t.idleTime>e.options.maxIdleTimeMS)}function j(e,t){const n=Object.assign({id:e[N].next().value,generation:e[I]},e.options);e[C]--,p(n,e[M],(n,i)=>{if(n)return e[C]++,e[O].debug(`connection attempt failed with error [${JSON.stringify(n)}]`),void("function"==typeof t&&t(n));e.closed?i.destroy({force:!0}):(u(i,e,["commandStarted","commandFailed","commandSucceeded","clusterTimeReceived"]),e.emit("connectionCreated",new v(e,i)),i.markAvailable(),e.emit("connectionReady",new b(e,i)),"function"!=typeof t?(e[k].push(i),process.nextTick(()=>U(e))):t(void 0,i))})}function z(e,t,n){e.emit("connectionClosed",new x(e,t,n)),e[C]++,process.nextTick(()=>t.destroy())}function U(e){if(e.closed)return;for(;e.waitQueueSize;){const t=e[B].peekFront();if(t[R]){e[B].shift();continue}if(!e.availableConnectionCount)break;const n=e[k].shift(),i=L(e,n),o=D(e,n);if(!i&&!o&&!n.closed)return e.emit("connectionCheckedOut",new _(e,n)),clearTimeout(t.timer),e[B].shift(),void t.callback(void 0,n);const r=n.closed?"error":i?"stale":"idle";z(e,n,r)}const t=e.options.maxPoolSize;e.waitQueueSize&&(t<=0||e.totalConnectionCount<t)&&j(e,(t,n)=>{const i=e[B].shift();null==i||i[R]?null==t&&e[k].push(n):(t?e.emit("connectionCheckOutFailed",new S(e,t)):e.emit("connectionCheckedOut",new _(e,n)),clearTimeout(i.timer),i.callback(t,n))})}e.exports={ConnectionPool:class extends o{constructor(e){if(super(),e=e||{},this.closed=!1,this.options=function(e,t){const n=Array.from(P).reduce((t,n)=>(Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]),t),{});return Object.freeze(Object.assign({},t,n))}(e,{connectionType:c,maxPoolSize:"number"==typeof e.maxPoolSize?e.maxPoolSize:100,minPoolSize:"number"==typeof e.minPoolSize?e.minPoolSize:0,maxIdleTimeMS:"number"==typeof e.maxIdleTimeMS?e.maxIdleTimeMS:0,waitQueueTimeoutMS:"number"==typeof e.waitQueueTimeoutMS?e.waitQueueTimeoutMS:0,autoEncrypter:e.autoEncrypter,metadata:e.metadata}),e.minSize>e.maxSize)throw new TypeError("Connection pool minimum size must not be greater than maxiumum pool size");this[O]=r("ConnectionPool",e),this[k]=new i,this[C]=this.options.maxPoolSize,this[A]=void 0,this[I]=0,this[N]=s(1),this[M]=new o,this[M].setMaxListeners(1/0),this[B]=new i,process.nextTick(()=>{this.emit("connectionPoolCreated",new g(this)),function e(t){if(t.closed||0===t.options.minPoolSize)return;const n=t.options.minPoolSize;for(let e=t.totalConnectionCount;e<n;++e)j(t);t[A]=setTimeout(()=>e(t),10)}(this)})}get address(){return`${this.options.host}:${this.options.port}`}get generation(){return this[I]}get totalConnectionCount(){return this[k].length+(this.options.maxPoolSize-this[C])}get availableConnectionCount(){return this[k].length}get waitQueueSize(){return this[B].length}checkOut(e){if(this.emit("connectionCheckOutStarted",new w(this)),this.closed)return this.emit("connectionCheckOutFailed",new S(this,"poolClosed")),void e(new h(this));const t={callback:e},n=this,i=this.options.waitQueueTimeoutMS;i&&(t.timer=setTimeout(()=>{t[R]=!0,t.timer=void 0,n.emit("connectionCheckOutFailed",new S(n,"timeout")),t.callback(new f(n))},i)),this[B].push(t),process.nextTick(()=>U(this))}checkIn(e){const t=this.closed,n=L(this,e),i=!!(t||n||e.closed);if(i||(e.markAvailable(),this[k].push(e)),this.emit("connectionCheckedIn",new T(this,e)),i){z(this,e,e.closed?"error":t?"poolClosed":"stale")}process.nextTick(()=>U(this))}clear(){this[I]+=1,this.emit("connectionPoolCleared",new E(this))}close(e,t){if("function"==typeof e&&(t=e),e=Object.assign({force:!1},e),this.closed)return t();for(this[M].emit("cancel");this.waitQueueSize;){const e=this[B].pop();clearTimeout(e.timer),e[R]||e.callback(new a("connection pool closed"))}this[A]&&clearTimeout(this[A]),"function"==typeof this[N].return&&this[N].return(),this.closed=!0,l(this[k].toArray(),(t,n)=>{this.emit("connectionClosed",new x(this,t,"poolClosed")),t.destroy(e,n)},e=>{this[k].clear(),this.emit("connectionPoolClosed",new y(this)),t(e)})}withConnection(e,t){this.checkOut((n,i)=>{e(n,i,(e,n)=>{"function"==typeof t&&(e?t(e):t(void 0,n)),i&&this.checkIn(i)})})}}}},function(e,t,n){"use strict";const i=n(14).Duplex,o=n(165),r=n(2).MongoParseError,s=n(23).decompress,a=n(18).Response,c=n(31).BinMsg,l=n(2).MongoError,p=n(6).opcodes.OP_COMPRESSED,u=n(6).opcodes.OP_MSG,d=n(6).MESSAGE_HEADER_SIZE,h=n(6).COMPRESSION_DETAILS_SIZE,f=n(6).opcodes,m=n(23).compress,g=n(23).compressorIDs,y=n(23).uncompressibleCommands,v=n(31).Msg,b=Symbol("buffer");e.exports=class extends i{constructor(e){super(e=e||{}),this.bson=e.bson,this.maxBsonMessageSize=e.maxBsonMessageSize||67108864,this[b]=new o}_write(e,t,n){this[b].append(e),function e(t,n){const i=t[b];if(i.length<4)return void n();const o=i.readInt32LE(0);if(o<0)return void n(new r("Invalid message size: "+o));if(o>t.maxBsonMessageSize)return void n(new r(`Invalid message size: ${o}, max allowed: ${t.maxBsonMessageSize}`));if(o>i.length)return void n();const h=i.slice(0,o);i.consume(o);const f={length:h.readInt32LE(0),requestId:h.readInt32LE(4),responseTo:h.readInt32LE(8),opCode:h.readInt32LE(12)};let m=f.opCode===u?c:a;const g=t.responseOptions;if(f.opCode!==p){const o=h.slice(d);return t.emit("message",new m(t.bson,h,f,o,g)),void(i.length>=4?e(t,n):n())}f.fromCompressed=!0,f.opCode=h.readInt32LE(d),f.length=h.readInt32LE(d+4);const y=h[d+8],v=h.slice(d+9);m=f.opCode===u?c:a,s(y,v,(o,r)=>{o?n(o):r.length===f.length?(t.emit("message",new m(t.bson,h,f,r,g)),i.length>=4?e(t,n):n()):n(new l("Decompressing a compressed message from the server failed. The message is corrupt."))})}(this,n)}_read(){}writeCommand(e,t){if(!(t&&!!t.agreedCompressor)||!function(e){const t=e instanceof v?e.command:e.query,n=Object.keys(t)[0];return!y.has(n)}(e)){const t=e.toBin();return void this.push(Array.isArray(t)?Buffer.concat(t):t)}const n=Buffer.concat(e.toBin()),i=n.slice(d),o=n.readInt32LE(12);m({options:t},i,(n,r)=>{if(n)return void t.cb(n,null);const s=Buffer.alloc(d);s.writeInt32LE(d+h+r.length,0),s.writeInt32LE(e.requestId,4),s.writeInt32LE(0,8),s.writeInt32LE(f.OP_COMPRESSED,12);const a=Buffer.alloc(h);a.writeInt32LE(o,0),a.writeInt32LE(i.length,4),a.writeUInt8(g[t.agreedCompressor],8),this.push(Buffer.concat([s,a,r]))})}}},function(e,t,n){"use strict";var i=n(166).Duplex,o=n(5),r=n(19).Buffer;function s(e){if(!(this instanceof s))return new s(e);if(this._bufs=[],this.length=0,"function"==typeof e){this._callback=e;var t=function(e){this._callback&&(this._callback(e),this._callback=null)}.bind(this);this.on("pipe",(function(e){e.on("error",t)})),this.on("unpipe",(function(e){e.removeListener("error",t)}))}else this.append(e);i.call(this)}o.inherits(s,i),s.prototype._offset=function(e){var t,n=0,i=0;if(0===e)return[0,0];for(;i<this._bufs.length;i++){if(e<(t=n+this._bufs[i].length)||i==this._bufs.length-1)return[i,e-n];n=t}},s.prototype._reverseOffset=function(e){for(var t=e[0],n=e[1],i=0;i<t;i++)n+=this._bufs[i].length;return n},s.prototype.append=function(e){var t=0;if(r.isBuffer(e))this._appendBuffer(e);else if(Array.isArray(e))for(;t<e.length;t++)this.append(e[t]);else if(e instanceof s)for(;t<e._bufs.length;t++)this.append(e._bufs[t]);else null!=e&&("number"==typeof e&&(e=e.toString()),this._appendBuffer(r.from(e)));return this},s.prototype._appendBuffer=function(e){this._bufs.push(e),this.length+=e.length},s.prototype._write=function(e,t,n){this._appendBuffer(e),"function"==typeof n&&n()},s.prototype._read=function(e){if(!this.length)return this.push(null);e=Math.min(e,this.length),this.push(this.slice(0,e)),this.consume(e)},s.prototype.end=function(e){i.prototype.end.call(this,e),this._callback&&(this._callback(null,this.slice()),this._callback=null)},s.prototype.get=function(e){if(!(e>this.length||e<0)){var t=this._offset(e);return this._bufs[t[0]][t[1]]}},s.prototype.slice=function(e,t){return"number"==typeof e&&e<0&&(e+=this.length),"number"==typeof t&&t<0&&(t+=this.length),this.copy(null,0,e,t)},s.prototype.copy=function(e,t,n,i){if(("number"!=typeof n||n<0)&&(n=0),("number"!=typeof i||i>this.length)&&(i=this.length),n>=this.length)return e||r.alloc(0);if(i<=0)return e||r.alloc(0);var o,s,a=!!e,c=this._offset(n),l=i-n,p=l,u=a&&t||0,d=c[1];if(0===n&&i==this.length){if(!a)return 1===this._bufs.length?this._bufs[0]:r.concat(this._bufs,this.length);for(s=0;s<this._bufs.length;s++)this._bufs[s].copy(e,u),u+=this._bufs[s].length;return e}if(p<=this._bufs[c[0]].length-d)return a?this._bufs[c[0]].copy(e,t,d,d+p):this._bufs[c[0]].slice(d,d+p);for(a||(e=r.allocUnsafe(l)),s=c[0];s<this._bufs.length;s++){if(!(p>(o=this._bufs[s].length-d))){this._bufs[s].copy(e,u,d,d+p),u+=o;break}this._bufs[s].copy(e,u,d),u+=o,p-=o,d&&(d=0)}return e.length>u?e.slice(0,u):e},s.prototype.shallowSlice=function(e,t){if(e=e||0,t="number"!=typeof t?this.length:t,e<0&&(e+=this.length),t<0&&(t+=this.length),e===t)return new s;var n=this._offset(e),i=this._offset(t),o=this._bufs.slice(n[0],i[0]+1);return 0==i[1]?o.pop():o[o.length-1]=o[o.length-1].slice(0,i[1]),0!=n[1]&&(o[0]=o[0].slice(n[1])),new s(o)},s.prototype.toString=function(e,t,n){return this.slice(t,n).toString(e)},s.prototype.consume=function(e){if(e=Math.trunc(e),Number.isNaN(e)||e<=0)return this;for(;this._bufs.length;){if(!(e>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},s.prototype.duplicate=function(){for(var e=0,t=new s;e<this._bufs.length;e++)t.append(this._bufs[e]);return t},s.prototype.destroy=function(){this._bufs.length=0,this.length=0,this.push(null)},s.prototype.indexOf=function(e,t,n){if(void 0===n&&"string"==typeof t&&(n=t,t=void 0),"function"==typeof e||Array.isArray(e))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if("number"==typeof e?e=r.from([e]):"string"==typeof e?e=r.from(e,n):e instanceof s?e=e.slice():r.isBuffer(e)||(e=r.from(e)),t=Number(t||0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),0===e.length)return t>this.length?this.length:t;for(var i=this._offset(t),o=i[0],a=i[1];o<this._bufs.length;o++){for(var c=this._bufs[o];a<c.length;){if(c.length-a>=e.length){var l=c.indexOf(e,a);if(-1!==l)return this._reverseOffset([o,l]);a=c.length-e.length+1}else{var p=this._reverseOffset([o,a]);if(this._match(p,e))return p;a++}}a=0}return-1},s.prototype._match=function(e,t){if(this.length-e<t.length)return!1;for(var n=0;n<t.length;n++)if(this.get(e+n)!==t[n])return!1;return!0},function(){var e={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(var t in e)!function(t){s.prototype[t]=null===e[t]?function(e,n){return this.slice(e,e+n)[t](0,n)}:function(n){return this.slice(n,n+e[t])[t](0)}}(t)}(),e.exports=s},function(e,t,n){var i=n(14);"disable"===process.env.READABLE_STREAM&&i?(e.exports=i,(t=e.exports=i.Readable).Readable=i.Readable,t.Writable=i.Writable,t.Duplex=i.Duplex,t.Transform=i.Transform,t.PassThrough=i.PassThrough,t.Stream=i):((t=e.exports=n(107)).Stream=i||t,t.Readable=t,t.Writable=n(110),t.Duplex=n(33),t.Transform=n(112),t.PassThrough=n(171))},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},function(e,t,n){"use strict";var i=n(58).Buffer,o=n(5);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return i.alloc(0);if(1===this.length)return this.head.data;for(var t,n,o,r=i.allocUnsafe(e>>>0),s=this.head,a=0;s;)t=s.data,n=r,o=a,t.copy(n,o),a+=s.data.length,s=s.next;return r},e}(),o&&o.inspect&&o.inspect.custom&&(e.exports.prototype[o.inspect.custom]=function(){var e=o.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t,n){e.exports=n(5).deprecate},function(e,t,n){"use strict";e.exports=r;var i=n(112),o=Object.create(n(39));function r(e){if(!(this instanceof r))return new r(e);i.call(this,e)}o.inherits=n(40),o.inherits(r,i),r.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){"use strict";const i=n(30).parseServerType,o=["minWireVersion","maxWireVersion","maxBsonObjectSize","maxMessageSizeBytes","maxWriteBatchSize","__nodejs_mock_server__"];e.exports={StreamDescription:class{constructor(e,t){this.address=e,this.type=i(null),this.minWireVersion=void 0,this.maxWireVersion=void 0,this.maxBsonObjectSize=16777216,this.maxMessageSizeBytes=48e6,this.maxWriteBatchSize=1e5,this.compressors=t&&t.compression&&Array.isArray(t.compression.compressors)?t.compression.compressors:[]}receiveResponse(e){this.type=i(e),o.forEach(t=>{void 0!==e[t]&&(this[t]=e[t])}),e.compression&&(this.compressor=this.compressors.filter(t=>-1!==e.compression.indexOf(t))[0])}}}},function(e,t,n){"use strict";const i=n(2).MongoError;e.exports={PoolClosedError:class extends i{constructor(e){super("Attempted to check out a connection from closed connection pool"),this.name="MongoPoolClosedError",this.address=e.address}},WaitQueueTimeoutError:class extends i{constructor(e){super("Timed out while checking out a connection from connection pool"),this.name="MongoWaitQueueTimeoutError",this.address=e.address}}}},function(e,t,n){"use strict";const i=n(13).ServerType,o=n(8),r=n(74),s=n(106).Connection,a=n(13),c=n(4).makeStateMachine,l=n(2).MongoNetworkError,p=n(9).retrieveBSON(),u=n(0).makeInterruptableAsyncInterval,d=n(0).calculateDurationInMs,h=n(0).now,f=n(105),m=f.ServerHeartbeatStartedEvent,g=f.ServerHeartbeatSucceededEvent,y=f.ServerHeartbeatFailedEvent,v=Symbol("server"),b=Symbol("monitorId"),x=Symbol("connection"),w=Symbol("cancellationToken"),S=Symbol("rttPinger"),_=Symbol("roundTripTime"),T=a.STATE_CLOSED,E=a.STATE_CLOSING,O=c({[E]:[E,"idle",T],[T]:[T,"monitoring"],idle:["idle","monitoring",E],monitoring:["monitoring","idle",E]}),k=new Set([E,T,"monitoring"]);function C(e){return e.s.state===T||e.s.state===E}function A(e){O(e,E),e[b]&&(e[b].stop(),e[b]=null),e[S]&&(e[S].close(),e[S]=void 0),e[w].emit("cancel"),e[b]&&(clearTimeout(e[b]),e[b]=void 0),e[x]&&e[x].destroy({force:!0})}function I(e){return t=>{function n(){C(e)||O(e,"idle"),t()}O(e,"monitoring"),process.nextTick(()=>e.emit("monitoring",e[v])),function(e,t){let n=h();function i(i){e[x]&&(e[x].destroy({force:!0}),e[x]=void 0),e.emit("serverHeartbeatFailed",new y(d(n),i,e.address)),e.emit("resetServer",i),e.emit("resetConnectionPool"),t(i)}if(e.emit("serverHeartbeatStarted",new m(e.address)),null!=e[x]&&!e[x].closed){const r=e.options.connectTimeoutMS,s=e.options.heartbeatFrequencyMS,a=e[v].description.topologyVersion,c=null!=a,l=c?{ismaster:!0,maxAwaitTimeMS:s,topologyVersion:(o=a,{processId:o.processId,counter:p.Long.fromNumber(o.counter)})}:{ismaster:!0},u=c?{socketTimeout:r+s,exhaustAllowed:!0}:{socketTimeout:r};return c&&null==e[S]&&(e[S]=new N(e[w],e.connectOptions)),void e[x].command("admin.$cmd",l,u,(o,r)=>{if(o)return void i(o);const s=r.result,a=c?e[S].roundTripTime:d(n);e.emit("serverHeartbeatSucceeded",new g(a,s,e.address)),c&&s.topologyVersion?(e.emit("serverHeartbeatStarted",new m(e.address)),n=h()):(e[S]&&(e[S].close(),e[S]=void 0),t(void 0,s))})}var o;r(e.connectOptions,e[w],(o,r)=>{if(r&&C(e))r.destroy({force:!0});else{if(o)return e[x]=void 0,o instanceof l||e.emit("resetConnectionPool"),void i(o);e[x]=r,e.emit("serverHeartbeatSucceeded",new g(d(n),r.ismaster,e.address)),t(void 0,r.ismaster)}})}(e,(t,o)=>{if(t&&e[v].description.type===i.Unknown)return e.emit("resetServer",t),n();o&&o.topologyVersion&&setTimeout(()=>{C(e)||e[b].wake()}),n()})}}class N{constructor(e,t){this[x]=null,this[w]=e,this[_]=0,this.closed=!1;const n=t.heartbeatFrequencyMS;this[b]=setTimeout(()=>function e(t,n){const i=h(),o=t[w],s=n.heartbeatFrequencyMS;if(t.closed)return;function a(o){t.closed?o.destroy({force:!0}):(null==t[x]&&(t[x]=o),t[_]=d(i),t[b]=setTimeout(()=>e(t,n),s))}if(null==t[x])return void r(n,o,(e,n)=>{if(e)return t[x]=void 0,void(t[_]=0);a(n)});t[x].command("admin.$cmd",{ismaster:1},e=>{if(e)return t[x]=void 0,void(t[_]=0);a()})}(this,t),n)}get roundTripTime(){return this[_]}close(){this.closed=!0,clearTimeout(this[b]),this[b]=void 0,this[x]&&this[x].destroy({force:!0})}}e.exports={Monitor:class extends o{constructor(e,t){super(t),this[v]=e,this[x]=void 0,this[w]=new o,this[w].setMaxListeners(1/0),this[b]=null,this.s={state:T},this.address=e.description.address,this.options=Object.freeze({connectTimeoutMS:"number"==typeof t.connectionTimeout?t.connectionTimeout:"number"==typeof t.connectTimeoutMS?t.connectTimeoutMS:1e4,heartbeatFrequencyMS:"number"==typeof t.heartbeatFrequencyMS?t.heartbeatFrequencyMS:1e4,minHeartbeatFrequencyMS:"number"==typeof t.minHeartbeatFrequencyMS?t.minHeartbeatFrequencyMS:500});const n=Object.assign({id:"<monitor>",host:e.description.host,port:e.description.port,bson:e.s.bson,connectionType:s},e.s.options,this.options,{raw:!1,promoteLongs:!0,promoteValues:!0,promoteBuffers:!0});delete n.credentials,this.connectOptions=Object.freeze(n)}connect(){if(this.s.state!==T)return;const e=this.options.heartbeatFrequencyMS,t=this.options.minHeartbeatFrequencyMS;this[b]=u(I(this),{interval:e,minInterval:t,immediate:!0})}requestCheck(){k.has(this.s.state)||this[b].wake()}reset(){if(C(this))return;O(this,E),A(this),O(this,"idle");const e=this.options.heartbeatFrequencyMS,t=this.options.minHeartbeatFrequencyMS;this[b]=u(I(this),{interval:e,minInterval:t})}close(){C(this)||(O(this,E),A(this),this.emit("close"),O(this,T))}}}},function(e,t,n){"use strict";const i=n(15),o=n(8).EventEmitter,r=n(45);class s{constructor(e){this.srvRecords=e}addresses(){return new Set(this.srvRecords.map(e=>`${e.name}:${e.port}`))}}e.exports.SrvPollingEvent=s,e.exports.SrvPoller=class extends o{constructor(e){if(super(),!e||!e.srvHost)throw new TypeError("options for SrvPoller must exist and include srvHost");this.srvHost=e.srvHost,this.rescanSrvIntervalMS=6e4,this.heartbeatFrequencyMS=e.heartbeatFrequencyMS||1e4,this.logger=i("srvPoller",e),this.haMode=!1,this.generation=0,this._timeout=null}get srvAddress(){return"_mongodb._tcp."+this.srvHost}get intervalMS(){return this.haMode?this.heartbeatFrequencyMS:this.rescanSrvIntervalMS}start(){this._timeout||this.schedule()}stop(){this._timeout&&(clearTimeout(this._timeout),this.generation+=1,this._timeout=null)}schedule(){clearTimeout(this._timeout),this._timeout=setTimeout(()=>this._poll(),this.intervalMS)}success(e){this.haMode=!1,this.schedule(),this.emit("srvRecordDiscovery",new s(e))}failure(e,t){this.logger.warn(e,t),this.haMode=!0,this.schedule()}parentDomainMismatch(e){this.logger.warn(`parent domain mismatch on SRV record (${e.name}:${e.port})`,e)}_poll(){const e=this.generation;r.resolveSrv(this.srvAddress,(t,n)=>{if(e!==this.generation)return;if(t)return void this.failure("DNS error",t);const i=[];n.forEach(e=>{!function(e,t){const n=/^.*?\./,i="."+e.replace(n,""),o="."+t.replace(n,"");return i.endsWith(o)}(e.name,this.srvHost)?this.parentDomainMismatch(e):i.push(e)}),i.length?this.success(i):this.failure("No valid addresses found at host")})}}},function(e,t,n){"use strict";const i=n(13).ServerType,o=n(13).TopologyType,r=n(11),s=n(2).MongoError;function a(e,t){const n=Object.keys(e),i=Object.keys(t);for(let o=0;o<n.length;++o){const r=n[o];if(-1===i.indexOf(r)||t[r]!==e[r])return!1}return!0}function c(e,t){const n=t.reduce((e,t)=>-1===e?t.roundTripTime:Math.min(t.roundTripTime,e),-1),i=n+e.localThresholdMS;return t.reduce((e,t)=>(t.roundTripTime<=i&&t.roundTripTime>=n&&e.push(t),e),[])}function l(e){return e.type===i.RSPrimary}function p(e){return e.type===i.RSSecondary}function u(e){return e.type===i.RSSecondary||e.type===i.RSPrimary}function d(e){return e.type!==i.Unknown}e.exports={writableServerSelector:function(){return function(e,t){return c(e,t.filter(e=>e.isWritable))}},readPreferenceServerSelector:function(e){if(!e.isValid())throw new TypeError("Invalid read preference specified");return function(t,n){const i=t.commonWireVersion;if(i&&e.minWireVersion&&e.minWireVersion>i)throw new s(`Minimum wire version '${e.minWireVersion}' required, but found '${i}'`);if(t.type===o.Unknown)return[];if(t.type===o.Single||t.type===o.Sharded)return c(t,n.filter(d));const h=e.mode;if(h===r.PRIMARY)return n.filter(l);if(h===r.PRIMARY_PREFERRED){const e=n.filter(l);if(e.length)return e}const f=h===r.NEAREST?u:p,m=c(t,function(e,t){if(null==e.tags||Array.isArray(e.tags)&&0===e.tags.length)return t;for(let n=0;n<e.tags.length;++n){const i=e.tags[n],o=t.reduce((e,t)=>(a(i,t.tags)&&e.push(t),e),[]);if(o.length)return o}return[]}(e,function(e,t,n){if(null==e.maxStalenessSeconds||e.maxStalenessSeconds<0)return n;const i=e.maxStalenessSeconds,r=(t.heartbeatFrequencyMS+1e4)/1e3;if(i<r)throw new s(`maxStalenessSeconds must be at least ${r} seconds`);if(i<90)throw new s("maxStalenessSeconds must be at least 90 seconds");if(t.type===o.ReplicaSetWithPrimary){const i=Array.from(t.servers.values()).filter(l)[0];return n.reduce((n,o)=>((o.lastUpdateTime-o.lastWriteDate-(i.lastUpdateTime-i.lastWriteDate)+t.heartbeatFrequencyMS)/1e3<=e.maxStalenessSeconds&&n.push(o),n),[])}if(t.type===o.ReplicaSetNoPrimary){if(0===n.length)return n;const i=n.reduce((e,t)=>t.lastWriteDate>e.lastWriteDate?t:e);return n.reduce((n,o)=>((i.lastWriteDate-o.lastWriteDate+t.heartbeatFrequencyMS)/1e3<=e.maxStalenessSeconds&&n.push(o),n),[])}return n}(e,t,n.filter(f))));return h===r.SECONDARY_PREFERRED&&0===m.length?n.filter(l):m}}}},function(e,t,n){"use strict";const i=n(34),o=n(103),r=n(45),s=n(2).MongoParseError,a=n(11),c=/(mongodb(?:\+srv|)):\/\/(?: (?:[^:]*) (?: : ([^@]*) )? @ )?([^/?]*)(?:\/|)(.*)/;function l(e,t){const n=/^.*?\./,i="."+e.replace(n,""),o="."+t.replace(n,"");return i.endsWith(o)}function p(e,t){if(Array.isArray(t))1===(t=t.filter((e,n)=>t.indexOf(e)===n)).length&&(t=t[0]);else if(t.indexOf(":")>0)t=t.split(",").reduce((t,n)=>{const i=n.split(":");return t[i[0]]=p(e,i[1]),t},{});else if(t.indexOf(",")>0)t=t.split(",").map(t=>p(e,t));else if("true"===t.toLowerCase()||"false"===t.toLowerCase())t="true"===t.toLowerCase();else if(!Number.isNaN(t)&&!d.has(e)){const e=parseFloat(t);Number.isNaN(e)||(t=parseFloat(t))}return t}const u=new Set(["slaveok","slave_ok","sslvalidate","fsync","safe","retrywrites","j"]),d=new Set(["authsource","replicaset"]),h=new Set(["GSSAPI","MONGODB-AWS","MONGODB-X509","MONGODB-CR","DEFAULT","SCRAM-SHA-1","SCRAM-SHA-256","PLAIN"]),f={replicaset:"replicaSet",connecttimeoutms:"connectTimeoutMS",sockettimeoutms:"socketTimeoutMS",maxpoolsize:"maxPoolSize",minpoolsize:"minPoolSize",maxidletimems:"maxIdleTimeMS",waitqueuemultiple:"waitQueueMultiple",waitqueuetimeoutms:"waitQueueTimeoutMS",wtimeoutms:"wtimeoutMS",readconcern:"readConcern",readconcernlevel:"readConcernLevel",readpreference:"readPreference",maxstalenessseconds:"maxStalenessSeconds",readpreferencetags:"readPreferenceTags",authsource:"authSource",authmechanism:"authMechanism",authmechanismproperties:"authMechanismProperties",gssapiservicename:"gssapiServiceName",localthresholdms:"localThresholdMS",serverselectiontimeoutms:"serverSelectionTimeoutMS",serverselectiontryonce:"serverSelectionTryOnce",heartbeatfrequencyms:"heartbeatFrequencyMS",retrywrites:"retryWrites",uuidrepresentation:"uuidRepresentation",zlibcompressionlevel:"zlibCompressionLevel",tlsallowinvalidcertificates:"tlsAllowInvalidCertificates",tlsallowinvalidhostnames:"tlsAllowInvalidHostnames",tlsinsecure:"tlsInsecure",tlscafile:"tlsCAFile",tlscertificatekeyfile:"tlsCertificateKeyFile",tlscertificatekeyfilepassword:"tlsCertificateKeyFilePassword",wtimeout:"wTimeoutMS",j:"journal",directconnection:"directConnection"};function m(e,t,n,i){if("journal"===t?t="j":"wtimeoutms"===t&&(t="wtimeout"),u.has(t)?n="true"===n||!0===n:"appname"===t?n=decodeURIComponent(n):"readconcernlevel"===t&&(e.readConcernLevel=n,t="readconcern",n={level:n}),"compressors"===t&&!(n=Array.isArray(n)?n:[n]).every(e=>"snappy"===e||"zlib"===e))throw new s("Value for `compressors` must be at least one of: `snappy`, `zlib`");if("authmechanism"===t&&!h.has(n))throw new s(`Value for authMechanism must be one of: ${Array.from(h).join(", ")}, found: ${n}`);if("readpreference"===t&&!a.isValid(n))throw new s("Value for `readPreference` must be one of: `primary`, `primaryPreferred`, `secondary`, `secondaryPreferred`, `nearest`");if("zlibcompressionlevel"===t&&(n<-1||n>9))throw new s("zlibCompressionLevel must be an integer between -1 and 9");"compressors"!==t&&"zlibcompressionlevel"!==t||(e.compression=e.compression||{},e=e.compression),"authmechanismproperties"===t&&("string"==typeof n.SERVICE_NAME&&(e.gssapiServiceName=n.SERVICE_NAME),"string"==typeof n.SERVICE_REALM&&(e.gssapiServiceRealm=n.SERVICE_REALM),void 0!==n.CANONICALIZE_HOST_NAME&&(e.gssapiCanonicalizeHostName=n.CANONICALIZE_HOST_NAME)),"readpreferencetags"===t&&(n=Array.isArray(n)?function(e){const t=[];for(let n=0;n<e.length;n++)t[n]={},e[n].split(",").forEach(e=>{const i=e.split(":");t[n][i[0]]=i[1]});return t}(n):[n]),i.caseTranslate&&f[t]?e[f[t]]=n:e[t]=n}const g=new Set(["GSSAPI","MONGODB-CR","PLAIN","SCRAM-SHA-1","SCRAM-SHA-256"]);function y(e,t){const n={};let i=o.parse(e);!function(e){const t=Object.keys(e);if(-1!==t.indexOf("tlsInsecure")&&(-1!==t.indexOf("tlsAllowInvalidCertificates")||-1!==t.indexOf("tlsAllowInvalidHostnames")))throw new s("The `tlsInsecure` option cannot be used with `tlsAllowInvalidCertificates` or `tlsAllowInvalidHostnames`.");const n=v("tls",e,t),i=v("ssl",e,t);if(null!=n&&null!=i&&n!==i)throw new s("All values of `tls` and `ssl` must be the same.")}(i);for(const e in i){const o=i[e];if(""===o||null==o)throw new s("Incomplete key value pair for option");const r=e.toLowerCase();m(n,r,p(r,o),t)}return n.wtimeout&&n.wtimeoutms&&(delete n.wtimeout,console.warn("Unsupported option `wtimeout` specified")),Object.keys(n).length?n:null}function v(e,t,n){const i=-1!==n.indexOf(e);let o;if(o=Array.isArray(t[e])?t[e][0]:t[e],i&&Array.isArray(t[e])){const n=t[e][0];t[e].forEach(t=>{if(t!==n)throw new s(`All values of ${e} must be the same.`)})}return o}const b="mongodb+srv",x=["mongodb",b];function w(e,t,n){"function"==typeof t&&(n=t,t={}),t=Object.assign({},{caseTranslate:!0},t);try{i.parse(e)}catch(e){return n(new s("URI malformed, cannot be parsed"))}const a=e.match(c);if(!a)return n(new s("Invalid connection string"));const p=a[1];if(-1===x.indexOf(p))return n(new s("Invalid protocol provided"));const u=a[4].split("?"),d=u.length>0?u[0]:null,h=u.length>1?u[1]:null;let f;try{f=y(h,t)}catch(e){return n(e)}if(f=Object.assign({},f,t),p===b)return function(e,t,n){const a=i.parse(e,!0);if(t.directConnection||t.directconnection)return n(new s("directConnection not supported with SRV URI"));if(a.hostname.split(".").length<3)return n(new s("URI does not have hostname, domain name and tld"));if(a.domainLength=a.hostname.split(".").length,a.pathname&&a.pathname.match(","))return n(new s("Invalid URI, cannot contain multiple hostnames"));if(a.port)return n(new s(`Ports not accepted with '${b}' URIs`));const c=a.host;r.resolveSrv("_mongodb._tcp."+c,(e,p)=>{if(e)return n(e);if(0===p.length)return n(new s("No addresses found at host"));for(let e=0;e<p.length;e++)if(!l(p[e].name,a.hostname,a.domainLength))return n(new s("Server record does not share hostname with parent URI"));a.protocol="mongodb",a.host=p.map(e=>`${e.name}:${e.port}`).join(","),"ssl"in t||a.search&&"ssl"in a.query&&null!==a.query.ssl||(a.query.ssl=!0),r.resolveTxt(c,(e,r)=>{if(e){if("ENODATA"!==e.code)return n(e);r=null}if(r){if(r.length>1)return n(new s("Multiple text records not allowed"));if(r=o.parse(r[0].join("")),Object.keys(r).some(e=>"authSource"!==e&&"replicaSet"!==e))return n(new s("Text record must only set `authSource` or `replicaSet`"));a.query=Object.assign({},r,a.query)}a.search=o.stringify(a.query);w(i.format(a),t,(e,t)=>{e?n(e):n(null,Object.assign({},t,{srvHost:c}))})})})}(e,f,n);const m={username:null,password:null,db:d&&""!==d?o.unescape(d):null};if(f.auth?(f.auth.username&&(m.username=f.auth.username),f.auth.user&&(m.username=f.auth.user),f.auth.password&&(m.password=f.auth.password)):(f.username&&(m.username=f.username),f.user&&(m.username=f.user),f.password&&(m.password=f.password)),-1!==a[4].split("?")[0].indexOf("@"))return n(new s("Unescaped slash in userinfo section"));const v=a[3].split("@");if(v.length>2)return n(new s("Unescaped at-sign in authority section"));if(null==v[0]||""===v[0])return n(new s("No username provided in authority section"));if(v.length>1){const e=v.shift().split(":");if(e.length>2)return n(new s("Unescaped colon in authority section"));if(""===e[0])return n(new s("Invalid empty username provided"));m.username||(m.username=o.unescape(e[0])),m.password||(m.password=e[1]?o.unescape(e[1]):null)}let S=null;const _=v.shift().split(",").map(e=>{let t=i.parse("mongodb://"+e);if("/:"===t.path)return S=new s("Double colon in host identifier"),null;if(e.match(/\.sock/)&&(t.hostname=o.unescape(e),t.port=null),Number.isNaN(t.port))return void(S=new s("Invalid port (non-numeric string)"));const n={host:t.hostname,port:t.port?parseInt(t.port):27017};if(0!==n.port)if(n.port>65535)S=new s("Invalid port (larger than 65535) with hostname");else{if(!(n.port<0))return n;S=new s("Invalid port (negative number)")}else S=new s("Invalid port (zero) with hostname")}).filter(e=>!!e);if(S)return n(S);if(0===_.length||""===_[0].host||null===_[0].host)return n(new s("No hostname or hostnames provided in connection string"));if(!!f.directConnection&&1!==_.length)return n(new s("directConnection option requires exactly one host"));const T={hosts:_,auth:m.db||m.username?m:null,options:Object.keys(f).length?f:null};var E;T.auth&&T.auth.db?T.defaultDatabase=T.auth.db:T.defaultDatabase="test",T.options=((E=T.options).tls&&(E.ssl=E.tls),E.tlsInsecure?(E.checkServerIdentity=!1,E.sslValidate=!1):Object.assign(E,{checkServerIdentity:!E.tlsAllowInvalidHostnames,sslValidate:!E.tlsAllowInvalidCertificates}),E.tlsCAFile&&(E.ssl=!0,E.sslCA=E.tlsCAFile),E.tlsCertificateKeyFile&&(E.ssl=!0,E.tlsCertificateFile?(E.sslCert=E.tlsCertificateFile,E.sslKey=E.tlsCertificateKeyFile):(E.sslKey=E.tlsCertificateKeyFile,E.sslCert=E.tlsCertificateKeyFile)),E.tlsCertificateKeyFilePassword&&(E.ssl=!0,E.sslPass=E.tlsCertificateKeyFilePassword),E);try{!function(e){if(null==e.options)return;const t=e.options,n=t.authsource||t.authSource;null!=n&&(e.auth=Object.assign({},e.auth,{db:n}));const i=t.authmechanism||t.authMechanism;if(null!=i){if(g.has(i)&&(!e.auth||null==e.auth.username))throw new s(`Username required for mechanism \`${i}\``);if("GSSAPI"===i){if(null!=n&&"$external"!==n)throw new s(`Invalid source \`${n}\` for mechanism \`${i}\` specified.`);e.auth=Object.assign({},e.auth,{db:"$external"})}if("MONGODB-AWS"===i){if(null!=n&&"$external"!==n)throw new s(`Invalid source \`${n}\` for mechanism \`${i}\` specified.`);e.auth=Object.assign({},e.auth,{db:"$external"})}if("MONGODB-X509"===i){if(e.auth&&null!=e.auth.password)throw new s(`Password not allowed for mechanism \`${i}\``);if(null!=n&&"$external"!==n)throw new s(`Invalid source \`${n}\` for mechanism \`${i}\` specified.`);e.auth=Object.assign({},e.auth,{db:"$external"})}"PLAIN"===i&&e.auth&&null==e.auth.db&&(e.auth=Object.assign({},e.auth,{db:"$external"}))}e.auth&&null==e.auth.db&&(e.auth=Object.assign({},e.auth,{db:"admin"}))}(T)}catch(e){return n(e)}n(null,T)}e.exports=w},function(e,t,n){"use strict";const i=n(8).EventEmitter;e.exports=class extends i{constructor(){super()}instrument(e,t){this.$MongoClient=e;const n=this.$prototypeConnect=e.prototype.connect,i=this;e.prototype.connect=function(e){return this.s.options.monitorCommands=!0,this.on("commandStarted",e=>i.emit("started",e)),this.on("commandSucceeded",e=>i.emit("succeeded",e)),this.on("commandFailed",e=>i.emit("failed",e)),n.call(this,e)},"function"==typeof t&&t(null,this)}uninstrument(){this.$MongoClient.prototype.connect=this.$prototypeConnect}}},function(e,t,n){"use strict";const i=n(41).buildCountCommand,o=n(0).handleCallback,r=n(1).MongoError,s=Array.prototype.push,a=n(16).CursorState;function c(e,t){if(0!==e.bufferedCount())return e._next(t),c}e.exports={count:function(e,t,n,o){t&&("number"==typeof e.cursorSkip()&&(n.skip=e.cursorSkip()),"number"==typeof e.cursorLimit()&&(n.limit=e.cursorLimit())),n.readPreference&&e.setReadPreference(n.readPreference),"number"!=typeof n.maxTimeMS&&e.cmd&&"number"==typeof e.cmd.maxTimeMS&&(n.maxTimeMS=e.cmd.maxTimeMS);let r,s={};s.skip=n.skip,s.limit=n.limit,s.hint=n.hint,s.maxTimeMS=n.maxTimeMS,s.collectionName=e.namespace.collection;try{r=i(e,e.cmd.query,s)}catch(e){return o(e)}e.server=e.topology.s.coreTopology,e.topology.command(e.namespace.withCollection("$cmd"),r,e.options,(e,t)=>{o(e,t?t.result.n:null)})},each:function e(t,n){if(!n)throw r.create({message:"callback is mandatory",driver:!0});if(t.isNotified())return;if(t.s.state===a.CLOSED||t.isDead())return o(n,r.create({message:"Cursor is closed",driver:!0}));t.s.state===a.INIT&&(t.s.state=a.OPEN);let i=null;if(t.bufferedCount()>0){for(;i=c(t,n);)i(t,n);e(t,n)}else t.next((i,r)=>i?o(n,i):null==r?t.close({skipKillCursors:!0},()=>o(n,null,null)):void(!1!==o(n,null,r)&&e(t,n)))},toArray:function(e,t){const n=[];e.rewind(),e.s.state=a.INIT;const i=()=>{e._next((r,a)=>{if(r)return o(t,r);if(null==a)return e.close({skipKillCursors:!0},()=>o(t,null,n));if(n.push(a),e.bufferedCount()>0){let t=e.readBufferedDocuments(e.bufferedCount());e.s.transforms&&"function"==typeof e.s.transforms.doc&&(t=t.map(e.s.transforms.doc)),s.apply(n,t)}i()})};i()}}},function(e,t,n){"use strict";const i=n(10).buildCountCommand,o=n(3).OperationBase;e.exports=class extends o{constructor(e,t,n){super(n),this.cursor=e,this.applySkipLimit=t}execute(e){const t=this.cursor,n=this.applySkipLimit,o=this.options;n&&("number"==typeof t.cursorSkip()&&(o.skip=t.cursorSkip()),"number"==typeof t.cursorLimit()&&(o.limit=t.cursorLimit())),o.readPreference&&t.setReadPreference(o.readPreference),"number"!=typeof o.maxTimeMS&&t.cmd&&"number"==typeof t.cmd.maxTimeMS&&(o.maxTimeMS=t.cmd.maxTimeMS);let r,s={};s.skip=o.skip,s.limit=o.limit,s.hint=o.hint,s.maxTimeMS=o.maxTimeMS,s.collectionName=t.namespace.collection;try{r=i(t,t.cmd.query,s)}catch(t){return e(t)}t.server=t.topology.s.coreTopology,t.topology.command(t.namespace.withCollection("$cmd"),r,t.options,(t,n)=>{e(t,n?n.result.n:null)})}}},function(e,t,n){"use strict";const i=n(78),o=i.BulkOperationBase,r=i.Batch,s=i.bson,a=n(0).toError;function c(e,t,n){const o=s.calculateObjectSize(n,{checkKeys:!1,ignoreUndefined:!1});if(o>=e.s.maxBsonObjectSize)throw a("document is larger than the maximum size "+e.s.maxBsonObjectSize);e.s.currentBatch=null,t===i.INSERT?e.s.currentBatch=e.s.currentInsertBatch:t===i.UPDATE?e.s.currentBatch=e.s.currentUpdateBatch:t===i.REMOVE&&(e.s.currentBatch=e.s.currentRemoveBatch);const c=e.s.maxKeySize;if(null==e.s.currentBatch&&(e.s.currentBatch=new r(t,e.s.currentIndex)),(e.s.currentBatch.size+1>=e.s.maxWriteBatchSize||e.s.currentBatch.size>0&&e.s.currentBatch.sizeBytes+c+o>=e.s.maxBatchSizeBytes||e.s.currentBatch.batchType!==t)&&(e.s.batches.push(e.s.currentBatch),e.s.currentBatch=new r(t,e.s.currentIndex)),Array.isArray(n))throw a("operation passed in cannot be an Array");return e.s.currentBatch.operations.push(n),e.s.currentBatch.originalIndexes.push(e.s.currentIndex),e.s.currentIndex=e.s.currentIndex+1,t===i.INSERT?(e.s.currentInsertBatch=e.s.currentBatch,e.s.bulkResult.insertedIds.push({index:e.s.bulkResult.insertedIds.length,_id:n._id})):t===i.UPDATE?e.s.currentUpdateBatch=e.s.currentBatch:t===i.REMOVE&&(e.s.currentRemoveBatch=e.s.currentBatch),e.s.currentBatch.size+=1,e.s.currentBatch.sizeBytes+=c+o,e}class l extends o{constructor(e,t,n){n=n||{},super(e,t,n=Object.assign(n,{addToOperationsList:c}),!1)}handleWriteError(e,t){return!this.s.batches.length&&super.handleWriteError(e,t)}}function p(e,t,n){return new l(e,t,n)}p.UnorderedBulkOperation=l,e.exports=p,e.exports.Bulk=l},function(e,t,n){"use strict";const i=n(78),o=i.BulkOperationBase,r=i.Batch,s=i.bson,a=n(0).toError;function c(e,t,n){const o=s.calculateObjectSize(n,{checkKeys:!1,ignoreUndefined:!1});if(o>=e.s.maxBsonObjectSize)throw a("document is larger than the maximum size "+e.s.maxBsonObjectSize);null==e.s.currentBatch&&(e.s.currentBatch=new r(t,e.s.currentIndex));const c=e.s.maxKeySize;if((e.s.currentBatchSize+1>=e.s.maxWriteBatchSize||e.s.currentBatchSize>0&&e.s.currentBatchSizeBytes+c+o>=e.s.maxBatchSizeBytes||e.s.currentBatch.batchType!==t)&&(e.s.batches.push(e.s.currentBatch),e.s.currentBatch=new r(t,e.s.currentIndex),e.s.currentBatchSize=0,e.s.currentBatchSizeBytes=0),t===i.INSERT&&e.s.bulkResult.insertedIds.push({index:e.s.currentIndex,_id:n._id}),Array.isArray(n))throw a("operation passed in cannot be an Array");return e.s.currentBatch.originalIndexes.push(e.s.currentIndex),e.s.currentBatch.operations.push(n),e.s.currentBatchSize+=1,e.s.currentBatchSizeBytes+=c+o,e.s.currentIndex+=1,e}class l extends o{constructor(e,t,n){n=n||{},super(e,t,n=Object.assign(n,{addToOperationsList:c}),!0)}}function p(e,t,n){return new l(e,t,n)}p.OrderedBulkOperation=l,e.exports=p,e.exports.Bulk=l},function(e,t,n){"use strict";const i=n(61);e.exports=class extends i{constructor(e,t,n){const i=[{$match:t}];"number"==typeof n.skip&&i.push({$skip:n.skip}),"number"==typeof n.limit&&i.push({$limit:n.limit}),i.push({$group:{_id:1,n:{$sum:1}}}),super(e,i,n)}execute(e,t){super.execute(e,(e,n)=>{if(e)return void t(e,null);const i=n.result;if(null==i.cursor||null==i.cursor.firstBatch)return void t(null,0);const o=i.cursor.firstBatch;t(null,o.length?o[0].n:0)})}}},function(e,t,n){"use strict";const i=n(3).OperationBase,o=n(10).deleteCallback,r=n(10).removeDocuments;e.exports=class extends i{constructor(e,t,n){super(n),this.collection=e,this.filter=t}execute(e){const t=this.collection,n=this.filter,i=this.options;i.single=!1,r(t,n,i,(t,n)=>o(t,n,e))}}},function(e,t,n){"use strict";const i=n(3).OperationBase,o=n(10).deleteCallback,r=n(10).removeDocuments;e.exports=class extends i{constructor(e,t,n){super(n),this.collection=e,this.filter=t}execute(e){const t=this.collection,n=this.filter,i=this.options;i.single=!0,r(t,n,i,(t,n)=>o(t,n,e))}}},function(e,t,n){"use strict";const i=n(3).Aspect,o=n(3).defineAspects,r=n(22),s=n(0).decorateWithCollation,a=n(0).decorateWithReadConcern;class c extends r{constructor(e,t,n,i){super(e,i),this.collection=e,this.key=t,this.query=n}execute(e,t){const n=this.collection,i=this.key,o=this.query,r=this.options,c={distinct:n.collectionName,key:i,query:o};"number"==typeof r.maxTimeMS&&(c.maxTimeMS=r.maxTimeMS),a(c,n,r);try{s(c,n,r)}catch(e){return t(e,null)}super.executeCommand(e,c,(e,n)=>{e?t(e):t(null,this.options.full?n:n.values)})}}o(c,[i.READ_OPERATION,i.RETRYABLE,i.EXECUTE_WITH_SELECTION]),e.exports=c},function(e,t,n){"use strict";const i=n(3).Aspect,o=n(3).defineAspects,r=n(116),s=n(0).handleCallback;class a extends r{constructor(e,t){super(e,"*",t)}execute(e){super.execute(t=>{if(t)return s(e,t,!1);s(e,null,!0)})}}o(a,i.WRITE_OPERATION),e.exports=a},function(e,t,n){"use strict";const i=n(3).Aspect,o=n(3).defineAspects,r=n(22);class s extends r{constructor(e,t,n){void 0===n&&(n=t,t=void 0),super(e,n),this.collectionName=e.s.namespace.collection,t&&(this.query=t)}execute(e,t){const n=this.options,i={count:this.collectionName};this.query&&(i.query=this.query),"number"==typeof n.skip&&(i.skip=n.skip),"number"==typeof n.limit&&(i.limit=n.limit),n.hint&&(i.hint=n.hint),super.executeCommand(e,i,(e,n)=>{e?t(e):t(null,n.n)})}}o(s,[i.READ_OPERATION,i.RETRYABLE,i.EXECUTE_WITH_SELECTION]),e.exports=s},function(e,t,n){"use strict";const i=n(3).OperationBase,o=n(3).Aspect,r=n(3).defineAspects,s=n(1).ReadPreference,a=n(4).maxWireVersion,c=n(2).MongoError;class l extends i{constructor(e,t,n,i){super(i),this.ns=t,this.cmd=n,this.readPreference=s.resolve(e,this.options)}execute(e,t){if(this.server=e,void 0!==this.cmd.allowDiskUse&&a(e)<4)return void t(new c("The `allowDiskUse` option is not supported on MongoDB < 3.2"));const n=this.cursorState||{};e.query(this.ns.toString(),this.cmd,n,this.options,t)}}r(l,[o.READ_OPERATION,o.RETRYABLE,o.EXECUTE_WITH_SELECTION]),e.exports=l},function(e,t,n){"use strict";const i=n(0).handleCallback,o=n(3).OperationBase,r=n(0).toError;e.exports=class extends o{constructor(e,t,n){super(n),this.collection=e,this.query=t}execute(e){const t=this.collection,n=this.query,o=this.options;try{t.find(n,o).limit(-1).batchSize(1).next((t,n)=>{if(null!=t)return i(e,r(t),null);i(e,null,n)})}catch(t){e(t)}}}},function(e,t,n){"use strict";const i=n(62);e.exports=class extends i{constructor(e,t,n){const i=Object.assign({},n);if(i.fields=n.projection,i.remove=!0,null==t||"object"!=typeof t)throw new TypeError("Filter parameter must be an object");super(e,t,i.sort,null,i)}}},function(e,t,n){"use strict";const i=n(62),o=n(0).hasAtomicOperators;e.exports=class extends i{constructor(e,t,n,i){const r=Object.assign({},i);if(r.fields=i.projection,r.update=!0,r.new=void 0!==i.returnOriginal&&!i.returnOriginal,r.upsert=void 0!==i.upsert&&!!i.upsert,null==t||"object"!=typeof t)throw new TypeError("Filter parameter must be an object");if(null==n||"object"!=typeof n)throw new TypeError("Replacement parameter must be an object");if(o(n))throw new TypeError("Replacement document must not contain atomic operators");super(e,t,r.sort,n,r)}}},function(e,t,n){"use strict";const i=n(62),o=n(0).hasAtomicOperators;e.exports=class extends i{constructor(e,t,n,i){const r=Object.assign({},i);if(r.fields=i.projection,r.update=!0,r.new="boolean"==typeof i.returnOriginal&&!i.returnOriginal,r.upsert="boolean"==typeof i.upsert&&i.upsert,null==t||"object"!=typeof t)throw new TypeError("Filter parameter must be an object");if(null==n||"object"!=typeof n)throw new TypeError("Update parameter must be an object");if(!o(n))throw new TypeError("Update document requires atomic operators");super(e,t,r.sort,n,r)}}},function(e,t,n){"use strict";const i=n(3).Aspect,o=n(3).defineAspects,r=n(3).OperationBase,s=n(0).decorateCommand,a=n(0).decorateWithReadConcern,c=n(12).executeCommand,l=n(0).handleCallback,p=n(1).ReadPreference,u=n(0).toError;class d extends r{constructor(e,t,n,i){super(i),this.collection=e,this.x=t,this.y=n}execute(e){const t=this.collection,n=this.x,i=this.y;let o=this.options,r={geoSearch:t.collectionName,near:[n,i]};r=s(r,o,["readPreference","session"]),o=Object.assign({},o),o.readPreference=p.resolve(t,o),a(r,t,o),c(t.s.db,r,o,(t,n)=>{if(t)return l(e,t);(n.err||n.errmsg)&&l(e,u(n)),l(e,null,n)})}}o(d,i.READ_OPERATION),e.exports=d},function(e,t,n){"use strict";const i=n(3).OperationBase,o=n(10).indexInformation;e.exports=class extends i{constructor(e,t){super(t),this.collection=e}execute(e){const t=this.collection;let n=this.options;n=Object.assign({},{full:!0},n),o(t.s.db,t.collectionName,n,e)}}},function(e,t,n){"use strict";const i=n(3).OperationBase,o=n(0).handleCallback,r=n(12).indexInformation;e.exports=class extends i{constructor(e,t,n){super(n),this.collection=e,this.indexes=t}execute(e){const t=this.collection,n=this.indexes,i=this.options;r(t.s.db,t.collectionName,i,(t,i)=>{if(null!=t)return o(e,t,null);if(!Array.isArray(n))return o(e,null,null!=i[n]);for(let t=0;t<n.length;t++)if(null==i[n[t]])return o(e,null,!1);return o(e,null,!0)})}}},function(e,t,n){"use strict";const i=n(3).OperationBase,o=n(114),r=n(1).MongoError,s=n(10).prepareDocs;e.exports=class extends i{constructor(e,t,n){super(n),this.collection=e,this.docs=t}execute(e){const t=this.collection;let n=this.docs;const i=this.options;if(!Array.isArray(n))return e(r.create({message:"docs parameter must be an array of documents",driver:!0}));i.serializeFunctions=i.serializeFunctions||t.s.serializeFunctions,n=s(t,n,i);new o(t,[{insertMany:n}],i).execute((t,i)=>{if(t)return e(t,null);e(null,function(e,t){const n={result:{ok:1,n:t.insertedCount},ops:e,insertedCount:t.insertedCount,insertedIds:t.insertedIds};t.getLastOp()&&(n.result.opTime=t.getLastOp());return n}(n,i))})}}},function(e,t,n){"use strict";const i=n(1).MongoError,o=n(3).OperationBase,r=n(10).insertDocuments;e.exports=class extends o{constructor(e,t,n){super(n),this.collection=e,this.doc=t}execute(e){const t=this.collection,n=this.doc,o=this.options;if(Array.isArray(n))return e(i.create({message:"doc parameter must be an object",driver:!0}));r(t,[n],o,(t,i)=>{if(null!=e){if(t&&e)return e(t);if(null==i)return e(null,{result:{ok:1}});i.insertedCount=i.result.n,i.insertedId=n._id,e&&e(null,i)}})}}},function(e,t,n){"use strict";const i=n(118),o=n(0).handleCallback;e.exports=class extends i{constructor(e,t){super(e,t)}execute(e){super.execute((t,n)=>{if(t)return o(e,t);o(e,null,!(!n||!n.capped))})}}},function(e,t,n){"use strict";const i=n(22),o=n(3).Aspect,r=n(3).defineAspects,s=n(4).maxWireVersion;class a extends i{constructor(e,t){super(e,t,{fullResponse:!0}),this.collectionNamespace=e.s.namespace}execute(e,t){if(s(e)<3){const n=this.collectionNamespace.withCollection("system.indexes").toString(),i=this.collectionNamespace.toString();return void e.query(n,{query:{ns:i}},{},this.options,t)}const n=this.options.batchSize?{batchSize:this.options.batchSize}:{};super.executeCommand(e,{listIndexes:this.collectionNamespace.collection,cursor:n},t)}}r(a,[o.READ_OPERATION,o.RETRYABLE,o.EXECUTE_WITH_SELECTION]),e.exports=a},function(e,t,n){"use strict";const i=n(0).applyWriteConcern,o=n(1).BSON.Code,r=n(0).decorateWithCollation,s=n(0).decorateWithReadConcern,a=n(12).executeCommand,c=n(0).handleCallback,l=n(0).isObject,p=n(82).loadDb,u=n(3).OperationBase,d=n(1).ReadPreference,h=n(0).toError,f=["readPreference","session","bypassDocumentValidation","w","wtimeout","j","writeConcern"];function m(e){if(!l(e)||"ObjectID"===e._bsontype)return e;const t=Object.keys(e);let n;const i={};for(let r=t.length-1;r>=0;r--)n=t[r],"function"==typeof e[n]?i[n]=new o(String(e[n])):i[n]=m(e[n]);return i}e.exports=class extends u{constructor(e,t,n,i){super(i),this.collection=e,this.map=t,this.reduce=n}execute(e){const t=this.collection,n=this.map,o=this.reduce;let l=this.options;const u={mapReduce:t.collectionName,map:n,reduce:o};for(let e in l)"scope"===e?u[e]=m(l[e]):-1===f.indexOf(e)&&(u[e]=l[e]);l=Object.assign({},l),l.readPreference=d.resolve(t,l),!1!==l.readPreference&&"primary"!==l.readPreference&&l.out&&1!==l.out.inline&&"inline"!==l.out?(l.readPreference="primary",i(u,{db:t.s.db,collection:t},l)):s(u,t,l),!0===l.bypassDocumentValidation&&(u.bypassDocumentValidation=l.bypassDocumentValidation);try{r(u,t,l)}catch(t){return e(t,null)}a(t.s.db,u,l,(n,i)=>{if(n)return c(e,n);if(1!==i.ok||i.err||i.errmsg)return c(e,h(i));const o={};if(i.timeMillis&&(o.processtime=i.timeMillis),i.counts&&(o.counts=i.counts),i.timing&&(o.timing=i.timing),i.results)return null!=l.verbose&&l.verbose?c(e,null,{results:i.results,stats:o}):c(e,null,i.results);let r=null;if(null!=i.result&&"object"==typeof i.result){const e=i.result;r=new(p())(e.db,t.s.db.s.topology,t.s.db.s.options).collection(e.collection)}else r=t.s.db.collection(i.result);if(null==l.verbose||!l.verbose)return c(e,n,r);c(e,n,{collection:r,stats:o})})}}},function(e,t,n){"use strict";const i=n(3).OperationBase,o=n(0).handleCallback;let r;e.exports=class extends i{constructor(e,t){super(t),this.db=e}execute(e){const t=this.db;let i=this.options,s=(r||(r=n(42)),r);i=Object.assign({},i,{nameOnly:!0}),t.listCollections({},i).toArray((n,i)=>{if(null!=n)return o(e,n,null);i=i.filter(e=>-1===e.name.indexOf("$")),o(e,null,i.map(e=>new s(t,t.s.topology,t.databaseName,e.name,t.s.pkFactory,t.s.options)))})}}},function(e,t,n){"use strict";const i=n(22),o=n(3).defineAspects,r=n(3).Aspect;class s extends i{constructor(e,t,n){super(e,n),this.command=t}execute(e,t){const n=this.command;this.executeCommand(e,n,t)}}o(s,[r.EXECUTE_WITH_SELECTION,r.NO_INHERIT_OPTIONS]),e.exports=s},function(e,t,n){"use strict";const i=n(3).Aspect,o=n(3).defineAspects,r=n(20),s=n(0).applyWriteConcern,a=n(82).loadCollection,c=n(1).MongoError,l=n(1).ReadPreference,p=new Set(["w","wtimeout","j","fsync","autoIndexId","strict","serializeFunctions","pkFactory","raw","readPreference","session","readConcern","writeConcern"]);class u extends r{constructor(e,t,n){super(e,n),this.name=t}_buildCommand(){const e=this.name,t=this.options,n={create:e};for(let e in t)null==t[e]||"function"==typeof t[e]||p.has(e)||(n[e]=t[e]);return n}execute(e){const t=this.db,n=this.name,i=this.options,o=a();let r=Object.assign({nameOnly:!0,strict:!1},i);function p(r){if(r)return e(r);try{e(null,new o(t,t.s.topology,t.databaseName,n,t.s.pkFactory,i))}catch(r){e(r)}}r=s(r,{db:t},r);r.strict?t.listCollections({name:n},r).setReadPreference(l.PRIMARY).toArray((t,i)=>t?e(t):i.length>0?e(new c(`Collection ${n} already exists. Currently in strict mode.`)):void super.execute(p)):super.execute(p)}}o(u,i.WRITE_OPERATION),e.exports=u},function(e,t,n){"use strict";const i=n(22),o=n(3).Aspect,r=n(3).defineAspects,s=n(4).maxWireVersion,a=n(77);class c extends i{constructor(e,t,n){super(e,n,{fullResponse:!0}),this.db=e,this.filter=t,this.nameOnly=!!this.options.nameOnly,"number"==typeof this.options.batchSize&&(this.batchSize=this.options.batchSize)}execute(e,t){if(s(e)<3){let n=this.filter;const i=this.db.s.namespace.db;"string"!=typeof n.name||new RegExp("^"+i+"\\.").test(n.name)||(n=Object.assign({},n),n.name=this.db.s.namespace.withCollection(n.name).toString()),null==n&&(n.name=`/${i}/`),n=n.name?{$and:[{name:n.name},{name:/^((?!\$).)*$/}]}:{name:/^((?!\$).)*$/};const o=function(e){const t=e+".";return{doc:e=>{const n=e.name.indexOf(t);return e.name&&0===n&&(e.name=e.name.substr(n+t.length)),e}}}(i);return void e.query(`${i}.${a.SYSTEM_NAMESPACE_COLLECTION}`,{query:n},{batchSize:this.batchSize||1e3},{},(e,n)=>{n&&n.message&&n.message.documents&&Array.isArray(n.message.documents)&&(n.message.documents=n.message.documents.map(o.doc)),t(e,n)})}const n={listCollections:1,filter:this.filter,cursor:this.batchSize?{batchSize:this.batchSize}:{},nameOnly:this.nameOnly};return super.executeCommand(e,n,t)}}r(c,[o.READ_OPERATION,o.RETRYABLE,o.EXECUTE_WITH_SELECTION]),e.exports=c},function(e,t,n){"use strict";const i=n(20);e.exports=class extends i{constructor(e,t,n){super(e,n)}_buildCommand(){return{profile:-1}}execute(e){super.execute((t,n)=>{if(null==t&&1===n.ok){const t=n.was;return 0===t?e(null,"off"):1===t?e(null,"slow_only"):2===t?e(null,"all"):e(new Error("Error: illegal profiling level value "+t),null)}e(null!=t?t:new Error("Error with profile command"),null)})}}},function(e,t,n){"use strict";const i=n(20),o=new Set(["off","slow_only","all"]);e.exports=class extends i{constructor(e,t,n){let i=0;"off"===t?i=0:"slow_only"===t?i=1:"all"===t&&(i=2),super(e,n),this.level=t,this.profile=i}_buildCommand(){return{profile:this.profile}}execute(e){const t=this.level;if(!o.has(t))return e(new Error("Error: illegal profiling level value "+t));super.execute((n,i)=>null==n&&1===i.ok?e(null,t):e(null!=n?n:new Error("Error with profile command"),null))}}},function(e,t,n){"use strict";const i=n(20);e.exports=class extends i{constructor(e,t,n){let i={validate:t};const o=Object.keys(n);for(let e=0;e<o.length;e++)Object.prototype.hasOwnProperty.call(n,o[e])&&"session"!==o[e]&&(i[o[e]]=n[o[e]]);super(e.s.db,n,null,i),this.collectionName=t}execute(e){const t=this.collectionName;super.execute((n,i)=>null!=n?e(n,null):0===i.ok?e(new Error("Error with validate command"),null):null!=i.result&&i.result.constructor!==String?e(new Error("Error with validation data"),null):null!=i.result&&null!=i.result.match(/exception|corrupt/)?e(new Error("Error: invalid collection "+t),null):null==i.valid||i.valid?e(null,i):e(new Error("Error: invalid collection "+t),null))}}},function(e,t,n){"use strict";const i=n(22),o=n(3).Aspect,r=n(3).defineAspects,s=n(0).MongoDBNamespace;class a extends i{constructor(e,t){super(e,t),this.ns=new s("admin","$cmd")}execute(e,t){const n={listDatabases:1};this.options.nameOnly&&(n.nameOnly=Number(n.nameOnly)),this.options.filter&&(n.filter=this.options.filter),"boolean"==typeof this.options.authorizedDatabases&&(n.authorizedDatabases=this.options.authorizedDatabases),super.executeCommand(e,n,t)}}r(a,[o.READ_OPERATION,o.RETRYABLE,o.EXECUTE_WITH_SELECTION]),e.exports=a},function(e,t,n){"use strict";const i=n(3).Aspect,o=n(3).defineAspects,r=n(22),s=n(13).serverType,a=n(13).ServerType,c=n(1).MongoError;class l extends r{constructor(e,t){super(e,t),this.collectionName=e.collectionName}execute(e,t){s(e)===a.Standalone?super.executeCommand(e,{reIndex:this.collectionName},(e,n)=>{e?t(e):t(null,!!n.ok)}):t(new c("reIndex can only be executed on standalone servers."))}}o(l,[i.EXECUTE_WITH_SELECTION]),e.exports=l},function(e,t,n){"use strict";const i=n(3).OperationBase,o=n(10).updateDocuments,r=n(0).hasAtomicOperators;e.exports=class extends i{constructor(e,t,n,i){if(super(i),r(n))throw new TypeError("Replacement document must not contain atomic operators");this.collection=e,this.filter=t,this.replacement=n}execute(e){const t=this.collection,n=this.filter,i=this.replacement,r=this.options;r.multi=!1,o(t,n,i,r,(t,n)=>function(e,t,n,i){if(null==i)return;if(e&&i)return i(e);if(null==t)return i(null,{result:{ok:1}});t.modifiedCount=null!=t.result.nModified?t.result.nModified:t.result.n,t.upsertedId=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?t.result.upserted[0]:null,t.upsertedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length?t.result.upserted.length:0,t.matchedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?0:t.result.n,t.ops=[n],i&&i(null,t)}(t,n,i,e))}}},function(e,t,n){"use strict";const i=n(3).Aspect,o=n(20),r=n(3).defineAspects;class s extends o{constructor(e,t){super(e.s.db,t,e)}_buildCommand(){const e=this.collection,t=this.options,n={collStats:e.collectionName};return null!=t.scale&&(n.scale=t.scale),n}}r(s,i.READ_OPERATION),e.exports=s},function(e,t,n){"use strict";const i=n(3).OperationBase,o=n(10).updateCallback,r=n(10).updateDocuments,s=n(0).hasAtomicOperators;e.exports=class extends i{constructor(e,t,n,i){if(super(i),!s(n))throw new TypeError("Update document requires atomic operators");this.collection=e,this.filter=t,this.update=n}execute(e){const t=this.collection,n=this.filter,i=this.update,s=this.options;s.multi=!0,r(t,n,i,s,(t,n)=>o(t,n,e))}}},function(e,t,n){"use strict";const i=n(3).OperationBase,o=n(10).updateDocuments,r=n(0).hasAtomicOperators;e.exports=class extends i{constructor(e,t,n,i){if(super(i),!r(n))throw new TypeError("Update document requires atomic operators");this.collection=e,this.filter=t,this.update=n}execute(e){const t=this.collection,n=this.filter,i=this.update,r=this.options;r.multi=!1,o(t,n,i,r,(t,n)=>function(e,t,n){if(null==n)return;if(e)return n(e);if(null==t)return n(null,{result:{ok:1}});t.modifiedCount=null!=t.result.nModified?t.result.nModified:t.result.n,t.upsertedId=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?t.result.upserted[0]:null,t.upsertedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length?t.result.upserted.length:0,t.matchedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?0:t.result.n,n(null,t)}(t,n,e))}}},function(e,t,n){"use strict";const i=n(1).ReadPreference,o=n(34),r=n(5).format,s=n(1).Logger,a=n(45),c=n(32);function l(e,t){let n=/^.*?\./,i="."+e.replace(n,""),o="."+t.replace(n,"");return!!i.endsWith(o)}function p(e,t,n){let a,l;try{a=function(e,t){let n="",a="",l="",p="admin",u=o.parse(e,!0);if((null==u.hostname||""===u.hostname)&&-1===e.indexOf(".sock"))throw new Error("No hostname or hostnames provided in connection string");if("0"===u.port)throw new Error("Invalid port (zero) with hostname");if(!isNaN(parseInt(u.port,10))&&parseInt(u.port,10)>65535)throw new Error("Invalid port (larger than 65535) with hostname");if(u.path&&u.path.length>0&&"/"!==u.path[0]&&-1===e.indexOf(".sock"))throw new Error("Missing delimiting slash between hosts and options");if(u.query)for(let e in u.query){if(-1!==e.indexOf("::"))throw new Error("Double colon in host identifier");if(""===u.query[e])throw new Error("Query parameter "+e+" is an incomplete value pair")}if(u.auth){let t=u.auth.split(":");if(-1!==e.indexOf(u.auth)&&t.length>2)throw new Error("Username with password containing an unescaped colon");if(-1!==e.indexOf(u.auth)&&-1!==u.auth.indexOf("@"))throw new Error("Username containing an unescaped at-sign")}let d=e.split("?").shift().split(","),h=[];for(let e=0;e<d.length;e++){let t=d[e];-1!==t.indexOf("mongodb")?-1!==t.indexOf("@")?h.push(t.split("@").pop()):h.push(t.substr("mongodb://".length)):-1!==t.indexOf("/")?h.push(t.split("/").shift()):-1===t.indexOf("/")&&h.push(t.trim())}for(let e=0;e<h.length;e++){let t=o.parse(r("mongodb://%s",h[e].trim()));if((!t.path||-1===t.path.indexOf(".sock"))&&(t.path&&-1!==t.path.indexOf(":")))throw t.path.split("/").length>1&&-1===t.path.indexOf("::")?new Error("Slash in host identifier"):new Error("Double colon in host identifier")}-1!==e.indexOf("?")?(l=e.substr(e.indexOf("?")+1),n=e.substring("mongodb://".length,e.indexOf("?"))):n=e.substring("mongodb://".length);-1!==n.indexOf("@")&&(a=n.split("@")[0],n=n.split("@")[1]);if(n.split("/").length>2)throw new Error("Unsupported host '"+n.split("?")[0]+"', hosts must be URL encoded and contain at most one unencoded slash");if(-1!==n.indexOf(".sock")){if(-1!==n.indexOf(".sock/")){if(p=n.split(".sock/")[1],-1!==p.indexOf("/")){if(2===p.split("/").length&&0===p.split("/")[1].length)throw new Error("Illegal trailing backslash after database name");throw new Error("More than 1 database name in URL")}n=n.split("/",n.indexOf(".sock")+".sock".length)}}else if(-1!==n.indexOf("/")){if(n.split("/").length>2){if(0===n.split("/")[2].length)throw new Error("Illegal trailing backslash after database name");throw new Error("More than 1 database name in URL")}p=n.split("/")[1],n=n.split("/")[0]}n=decodeURIComponent(n);let f,m,g,y,v={},b=a||"",x=b.split(":",2),w=decodeURIComponent(x[0]);if(x[0]!==encodeURIComponent(w))throw new Error("Username contains an illegal unescaped character");if(x[0]=w,x[1]){let e=decodeURIComponent(x[1]);if(x[1]!==encodeURIComponent(e))throw new Error("Password contains an illegal unescaped character");x[1]=e}2===x.length&&(v.auth={user:x[0],password:x[1]});t&&null!=t.auth&&(v.auth=t.auth);let S={socketOptions:{}},_={read_preference_tags:[]},T={socketOptions:{}},E={socketOptions:{}};if(v.server_options=S,v.db_options=_,v.rs_options=T,v.mongos_options=E,e.match(/\.sock/)){let t=e.substring(e.indexOf("mongodb://")+"mongodb://".length,e.lastIndexOf(".sock")+".sock".length);-1!==t.indexOf("@")&&(t=t.split("@")[1]),t=decodeURIComponent(t),g=[{domain_socket:t}]}else{f=n;let e={};g=f.split(",").map((function(t){let n,i,o;if(o=/\[([^\]]+)\](?::(.+))?/.exec(t))n=o[1],i=parseInt(o[2],10)||27017;else{let e=t.split(":",2);n=e[0]||"localhost",i=null!=e[1]?parseInt(e[1],10):27017,-1!==n.indexOf("?")&&(n=n.split(/\?/)[0])}return e[n+"_"+i]?null:(e[n+"_"+i]=1,{host:n,port:i})})).filter((function(e){return null!=e}))}v.dbName=p||"admin",m=(l||"").split(/[&;]/),m.forEach((function(e){if(e){var t=e.split("="),n=t[0],o=t[1];switch(n){case"slaveOk":case"slave_ok":S.slave_ok="true"===o,_.slaveOk="true"===o;break;case"maxPoolSize":case"poolSize":S.poolSize=parseInt(o,10),T.poolSize=parseInt(o,10);break;case"appname":v.appname=decodeURIComponent(o);break;case"autoReconnect":case"auto_reconnect":S.auto_reconnect="true"===o;break;case"ssl":if("prefer"===o){S.ssl=o,T.ssl=o,E.ssl=o;break}S.ssl="true"===o,T.ssl="true"===o,E.ssl="true"===o;break;case"sslValidate":S.sslValidate="true"===o,T.sslValidate="true"===o,E.sslValidate="true"===o;break;case"replicaSet":case"rs_name":T.rs_name=o;break;case"reconnectWait":T.reconnectWait=parseInt(o,10);break;case"retries":T.retries=parseInt(o,10);break;case"readSecondary":case"read_secondary":T.read_secondary="true"===o;break;case"fsync":_.fsync="true"===o;break;case"journal":_.j="true"===o;break;case"safe":_.safe="true"===o;break;case"nativeParser":case"native_parser":_.native_parser="true"===o;break;case"readConcernLevel":_.readConcern=new c(o);break;case"connectTimeoutMS":S.socketOptions.connectTimeoutMS=parseInt(o,10),T.socketOptions.connectTimeoutMS=parseInt(o,10),E.socketOptions.connectTimeoutMS=parseInt(o,10);break;case"socketTimeoutMS":S.socketOptions.socketTimeoutMS=parseInt(o,10),T.socketOptions.socketTimeoutMS=parseInt(o,10),E.socketOptions.socketTimeoutMS=parseInt(o,10);break;case"w":_.w=parseInt(o,10),isNaN(_.w)&&(_.w=o);break;case"authSource":_.authSource=o;break;case"gssapiServiceName":_.gssapiServiceName=o;break;case"authMechanism":if("GSSAPI"===o)if(null==v.auth){let e=decodeURIComponent(b);if(-1===e.indexOf("@"))throw new Error("GSSAPI requires a provided principal");v.auth={user:e,password:null}}else v.auth.user=decodeURIComponent(v.auth.user);else"MONGODB-X509"===o&&(v.auth={user:decodeURIComponent(b)});if("GSSAPI"!==o&&"MONGODB-X509"!==o&&"MONGODB-CR"!==o&&"DEFAULT"!==o&&"SCRAM-SHA-1"!==o&&"SCRAM-SHA-256"!==o&&"PLAIN"!==o)throw new Error("Only DEFAULT, GSSAPI, PLAIN, MONGODB-X509, or SCRAM-SHA-1 is supported by authMechanism");_.authMechanism=o;break;case"authMechanismProperties":{let e=o.split(","),t={};e.forEach((function(e){let n=e.split(":");t[n[0]]=n[1]})),_.authMechanismProperties=t,"string"==typeof t.SERVICE_NAME&&(_.gssapiServiceName=t.SERVICE_NAME),"string"==typeof t.SERVICE_REALM&&(_.gssapiServiceRealm=t.SERVICE_REALM),"string"==typeof t.CANONICALIZE_HOST_NAME&&(_.gssapiCanonicalizeHostName="true"===t.CANONICALIZE_HOST_NAME)}break;case"wtimeoutMS":_.wtimeout=parseInt(o,10);break;case"readPreference":if(!i.isValid(o))throw new Error("readPreference must be either primary/primaryPreferred/secondary/secondaryPreferred/nearest");_.readPreference=o;break;case"maxStalenessSeconds":_.maxStalenessSeconds=parseInt(o,10);break;case"readPreferenceTags":{let e={};if(null==(o=decodeURIComponent(o))||""===o){_.read_preference_tags.push(e);break}let t=o.split(/,/);for(let n=0;n<t.length;n++){let i=t[n].trim().split(/:/);e[i[0]]=i[1]}_.read_preference_tags.push(e)}break;case"compressors":{y=S.compression||{};let e=o.split(",");if(!e.every((function(e){return"snappy"===e||"zlib"===e})))throw new Error("Compressors must be at least one of snappy or zlib");y.compressors=e,S.compression=y}break;case"zlibCompressionLevel":{y=S.compression||{};let e=parseInt(o,10);if(e<-1||e>9)throw new Error("zlibCompressionLevel must be an integer between -1 and 9");y.zlibCompressionLevel=e,S.compression=y}break;case"retryWrites":_.retryWrites="true"===o;break;case"minSize":_.minSize=parseInt(o,10);break;default:s("URL Parser").warn(n+" is not supported as a connection string option")}}})),0===_.read_preference_tags.length&&(_.read_preference_tags=null);if(!(-1!==_.w&&0!==_.w||!0!==_.journal&&!0!==_.fsync&&!0!==_.safe))throw new Error("w set to -1 or 0 cannot be combined with safe/w/journal/fsync");_.readPreference||(_.readPreference="primary");return _=Object.assign(_,t),v.servers=g,v}(e,t)}catch(e){l=e}return l?n(l,null):n(null,a)}e.exports=function(e,t,n){let i;"function"==typeof t&&(n=t,t={}),t=t||{};try{i=o.parse(e,!0)}catch(e){return n(new Error("URL malformed, cannot be parsed"))}if("mongodb:"!==i.protocol&&"mongodb+srv:"!==i.protocol)return n(new Error("Invalid schema, expected `mongodb` or `mongodb+srv`"));if("mongodb:"===i.protocol)return p(e,t,n);if(i.hostname.split(".").length<3)return n(new Error("URI does not have hostname, domain name and tld"));if(i.domainLength=i.hostname.split(".").length,i.pathname&&i.pathname.match(","))return n(new Error("Invalid URI, cannot contain multiple hostnames"));if(i.port)return n(new Error("Ports not accepted with `mongodb+srv` URIs"));let r="_mongodb._tcp."+i.host;a.resolveSrv(r,(function(e,o){if(e)return n(e);if(0===o.length)return n(new Error("No addresses found at host"));for(let e=0;e<o.length;e++)if(!l(o[e].name,i.hostname,i.domainLength))return n(new Error("Server record does not share hostname with parent URI"));let r=i.auth?`mongodb://${i.auth}@`:"mongodb://",s=o.map((function(e,t){return 0===t?`${r}${e.name}:${e.port}`:`${e.name}:${e.port}`})).join(",")+"/",c=[];if(i.path){let e=i.path.slice(1);-1!==e.indexOf("?")&&(e=e.slice(0,e.indexOf("?"))),s+=e}(t.ssl||i.search)&&(t.ssl||!i.search||i.search.match("ssl"))||c.push("ssl=true"),i.search&&c.push(i.search.replace("?","")),a.resolveTxt(i.host,(function(e,i){if(e&&"ENODATA"!==e.code)return n(e);if(e&&"ENODATA"===e.code&&(i=null),i){if(i.length>1)return n(new Error("Multiple text records not allowed"));if(!(i=(i=i[0]).length>1?i.join(""):i[0]).includes("authSource")&&!i.includes("replicaSet"))return n(new Error("Text record must only set `authSource` or `replicaSet`"));c.push(i)}c.length&&(s+="?"+c.join("&")),p(s,t,n)}))}))}},function(e,t,n){"use strict";const i=n(128),o=n(1).BSON.ObjectID,r=n(1).ReadPreference,s=n(19).Buffer,a=n(44),c=n(5).format,l=n(5),p=n(1).MongoError,u=l.inherits,d=n(14).Duplex,h=n(0).shallowClone,f=n(0).executeLegacyOperation,m=n(5).deprecate;const g=m(()=>{},"GridStore is deprecated, and will be removed in a future version. Please use GridFSBucket instead");var y=function e(t,n,s,a,c){if(g(),!(this instanceof e))return new e(t,n,s,a,c);this.db=t,void 0===c&&(c={}),void 0===a?(a=s,s=void 0):"object"==typeof a&&(c=a,a=s,s=void 0),n&&"ObjectID"===n._bsontype?(this.referenceBy=1,this.fileId=n,this.filename=s):void 0===s?(this.referenceBy=0,this.filename=n,null!=a.indexOf("w")&&(this.fileId=new o)):(this.referenceBy=1,this.fileId=n,this.filename=s),this.mode=null==a?"r":a,this.options=c||{},this.isOpen=!1,this.root=null==this.options.root?e.DEFAULT_ROOT_COLLECTION:this.options.root,this.position=0,this.readPreference=this.options.readPreference||t.options.readPreference||r.primary,this.writeConcern=U(t,this.options),this.internalChunkSize=null==this.options.chunkSize?i.DEFAULT_CHUNK_SIZE:this.options.chunkSize;var l=this.options.promiseLibrary||Promise;this.promiseLibrary=l,Object.defineProperty(this,"chunkSize",{enumerable:!0,get:function(){return this.internalChunkSize},set:function(e){"w"!==this.mode[0]||0!==this.position||null!=this.uploadDate?this.internalChunkSize=this.internalChunkSize:this.internalChunkSize=e}}),Object.defineProperty(this,"md5",{enumerable:!0,get:function(){return this.internalMd5}}),Object.defineProperty(this,"chunkNumber",{enumerable:!0,get:function(){return this.currentChunk&&this.currentChunk.chunkNumber?this.currentChunk.chunkNumber:null}})};y.prototype.open=function(e,t){if("function"==typeof e&&(t=e,e={}),e=e||{},"w"!==this.mode&&"w+"!==this.mode&&"r"!==this.mode)throw p.create({message:"Illegal mode "+this.mode,driver:!0});return f(this.db.s.topology,v,[this,e,t],{skipSessions:!0})};var v=function(e,t,n){var i=U(e.db,e.options);"w"===e.mode||"w+"===e.mode?e.collection().ensureIndex([["filename",1]],i,(function(){var t=e.chunkCollection(),o=h(i);o.unique=!0,t.ensureIndex([["files_id",1],["n",1]],o,(function(){k(e,i,(function(t,i){if(t)return n(t);e.isOpen=!0,n(t,i)}))}))})):k(e,i,(function(t,i){if(t)return n(t);e.isOpen=!0,n(t,i)}))};y.prototype.eof=function(){return this.position===this.length},y.prototype.getc=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},f(this.db.s.topology,b,[this,e,t],{skipSessions:!0})};var b=function(e,t,n){e.eof()?n(null,null):e.currentChunk.eof()?I(e,e.currentChunk.chunkNumber+1,(function(t,i){e.currentChunk=i,e.position=e.position+1,n(t,e.currentChunk.getc())})):(e.position=e.position+1,n(null,e.currentChunk.getc()))};y.prototype.puts=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||{};var i=null==e.match(/\n$/)?e+"\n":e;return f(this.db.s.topology,this.write.bind(this),[i,t,n],{skipSessions:!0})},y.prototype.stream=function(){return new q(this)},y.prototype.write=function(e,t,n,i){return"function"==typeof n&&(i=n,n={}),n=n||{},f(this.db.s.topology,j,[this,e,t,n,i],{skipSessions:!0})},y.prototype.destroy=function(){this.writable&&(this.readable=!1,this.writable&&(this.writable=!1,this._q.length=0,this.emit("close")))},y.prototype.writeFile=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},f(this.db.s.topology,x,[this,e,t,n],{skipSessions:!0})};var x=function(e,t,n,o){"string"!=typeof t?e.open((function(e,n){if(e)return o(e,n);a.fstat(t,(function(e,r){if(e)return o(e,n);var c=0,l=0,p=function(){var e=s.alloc(n.chunkSize);a.read(t,e,0,e.length,c,(function(e,s,u){if(e)return o(e,n);c+=s,new i(n,{n:l++},n.writeConcern).write(u.slice(0,s),(function(e,i){if(e)return o(e,n);i.save({},(function(e){return e?o(e,n):(n.position=n.position+s,n.currentChunk=i,c>=r.size?void a.close(t,(function(e){if(e)return o(e);n.close((function(e){return o(e||null,n)}))})):process.nextTick(p))}))}))}))};process.nextTick(p)}))})):a.open(t,"r",(function(t,n){if(t)return o(t);e.writeFile(n,o)}))};y.prototype.close=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},f(this.db.s.topology,w,[this,e,t],{skipSessions:!0})};var w=function(e,t,n){"w"===e.mode[0]?(t=Object.assign({},e.writeConcern,t),null!=e.currentChunk&&e.currentChunk.position>0?e.currentChunk.save({},(function(i){if(i&&"function"==typeof n)return n(i);e.collection((function(i,o){if(i&&"function"==typeof n)return n(i);null!=e.uploadDate||(e.uploadDate=new Date),A(e,(function(e,i){if(e){if("function"==typeof n)return n(e);throw e}o.save(i,t,(function(e){"function"==typeof n&&n(e,i)}))}))}))})):e.collection((function(i,o){if(i&&"function"==typeof n)return n(i);e.uploadDate=new Date,A(e,(function(e,i){if(e){if("function"==typeof n)return n(e);throw e}o.save(i,t,(function(e){"function"==typeof n&&n(e,i)}))}))}))):"r"===e.mode[0]?"function"==typeof n&&n(null,null):"function"==typeof n&&n(p.create({message:c("Illegal mode %s",e.mode),driver:!0}))};y.prototype.chunkCollection=function(e){return"function"==typeof e?this.db.collection(this.root+".chunks",e):this.db.collection(this.root+".chunks")},y.prototype.unlink=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},f(this.db.s.topology,S,[this,e,t],{skipSessions:!0})};var S=function(e,t,n){M(e,(function(t){if(null!==t)return t.message="at deleteChunks: "+t.message,n(t);e.collection((function(t,i){if(null!==t)return t.message="at collection: "+t.message,n(t);i.remove({_id:e.fileId},e.writeConcern,(function(t){n(t,e)}))}))}))};y.prototype.collection=function(e){return"function"==typeof e&&this.db.collection(this.root+".files",e),this.db.collection(this.root+".files")},y.prototype.readlines=function(e,t,n){var i=Array.prototype.slice.call(arguments,0);return n="function"==typeof i[i.length-1]?i.pop():void 0,e=(e=i.length?i.shift():"\n")||"\n",t=i.length?i.shift():{},f(this.db.s.topology,_,[this,e,t,n],{skipSessions:!0})};var _=function(e,t,n,i){e.read((function(e,n){if(e)return i(e);var o=n.toString().split(t);o=o.length>0?o.splice(0,o.length-1):[];for(var r=0;r<o.length;r++)o[r]=o[r]+t;i(null,o)}))};y.prototype.rewind=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},f(this.db.s.topology,T,[this,e,t],{skipSessions:!0})};var T=function(e,t,n){0!==e.currentChunk.chunkNumber?"w"===e.mode[0]?M(e,(function(t){if(t)return n(t);e.currentChunk=new i(e,{n:0},e.writeConcern),e.position=0,n(null,e)})):e.currentChunk(0,(function(t,i){if(t)return n(t);e.currentChunk=i,e.currentChunk.rewind(),e.position=0,n(null,e)})):(e.currentChunk.rewind(),e.position=0,n(null,e))};y.prototype.read=function(e,t,n,i){var o=Array.prototype.slice.call(arguments,0);return i="function"==typeof o[o.length-1]?o.pop():void 0,e=o.length?o.shift():null,t=o.length?o.shift():null,n=o.length?o.shift():{},f(this.db.s.topology,E,[this,e,t,n,i],{skipSessions:!0})};var E=function(e,t,n,i,o){var r=null==t?e.length-e.position:t,a=null==n?s.alloc(r):n;if(a._index=null!=n&&null!=n._index?n._index:0,e.currentChunk.length()-e.currentChunk.position+a._index>=r){var c=e.currentChunk.readSlice(r-a._index);return c.copy(a,a._index),e.position=e.position+a.length,0===r&&0===a.length?o(p.create({message:"File does not exist",driver:!0}),null):o(null,a)}(c=e.currentChunk.readSlice(e.currentChunk.length()-e.currentChunk.position)).copy(a,a._index),a._index+=c.length,I(e,e.currentChunk.chunkNumber+1,(function(n,i){if(n)return o(n);i.length()>0?(e.currentChunk=i,e.read(t,a,o)):a._index>0?o(null,a):o(p.create({message:"no chunks found for file, possibly corrupt",driver:!0}),null)}))};y.prototype.tell=function(e){var t=this;return"function"==typeof e?e(null,this.position):new t.promiseLibrary((function(e){e(t.position)}))},y.prototype.seek=function(e,t,n,i){var o=Array.prototype.slice.call(arguments,1);return i="function"==typeof o[o.length-1]?o.pop():void 0,t=o.length?o.shift():null,n=o.length?o.shift():{},f(this.db.s.topology,O,[this,e,t,n,i],{skipSessions:!0})};var O=function(e,t,n,i,o){if("r"!==e.mode)return o(p.create({message:"seek is only supported for mode r",driver:!0}));var r=null==n?y.IO_SEEK_SET:n,s=t,a=0;a=r===y.IO_SEEK_CUR?e.position+s:r===y.IO_SEEK_END?e.length+s:s;var c=Math.floor(a/e.chunkSize);I(e,c,(function(t,n){return t?o(t,null):null==n?o(new Error("no chunk found")):(e.currentChunk=n,e.position=a,e.currentChunk.position=e.position%e.chunkSize,void o(t,e))}))},k=function(e,t,n){var r=e.collection(),s=1===e.referenceBy?{_id:e.fileId}:{filename:e.filename};function a(e){a.err||n(a.err=e)}s=null==e.fileId&&null==e.filename?null:s,t.readPreference=e.readPreference,null!=s?r.findOne(s,t,(function(r,s){if(r)return a(r);if(null!=s)e.fileId=s._id,e.filename="r"===e.mode||void 0===e.filename?s.filename:e.filename,e.contentType=s.contentType,e.internalChunkSize=s.chunkSize,e.uploadDate=s.uploadDate,e.aliases=s.aliases,e.length=s.length,e.metadata=s.metadata,e.internalMd5=s.md5;else{if("r"===e.mode){e.length=0;var l="ObjectID"===e.fileId._bsontype?e.fileId.toHexString():e.fileId;return a(p.create({message:c("file with id %s not opened for writing",1===e.referenceBy?l:e.filename),driver:!0}))}e.fileId=null==e.fileId?new o:e.fileId,e.contentType=y.DEFAULT_CONTENT_TYPE,e.internalChunkSize=null==e.internalChunkSize?i.DEFAULT_CHUNK_SIZE:e.internalChunkSize,e.length=0}"r"===e.mode?I(e,0,t,(function(t,i){if(t)return a(t);e.currentChunk=i,e.position=0,n(null,e)})):"w"===e.mode&&s?M(e,t,(function(t){if(t)return a(t);e.currentChunk=new i(e,{n:0},e.writeConcern),e.contentType=null==e.options.content_type?e.contentType:e.options.content_type,e.internalChunkSize=null==e.options.chunk_size?e.internalChunkSize:e.options.chunk_size,e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=0,n(null,e)})):"w"===e.mode?(e.currentChunk=new i(e,{n:0},e.writeConcern),e.contentType=null==e.options.content_type?e.contentType:e.options.content_type,e.internalChunkSize=null==e.options.chunk_size?e.internalChunkSize:e.options.chunk_size,e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=0,n(null,e)):"w+"===e.mode&&I(e,N(e),t,(function(t,o){if(t)return a(t);e.currentChunk=null==o?new i(e,{n:0},e.writeConcern):o,e.currentChunk.position=e.currentChunk.data.length(),e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=e.length,n(null,e)}))})):(e.fileId=null==e.fileId?new o:e.fileId,e.contentType=y.DEFAULT_CONTENT_TYPE,e.internalChunkSize=null==e.internalChunkSize?i.DEFAULT_CHUNK_SIZE:e.internalChunkSize,e.length=0,"w"===e.mode?M(e,t,(function(t){if(t)return a(t);e.currentChunk=new i(e,{n:0},e.writeConcern),e.contentType=null==e.options.content_type?e.contentType:e.options.content_type,e.internalChunkSize=null==e.options.chunk_size?e.internalChunkSize:e.options.chunk_size,e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=0,n(null,e)})):"w+"===e.mode&&I(e,N(e),t,(function(t,o){if(t)return a(t);e.currentChunk=null==o?new i(e,{n:0},e.writeConcern):o,e.currentChunk.position=e.currentChunk.data.length(),e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=e.length,n(null,e)})))},C=function(e,t,n,o){"function"==typeof n&&(o=n,n=null);var r="boolean"==typeof n&&n;if("w"!==e.mode)o(p.create({message:c("file with id %s not opened for writing",1===e.referenceBy?e.referenceBy:e.filename),driver:!0}),null);else{if(!(e.currentChunk.position+t.length>=e.chunkSize))return e.position=e.position+t.length,e.currentChunk.write(t),r?e.close((function(t){o(t,e)})):o(null,e);for(var s=e.currentChunk.chunkNumber,a=e.chunkSize-e.currentChunk.position,l=t.slice(0,a),u=t.slice(a),d=[e.currentChunk.write(l)];u.length>=e.chunkSize;){var h=new i(e,{n:s+1},e.writeConcern);l=u.slice(0,e.chunkSize),u=u.slice(e.chunkSize),s+=1,h.write(l),d.push(h)}e.currentChunk=new i(e,{n:s+1},e.writeConcern),u.length>0&&e.currentChunk.write(u),e.position=e.position+t.length;for(var f=d.length,m=0;m<d.length;m++)d[m].save({},(function(t){return t?o(t):(f-=1)<=0?r?e.close((function(t){o(t,e)})):o(null,e):void 0}))}},A=function(e,t){var n={_id:e.fileId,filename:e.filename,contentType:e.contentType,length:e.position?e.position:0,chunkSize:e.chunkSize,uploadDate:e.uploadDate,aliases:e.aliases,metadata:e.metadata},i={filemd5:e.fileId,root:e.root};e.db.command(i,(function(e,i){if(e)return t(e);n.md5=i.md5,t(null,n)}))},I=function(e,t,n,o){"function"==typeof n&&(o=n,n={}),(n=n||e.writeConcern).readPreference=e.readPreference,e.chunkCollection().findOne({files_id:e.fileId,n:t},n,(function(t,n){if(t)return o(t);o(null,new i(e,null==n?{}:n,e.writeConcern))}))},N=function(e){return Math.floor((e.length?e.length-1:0)/e.chunkSize)},M=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||e.writeConcern,null!=e.fileId?e.chunkCollection().remove({files_id:e.fileId},t,(function(e){if(e)return n(e,!1);n(null,!0)})):n(null,!0)};y.DEFAULT_ROOT_COLLECTION="fs",y.DEFAULT_CONTENT_TYPE="binary/octet-stream",y.IO_SEEK_SET=0,y.IO_SEEK_CUR=1,y.IO_SEEK_END=2,y.exist=function(e,t,n,i,o){var r=Array.prototype.slice.call(arguments,2);return o="function"==typeof r[r.length-1]?r.pop():void 0,n=r.length?r.shift():null,i=(i=r.length?r.shift():{})||{},f(e.s.topology,B,[e,t,n,i,o],{skipSessions:!0})};var B=function(e,t,n,i,o){var s=i.readPreference||r.PRIMARY,a=null!=n?n:y.DEFAULT_ROOT_COLLECTION;e.collection(a+".files",(function(e,n){if(e)return o(e);var i="string"==typeof t||"[object RegExp]"===Object.prototype.toString.call(t)?{filename:t}:{_id:t};null!=t&&"object"==typeof t&&"[object RegExp]"!==Object.prototype.toString.call(t)&&(i=t),n.findOne(i,{readPreference:s},(function(e,t){if(e)return o(e);o(null,null!=t)}))}))};y.list=function(e,t,n,i){var o=Array.prototype.slice.call(arguments,1);return i="function"==typeof o[o.length-1]?o.pop():void 0,t=o.length?o.shift():null,n=(n=o.length?o.shift():{})||{},f(e.s.topology,R,[e,t,n,i],{skipSessions:!0})};var R=function(e,t,n,i){null!=t&&"object"==typeof t&&(n=t,t=null);var o=n.readPreference||r.primary,s=null!=n.id&&n.id,a=null!=t?t:y.DEFAULT_ROOT_COLLECTION,c=[];e.collection(a+".files",(function(e,t){if(e)return i(e);t.find({},{readPreference:o},(function(e,t){if(e)return i(e);t.each((function(e,t){null!=t?c.push(s?t._id:t.filename):i(e,c)}))}))}))};y.read=function(e,t,n,i,o,r){var s=Array.prototype.slice.call(arguments,2);return r="function"==typeof s[s.length-1]?s.pop():void 0,n=s.length?s.shift():null,i=s.length?s.shift():null,o=(o=s.length?s.shift():null)||{},f(e.s.topology,P,[e,t,n,i,o,r],{skipSessions:!0})};var P=function(e,t,n,i,o,r){new y(e,t,"r",o).open((function(e,t){return e?r(e):i&&i>=t.length?r("offset larger than size of file",null):n&&n>t.length?r("length is larger than the size of the file",null):i&&n&&i+n>t.length?r("offset and length is larger than the size of the file",null):void(null!=i?t.seek(i,(function(e,t){if(e)return r(e);t.read(n,r)})):t.read(n,r))}))};y.readlines=function(e,t,n,i,o){var r=Array.prototype.slice.call(arguments,2);return o="function"==typeof r[r.length-1]?r.pop():void 0,n=r.length?r.shift():null,i=(i=r.length?r.shift():null)||{},f(e.s.topology,L,[e,t,n,i,o],{skipSessions:!0})};var L=function(e,t,n,i,o){var r=null==n?"\n":n;new y(e,t,"r",i).open((function(e,t){if(e)return o(e);t.readlines(r,o)}))};y.unlink=function(e,t,n,i){var o=Array.prototype.slice.call(arguments,2);return i="function"==typeof o[o.length-1]?o.pop():void 0,n=(n=o.length?o.shift():{})||{},f(e.s.topology,D,[this,e,t,n,i],{skipSessions:!0})};var D=function(e,t,n,i,o){var r=U(t,i);if(n.constructor===Array)for(var s=0,a=0;a<n.length;a++)++s,y.unlink(t,n[a],i,(function(){0==--s&&o(null,e)}));else new y(t,n,"w",i).open((function(t,n){if(t)return o(t);M(n,(function(t){if(t)return o(t);n.collection((function(t,i){if(t)return o(t);i.remove({_id:n.fileId},r,(function(t){o(t,e)}))}))}))}))},j=function(e,t,n,i,o){return s.isBuffer(t)?C(e,t,n,o):C(e,s.from(t,"binary"),n,o)},z=function(e){var t={};return null!=e.w&&(t.w=e.w),!0===e.journal&&(t.j=e.journal),!0===e.j&&(t.j=e.j),!0===e.fsync&&(t.fsync=e.fsync),null!=e.wtimeout&&(t.wtimeout=e.wtimeout),t},U=function(e,t){var n={w:1};if(null!=(t=t||{}).w||"boolean"==typeof t.j||"boolean"==typeof t.journal||"boolean"==typeof t.fsync?n=z(t):null!=t.safe&&"object"==typeof t.safe?n=z(t.safe):"boolean"==typeof t.safe?n={w:t.safe?1:0}:null!=e.options.w||"boolean"==typeof e.options.j||"boolean"==typeof e.options.journal||"boolean"==typeof e.options.fsync?n=z(e.options):!e.safe||null==e.safe.w&&"boolean"!=typeof e.safe.j&&"boolean"!=typeof e.safe.journal&&"boolean"!=typeof e.safe.fsync?"boolean"==typeof e.safe&&(n={w:e.safe?1:0}):n=z(e.safe),n.w<1&&(!0===n.journal||!0===n.j||!0===n.fsync))throw p.create({message:"No acknowledgement using w < 1 cannot be combined with journal:true or fsync:true",driver:!0});return n},q=function(e){d.call(this),this.gs=e,this.endCalled=!1,this.totalBytesToRead=this.gs.length-this.gs.position,this.seekPosition=this.gs.position};u(q,d),q.prototype._pipe=q.prototype.pipe,q.prototype.pipe=function(e){var t=this;return t.gs.isOpen?(t.totalBytesToRead=t.gs.length-t.gs.position,t._pipe.apply(t,[e])):t.gs.open((function(n){if(n)return t.emit("error",n);t.totalBytesToRead=t.gs.length-t.gs.position,t._pipe.apply(t,[e])})),e},q.prototype._read=function(){var e=this,t=function(){e.gs.read(n,(function(t,n){return t&&!e.endCalled?e.emit("error",t):e.endCalled||null==n?e.push(null):(n.length<=e.totalBytesToRead?(e.totalBytesToRead=e.totalBytesToRead-n.length,e.push(n)):n.length>e.totalBytesToRead&&(e.totalBytesToRead=e.totalBytesToRead-n._index,e.push(n.slice(0,n._index))),void(e.totalBytesToRead<=0&&(e.endCalled=!0)))}))},n=e.gs.length<e.gs.chunkSize?e.gs.length-e.seekPosition:e.gs.chunkSize;e.gs.isOpen?t():e.gs.open((function(n){if(e.totalBytesToRead=e.gs.length-e.gs.position,n)return e.emit("error",n);t()}))},q.prototype.destroy=function(){this.pause(),this.endCalled=!0,this.gs.close(),this.emit("end")},q.prototype.write=function(e){var t=this;return t.endCalled?t.emit("error",p.create({message:"attempting to write to stream after end called",driver:!0})):t.gs.isOpen?(t.gs.write(e,(function(){t.emit("drain")})),!0):(t.gs.open((function(){t.gs.isOpen=!0,t.gs.write(e,(function(){process.nextTick((function(){t.emit("drain")}))}))})),!1)},q.prototype.end=function(e,t,n){var i=this,o=Array.prototype.slice.call(arguments,0);n="function"==typeof o[o.length-1]?o.pop():void 0,e=o.length?o.shift():null,t=o.length?o.shift():null,i.endCalled=!0,e&&i.gs.write(e,(function(){i.gs.close((function(){"function"==typeof n&&n(),i.emit("end")}))})),i.gs.close((function(){"function"==typeof n&&n(),i.emit("end")}))},e.exports=y},function(e,t,n){"use strict";var i=n(8).EventEmitter,o=n(218),r=n(219),s=n(0).shallowClone,a=n(0).toError,c=n(5),l=n(0).executeLegacyOperation,p={bucketName:"fs",chunkSizeBytes:261120};function u(e,t){if(i.apply(this),this.setMaxListeners(0),t&&"object"==typeof t){t=s(t);for(var n=Object.keys(p),o=0;o<n.length;++o)t[n[o]]||(t[n[o]]=p[n[o]])}else t=p;this.s={db:e,options:t,_chunksCollection:e.collection(t.bucketName+".chunks"),_filesCollection:e.collection(t.bucketName+".files"),checkedIndexes:!1,calledOpenUploadStream:!1,promiseLibrary:e.s.promiseLibrary||Promise}}function d(e,t,n){e.s._filesCollection.deleteOne({_id:t},(function(i,o){if(i)return n(i);e.s._chunksCollection.deleteMany({files_id:t},(function(e){return e?n(e):o.result.n?void n():n(new Error("FileNotFound: no file with id "+t+" found"))}))}))}function h(e,t,n,i){var o={_id:t},r={$set:{filename:n}};e.s._filesCollection.updateOne(o,r,(function(e,n){return e?i(e):n.result.n?void i():i(a("File with id "+t+" not found"))}))}function f(e,t){e.s._filesCollection.drop((function(n){if(n)return t(n);e.s._chunksCollection.drop((function(e){return e?t(e):t()}))}))}e.exports=u,c.inherits(u,i),u.prototype.openUploadStream=function(e,t){return(t=t?s(t):{}).chunkSizeBytes||(t.chunkSizeBytes=this.s.options.chunkSizeBytes),new r(this,e,t)},u.prototype.openUploadStreamWithId=function(e,t,n){return(n=n?s(n):{}).chunkSizeBytes||(n.chunkSizeBytes=this.s.options.chunkSizeBytes),n.id=e,new r(this,t,n)},u.prototype.openDownloadStream=function(e,t){var n={_id:e};return t={start:t&&t.start,end:t&&t.end},new o(this.s._chunksCollection,this.s._filesCollection,this.s.options.readPreference,n,t)},u.prototype.delete=function(e,t){return l(this.s.db.s.topology,d,[this,e,t],{skipSessions:!0})},u.prototype.find=function(e,t){e=e||{},t=t||{};var n=this.s._filesCollection.find(e);return null!=t.batchSize&&n.batchSize(t.batchSize),null!=t.limit&&n.limit(t.limit),null!=t.maxTimeMS&&n.maxTimeMS(t.maxTimeMS),null!=t.noCursorTimeout&&n.addCursorFlag("noCursorTimeout",t.noCursorTimeout),null!=t.skip&&n.skip(t.skip),null!=t.sort&&n.sort(t.sort),n},u.prototype.openDownloadStreamByName=function(e,t){var n={uploadDate:-1},i=null;t&&null!=t.revision&&(t.revision>=0?(n={uploadDate:1},i=t.revision):i=-t.revision-1);var r={filename:e};return t={sort:n,skip:i,start:t&&t.start,end:t&&t.end},new o(this.s._chunksCollection,this.s._filesCollection,this.s.options.readPreference,r,t)},u.prototype.rename=function(e,t,n){return l(this.s.db.s.topology,h,[this,e,t,n],{skipSessions:!0})},u.prototype.drop=function(e){return l(this.s.db.s.topology,f,[this,e],{skipSessions:!0})},u.prototype.getLogger=function(){return this.s.db.s.logger}},function(e,t,n){"use strict";var i=n(14),o=n(5);function r(e,t,n,o,r){this.s={bytesRead:0,chunks:e,cursor:null,expected:0,files:t,filter:o,init:!1,expectedEnd:0,file:null,options:r,readPreference:n},i.Readable.call(this)}function s(e){if(e.s.init)throw new Error("You cannot change options after the stream has enteredflowing mode!")}function a(e,t){e.emit("error",t)}e.exports=r,o.inherits(r,i.Readable),r.prototype._read=function(){var e=this;this.destroyed||function(e,t){if(e.s.file)return t();e.s.init||(!function(e){var t={};e.s.readPreference&&(t.readPreference=e.s.readPreference);e.s.options&&e.s.options.sort&&(t.sort=e.s.options.sort);e.s.options&&e.s.options.skip&&(t.skip=e.s.options.skip);e.s.files.findOne(e.s.filter,t,(function(t,n){if(t)return a(e,t);if(!n){var i=e.s.filter._id?e.s.filter._id.toString():e.s.filter.filename,o=new Error("FileNotFound: file "+i+" was not found");return o.code="ENOENT",a(e,o)}if(n.length<=0)e.push(null);else if(e.destroyed)e.emit("close");else{try{e.s.bytesToSkip=function(e,t,n){if(n&&null!=n.start){if(n.start>t.length)throw new Error("Stream start ("+n.start+") must not be more than the length of the file ("+t.length+")");if(n.start<0)throw new Error("Stream start ("+n.start+") must not be negative");if(null!=n.end&&n.end<n.start)throw new Error("Stream start ("+n.start+") must not be greater than stream end ("+n.end+")");return e.s.bytesRead=Math.floor(n.start/t.chunkSize)*t.chunkSize,e.s.expected=Math.floor(n.start/t.chunkSize),n.start-e.s.bytesRead}}(e,n,e.s.options)}catch(t){return a(e,t)}var r={files_id:n._id};if(e.s.options&&null!=e.s.options.start){var s=Math.floor(e.s.options.start/n.chunkSize);s>0&&(r.n={$gte:s})}e.s.cursor=e.s.chunks.find(r).sort({n:1}),e.s.readPreference&&e.s.cursor.setReadPreference(e.s.readPreference),e.s.expectedEnd=Math.ceil(n.length/n.chunkSize),e.s.file=n;try{e.s.bytesToTrim=function(e,t,n,i){if(i&&null!=i.end){if(i.end>t.length)throw new Error("Stream end ("+i.end+") must not be more than the length of the file ("+t.length+")");if(i.start<0)throw new Error("Stream end ("+i.end+") must not be negative");var o=null!=i.start?Math.floor(i.start/t.chunkSize):0;return n.limit(Math.ceil(i.end/t.chunkSize)-o),e.s.expectedEnd=Math.ceil(i.end/t.chunkSize),Math.ceil(i.end/t.chunkSize)*t.chunkSize-i.end}}(e,n,e.s.cursor,e.s.options)}catch(t){return a(e,t)}e.emit("file",n)}}))}(e),e.s.init=!0);e.once("file",(function(){t()}))}(e,(function(){!function(e){if(e.destroyed)return;e.s.cursor.next((function(t,n){if(e.destroyed)return;if(t)return a(e,t);if(!n)return e.push(null),void process.nextTick(()=>{e.s.cursor.close((function(t){t?a(e,t):e.emit("close")}))});var i=e.s.file.length-e.s.bytesRead,o=e.s.expected++,r=Math.min(e.s.file.chunkSize,i);if(n.n>o){var s="ChunkIsMissing: Got unexpected n: "+n.n+", expected: "+o;return a(e,new Error(s))}if(n.n<o)return s="ExtraChunk: Got unexpected n: "+n.n+", expected: "+o,a(e,new Error(s));var c=Buffer.isBuffer(n.data)?n.data:n.data.buffer;if(c.length!==r)return i<=0?(s="ExtraChunk: Got unexpected n: "+n.n,a(e,new Error(s))):(s="ChunkIsWrongSize: Got unexpected length: "+c.length+", expected: "+r,a(e,new Error(s)));if(e.s.bytesRead+=c.length,0===c.length)return e.push(null);var l=null,p=null;null!=e.s.bytesToSkip&&(l=e.s.bytesToSkip,e.s.bytesToSkip=0);const u=o===e.s.expectedEnd-1,d=e.s.options.end-e.s.bytesToSkip;u&&null!=e.s.bytesToTrim?p=e.s.file.chunkSize-e.s.bytesToTrim:e.s.options.end&&d<n.data.length()&&(p=d),null==l&&null==p||(c=c.slice(l||0,p||c.length)),e.push(c)}))}(e)}))},r.prototype.start=function(e){return s(this),this.s.options.start=e,this},r.prototype.end=function(e){return s(this),this.s.options.end=e,this},r.prototype.abort=function(e){var t=this;this.push(null),this.destroyed=!0,this.s.cursor?this.s.cursor.close((function(n){t.emit("close"),e&&e(n)})):(this.s.init||t.emit("close"),e&&e())}},function(e,t,n){"use strict";var i=n(1),o=n(17),r=n(14),s=n(5),a=n(19).Buffer;function c(e,t,n){if(n=n||{},this.bucket=e,this.chunks=e.s._chunksCollection,this.filename=t,this.files=e.s._filesCollection,this.options=n,this.done=!1,this.id=n.id?n.id:i.BSON.ObjectId(),this.chunkSizeBytes=this.options.chunkSizeBytes,this.bufToStore=a.alloc(this.chunkSizeBytes),this.length=0,this.md5=!n.disableMD5&&o.createHash("md5"),this.n=0,this.pos=0,this.state={streamEnd:!1,outstandingRequests:0,errored:!1,aborted:!1,promiseLibrary:this.bucket.s.promiseLibrary},!this.bucket.s.calledOpenUploadStream){this.bucket.s.calledOpenUploadStream=!0;var r=this;!function(e,t){e.files.findOne({},{_id:1},(function(n,i){return n?t(n):i?t():void e.files.listIndexes().toArray((function(n,i){if(n){if(26===n.code){var o={filename:1,uploadDate:1};return void e.files.createIndex(o,{background:!1},(function(n){if(n)return t(n);u(e,t)}))}return t(n)}var r=!1;if(i.forEach((function(e){2===Object.keys(e.key).length&&1===e.key.filename&&1===e.key.uploadDate&&(r=!0)})),r)u(e,t);else{o={filename:1,uploadDate:1};var s=h(e);s.background=!1,e.files.createIndex(o,s,(function(n){if(n)return t(n);u(e,t)}))}}))}))}(this,(function(){r.bucket.s.checkedIndexes=!0,r.bucket.emit("index")}))}}function l(e,t,n){if(!e.state.errored){if(e.state.errored=!0,n)return n(t);e.emit("error",t)}}function p(e,t,n){return{_id:i.BSON.ObjectId(),files_id:e,n:t,data:n}}function u(e,t){e.chunks.listIndexes().toArray((function(n,i){if(n){if(26===n.code){var o={files_id:1,n:1};return void e.chunks.createIndex(o,{background:!1,unique:!0},(function(e){if(e)return t(e);t()}))}return t(n)}var r=!1;if(i.forEach((function(e){e.key&&(2===Object.keys(e.key).length&&1===e.key.files_id&&1===e.key.n&&(r=!0))})),r)t();else{o={files_id:1,n:1};var s=h(e);s.background=!1,s.unique=!0,e.chunks.createIndex(o,s,(function(e){if(e)return t(e);t()}))}}))}function d(e,t){if(e.done)return!0;if(e.state.streamEnd&&0===e.state.outstandingRequests&&!e.state.errored){e.done=!0;var n=function(e,t,n,i,o,r,s,a){var c={_id:e,length:t,chunkSize:n,uploadDate:new Date,filename:o};i&&(c.md5=i);r&&(c.contentType=r);s&&(c.aliases=s);a&&(c.metadata=a);return c}(e.id,e.length,e.chunkSizeBytes,e.md5&&e.md5.digest("hex"),e.filename,e.options.contentType,e.options.aliases,e.options.metadata);return!g(e,t)&&(e.files.insertOne(n,h(e),(function(i){if(i)return l(e,i,t);e.emit("finish",n)})),!0)}return!1}function h(e){var t={};return e.options.writeConcern&&(t.w=e.options.writeConcern.w,t.wtimeout=e.options.writeConcern.wtimeout,t.j=e.options.writeConcern.j),t}function f(e,t){return e.bucket.s.checkedIndexes?t(!1):(e.bucket.once("index",(function(){t(!0)})),!0)}function m(e,t){if(0===e.pos)return d(e,t);++e.state.outstandingRequests;var n=a.alloc(e.pos);e.bufToStore.copy(n,0,0,e.pos),e.md5&&e.md5.update(n);var i=p(e.id,e.n,n);if(g(e,t))return!1;e.chunks.insertOne(i,h(e),(function(t){if(t)return l(e,t);--e.state.outstandingRequests,d(e)}))}function g(e,t){return!!e.state.aborted&&("function"==typeof t&&t(new Error("this stream has been aborted")),!0)}e.exports=c,s.inherits(c,r.Writable),c.prototype.write=function(e,t,n){var i=this;return f(this,(function(){return function(e,t,n,i){if(g(e,i))return!1;var o=a.isBuffer(t)?t:a.from(t,n);if(e.length+=o.length,e.pos+o.length<e.chunkSizeBytes)return o.copy(e.bufToStore,e.pos),e.pos+=o.length,i&&i(),!0;var r=o.length,s=e.chunkSizeBytes-e.pos,c=Math.min(s,o.length),u=0;for(;r>0;){var f=o.length-r;if(o.copy(e.bufToStore,e.pos,f,f+c),e.pos+=c,0===(s-=c)){e.md5&&e.md5.update(e.bufToStore);var m=p(e.id,e.n,a.from(e.bufToStore));if(++e.state.outstandingRequests,++u,g(e,i))return!1;e.chunks.insertOne(m,h(e),(function(t){if(t)return l(e,t);--e.state.outstandingRequests,--u||(e.emit("drain",m),i&&i(),d(e))})),s=e.chunkSizeBytes,e.pos=0,++e.n}r-=c,c=Math.min(s,r)}return!1}(i,e,t,n)}))},c.prototype.abort=function(e){if(this.state.streamEnd){var t=new Error("Cannot abort a stream that has already completed");return"function"==typeof e?e(t):this.state.promiseLibrary.reject(t)}if(this.state.aborted)return t=new Error("Cannot call abort() on a stream twice"),"function"==typeof e?e(t):this.state.promiseLibrary.reject(t);this.state.aborted=!0,this.chunks.deleteMany({files_id:this.id},(function(t){"function"==typeof e&&e(t)}))},c.prototype.end=function(e,t,n){var i=this;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),g(this,n)||(this.state.streamEnd=!0,n&&this.once("finish",(function(e){n(null,e)})),e?this.write(e,t,(function(){m(i)})):f(this,(function(){m(i)})))}},function(e,t,n){var i=n(241),o=n(230);e.exports=function(e){return i(o(e))}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var i=n(43),o=n(133),r=n(85),s=n(223),a=n(232),c=n(243),l=c.get,p=c.enforce,u=String(String).split("String");(e.exports=function(e,t,n,a){var c,l=!!a&&!!a.unsafe,d=!!a&&!!a.enumerable,h=!!a&&!!a.noTargetGet;"function"==typeof n&&("string"!=typeof t||r(n,"name")||o(n,"name",t),(c=p(n)).source||(c.source=u.join("string"==typeof t?t:""))),e!==i?(l?!h&&e[t]&&(d=!0):delete e[t],d?e[t]=n:o(e,t,n)):d?e[t]=n:s(t,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&l(this).source||a(this)}))},function(e,t,n){var i=n(43),o=n(133);e.exports=function(e,t){try{o(i,e,t)}catch(n){i[e]=t}return t}},function(e,t,n){var i=n(43),o=n(223),r=i["__core-js_shared__"]||o("__core-js_shared__",{});e.exports=r},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var i=n(84);e.exports=function(e,t){if(!i(e))return e;var n,o;if(t&&"function"==typeof(n=e.toString)&&!i(o=n.call(e)))return o;if("function"==typeof(n=e.valueOf)&&!i(o=n.call(e)))return o;if(!t&&"function"==typeof(n=e.toString)&&!i(o=n.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports={}},function(e,t,n){var i=n(256),o=n(43),r=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?r(i[e])||r(o[e]):i[e]&&i[e][t]||o[e]&&o[e][t]}},function(e,t,n){var i=n(83),o=n(251),r=n(225),s=n(220),a=n(226),c=n(85),l=n(231),p=Object.getOwnPropertyDescriptor;t.f=i?p:function(e,t){if(e=s(e),t=a(t,!0),l)try{return p(e,t)}catch(e){}if(c(e,t))return r(!o.f.call(e,t),e[t])}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},function(e,t,n){var i=n(83),o=n(65),r=n(242);e.exports=!i&&!o((function(){return 7!=Object.defineProperty(r("div"),"a",{get:function(){return 7}}).a}))},function(e,t,n){var i=n(224),o=Function.toString;"function"!=typeof i.inspectSource&&(i.inspectSource=function(e){return o.call(e)}),e.exports=i.inspectSource},function(e,t,n){var i=n(253),o=n(224);(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.8.1",mode:i?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},function(e,t){var n=0,i=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++n+i).toString(36)}},function(e,t,n){var i=n(236),o=Math.min;e.exports=function(e){return e>0?o(i(e),9007199254740991):0}},function(e,t){var n=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?i:n)(e)}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t,n){var i=n(65);e.exports=!!Object.getOwnPropertySymbols&&!i((function(){return!String(Symbol())}))},function(e,t,n){"use strict";var i=n(88);e.exports=function(){var e=i(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,n){var i=n(43),o=n(229).f,r=n(133),s=n(222),a=n(223),c=n(254),l=n(247);e.exports=function(e,t){var n,p,u,d,h,f=e.target,m=e.global,g=e.stat;if(n=m?i:g?i[f]||a(f,{}):(i[f]||{}).prototype)for(p in t){if(d=t[p],u=e.noTargetGet?(h=o(n,p))&&h.value:n[p],!l(m?p:f+(g?".":"#")+p,e.forced)&&void 0!==u){if(typeof d==typeof u)continue;c(d,u)}(e.sham||u&&u.sham)&&r(d,"sham",!0),s(n,p,d,e)}}},function(e,t,n){var i=n(65),o=n(221),r="".split;e.exports=i((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==o(e)?r.call(e,""):Object(e)}:Object},function(e,t,n){var i=n(43),o=n(84),r=i.document,s=o(r)&&o(r.createElement);e.exports=function(e){return s?r.createElement(e):{}}},function(e,t,n){var i,o,r,s=n(252),a=n(43),c=n(84),l=n(133),p=n(85),u=n(224),d=n(244),h=n(227),f=a.WeakMap;if(s){var m=u.state||(u.state=new f),g=m.get,y=m.has,v=m.set;i=function(e,t){return t.facade=e,v.call(m,e,t),t},o=function(e){return g.call(m,e)||{}},r=function(e){return y.call(m,e)}}else{var b=d("state");h[b]=!0,i=function(e,t){return t.facade=e,l(e,b,t),t},o=function(e){return p(e,b)?e[b]:{}},r=function(e){return p(e,b)}}e.exports={set:i,get:o,has:r,enforce:function(e){return r(e)?o(e):i(e,{})},getterFor:function(e){return function(t){var n;if(!c(t)||(n=o(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}}},function(e,t,n){var i=n(233),o=n(234),r=i("keys");e.exports=function(e){return r[e]||(r[e]=o(e))}},function(e,t,n){var i=n(246),o=n(237).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return i(e,o)}},function(e,t,n){var i=n(85),o=n(220),r=n(257).indexOf,s=n(227);e.exports=function(e,t){var n,a=o(e),c=0,l=[];for(n in a)!i(s,n)&&i(a,n)&&l.push(n);for(;t.length>c;)i(a,n=t[c++])&&(~r(l,n)||l.push(n));return l}},function(e,t,n){var i=n(65),o=/#|\.prototype\./,r=function(e,t){var n=a[s(e)];return n==l||n!=c&&("function"==typeof t?i(t):!!t)},s=r.normalize=function(e){return String(e).replace(o,".").toLowerCase()},a=r.data={},c=r.NATIVE="N",l=r.POLYFILL="P";e.exports=r},function(e,t,n){var i=n(221);e.exports=Array.isArray||function(e){return"Array"==i(e)}},function(e,t,n){"use strict";const i=n(135),o=n(309),r=n(34),s=n(134),a=n(14).PassThrough,c=n(310),l=n(130);e.exports=function(e,t){return function e(t,n){(n=n||{}).fetchRes=n.fetchRes||new a,n.cookies=n.cookies||new c,n.redirects=n.redirects||0,n.maxRedirects=isNaN(n.maxRedirects)?5:n.maxRedirects,n.cookie&&([].concat(n.cookie||[]).forEach(e=>{n.cookies.set(e,t)}),n.cookie=!1);let p,u,d,h=n.fetchRes,f=r.parse(t),m=(n.method||"").toString().trim().toUpperCase()||"GET",g=!1,y="https:"===f.protocol?o:i,v={"accept-encoding":"gzip,deflate","user-agent":"nodemailer/"+l.version};Object.keys(n.headers||{}).forEach(e=>{v[e.toLowerCase().trim()]=n.headers[e]}),n.userAgent&&(v["user-agent"]=n.userAgent);f.auth&&(v.Authorization="Basic "+Buffer.from(f.auth).toString("base64"));(p=n.cookies.get(t))&&(v.cookie=p);if(n.body){if(!1!==n.contentType&&(v["Content-Type"]=n.contentType||"application/x-www-form-urlencoded"),"function"==typeof n.body.pipe)v["Transfer-Encoding"]="chunked",u=n.body,u.on("error",e=>{g||(g=!0,e.type="FETCH",e.sourceUrl=t,h.emit("error",e))});else{if(n.body instanceof Buffer)u=n.body;else if("object"==typeof n.body)try{u=Buffer.from(Object.keys(n.body).map(e=>{let t=n.body[e].toString().trim();return encodeURIComponent(e)+"="+encodeURIComponent(t)}).join("&"))}catch(e){if(g)return;return g=!0,e.type="FETCH",e.sourceUrl=t,void h.emit("error",e)}else u=Buffer.from(n.body.toString().trim());v["Content-Type"]=n.contentType||"application/x-www-form-urlencoded",v["Content-Length"]=u.length}m=(n.method||"").toString().trim().toUpperCase()||"POST"}let b={method:m,host:f.hostname,path:f.path,port:f.port?f.port:"https:"===f.protocol?443:80,headers:v,rejectUnauthorized:!1,agent:!1};n.tls&&Object.keys(n.tls).forEach(e=>{b[e]=n.tls[e]});try{d=y.request(b)}catch(e){return g=!0,setImmediate(()=>{e.type="FETCH",e.sourceUrl=t,h.emit("error",e)}),h}n.timeout&&d.setTimeout(n.timeout,()=>{if(g)return;g=!0,d.abort();let e=new Error("Request Timeout");e.type="FETCH",e.sourceUrl=t,h.emit("error",e)});return d.on("error",e=>{g||(g=!0,e.type="FETCH",e.sourceUrl=t,h.emit("error",e))}),d.on("response",i=>{let o;if(!g){switch(i.headers["content-encoding"]){case"gzip":case"deflate":o=s.createUnzip()}if(i.headers["set-cookie"]&&[].concat(i.headers["set-cookie"]||[]).forEach(e=>{n.cookies.set(e,t)}),[301,302,303,307,308].includes(i.statusCode)&&i.headers.location){if(n.redirects++,n.redirects>n.maxRedirects){g=!0;let e=new Error("Maximum redirect count exceeded");return e.type="FETCH",e.sourceUrl=t,h.emit("error",e),void d.abort()}return n.method="GET",n.body=!1,e(r.resolve(t,i.headers.location),n)}if(h.statusCode=i.statusCode,h.headers=i.headers,i.statusCode>=300&&!n.allowErrorResponse){g=!0;let e=new Error("Invalid status code "+i.statusCode);return e.type="FETCH",e.sourceUrl=t,h.emit("error",e),void d.abort()}i.on("error",e=>{g||(g=!0,e.type="FETCH",e.sourceUrl=t,h.emit("error",e),d.abort())}),o?(i.pipe(o).pipe(h),o.on("error",e=>{g||(g=!0,e.type="FETCH",e.sourceUrl=t,h.emit("error",e),d.abort())})):i.pipe(h)}}),setImmediate(()=>{if(u)try{if("function"==typeof u.pipe)return u.pipe(d);d.write(u)}catch(e){return g=!0,e.type="FETCH",e.sourceUrl=t,void h.emit("error",e)}d.end()}),h}(e,t)},e.exports.Cookies=c},function(e,t,n){"use strict";const i=n(273),o=n(274),r=n(270);e.exports={isPlainText:(e,t)=>"string"==typeof e&&!(t?/[\x00-\x08\x0b\x0c\x0e-\x1f"\u0080-\uFFFF]/:/[\x00-\x08\x0b\x0c\x0e-\x1f\u0080-\uFFFF]/).test(e),hasLongerLines:(e,t)=>e.length>131072||new RegExp("^.{"+(t+1)+",}","m").test(e),encodeWord(e,t,n){let r;t=(t||"Q").toString().toUpperCase().trim().charAt(0);if((n=n||0)&&n>7+"UTF-8".length&&(n-=7+"UTF-8".length),"Q"===t?r=o.encode(e).replace(/[^a-z0-9!*+\-/=]/gi,e=>{let t=e.charCodeAt(0).toString(16).toUpperCase();return" "===e?"_":"="+(1===t.length?"0"+t:t)}):"B"===t&&(r="string"==typeof e?e:i.encode(e),n=n?Math.max(3,(n-n%4)/4*3):0),n&&("B"!==t?r:i.encode(e)).length>n)if("Q"===t)r=this.splitMimeEncodedString(r,n).join("?= =?UTF-8?"+t+"?");else{let e=[],o="";for(let t=0,s=r.length;t<s;t++){let s=r.charAt(t);Buffer.byteLength(o+s)<=n||0===t?o+=s:(e.push(i.encode(o)),o=s)}o&&e.push(i.encode(o)),r=e.length>1?e.join("?= =?UTF-8?"+t+"?"):e.join("")}else"B"===t&&(r=i.encode(e));return"=?UTF-8?"+t+"?"+r+("?="===r.substr(-2)?"":"?=")},encodeWords(e,t,n,i){let o;n=n||0;let r=e.match(/(?:^|\s)([^\s]*["\u0080-\uFFFF])/);if(!r)return e;if(i)return this.encodeWord(e,t,n);let s=e.match(/(["\u0080-\uFFFF][^\s]*)[^"\u0080-\uFFFF]*$/);if(!s)return e;let a=r.index+(r[0].match(/[^\s]/)||{index:0}).index,c=s.index+(s[1]||"").length;return o=(a?e.substr(0,a):"")+this.encodeWord(e.substring(a,c),t||"Q",n)+(c<e.length?e.substr(c):""),o},buildHeaderValue(e){let t=[];return Object.keys(e.params||{}).forEach(n=>{let i=e.params[n];!this.isPlainText(i,!0)||i.length>=75?this.buildHeaderParam(n,i,50).forEach(e=>{/[\s"\\;:/=(),<>@[\]?]|^[-']|'$/.test(e.value)&&"*"!==e.key.substr(-1)?t.push(e.key+"="+JSON.stringify(e.value)):t.push(e.key+"="+e.value)}):/[\s'"\\;:/=(),<>@[\]?]|^-/.test(i)?t.push(n+"="+JSON.stringify(i)):t.push(n+"="+i)}),e.value+(t.length?"; "+t.join("; "):"")},buildHeaderParam(e,t,n){let i,o,r,s,a,c,l=[],p="string"==typeof t?t:(t||"").toString(),u=0;if(n=n||50,this.isPlainText(t,!0)){if(p.length<=n)return[{key:e,value:p}];p=p.replace(new RegExp(".{"+n+"}","g"),e=>(l.push({line:e}),"")),p&&l.push({line:p})}else{if(/[\uD800-\uDBFF]/.test(p)){for(i=[],a=0,c=p.length;a<c;a++)o=p.charAt(a),r=o.charCodeAt(0),r>=55296&&r<=56319&&a<c-1?(o+=p.charAt(a+1),i.push(o),a++):i.push(o);p=i}s="utf-8''";let e=!0;for(u=0,a=0,c=p.length;a<c;a++){if(o=p[a],e)o=this.safeEncodeURIComponent(o);else if(o=" "===o?o:this.safeEncodeURIComponent(o),o!==p[a]){if(!((this.safeEncodeURIComponent(s)+o).length>=n)){e=!0,a=u,s="";continue}l.push({line:s,encoded:e}),s="",u=a-1}(s+o).length>=n?(l.push({line:s,encoded:e}),s=o=" "===p[a]?" ":this.safeEncodeURIComponent(p[a]),o===p[a]?(e=!1,u=a-1):e=!0):s+=o}s&&l.push({line:s,encoded:e})}return l.map((t,n)=>({key:e+"*"+n+(t.encoded?"*":""),value:t.line}))},parseHeaderValue(e){let t,n={value:!1,params:{}},i=!1,o="",r="value",s=!1,a=!1;for(let c=0,l=e.length;c<l;c++)if(t=e.charAt(c),"key"===r){if("="===t){i=o.trim().toLowerCase(),r="value",o="";continue}o+=t}else{if(a)o+=t;else{if("\\"===t){a=!0;continue}s&&t===s?s=!1:s||'"'!==t?s||";"!==t?o+=t:(!1===i?n.value=o.trim():n.params[i]=o.trim(),r="key",o=""):s=t}a=!1}return"value"===r?!1===i?n.value=o.trim():n.params[i]=o.trim():o.trim()&&(n.params[o.trim().toLowerCase()]=""),Object.keys(n.params).forEach(e=>{let t,i,o,r;(o=e.match(/(\*(\d+)|\*(\d+)\*|\*)$/))&&(t=e.substr(0,o.index),i=Number(o[2]||o[3])||0,n.params[t]&&"object"==typeof n.params[t]||(n.params[t]={charset:!1,values:[]}),r=n.params[e],0===i&&"*"===o[0].substr(-1)&&(o=r.match(/^([^']*)'[^']*'(.*)$/))&&(n.params[t].charset=o[1]||"iso-8859-1",r=o[2]),n.params[t].values[i]=r,delete n.params[e])}),Object.keys(n.params).forEach(e=>{let t;n.params[e]&&Array.isArray(n.params[e].values)&&(t=n.params[e].values.map(e=>e||"").join(""),n.params[e].charset?n.params[e]="=?"+n.params[e].charset+"?Q?"+t.replace(/[=?_\s]/g,e=>{let t=e.charCodeAt(0).toString(16);return" "===e?"_":"%"+(t.length<2?"0":"")+t}).replace(/%/g,"=")+"?=":n.params[e]=t)}),n},detectExtension:e=>r.detectExtension(e),detectMimeType:e=>r.detectMimeType(e),foldLines(e,t,n){t=t||76;let i,o,r=0,s=(e=(e||"").toString()).length,a="";for(;r<s;){if(i=e.substr(r,t),i.length<t){a+=i;break}(o=i.match(/^[^\n\r]*(\r?\n|\r)/))?(i=o[0],a+=i,r+=i.length):((o=i.match(/(\s+)[^\s]*$/))&&o[0].length-(n?(o[1]||"").length:0)<i.length?i=i.substr(0,i.length-(o[0].length-(n?(o[1]||"").length:0))):(o=e.substr(r+i.length).match(/^[^\s]+(\s*)/))&&(i+=o[0].substr(0,o[0].length-(n?0:(o[1]||"").length))),a+=i,r+=i.length,r<s&&(a+="\r\n"))}return a},splitMimeEncodedString:(e,t)=>{let n,i,o,r,s=[];for(t=Math.max(t||0,12);e.length;){for(n=e.substr(0,t),(i=n.match(/[=][0-9A-F]?$/i))&&(n=n.substr(0,i.index)),r=!1;!r;)r=!0,(i=e.substr(n.length).match(/^[=]([0-9A-F]{2})/i))&&(o=parseInt(i[1],16),o<194&&o>127&&(n=n.substr(0,n.length-3),r=!1));n.length&&s.push(n),e=e.substr(n.length)}return s},encodeURICharComponent:e=>{let t="",n=e.charCodeAt(0).toString(16).toUpperCase();if(n.length%2&&(n="0"+n),n.length>2)for(let e=0,i=n.length/2;e<i;e++)t+="%"+n.substr(e,2);else t+="%"+n;return t},safeEncodeURIComponent(e){e=(e||"").toString();try{e=encodeURIComponent(e)}catch(t){return e.replace(/[^\x00-\x1F *'()<>@,;:\\"[\]?=\u007F-\uFFFF]+/g,"")}return e.replace(/[\x00-\x1F *'()<>@,;:\\"[\]?=\u007F-\uFFFF]/g,e=>this.encodeURICharComponent(e))}}},function(e,t,n){"use strict";var i={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,r=o&&!i.call({1:2},1);t.f=r?function(e){var t=o(this,e);return!!t&&t.enumerable}:i},function(e,t,n){var i=n(43),o=n(232),r=i.WeakMap;e.exports="function"==typeof r&&/native code/.test(o(r))},function(e,t){e.exports=!1},function(e,t,n){var i=n(85),o=n(255),r=n(229),s=n(87);e.exports=function(e,t){for(var n=o(t),a=s.f,c=r.f,l=0;l<n.length;l++){var p=n[l];i(e,p)||a(e,p,c(t,p))}}},function(e,t,n){var i=n(228),o=n(245),r=n(259),s=n(88);e.exports=i("Reflect","ownKeys")||function(e){var t=o.f(s(e)),n=r.f;return n?t.concat(n(e)):t}},function(e,t,n){var i=n(43);e.exports=i},function(e,t,n){var i=n(220),o=n(235),r=n(258),s=function(e){return function(t,n,s){var a,c=i(t),l=o(c.length),p=r(s,l);if(e&&n!=n){for(;l>p;)if((a=c[p++])!=a)return!0}else for(;l>p;p++)if((e||p in c)&&c[p]===n)return e||p||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},function(e,t,n){var i=n(236),o=Math.max,r=Math.min;e.exports=function(e,t){var n=i(e);return n<0?o(n+t,0):r(n,t)}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var i=n(230);e.exports=function(e){return Object(i(e))}},function(e,t,n){var i=n(84),o=n(248),r=n(129)("species");e.exports=function(e,t){var n;return o(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!o(n.prototype)?i(n)&&null===(n=n[r])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)}},function(e,t,n){var i=n(238);e.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,n){var i=n(83),o=n(87).f,r=Function.prototype,s=r.toString,a=/^\s*function ([^ (]*)/;i&&!("name"in r)&&o(r,"name",{configurable:!0,get:function(){try{return s.call(this).match(a)[1]}catch(e){return""}}})},function(e,t,n){"use strict";var i=n(222),o=n(88),r=n(65),s=n(239),a=RegExp.prototype,c=a.toString,l=r((function(){return"/a/b"!=c.call({source:"a",flags:"b"})})),p="toString"!=c.name;(l||p)&&i(RegExp.prototype,"toString",(function(){var e=o(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in a)?s.call(e):n)}),{unsafe:!0})},function(e,t,n){var i={};i[n(129)("toStringTag")]="z",e.exports="[object z]"===String(i)},function(e,t,n){"use strict";const i=n(130),o=n(8).EventEmitter,r=n(96),s=n(132),a=n(131),c=n(17),l=n(322),p=n(14).PassThrough,u=n(86);e.exports=class extends o{constructor(e){super(e),this.id=c.randomBytes(8).toString("base64").replace(/\W/g,""),this.stage="init",this.options=e||{},this.secureConnection=!!this.options.secure,this.alreadySecured=!!this.options.secured,this.port=Number(this.options.port)||(this.secureConnection?465:587),this.host=this.options.host||"localhost",void 0===this.options.secure&&465===this.port&&(this.secureConnection=!0),this.name=this.options.name||this._getHostname(),this.logger=u.getLogger(this.options,{component:this.options.component||"smtp-connection",sid:this.id}),this.customAuth=new Map,Object.keys(this.options.customAuth||{}).forEach(e=>{let t=(e||"").toString().trim().toUpperCase();t&&this.customAuth.set(t,this.options.customAuth[e])}),this.version=i.version,this.authenticated=!1,this.destroyed=!1,this.secure=!!this.secureConnection,this._remainder="",this._responseQueue=[],this.lastServerResponse=!1,this._socket=!1,this._supportedAuth=[],this.allowsAuth=!1,this._envelope=!1,this._supportedExtensions=[],this._maxAllowedSize=0,this._responseActions=[],this._recipientQueue=[],this._greetingTimeout=!1,this._connectionTimeout=!1,this._destroyed=!1,this._closing=!1,this._onSocketData=e=>this._onData(e),this._onSocketError=e=>this._onError(e,"ESOCKET",!1,"CONN"),this._onSocketClose=()=>this._onClose(),this._onSocketEnd=()=>this._onEnd(),this._onSocketTimeout=()=>this._onTimeout()}connect(e){if("function"==typeof e){this.once("connect",()=>{this.logger.debug({tnx:"smtp"},"SMTP handshake finished"),e()});const t=this._isDestroyedMessage("connect");if(t)return e(this._formatError(t,"ECONNECTION",!1,"CONN"))}let t={port:this.port,host:this.host};this.options.localAddress&&(t.localAddress=this.options.localAddress);let n=()=>{this._connectionTimeout=setTimeout(()=>{this._onError("Connection timeout","ETIMEDOUT",!1,"CONN")},this.options.connectionTimeout||12e4),this._socket.on("error",this._onSocketError)};return this.options.connection?(this._socket=this.options.connection,void(this.secureConnection&&!this.alreadySecured?setImmediate(()=>this._upgradeConnection(e=>{e?this._onError(new Error("Error initiating TLS - "+(e.message||e)),"ETLS",!1,"CONN"):this._onConnect()})):setImmediate(()=>this._onConnect()))):this.options.socket?(this._socket=this.options.socket,u.resolveHostname(t,(e,i)=>{if(e)return setImmediate(()=>this._onError(e,"EDNS",!1,"CONN"));this.logger.debug({tnx:"dns",source:t.host,resolved:i.host,cached:!!i._cached},"Resolved %s as %s [cache %s]",t.host,i.host,i._cached?"hit":"miss"),Object.keys(i).forEach(e=>{"_"!==e.charAt(0)&&i[e]&&(t[e]=i[e])});try{this._socket.connect(this.port,this.host,()=>{this._socket.setKeepAlive(!0),this._onConnect()}),n()}catch(e){return setImmediate(()=>this._onError(e,"ECONNECTION",!1,"CONN"))}})):this.secureConnection?(this.options.tls&&Object.keys(this.options.tls).forEach(e=>{t[e]=this.options.tls[e]}),u.resolveHostname(t,(e,i)=>{if(e)return setImmediate(()=>this._onError(e,"EDNS",!1,"CONN"));this.logger.debug({tnx:"dns",source:t.host,resolved:i.host,cached:!!i._cached},"Resolved %s as %s [cache %s]",t.host,i.host,i._cached?"hit":"miss"),Object.keys(i).forEach(e=>{"_"!==e.charAt(0)&&i[e]&&(t[e]=i[e])});try{this._socket=s.connect(t,()=>{this._socket.setKeepAlive(!0),this._onConnect()}),n()}catch(e){return setImmediate(()=>this._onError(e,"ECONNECTION",!1,"CONN"))}})):u.resolveHostname(t,(e,i)=>{if(e)return setImmediate(()=>this._onError(e,"EDNS",!1,"CONN"));this.logger.debug({tnx:"dns",source:t.host,resolved:i.host,cached:!!i._cached},"Resolved %s as %s [cache %s]",t.host,i.host,i._cached?"hit":"miss"),Object.keys(i).forEach(e=>{"_"!==e.charAt(0)&&i[e]&&(t[e]=i[e])});try{this._socket=r.connect(t,()=>{this._socket.setKeepAlive(!0),this._onConnect()}),n()}catch(e){return setImmediate(()=>this._onError(e,"ECONNECTION",!1,"CONN"))}})}quit(){this._sendCommand("QUIT"),this._responseActions.push(this.close)}close(){if(clearTimeout(this._connectionTimeout),clearTimeout(this._greetingTimeout),this._responseActions=[],this._closing)return;this._closing=!0;let e="end";"init"===this.stage&&(e="destroy"),this.logger.debug({tnx:"smtp"},'Closing connection to the server using "%s"',e);let t=this._socket&&this._socket.socket||this._socket;if(t&&!t.destroyed)try{this._socket[e]()}catch(e){}this._destroy()}login(e,t){const n=this._isDestroyedMessage("login");if(n)return t(this._formatError(n,"ECONNECTION",!1,"API"));if(this._auth=e||{},this._authMethod=(this._auth.method||"").toString().trim().toUpperCase()||!1,this._authMethod||!this._auth.oauth2||this._auth.credentials?this._authMethod&&("XOAUTH2"!==this._authMethod||this._auth.oauth2)||(this._authMethod=(this._supportedAuth[0]||"PLAIN").toUpperCase().trim()):this._authMethod="XOAUTH2",!("XOAUTH2"===this._authMethod||this._auth.credentials&&this._auth.credentials.user&&this._auth.credentials.pass)){if(!this._auth.user||!this._auth.pass)return t(this._formatError('Missing credentials for "'+this._authMethod+'"',"EAUTH",!1,"API"));this._auth.credentials={user:this._auth.user,pass:this._auth.pass,options:this._auth.options}}if(!this.customAuth.has(this._authMethod)){switch(this._authMethod){case"XOAUTH2":return void this._handleXOauth2Token(!1,t);case"LOGIN":return this._responseActions.push(e=>{this._actionAUTH_LOGIN_USER(e,t)}),void this._sendCommand("AUTH LOGIN");case"PLAIN":return this._responseActions.push(e=>{this._actionAUTHComplete(e,t)}),void this._sendCommand("AUTH PLAIN "+Buffer.from("\0"+this._auth.credentials.user+"\0"+this._auth.credentials.pass,"utf-8").toString("base64"));case"CRAM-MD5":return this._responseActions.push(e=>{this._actionAUTH_CRAM_MD5(e,t)}),void this._sendCommand("AUTH CRAM-MD5")}return t(this._formatError('Unknown authentication method "'+this._authMethod+'"',"EAUTH",!1,"API"))}{let e,n=this.customAuth.get(this._authMethod),i=!1,o=()=>{i||(i=!0,this.logger.info({tnx:"smtp",username:this._auth.user,action:"authenticated",method:this._authMethod},"User %s authenticated",JSON.stringify(this._auth.user)),this.authenticated=!0,t(null,!0))},r=n=>{i||(i=!0,t(this._formatError(n,"EAUTH",e,"AUTH "+this._authMethod)))},s=n({auth:this._auth,method:this._authMethod,extensions:[].concat(this._supportedExtensions),authMethods:[].concat(this._supportedAuth),maxAllowedSize:this._maxAllowedSize||!1,sendCommand:(t,n)=>{let i;return n||(i=new Promise((e,t)=>{n=u.callbackPromise(e,t)})),this._responseActions.push(i=>{e=i;let o=i.match(/^(\d+)(?:\s(\d+\.\d+\.\d+))?\s/),r={command:t,response:i};o?(r.status=Number(o[1])||0,o[2]&&(r.code=o[2]),r.text=i.substr(o[0].length)):(r.text=i,r.status=0),n(null,r)}),setImmediate(()=>this._sendCommand(t)),i},resolve:o,reject:r});s&&"function"==typeof s.catch&&s.then(o).catch(r)}}send(e,t,n){if(!t)return n(this._formatError("Empty message","EMESSAGE",!1,"API"));const i=this._isDestroyedMessage("send message");if(i)return n(this._formatError(i,"ECONNECTION",!1,"API"));if(this._maxAllowedSize&&e.size>this._maxAllowedSize)return setImmediate(()=>{n(this._formatError("Message size larger than allowed "+this._maxAllowedSize,"EMESSAGE",!1,"MAIL FROM"))});let o=!1,r=function(){o||(o=!0,n(...arguments))};"function"==typeof t.on&&t.on("error",e=>r(this._formatError(e,"ESTREAM",!1,"API")));let s=Date.now();this._setEnvelope(e,(e,n)=>{if(e)return r(e);let i=Date.now(),o=this._createSendStream((e,t)=>e?r(e):(n.envelopeTime=i-s,n.messageTime=Date.now()-i,n.messageSize=o.outByteCount,n.response=t,r(null,n)));"function"==typeof t.pipe?t.pipe(o):(o.write(t),o.end())})}reset(e){this._sendCommand("RSET"),this._responseActions.push(t=>"2"!==t.charAt(0)?e(this._formatError("Could not reset session state. response="+t,"EPROTOCOL",t,"RSET")):(this._envelope=!1,e(null,!0)))}_onConnect(){clearTimeout(this._connectionTimeout),this.logger.info({tnx:"network",localAddress:this._socket.localAddress,localPort:this._socket.localPort,remoteAddress:this._socket.remoteAddress,remotePort:this._socket.remotePort},"%s established to %s:%s",this.secure?"Secure connection":"Connection",this._socket.remoteAddress,this._socket.remotePort),this._destroyed?this.close():(this.stage="connected",this._socket.removeListener("data",this._onSocketData),this._socket.removeListener("timeout",this._onSocketTimeout),this._socket.removeListener("close",this._onSocketClose),this._socket.removeListener("end",this._onSocketEnd),this._socket.on("data",this._onSocketData),this._socket.once("close",this._onSocketClose),this._socket.once("end",this._onSocketEnd),this._socket.setTimeout(this.options.socketTimeout||6e5),this._socket.on("timeout",this._onSocketTimeout),this._greetingTimeout=setTimeout(()=>{this._socket&&!this._destroyed&&this._responseActions[0]===this._actionGreeting&&this._onError("Greeting never received","ETIMEDOUT",!1,"CONN")},this.options.greetingTimeout||3e4),this._responseActions.push(this._actionGreeting),this._socket.resume())}_onData(e){if(this._destroyed||!e||!e.length)return;let t,n=(e||"").toString("binary"),i=(this._remainder+n).split(/\r?\n/);this._remainder=i.pop();for(let e=0,n=i.length;e<n;e++)this._responseQueue.length&&(t=this._responseQueue[this._responseQueue.length-1],/^\d+-/.test(t.split("\n").pop()))?this._responseQueue[this._responseQueue.length-1]+="\n"+i[e]:this._responseQueue.push(i[e]);this._responseQueue.length&&(t=this._responseQueue[this._responseQueue.length-1],/^\d+-/.test(t.split("\n").pop()))||this._processResponse()}_onError(e,t,n,i){clearTimeout(this._connectionTimeout),clearTimeout(this._greetingTimeout),this._destroyed||(e=this._formatError(e,t,n,i),this.logger.error(n,e.message),this.emit("error",e),this.close())}_formatError(e,t,n,i){let o;o=/Error\]$/i.test(Object.prototype.toString.call(e))?e:new Error(e),t&&"Error"!==t&&(o.code=t),n&&(o.response=n,o.message+=": "+n);let r="string"==typeof n&&Number((n.match(/^\d+/)||[])[0])||!1;return r&&(o.responseCode=r),i&&(o.command=i),o}_onClose(){return this.logger.info({tnx:"network"},"Connection closed"),this.upgrading&&!this._destroyed?this._onError(new Error("Connection closed unexpectedly"),"ETLS",!1,"CONN"):[this._actionGreeting,this.close].includes(this._responseActions[0])||this._destroyed?void this._destroy():this._onError(new Error("Connection closed unexpectedly"),"ECONNECTION",!1,"CONN")}_onEnd(){this._socket&&!this._socket.destroyed&&this._socket.destroy()}_onTimeout(){return this._onError(new Error("Timeout"),"ETIMEDOUT",!1,"CONN")}_destroy(){this._destroyed||(this._destroyed=!0,this.emit("end"))}_upgradeConnection(e){this._socket.removeListener("data",this._onSocketData),this._socket.removeListener("timeout",this._onSocketTimeout);let t=this._socket,n={socket:this._socket,host:this.host};Object.keys(this.options.tls||{}).forEach(e=>{n[e]=this.options.tls[e]}),this.upgrading=!0,this._socket=s.connect(n,()=>(this.secure=!0,this.upgrading=!1,this._socket.on("data",this._onSocketData),t.removeListener("close",this._onSocketClose),t.removeListener("end",this._onSocketEnd),e(null,!0))),this._socket.on("error",this._onSocketError),this._socket.once("close",this._onSocketClose),this._socket.once("end",this._onSocketEnd),this._socket.setTimeout(this.options.socketTimeout||6e5),this._socket.on("timeout",this._onSocketTimeout),t.resume()}_processResponse(){if(!this._responseQueue.length)return!1;let e=this.lastServerResponse=(this._responseQueue.shift()||"").toString();if(/^\d+-/.test(e.split("\n").pop()))return;(this.options.debug||this.options.transactionLog)&&this.logger.debug({tnx:"server"},e.replace(/\r?\n$/,"")),e.trim()||setImmediate(()=>this._processResponse(!0));let t=this._responseActions.shift();if("function"!=typeof t)return this._onError(new Error("Unexpected Response"),"EPROTOCOL",e,"CONN");t.call(this,e),setImmediate(()=>this._processResponse(!0))}_sendCommand(e){if(!this._destroyed){if(this._socket.destroyed)return this.close();(this.options.debug||this.options.transactionLog)&&this.logger.debug({tnx:"client"},(e||"").toString().replace(/\r?\n$/,"")),this._socket.write(Buffer.from(e+"\r\n","utf-8"))}}_setEnvelope(e,t){let n=[],i=!1;if(this._envelope=e||{},this._envelope.from=(this._envelope.from&&this._envelope.from.address||this._envelope.from||"").toString().trim(),this._envelope.to=[].concat(this._envelope.to||[]).map(e=>(e&&e.address||e||"").toString().trim()),!this._envelope.to.length)return t(this._formatError("No recipients defined","EENVELOPE",!1,"API"));if(this._envelope.from&&/[\r\n<>]/.test(this._envelope.from))return t(this._formatError("Invalid sender "+JSON.stringify(this._envelope.from),"EENVELOPE",!1,"API"));/[\x80-\uFFFF]/.test(this._envelope.from)&&(i=!0);for(let e=0,n=this._envelope.to.length;e<n;e++){if(!this._envelope.to[e]||/[\r\n<>]/.test(this._envelope.to[e]))return t(this._formatError("Invalid recipient "+JSON.stringify(this._envelope.to[e]),"EENVELOPE",!1,"API"));/[\x80-\uFFFF]/.test(this._envelope.to[e])&&(i=!0)}if(this._envelope.rcptQueue=JSON.parse(JSON.stringify(this._envelope.to||[])),this._envelope.rejected=[],this._envelope.rejectedErrors=[],this._envelope.accepted=[],this._envelope.dsn)try{this._envelope.dsn=this._setDsnEnvelope(this._envelope.dsn)}catch(e){return t(this._formatError("Invalid DSN "+e.message,"EENVELOPE",!1,"API"))}this._responseActions.push(e=>{this._actionMAIL(e,t)}),i&&this._supportedExtensions.includes("SMTPUTF8")&&(n.push("SMTPUTF8"),this._usingSmtpUtf8=!0),this._envelope.use8BitMime&&this._supportedExtensions.includes("8BITMIME")&&(n.push("BODY=8BITMIME"),this._using8BitMime=!0),this._envelope.size&&this._supportedExtensions.includes("SIZE")&&n.push("SIZE="+this._envelope.size),this._envelope.dsn&&this._supportedExtensions.includes("DSN")&&(this._envelope.dsn.ret&&n.push("RET="+u.encodeXText(this._envelope.dsn.ret)),this._envelope.dsn.envid&&n.push("ENVID="+u.encodeXText(this._envelope.dsn.envid))),this._sendCommand("MAIL FROM:<"+this._envelope.from+">"+(n.length?" "+n.join(" "):""))}_setDsnEnvelope(e){let t=(e.ret||e.return||"").toString().toUpperCase()||null;if(t)switch(t){case"HDRS":case"HEADERS":t="HDRS";break;case"FULL":case"BODY":t="FULL"}if(t&&!["FULL","HDRS"].includes(t))throw new Error("ret: "+JSON.stringify(t));let n=(e.envid||e.id||"").toString()||null,i=e.notify||null;if(i){"string"==typeof i&&(i=i.split(",")),i=i.map(e=>e.trim().toUpperCase());let e=["NEVER","SUCCESS","FAILURE","DELAY"];if(i.filter(t=>!e.includes(t)).length||i.length>1&&i.includes("NEVER"))throw new Error("notify: "+JSON.stringify(i.join(",")));i=i.join(",")}let o=(e.orcpt||e.recipient||"").toString()||null;return o&&o.indexOf(";")<0&&(o="rfc822;"+o),{ret:t,envid:n,notify:i,orcpt:o}}_getDsnRcptToArgs(){let e=[];return this._envelope.dsn&&this._supportedExtensions.includes("DSN")&&(this._envelope.dsn.notify&&e.push("NOTIFY="+u.encodeXText(this._envelope.dsn.notify)),this._envelope.dsn.orcpt&&e.push("ORCPT="+u.encodeXText(this._envelope.dsn.orcpt))),e.length?" "+e.join(" "):""}_createSendStream(e){let t,n=new l;return this.options.lmtp?this._envelope.accepted.forEach((t,n)=>{let i=n===this._envelope.accepted.length-1;this._responseActions.push(n=>{this._actionLMTPStream(t,i,n,e)})}):this._responseActions.push(t=>{this._actionSMTPStream(t,e)}),n.pipe(this._socket,{end:!1}),this.options.debug&&(t=new p,t.on("readable",()=>{let e;for(;e=t.read();)this.logger.debug({tnx:"message"},e.toString("binary").replace(/\r?\n$/,""))}),n.pipe(t)),n.once("end",()=>{this.logger.info({tnx:"message",inByteCount:n.inByteCount,outByteCount:n.outByteCount},"<%s bytes encoded mime message (source size %s bytes)>",n.outByteCount,n.inByteCount)}),n}_actionGreeting(e){clearTimeout(this._greetingTimeout),"220"===e.substr(0,3)?this.options.lmtp?(this._responseActions.push(this._actionLHLO),this._sendCommand("LHLO "+this.name)):(this._responseActions.push(this._actionEHLO),this._sendCommand("EHLO "+this.name)):this._onError(new Error("Invalid greeting. response="+e),"EPROTOCOL",e,"CONN")}_actionLHLO(e){"2"===e.charAt(0)?this._actionEHLO(e):this._onError(new Error("Invalid LHLO. response="+e),"EPROTOCOL",e,"LHLO")}_actionEHLO(e){let t;if("421"!==e.substr(0,3)){if("2"!==e.charAt(0))return this.options.requireTLS?void this._onError(new Error("EHLO failed but HELO does not support required STARTTLS. response="+e),"ECONNECTION",e,"EHLO"):(this._responseActions.push(this._actionHELO),void this._sendCommand("HELO "+this.name));if(!this.secure&&!this.options.ignoreTLS&&(/[ -]STARTTLS\b/im.test(e)||this.options.requireTLS))return this._sendCommand("STARTTLS"),void this._responseActions.push(this._actionSTARTTLS);/[ -]SMTPUTF8\b/im.test(e)&&this._supportedExtensions.push("SMTPUTF8"),/[ -]DSN\b/im.test(e)&&this._supportedExtensions.push("DSN"),/[ -]8BITMIME\b/im.test(e)&&this._supportedExtensions.push("8BITMIME"),/[ -]PIPELINING\b/im.test(e)&&this._supportedExtensions.push("PIPELINING"),/[ -]AUTH\b/i.test(e)&&(this.allowsAuth=!0),/[ -]AUTH(?:(\s+|=)[^\n]*\s+|\s+|=)PLAIN/i.test(e)&&this._supportedAuth.push("PLAIN"),/[ -]AUTH(?:(\s+|=)[^\n]*\s+|\s+|=)LOGIN/i.test(e)&&this._supportedAuth.push("LOGIN"),/[ -]AUTH(?:(\s+|=)[^\n]*\s+|\s+|=)CRAM-MD5/i.test(e)&&this._supportedAuth.push("CRAM-MD5"),/[ -]AUTH(?:(\s+|=)[^\n]*\s+|\s+|=)XOAUTH2/i.test(e)&&this._supportedAuth.push("XOAUTH2"),(t=e.match(/[ -]SIZE(?:[ \t]+(\d+))?/im))&&(this._supportedExtensions.push("SIZE"),this._maxAllowedSize=Number(t[1])||0),this.emit("connect")}else this._onError(new Error("Server terminates connection. response="+e),"ECONNECTION",e,"EHLO")}_actionHELO(e){"2"===e.charAt(0)?(this.allowsAuth=!0,this.emit("connect")):this._onError(new Error("Invalid HELO. response="+e),"EPROTOCOL",e,"HELO")}_actionSTARTTLS(e){if("2"!==e.charAt(0))return this.options.opportunisticTLS?(this.logger.info({tnx:"smtp"},"Failed STARTTLS upgrade, continuing unencrypted"),this.emit("connect")):void this._onError(new Error("Error upgrading connection with STARTTLS"),"ETLS",e,"STARTTLS");this._upgradeConnection((e,t)=>{e?this._onError(new Error("Error initiating TLS - "+(e.message||e)),"ETLS",!1,"STARTTLS"):(this.logger.info({tnx:"smtp"},"Connection upgraded with STARTTLS"),t?this.options.lmtp?(this._responseActions.push(this._actionLHLO),this._sendCommand("LHLO "+this.name)):(this._responseActions.push(this._actionEHLO),this._sendCommand("EHLO "+this.name)):this.emit("connect"))})}_actionAUTH_LOGIN_USER(e,t){/^334[ -]/.test(e)?(this._responseActions.push(e=>{this._actionAUTH_LOGIN_PASS(e,t)}),this._sendCommand(Buffer.from(this._auth.credentials.user+"","utf-8").toString("base64"))):t(this._formatError('Invalid login sequence while waiting for "334 VXNlcm5hbWU6"',"EAUTH",e,"AUTH LOGIN"))}_actionAUTH_CRAM_MD5(e,t){let n=e.match(/^334\s+(.+)$/),i="";if(!n)return t(this._formatError("Invalid login sequence while waiting for server challenge string","EAUTH",e,"AUTH CRAM-MD5"));i=n[1];let o=Buffer.from(i,"base64").toString("ascii"),r=c.createHmac("md5",this._auth.credentials.pass);r.update(o);let s=r.digest("hex"),a=this._auth.credentials.user+" "+s;this._responseActions.push(e=>{this._actionAUTH_CRAM_MD5_PASS(e,t)}),this._sendCommand(Buffer.from(a).toString("base64"))}_actionAUTH_CRAM_MD5_PASS(e,t){if(!e.match(/^235\s+/))return t(this._formatError('Invalid login sequence while waiting for "235"',"EAUTH",e,"AUTH CRAM-MD5"));this.logger.info({tnx:"smtp",username:this._auth.user,action:"authenticated",method:this._authMethod},"User %s authenticated",JSON.stringify(this._auth.user)),this.authenticated=!0,t(null,!0)}_actionAUTH_LOGIN_PASS(e,t){if(!/^334[ -]/.test(e))return t(this._formatError('Invalid login sequence while waiting for "334 UGFzc3dvcmQ6"',"EAUTH",e,"AUTH LOGIN"));this._responseActions.push(e=>{this._actionAUTHComplete(e,t)}),this._sendCommand(Buffer.from(this._auth.credentials.pass+"","utf-8").toString("base64"))}_actionAUTHComplete(e,t,n){return n||"function"!=typeof t||(n=t,t=!1),"334"===e.substr(0,3)?(this._responseActions.push(e=>{t||"XOAUTH2"!==this._authMethod?this._actionAUTHComplete(e,!0,n):setImmediate(()=>this._handleXOauth2Token(!0,n))}),void this._sendCommand("")):"2"!==e.charAt(0)?(this.logger.info({tnx:"smtp",username:this._auth.user,action:"authfail",method:this._authMethod},"User %s failed to authenticate",JSON.stringify(this._auth.user)),n(this._formatError("Invalid login","EAUTH",e,"AUTH "+this._authMethod))):(this.logger.info({tnx:"smtp",username:this._auth.user,action:"authenticated",method:this._authMethod},"User %s authenticated",JSON.stringify(this._auth.user)),this.authenticated=!0,void n(null,!0))}_actionMAIL(e,t){let n,i;if(2!==Number(e.charAt(0)))return n=this._usingSmtpUtf8&&/^550 /.test(e)&&/[\x80-\uFFFF]/.test(this._envelope.from)?"Internationalized mailbox name not allowed":"Mail command failed",t(this._formatError(n,"EENVELOPE",e,"MAIL FROM"));if(!this._envelope.rcptQueue.length)return t(this._formatError("Can't send mail - no recipients defined","EENVELOPE",!1,"API"));if(this._recipientQueue=[],this._supportedExtensions.includes("PIPELINING"))for(;this._envelope.rcptQueue.length;)i=this._envelope.rcptQueue.shift(),this._recipientQueue.push(i),this._responseActions.push(e=>{this._actionRCPT(e,t)}),this._sendCommand("RCPT TO:<"+i+">"+this._getDsnRcptToArgs());else i=this._envelope.rcptQueue.shift(),this._recipientQueue.push(i),this._responseActions.push(e=>{this._actionRCPT(e,t)}),this._sendCommand("RCPT TO:<"+i+">"+this._getDsnRcptToArgs())}_actionRCPT(e,t){let n,i,o=this._recipientQueue.shift();if(2!==Number(e.charAt(0))?(n=this._usingSmtpUtf8&&/^553 /.test(e)&&/[\x80-\uFFFF]/.test(o)?"Internationalized mailbox name not allowed":"Recipient command failed",this._envelope.rejected.push(o),i=this._formatError(n,"EENVELOPE",e,"RCPT TO"),i.recipient=o,this._envelope.rejectedErrors.push(i)):this._envelope.accepted.push(o),this._envelope.rcptQueue.length||this._recipientQueue.length)this._envelope.rcptQueue.length&&(o=this._envelope.rcptQueue.shift(),this._recipientQueue.push(o),this._responseActions.push(e=>{this._actionRCPT(e,t)}),this._sendCommand("RCPT TO:<"+o+">"+this._getDsnRcptToArgs()));else{if(!(this._envelope.rejected.length<this._envelope.to.length))return i=this._formatError("Can't send mail - all recipients were rejected","EENVELOPE",e,"RCPT TO"),i.rejected=this._envelope.rejected,i.rejectedErrors=this._envelope.rejectedErrors,t(i);this._responseActions.push(e=>{this._actionDATA(e,t)}),this._sendCommand("DATA")}}_actionDATA(e,t){if(!/^[23]/.test(e))return t(this._formatError("Data command failed","EENVELOPE",e,"DATA"));let n={accepted:this._envelope.accepted,rejected:this._envelope.rejected};this._envelope.rejectedErrors.length&&(n.rejectedErrors=this._envelope.rejectedErrors),t(null,n)}_actionSMTPStream(e,t){return 2!==Number(e.charAt(0))?t(this._formatError("Message failed","EMESSAGE",e,"DATA")):t(null,e)}_actionLMTPStream(e,t,n,i){let o;if(2!==Number(n.charAt(0))){o=this._formatError("Message failed for recipient "+e,"EMESSAGE",n,"DATA"),o.recipient=e,this._envelope.rejected.push(e),this._envelope.rejectedErrors.push(o);for(let t=0,n=this._envelope.accepted.length;t<n;t++)this._envelope.accepted[t]===e&&this._envelope.accepted.splice(t,1)}if(t)return i(null,n)}_handleXOauth2Token(e,t){this._auth.oauth2.getToken(e,(n,i)=>{if(n)return this.logger.info({tnx:"smtp",username:this._auth.user,action:"authfail",method:this._authMethod},"User %s failed to authenticate",JSON.stringify(this._auth.user)),t(this._formatError(n,"EAUTH",!1,"AUTH XOAUTH2"));this._responseActions.push(n=>{this._actionAUTHComplete(n,e,t)}),this._sendCommand("AUTH XOAUTH2 "+this._auth.oauth2.buildXOAuth2Token(i))})}_isDestroyedMessage(e){if(this._destroyed)return"Cannot "+e+" - smtp connection is already destroyed.";if(this._socket){if(this._socket.destroyed)return"Cannot "+e+" - smtp connection socket is already destroyed.";if(!this._socket.writable)return"Cannot "+e+" - smtp connection socket is already half-closed."}}_getHostname(){let e=a.hostname()||"";return e.indexOf(".")<0&&(e="[127.0.0.1]"),e.match(/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/)&&(e="["+e+"]"),e}}},function(e,t,n){"use strict";const i=n(14).Transform;e.exports=class extends i{constructor(e){super(e),this.options=e||{},this.lastByte=!1}_transform(e,t,n){let i,o=0;for(let t=0,n=e.length;t<n;t++)10===e[t]&&(t&&13!==e[t-1]||!t&&13!==this.lastByte)&&(t>o&&(i=e.slice(o,t),this.push(i)),this.push(Buffer.from("\r\n")),o=t+1);o&&o<e.length?(i=e.slice(o),this.push(i)):o||this.push(e),this.lastByte=e[e.length-1],n()}}},,function(e,t,n){var i,o,r=n(43),s=n(303),a=r.process,c=a&&a.versions,l=c&&c.v8;l?o=(i=l.split("."))[0]+i[1]:s&&(!(i=s.match(/Edge\/(\d+)/))||i[1]>=74)&&(i=s.match(/Chrome\/(\d+)/))&&(o=i[1]),e.exports=o&&+o},function(e,t,n){"use strict";const i=n(66),o=new Map([["application/acad","dwg"],["application/applixware","aw"],["application/arj","arj"],["application/atom+xml","xml"],["application/atomcat+xml","atomcat"],["application/atomsvc+xml","atomsvc"],["application/base64",["mm","mme"]],["application/binhex","hqx"],["application/binhex4","hqx"],["application/book",["book","boo"]],["application/ccxml+xml,","ccxml"],["application/cdf","cdf"],["application/cdmi-capability","cdmia"],["application/cdmi-container","cdmic"],["application/cdmi-domain","cdmid"],["application/cdmi-object","cdmio"],["application/cdmi-queue","cdmiq"],["application/clariscad","ccad"],["application/commonground","dp"],["application/cu-seeme","cu"],["application/davmount+xml","davmount"],["application/drafting","drw"],["application/dsptype","tsp"],["application/dssc+der","dssc"],["application/dssc+xml","xdssc"],["application/dxf","dxf"],["application/ecmascript",["js","es"]],["application/emma+xml","emma"],["application/envoy","evy"],["application/epub+zip","epub"],["application/excel",["xls","xl","xla","xlb","xlc","xld","xlk","xll","xlm","xlt","xlv","xlw"]],["application/exi","exi"],["application/font-tdpfr","pfr"],["application/fractals","fif"],["application/freeloader","frl"],["application/futuresplash","spl"],["application/gnutar","tgz"],["application/groupwise","vew"],["application/hlp","hlp"],["application/hta","hta"],["application/hyperstudio","stk"],["application/i-deas","unv"],["application/iges",["iges","igs"]],["application/inf","inf"],["application/internet-property-stream","acx"],["application/ipfix","ipfix"],["application/java","class"],["application/java-archive","jar"],["application/java-byte-code","class"],["application/java-serialized-object","ser"],["application/java-vm","class"],["application/javascript","js"],["application/json","json"],["application/lha","lha"],["application/lzx","lzx"],["application/mac-binary","bin"],["application/mac-binhex","hqx"],["application/mac-binhex40","hqx"],["application/mac-compactpro","cpt"],["application/macbinary","bin"],["application/mads+xml","mads"],["application/marc","mrc"],["application/marcxml+xml","mrcx"],["application/mathematica","ma"],["application/mathml+xml","mathml"],["application/mbedlet","mbd"],["application/mbox","mbox"],["application/mcad","mcd"],["application/mediaservercontrol+xml","mscml"],["application/metalink4+xml","meta4"],["application/mets+xml","mets"],["application/mime","aps"],["application/mods+xml","mods"],["application/mp21","m21"],["application/mp4","mp4"],["application/mspowerpoint",["ppt","pot","pps","ppz"]],["application/msword",["doc","dot","w6w","wiz","word"]],["application/mswrite","wri"],["application/mxf","mxf"],["application/netmc","mcp"],["application/octet-stream",["*"]],["application/oda","oda"],["application/oebps-package+xml","opf"],["application/ogg","ogx"],["application/olescript","axs"],["application/onenote","onetoc"],["application/patch-ops-error+xml","xer"],["application/pdf","pdf"],["application/pgp-encrypted","asc"],["application/pgp-signature","pgp"],["application/pics-rules","prf"],["application/pkcs-12","p12"],["application/pkcs-crl","crl"],["application/pkcs10","p10"],["application/pkcs7-mime",["p7c","p7m"]],["application/pkcs7-signature","p7s"],["application/pkcs8","p8"],["application/pkix-attr-cert","ac"],["application/pkix-cert",["cer","crt"]],["application/pkix-crl","crl"],["application/pkix-pkipath","pkipath"],["application/pkixcmp","pki"],["application/plain","text"],["application/pls+xml","pls"],["application/postscript",["ps","ai","eps"]],["application/powerpoint","ppt"],["application/pro_eng",["part","prt"]],["application/prs.cww","cww"],["application/pskc+xml","pskcxml"],["application/rdf+xml","rdf"],["application/reginfo+xml","rif"],["application/relax-ng-compact-syntax","rnc"],["application/resource-lists+xml","rl"],["application/resource-lists-diff+xml","rld"],["application/ringing-tones","rng"],["application/rls-services+xml","rs"],["application/rsd+xml","rsd"],["application/rss+xml","xml"],["application/rtf",["rtf","rtx"]],["application/sbml+xml","sbml"],["application/scvp-cv-request","scq"],["application/scvp-cv-response","scs"],["application/scvp-vp-request","spq"],["application/scvp-vp-response","spp"],["application/sdp","sdp"],["application/sea","sea"],["application/set","set"],["application/set-payment-initiation","setpay"],["application/set-registration-initiation","setreg"],["application/shf+xml","shf"],["application/sla","stl"],["application/smil",["smi","smil"]],["application/smil+xml","smi"],["application/solids","sol"],["application/sounder","sdr"],["application/sparql-query","rq"],["application/sparql-results+xml","srx"],["application/srgs","gram"],["application/srgs+xml","grxml"],["application/sru+xml","sru"],["application/ssml+xml","ssml"],["application/step",["step","stp"]],["application/streamingmedia","ssm"],["application/tei+xml","tei"],["application/thraud+xml","tfi"],["application/timestamped-data","tsd"],["application/toolbook","tbk"],["application/vda","vda"],["application/vnd.3gpp.pic-bw-large","plb"],["application/vnd.3gpp.pic-bw-small","psb"],["application/vnd.3gpp.pic-bw-var","pvb"],["application/vnd.3gpp2.tcap","tcap"],["application/vnd.3m.post-it-notes","pwn"],["application/vnd.accpac.simply.aso","aso"],["application/vnd.accpac.simply.imp","imp"],["application/vnd.acucobol","acu"],["application/vnd.acucorp","atc"],["application/vnd.adobe.air-application-installer-package+zip","air"],["application/vnd.adobe.fxp","fxp"],["application/vnd.adobe.xdp+xml","xdp"],["application/vnd.adobe.xfdf","xfdf"],["application/vnd.ahead.space","ahead"],["application/vnd.airzip.filesecure.azf","azf"],["application/vnd.airzip.filesecure.azs","azs"],["application/vnd.amazon.ebook","azw"],["application/vnd.americandynamics.acc","acc"],["application/vnd.amiga.ami","ami"],["application/vnd.android.package-archive","apk"],["application/vnd.anser-web-certificate-issue-initiation","cii"],["application/vnd.anser-web-funds-transfer-initiation","fti"],["application/vnd.antix.game-component","atx"],["application/vnd.apple.installer+xml","mpkg"],["application/vnd.apple.mpegurl","m3u8"],["application/vnd.aristanetworks.swi","swi"],["application/vnd.audiograph","aep"],["application/vnd.blueice.multipass","mpm"],["application/vnd.bmi","bmi"],["application/vnd.businessobjects","rep"],["application/vnd.chemdraw+xml","cdxml"],["application/vnd.chipnuts.karaoke-mmd","mmd"],["application/vnd.cinderella","cdy"],["application/vnd.claymore","cla"],["application/vnd.cloanto.rp9","rp9"],["application/vnd.clonk.c4group","c4g"],["application/vnd.cluetrust.cartomobile-config","c11amc"],["application/vnd.cluetrust.cartomobile-config-pkg","c11amz"],["application/vnd.commonspace","csp"],["application/vnd.contact.cmsg","cdbcmsg"],["application/vnd.cosmocaller","cmc"],["application/vnd.crick.clicker","clkx"],["application/vnd.crick.clicker.keyboard","clkk"],["application/vnd.crick.clicker.palette","clkp"],["application/vnd.crick.clicker.template","clkt"],["application/vnd.crick.clicker.wordbank","clkw"],["application/vnd.criticaltools.wbs+xml","wbs"],["application/vnd.ctc-posml","pml"],["application/vnd.cups-ppd","ppd"],["application/vnd.curl.car","car"],["application/vnd.curl.pcurl","pcurl"],["application/vnd.data-vision.rdz","rdz"],["application/vnd.denovo.fcselayout-link","fe_launch"],["application/vnd.dna","dna"],["application/vnd.dolby.mlp","mlp"],["application/vnd.dpgraph","dpg"],["application/vnd.dreamfactory","dfac"],["application/vnd.dvb.ait","ait"],["application/vnd.dvb.service","svc"],["application/vnd.dynageo","geo"],["application/vnd.ecowin.chart","mag"],["application/vnd.enliven","nml"],["application/vnd.epson.esf","esf"],["application/vnd.epson.msf","msf"],["application/vnd.epson.quickanime","qam"],["application/vnd.epson.salt","slt"],["application/vnd.epson.ssf","ssf"],["application/vnd.eszigno3+xml","es3"],["application/vnd.ezpix-album","ez2"],["application/vnd.ezpix-package","ez3"],["application/vnd.fdf","fdf"],["application/vnd.fdsn.seed","seed"],["application/vnd.flographit","gph"],["application/vnd.fluxtime.clip","ftc"],["application/vnd.framemaker","fm"],["application/vnd.frogans.fnc","fnc"],["application/vnd.frogans.ltf","ltf"],["application/vnd.fsc.weblaunch","fsc"],["application/vnd.fujitsu.oasys","oas"],["application/vnd.fujitsu.oasys2","oa2"],["application/vnd.fujitsu.oasys3","oa3"],["application/vnd.fujitsu.oasysgp","fg5"],["application/vnd.fujitsu.oasysprs","bh2"],["application/vnd.fujixerox.ddd","ddd"],["application/vnd.fujixerox.docuworks","xdw"],["application/vnd.fujixerox.docuworks.binder","xbd"],["application/vnd.fuzzysheet","fzs"],["application/vnd.genomatix.tuxedo","txd"],["application/vnd.geogebra.file","ggb"],["application/vnd.geogebra.tool","ggt"],["application/vnd.geometry-explorer","gex"],["application/vnd.geonext","gxt"],["application/vnd.geoplan","g2w"],["application/vnd.geospace","g3w"],["application/vnd.gmx","gmx"],["application/vnd.google-earth.kml+xml","kml"],["application/vnd.google-earth.kmz","kmz"],["application/vnd.grafeq","gqf"],["application/vnd.groove-account","gac"],["application/vnd.groove-help","ghf"],["application/vnd.groove-identity-message","gim"],["application/vnd.groove-injector","grv"],["application/vnd.groove-tool-message","gtm"],["application/vnd.groove-tool-template","tpl"],["application/vnd.groove-vcard","vcg"],["application/vnd.hal+xml","hal"],["application/vnd.handheld-entertainment+xml","zmm"],["application/vnd.hbci","hbci"],["application/vnd.hhe.lesson-player","les"],["application/vnd.hp-hpgl",["hgl","hpg","hpgl"]],["application/vnd.hp-hpid","hpid"],["application/vnd.hp-hps","hps"],["application/vnd.hp-jlyt","jlt"],["application/vnd.hp-pcl","pcl"],["application/vnd.hp-pclxl","pclxl"],["application/vnd.hydrostatix.sof-data","sfd-hdstx"],["application/vnd.hzn-3d-crossword","x3d"],["application/vnd.ibm.minipay","mpy"],["application/vnd.ibm.modcap","afp"],["application/vnd.ibm.rights-management","irm"],["application/vnd.ibm.secure-container","sc"],["application/vnd.iccprofile","icc"],["application/vnd.igloader","igl"],["application/vnd.immervision-ivp","ivp"],["application/vnd.immervision-ivu","ivu"],["application/vnd.insors.igm","igm"],["application/vnd.intercon.formnet","xpw"],["application/vnd.intergeo","i2g"],["application/vnd.intu.qbo","qbo"],["application/vnd.intu.qfx","qfx"],["application/vnd.ipunplugged.rcprofile","rcprofile"],["application/vnd.irepository.package+xml","irp"],["application/vnd.is-xpr","xpr"],["application/vnd.isac.fcs","fcs"],["application/vnd.jam","jam"],["application/vnd.jcp.javame.midlet-rms","rms"],["application/vnd.jisp","jisp"],["application/vnd.joost.joda-archive","joda"],["application/vnd.kahootz","ktz"],["application/vnd.kde.karbon","karbon"],["application/vnd.kde.kchart","chrt"],["application/vnd.kde.kformula","kfo"],["application/vnd.kde.kivio","flw"],["application/vnd.kde.kontour","kon"],["application/vnd.kde.kpresenter","kpr"],["application/vnd.kde.kspread","ksp"],["application/vnd.kde.kword","kwd"],["application/vnd.kenameaapp","htke"],["application/vnd.kidspiration","kia"],["application/vnd.kinar","kne"],["application/vnd.koan","skp"],["application/vnd.kodak-descriptor","sse"],["application/vnd.las.las+xml","lasxml"],["application/vnd.llamagraphics.life-balance.desktop","lbd"],["application/vnd.llamagraphics.life-balance.exchange+xml","lbe"],["application/vnd.lotus-1-2-3","123"],["application/vnd.lotus-approach","apr"],["application/vnd.lotus-freelance","pre"],["application/vnd.lotus-notes","nsf"],["application/vnd.lotus-organizer","org"],["application/vnd.lotus-screencam","scm"],["application/vnd.lotus-wordpro","lwp"],["application/vnd.macports.portpkg","portpkg"],["application/vnd.mcd","mcd"],["application/vnd.medcalcdata","mc1"],["application/vnd.mediastation.cdkey","cdkey"],["application/vnd.mfer","mwf"],["application/vnd.mfmp","mfm"],["application/vnd.micrografx.flo","flo"],["application/vnd.micrografx.igx","igx"],["application/vnd.mif","mif"],["application/vnd.mobius.daf","daf"],["application/vnd.mobius.dis","dis"],["application/vnd.mobius.mbk","mbk"],["application/vnd.mobius.mqy","mqy"],["application/vnd.mobius.msl","msl"],["application/vnd.mobius.plc","plc"],["application/vnd.mobius.txf","txf"],["application/vnd.mophun.application","mpn"],["application/vnd.mophun.certificate","mpc"],["application/vnd.mozilla.xul+xml","xul"],["application/vnd.ms-artgalry","cil"],["application/vnd.ms-cab-compressed","cab"],["application/vnd.ms-excel",["xls","xla","xlc","xlm","xlt","xlw","xlb","xll"]],["application/vnd.ms-excel.addin.macroenabled.12","xlam"],["application/vnd.ms-excel.sheet.binary.macroenabled.12","xlsb"],["application/vnd.ms-excel.sheet.macroenabled.12","xlsm"],["application/vnd.ms-excel.template.macroenabled.12","xltm"],["application/vnd.ms-fontobject","eot"],["application/vnd.ms-htmlhelp","chm"],["application/vnd.ms-ims","ims"],["application/vnd.ms-lrm","lrm"],["application/vnd.ms-officetheme","thmx"],["application/vnd.ms-outlook","msg"],["application/vnd.ms-pki.certstore","sst"],["application/vnd.ms-pki.pko","pko"],["application/vnd.ms-pki.seccat","cat"],["application/vnd.ms-pki.stl","stl"],["application/vnd.ms-pkicertstore","sst"],["application/vnd.ms-pkiseccat","cat"],["application/vnd.ms-pkistl","stl"],["application/vnd.ms-powerpoint",["ppt","pot","pps","ppa","pwz"]],["application/vnd.ms-powerpoint.addin.macroenabled.12","ppam"],["application/vnd.ms-powerpoint.presentation.macroenabled.12","pptm"],["application/vnd.ms-powerpoint.slide.macroenabled.12","sldm"],["application/vnd.ms-powerpoint.slideshow.macroenabled.12","ppsm"],["application/vnd.ms-powerpoint.template.macroenabled.12","potm"],["application/vnd.ms-project","mpp"],["application/vnd.ms-word.document.macroenabled.12","docm"],["application/vnd.ms-word.template.macroenabled.12","dotm"],["application/vnd.ms-works",["wks","wcm","wdb","wps"]],["application/vnd.ms-wpl","wpl"],["application/vnd.ms-xpsdocument","xps"],["application/vnd.mseq","mseq"],["application/vnd.musician","mus"],["application/vnd.muvee.style","msty"],["application/vnd.neurolanguage.nlu","nlu"],["application/vnd.noblenet-directory","nnd"],["application/vnd.noblenet-sealer","nns"],["application/vnd.noblenet-web","nnw"],["application/vnd.nokia.configuration-message","ncm"],["application/vnd.nokia.n-gage.data","ngdat"],["application/vnd.nokia.n-gage.symbian.install","n-gage"],["application/vnd.nokia.radio-preset","rpst"],["application/vnd.nokia.radio-presets","rpss"],["application/vnd.nokia.ringing-tone","rng"],["application/vnd.novadigm.edm","edm"],["application/vnd.novadigm.edx","edx"],["application/vnd.novadigm.ext","ext"],["application/vnd.oasis.opendocument.chart","odc"],["application/vnd.oasis.opendocument.chart-template","otc"],["application/vnd.oasis.opendocument.database","odb"],["application/vnd.oasis.opendocument.formula","odf"],["application/vnd.oasis.opendocument.formula-template","odft"],["application/vnd.oasis.opendocument.graphics","odg"],["application/vnd.oasis.opendocument.graphics-template","otg"],["application/vnd.oasis.opendocument.image","odi"],["application/vnd.oasis.opendocument.image-template","oti"],["application/vnd.oasis.opendocument.presentation","odp"],["application/vnd.oasis.opendocument.presentation-template","otp"],["application/vnd.oasis.opendocument.spreadsheet","ods"],["application/vnd.oasis.opendocument.spreadsheet-template","ots"],["application/vnd.oasis.opendocument.text","odt"],["application/vnd.oasis.opendocument.text-master","odm"],["application/vnd.oasis.opendocument.text-template","ott"],["application/vnd.oasis.opendocument.text-web","oth"],["application/vnd.olpc-sugar","xo"],["application/vnd.oma.dd2+xml","dd2"],["application/vnd.openofficeorg.extension","oxt"],["application/vnd.openxmlformats-officedocument.presentationml.presentation","pptx"],["application/vnd.openxmlformats-officedocument.presentationml.slide","sldx"],["application/vnd.openxmlformats-officedocument.presentationml.slideshow","ppsx"],["application/vnd.openxmlformats-officedocument.presentationml.template","potx"],["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","xlsx"],["application/vnd.openxmlformats-officedocument.spreadsheetml.template","xltx"],["application/vnd.openxmlformats-officedocument.wordprocessingml.document","docx"],["application/vnd.openxmlformats-officedocument.wordprocessingml.template","dotx"],["application/vnd.osgeo.mapguide.package","mgp"],["application/vnd.osgi.dp","dp"],["application/vnd.palm","pdb"],["application/vnd.pawaafile","paw"],["application/vnd.pg.format","str"],["application/vnd.pg.osasli","ei6"],["application/vnd.picsel","efif"],["application/vnd.pmi.widget","wg"],["application/vnd.pocketlearn","plf"],["application/vnd.powerbuilder6","pbd"],["application/vnd.previewsystems.box","box"],["application/vnd.proteus.magazine","mgz"],["application/vnd.publishare-delta-tree","qps"],["application/vnd.pvi.ptid1","ptid"],["application/vnd.quark.quarkxpress","qxd"],["application/vnd.realvnc.bed","bed"],["application/vnd.recordare.musicxml","mxl"],["application/vnd.recordare.musicxml+xml","musicxml"],["application/vnd.rig.cryptonote","cryptonote"],["application/vnd.rim.cod","cod"],["application/vnd.rn-realmedia","rm"],["application/vnd.rn-realplayer","rnx"],["application/vnd.route66.link66+xml","link66"],["application/vnd.sailingtracker.track","st"],["application/vnd.seemail","see"],["application/vnd.sema","sema"],["application/vnd.semd","semd"],["application/vnd.semf","semf"],["application/vnd.shana.informed.formdata","ifm"],["application/vnd.shana.informed.formtemplate","itp"],["application/vnd.shana.informed.interchange","iif"],["application/vnd.shana.informed.package","ipk"],["application/vnd.simtech-mindmapper","twd"],["application/vnd.smaf","mmf"],["application/vnd.smart.teacher","teacher"],["application/vnd.solent.sdkm+xml","sdkm"],["application/vnd.spotfire.dxp","dxp"],["application/vnd.spotfire.sfs","sfs"],["application/vnd.stardivision.calc","sdc"],["application/vnd.stardivision.draw","sda"],["application/vnd.stardivision.impress","sdd"],["application/vnd.stardivision.math","smf"],["application/vnd.stardivision.writer","sdw"],["application/vnd.stardivision.writer-global","sgl"],["application/vnd.stepmania.stepchart","sm"],["application/vnd.sun.xml.calc","sxc"],["application/vnd.sun.xml.calc.template","stc"],["application/vnd.sun.xml.draw","sxd"],["application/vnd.sun.xml.draw.template","std"],["application/vnd.sun.xml.impress","sxi"],["application/vnd.sun.xml.impress.template","sti"],["application/vnd.sun.xml.math","sxm"],["application/vnd.sun.xml.writer","sxw"],["application/vnd.sun.xml.writer.global","sxg"],["application/vnd.sun.xml.writer.template","stw"],["application/vnd.sus-calendar","sus"],["application/vnd.svd","svd"],["application/vnd.symbian.install","sis"],["application/vnd.syncml+xml","xsm"],["application/vnd.syncml.dm+wbxml","bdm"],["application/vnd.syncml.dm+xml","xdm"],["application/vnd.tao.intent-module-archive","tao"],["application/vnd.tmobile-livetv","tmo"],["application/vnd.trid.tpt","tpt"],["application/vnd.triscape.mxs","mxs"],["application/vnd.trueapp","tra"],["application/vnd.ufdl","ufd"],["application/vnd.uiq.theme","utz"],["application/vnd.umajin","umj"],["application/vnd.unity","unityweb"],["application/vnd.uoml+xml","uoml"],["application/vnd.vcx","vcx"],["application/vnd.visio","vsd"],["application/vnd.visionary","vis"],["application/vnd.vsf","vsf"],["application/vnd.wap.wbxml","wbxml"],["application/vnd.wap.wmlc","wmlc"],["application/vnd.wap.wmlscriptc","wmlsc"],["application/vnd.webturbo","wtb"],["application/vnd.wolfram.player","nbp"],["application/vnd.wordperfect","wpd"],["application/vnd.wqd","wqd"],["application/vnd.wt.stf","stf"],["application/vnd.xara",["web","xar"]],["application/vnd.xfdl","xfdl"],["application/vnd.yamaha.hv-dic","hvd"],["application/vnd.yamaha.hv-script","hvs"],["application/vnd.yamaha.hv-voice","hvp"],["application/vnd.yamaha.openscoreformat","osf"],["application/vnd.yamaha.openscoreformat.osfpvg+xml","osfpvg"],["application/vnd.yamaha.smaf-audio","saf"],["application/vnd.yamaha.smaf-phrase","spf"],["application/vnd.yellowriver-custom-menu","cmp"],["application/vnd.zul","zir"],["application/vnd.zzazz.deck+xml","zaz"],["application/vocaltec-media-desc","vmd"],["application/vocaltec-media-file","vmf"],["application/voicexml+xml","vxml"],["application/widget","wgt"],["application/winhlp","hlp"],["application/wordperfect",["wp","wp5","wp6","wpd"]],["application/wordperfect6.0",["w60","wp5"]],["application/wordperfect6.1","w61"],["application/wsdl+xml","wsdl"],["application/wspolicy+xml","wspolicy"],["application/x-123","wk1"],["application/x-7z-compressed","7z"],["application/x-abiword","abw"],["application/x-ace-compressed","ace"],["application/x-aim","aim"],["application/x-authorware-bin","aab"],["application/x-authorware-map","aam"],["application/x-authorware-seg","aas"],["application/x-bcpio","bcpio"],["application/x-binary","bin"],["application/x-binhex40","hqx"],["application/x-bittorrent","torrent"],["application/x-bsh",["bsh","sh","shar"]],["application/x-bytecode.elisp","elc"],["applicaiton/x-bytecode.python","pyc"],["application/x-bzip","bz"],["application/x-bzip2",["boz","bz2"]],["application/x-cdf","cdf"],["application/x-cdlink","vcd"],["application/x-chat",["cha","chat"]],["application/x-chess-pgn","pgn"],["application/x-cmu-raster","ras"],["application/x-cocoa","cco"],["application/x-compactpro","cpt"],["application/x-compress","z"],["application/x-compressed",["tgz","gz","z","zip"]],["application/x-conference","nsc"],["application/x-cpio","cpio"],["application/x-cpt","cpt"],["application/x-csh","csh"],["application/x-debian-package","deb"],["application/x-deepv","deepv"],["application/x-director",["dir","dcr","dxr"]],["application/x-doom","wad"],["application/x-dtbncx+xml","ncx"],["application/x-dtbook+xml","dtb"],["application/x-dtbresource+xml","res"],["application/x-dvi","dvi"],["application/x-elc","elc"],["application/x-envoy",["env","evy"]],["application/x-esrehber","es"],["application/x-excel",["xls","xla","xlb","xlc","xld","xlk","xll","xlm","xlt","xlv","xlw"]],["application/x-font-bdf","bdf"],["application/x-font-ghostscript","gsf"],["application/x-font-linux-psf","psf"],["application/x-font-otf","otf"],["application/x-font-pcf","pcf"],["application/x-font-snf","snf"],["application/x-font-ttf","ttf"],["application/x-font-type1","pfa"],["application/x-font-woff","woff"],["application/x-frame","mif"],["application/x-freelance","pre"],["application/x-futuresplash","spl"],["application/x-gnumeric","gnumeric"],["application/x-gsp","gsp"],["application/x-gss","gss"],["application/x-gtar","gtar"],["application/x-gzip",["gz","gzip"]],["application/x-hdf","hdf"],["application/x-helpfile",["help","hlp"]],["application/x-httpd-imap","imap"],["application/x-ima","ima"],["application/x-internet-signup",["ins","isp"]],["application/x-internett-signup","ins"],["application/x-inventor","iv"],["application/x-ip2","ip"],["application/x-iphone","iii"],["application/x-java-class","class"],["application/x-java-commerce","jcm"],["application/x-java-jnlp-file","jnlp"],["application/x-javascript","js"],["application/x-koan",["skd","skm","skp","skt"]],["application/x-ksh","ksh"],["application/x-latex",["latex","ltx"]],["application/x-lha","lha"],["application/x-lisp","lsp"],["application/x-livescreen","ivy"],["application/x-lotus","wq1"],["application/x-lotusscreencam","scm"],["application/x-lzh","lzh"],["application/x-lzx","lzx"],["application/x-mac-binhex40","hqx"],["application/x-macbinary","bin"],["application/x-magic-cap-package-1.0","mc$"],["application/x-mathcad","mcd"],["application/x-meme","mm"],["application/x-midi",["mid","midi"]],["application/x-mif","mif"],["application/x-mix-transfer","nix"],["application/x-mobipocket-ebook","prc"],["application/x-mplayer2","asx"],["application/x-ms-application","application"],["application/x-ms-wmd","wmd"],["application/x-ms-wmz","wmz"],["application/x-ms-xbap","xbap"],["application/x-msaccess","mdb"],["application/x-msbinder","obd"],["application/x-mscardfile","crd"],["application/x-msclip","clp"],["application/x-msdownload",["exe","dll"]],["application/x-msexcel",["xls","xla","xlw"]],["application/x-msmediaview",["mvb","m13","m14"]],["application/x-msmetafile","wmf"],["application/x-msmoney","mny"],["application/x-mspowerpoint","ppt"],["application/x-mspublisher","pub"],["application/x-msschedule","scd"],["application/x-msterminal","trm"],["application/x-mswrite","wri"],["application/x-navi-animation","ani"],["application/x-navidoc","nvd"],["application/x-navimap","map"],["application/x-navistyle","stl"],["application/x-netcdf",["cdf","nc"]],["application/x-newton-compatible-pkg","pkg"],["application/x-nokia-9000-communicator-add-on-software","aos"],["application/x-omc","omc"],["application/x-omcdatamaker","omcd"],["application/x-omcregerator","omcr"],["application/x-pagemaker",["pm4","pm5"]],["application/x-pcl","pcl"],["application/x-perfmon",["pma","pmc","pml","pmr","pmw"]],["application/x-pixclscript","plx"],["application/x-pkcs10","p10"],["application/x-pkcs12",["p12","pfx"]],["application/x-pkcs7-certificates",["p7b","spc"]],["application/x-pkcs7-certreqresp","p7r"],["application/x-pkcs7-mime",["p7m","p7c"]],["application/x-pkcs7-signature",["p7s","p7a"]],["application/x-pointplus","css"],["application/x-portable-anymap","pnm"],["application/x-project",["mpc","mpt","mpv","mpx"]],["application/x-qpro","wb1"],["application/x-rar-compressed","rar"],["application/x-rtf","rtf"],["application/x-sdp","sdp"],["application/x-sea","sea"],["application/x-seelogo","sl"],["application/x-sh","sh"],["application/x-shar",["shar","sh"]],["application/x-shockwave-flash","swf"],["application/x-silverlight-app","xap"],["application/x-sit","sit"],["application/x-sprite",["spr","sprite"]],["application/x-stuffit","sit"],["application/x-stuffitx","sitx"],["application/x-sv4cpio","sv4cpio"],["application/x-sv4crc","sv4crc"],["application/x-tar","tar"],["application/x-tbook",["sbk","tbk"]],["application/x-tcl","tcl"],["application/x-tex","tex"],["application/x-tex-tfm","tfm"],["application/x-texinfo",["texi","texinfo"]],["application/x-troff",["roff","t","tr"]],["application/x-troff-man","man"],["application/x-troff-me","me"],["application/x-troff-ms","ms"],["application/x-troff-msvideo","avi"],["application/x-ustar","ustar"],["application/x-visio",["vsd","vst","vsw"]],["application/x-vnd.audioexplosion.mzz","mzz"],["application/x-vnd.ls-xpix","xpix"],["application/x-vrml","vrml"],["application/x-wais-source",["src","wsrc"]],["application/x-winhelp","hlp"],["application/x-wintalk","wtk"],["application/x-world",["wrl","svr"]],["application/x-wpwin","wpd"],["application/x-wri","wri"],["application/x-x509-ca-cert",["cer","crt","der"]],["application/x-x509-user-cert","crt"],["application/x-xfig","fig"],["application/x-xpinstall","xpi"],["application/x-zip-compressed","zip"],["application/xcap-diff+xml","xdf"],["application/xenc+xml","xenc"],["application/xhtml+xml","xhtml"],["application/xml","xml"],["application/xml-dtd","dtd"],["application/xop+xml","xop"],["application/xslt+xml","xslt"],["application/xspf+xml","xspf"],["application/xv+xml","mxml"],["application/yang","yang"],["application/yin+xml","yin"],["application/ynd.ms-pkipko","pko"],["application/zip","zip"],["audio/adpcm","adp"],["audio/aiff",["aiff","aif","aifc"]],["audio/basic",["snd","au"]],["audio/it","it"],["audio/make",["funk","my","pfunk"]],["audio/make.my.funk","pfunk"],["audio/mid",["mid","rmi"]],["audio/midi",["midi","kar","mid"]],["audio/mod","mod"],["audio/mp4","mp4a"],["audio/mpeg",["mpga","mp3","m2a","mp2","mpa","mpg"]],["audio/mpeg3","mp3"],["audio/nspaudio",["la","lma"]],["audio/ogg","oga"],["audio/s3m","s3m"],["audio/tsp-audio","tsi"],["audio/tsplayer","tsp"],["audio/vnd.dece.audio","uva"],["audio/vnd.digital-winds","eol"],["audio/vnd.dra","dra"],["audio/vnd.dts","dts"],["audio/vnd.dts.hd","dtshd"],["audio/vnd.lucent.voice","lvp"],["audio/vnd.ms-playready.media.pya","pya"],["audio/vnd.nuera.ecelp4800","ecelp4800"],["audio/vnd.nuera.ecelp7470","ecelp7470"],["audio/vnd.nuera.ecelp9600","ecelp9600"],["audio/vnd.qcelp","qcp"],["audio/vnd.rip","rip"],["audio/voc","voc"],["audio/voxware","vox"],["audio/wav","wav"],["audio/webm","weba"],["audio/x-aac","aac"],["audio/x-adpcm","snd"],["audio/x-aiff",["aiff","aif","aifc"]],["audio/x-au","au"],["audio/x-gsm",["gsd","gsm"]],["audio/x-jam","jam"],["audio/x-liveaudio","lam"],["audio/x-mid",["mid","midi"]],["audio/x-midi",["midi","mid"]],["audio/x-mod","mod"],["audio/x-mpeg","mp2"],["audio/x-mpeg-3","mp3"],["audio/x-mpegurl","m3u"],["audio/x-mpequrl","m3u"],["audio/x-ms-wax","wax"],["audio/x-ms-wma","wma"],["audio/x-nspaudio",["la","lma"]],["audio/x-pn-realaudio",["ra","ram","rm","rmm","rmp"]],["audio/x-pn-realaudio-plugin",["ra","rmp","rpm"]],["audio/x-psid","sid"],["audio/x-realaudio","ra"],["audio/x-twinvq","vqf"],["audio/x-twinvq-plugin",["vqe","vql"]],["audio/x-vnd.audioexplosion.mjuicemediafile","mjf"],["audio/x-voc","voc"],["audio/x-wav","wav"],["audio/xm","xm"],["chemical/x-cdx","cdx"],["chemical/x-cif","cif"],["chemical/x-cmdf","cmdf"],["chemical/x-cml","cml"],["chemical/x-csml","csml"],["chemical/x-pdb",["pdb","xyz"]],["chemical/x-xyz","xyz"],["drawing/x-dwf","dwf"],["i-world/i-vrml","ivr"],["image/bmp",["bmp","bm"]],["image/cgm","cgm"],["image/cis-cod","cod"],["image/cmu-raster",["ras","rast"]],["image/fif","fif"],["image/florian",["flo","turbot"]],["image/g3fax","g3"],["image/gif","gif"],["image/ief",["ief","iefs"]],["image/jpeg",["jpeg","jpe","jpg","jfif","jfif-tbnl"]],["image/jutvision","jut"],["image/ktx","ktx"],["image/naplps",["nap","naplps"]],["image/pict",["pic","pict"]],["image/pipeg","jfif"],["image/pjpeg",["jfif","jpe","jpeg","jpg"]],["image/png",["png","x-png"]],["image/prs.btif","btif"],["image/svg+xml","svg"],["image/tiff",["tif","tiff"]],["image/vasa","mcf"],["image/vnd.adobe.photoshop","psd"],["image/vnd.dece.graphic","uvi"],["image/vnd.djvu","djvu"],["image/vnd.dvb.subtitle","sub"],["image/vnd.dwg",["dwg","dxf","svf"]],["image/vnd.dxf","dxf"],["image/vnd.fastbidsheet","fbs"],["image/vnd.fpx","fpx"],["image/vnd.fst","fst"],["image/vnd.fujixerox.edmics-mmr","mmr"],["image/vnd.fujixerox.edmics-rlc","rlc"],["image/vnd.ms-modi","mdi"],["image/vnd.net-fpx",["fpx","npx"]],["image/vnd.rn-realflash","rf"],["image/vnd.rn-realpix","rp"],["image/vnd.wap.wbmp","wbmp"],["image/vnd.xiff","xif"],["image/webp","webp"],["image/x-cmu-raster","ras"],["image/x-cmx","cmx"],["image/x-dwg",["dwg","dxf","svf"]],["image/x-freehand","fh"],["image/x-icon","ico"],["image/x-jg","art"],["image/x-jps","jps"],["image/x-niff",["niff","nif"]],["image/x-pcx","pcx"],["image/x-pict",["pct","pic"]],["image/x-portable-anymap","pnm"],["image/x-portable-bitmap","pbm"],["image/x-portable-graymap","pgm"],["image/x-portable-greymap","pgm"],["image/x-portable-pixmap","ppm"],["image/x-quicktime",["qif","qti","qtif"]],["image/x-rgb","rgb"],["image/x-tiff",["tif","tiff"]],["image/x-windows-bmp","bmp"],["image/x-xbitmap","xbm"],["image/x-xbm","xbm"],["image/x-xpixmap",["xpm","pm"]],["image/x-xwd","xwd"],["image/x-xwindowdump","xwd"],["image/xbm","xbm"],["image/xpm","xpm"],["message/rfc822",["eml","mht","mhtml","nws","mime"]],["model/iges",["iges","igs"]],["model/mesh","msh"],["model/vnd.collada+xml","dae"],["model/vnd.dwf","dwf"],["model/vnd.gdl","gdl"],["model/vnd.gtw","gtw"],["model/vnd.mts","mts"],["model/vnd.vtu","vtu"],["model/vrml",["vrml","wrl","wrz"]],["model/x-pov","pov"],["multipart/x-gzip","gzip"],["multipart/x-ustar","ustar"],["multipart/x-zip","zip"],["music/crescendo",["mid","midi"]],["music/x-karaoke","kar"],["paleovu/x-pv","pvu"],["text/asp","asp"],["text/calendar","ics"],["text/css","css"],["text/csv","csv"],["text/ecmascript","js"],["text/h323","323"],["text/html",["html","htm","stm","acgi","htmls","htx","shtml"]],["text/iuls","uls"],["text/javascript","js"],["text/mcf","mcf"],["text/n3","n3"],["text/pascal","pas"],["text/plain",["txt","bas","c","h","c++","cc","com","conf","cxx","def","f","f90","for","g","hh","idc","jav","java","list","log","lst","m","mar","pl","sdml","text"]],["text/plain-bas","par"],["text/prs.lines.tag","dsc"],["text/richtext",["rtx","rt","rtf"]],["text/scriplet","wsc"],["text/scriptlet","sct"],["text/sgml",["sgm","sgml"]],["text/tab-separated-values","tsv"],["text/troff","t"],["text/turtle","ttl"],["text/uri-list",["uni","unis","uri","uris"]],["text/vnd.abc","abc"],["text/vnd.curl","curl"],["text/vnd.curl.dcurl","dcurl"],["text/vnd.curl.mcurl","mcurl"],["text/vnd.curl.scurl","scurl"],["text/vnd.fly","fly"],["text/vnd.fmi.flexstor","flx"],["text/vnd.graphviz","gv"],["text/vnd.in3d.3dml","3dml"],["text/vnd.in3d.spot","spot"],["text/vnd.rn-realtext","rt"],["text/vnd.sun.j2me.app-descriptor","jad"],["text/vnd.wap.wml","wml"],["text/vnd.wap.wmlscript","wmls"],["text/webviewhtml","htt"],["text/x-asm",["asm","s"]],["text/x-audiosoft-intra","aip"],["text/x-c",["c","cc","cpp"]],["text/x-component","htc"],["text/x-fortran",["for","f","f77","f90"]],["text/x-h",["h","hh"]],["text/x-java-source",["java","jav"]],["text/x-java-source,java","java"],["text/x-la-asf","lsx"],["text/x-m","m"],["text/x-pascal","p"],["text/x-script","hlb"],["text/x-script.csh","csh"],["text/x-script.elisp","el"],["text/x-script.guile","scm"],["text/x-script.ksh","ksh"],["text/x-script.lisp","lsp"],["text/x-script.perl","pl"],["text/x-script.perl-module","pm"],["text/x-script.phyton","py"],["text/x-script.rexx","rexx"],["text/x-script.scheme","scm"],["text/x-script.sh","sh"],["text/x-script.tcl","tcl"],["text/x-script.tcsh","tcsh"],["text/x-script.zsh","zsh"],["text/x-server-parsed-html",["shtml","ssi"]],["text/x-setext","etx"],["text/x-sgml",["sgm","sgml"]],["text/x-speech",["spc","talk"]],["text/x-uil","uil"],["text/x-uuencode",["uu","uue"]],["text/x-vcalendar","vcs"],["text/x-vcard","vcf"],["text/xml","xml"],["video/3gpp","3gp"],["video/3gpp2","3g2"],["video/animaflex","afl"],["video/avi","avi"],["video/avs-video","avs"],["video/dl","dl"],["video/fli","fli"],["video/gl","gl"],["video/h261","h261"],["video/h263","h263"],["video/h264","h264"],["video/jpeg","jpgv"],["video/jpm","jpm"],["video/mj2","mj2"],["video/mp4","mp4"],["video/mpeg",["mpeg","mp2","mpa","mpe","mpg","mpv2","m1v","m2v","mp3"]],["video/msvideo","avi"],["video/ogg","ogv"],["video/quicktime",["mov","qt","moov"]],["video/vdo","vdo"],["video/vivo",["viv","vivo"]],["video/vnd.dece.hd","uvh"],["video/vnd.dece.mobile","uvm"],["video/vnd.dece.pd","uvp"],["video/vnd.dece.sd","uvs"],["video/vnd.dece.video","uvv"],["video/vnd.fvt","fvt"],["video/vnd.mpegurl","mxu"],["video/vnd.ms-playready.media.pyv","pyv"],["video/vnd.rn-realvideo","rv"],["video/vnd.uvvu.mp4","uvu"],["video/vnd.vivo",["viv","vivo"]],["video/vosaic","vos"],["video/webm","webm"],["video/x-amt-demorun","xdr"],["video/x-amt-showrun","xsr"],["video/x-atomic3d-feature","fmf"],["video/x-dl","dl"],["video/x-dv",["dif","dv"]],["video/x-f4v","f4v"],["video/x-fli","fli"],["video/x-flv","flv"],["video/x-gl","gl"],["video/x-isvideo","isu"],["video/x-la-asf",["lsf","lsx"]],["video/x-m4v","m4v"],["video/x-motion-jpeg","mjpg"],["video/x-mpeg",["mp3","mp2"]],["video/x-mpeq2a","mp2"],["video/x-ms-asf",["asf","asr","asx"]],["video/x-ms-asf-plugin","asx"],["video/x-ms-wm","wm"],["video/x-ms-wmv","wmv"],["video/x-ms-wmx","wmx"],["video/x-ms-wvx","wvx"],["video/x-msvideo","avi"],["video/x-qtc","qtc"],["video/x-scm","scm"],["video/x-sgi-movie",["movie","mv"]],["windows/metafile","wmf"],["www/mime","mime"],["x-conference/x-cooltalk","ice"],["x-music/x-midi",["mid","midi"]],["x-world/x-3dmf",["3dm","3dmf","qd3","qd3d"]],["x-world/x-svr","svr"],["x-world/x-vrml",["flr","vrml","wrl","wrz","xaf","xof"]],["x-world/x-vrt","vrt"],["xgl/drawing","xgz"],["xgl/movie","xmz"]]),r=new Map([["123","application/vnd.lotus-1-2-3"],["323","text/h323"],["*","application/octet-stream"],["3dm","x-world/x-3dmf"],["3dmf","x-world/x-3dmf"],["3dml","text/vnd.in3d.3dml"],["3g2","video/3gpp2"],["3gp","video/3gpp"],["7z","application/x-7z-compressed"],["a","application/octet-stream"],["aab","application/x-authorware-bin"],["aac","audio/x-aac"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abc","text/vnd.abc"],["abw","application/x-abiword"],["ac","application/pkix-attr-cert"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acgi","text/html"],["acu","application/vnd.acucobol"],["acx","application/internet-property-stream"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afl","video/animaflex"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/postscript"],["aif",["audio/aiff","audio/x-aiff"]],["aifc",["audio/aiff","audio/x-aiff"]],["aiff",["audio/aiff","audio/x-aiff"]],["aim","application/x-aim"],["aip","text/x-audiosoft-intra"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["ani","application/x-navi-animation"],["aos","application/x-nokia-9000-communicator-add-on-software"],["apk","application/vnd.android.package-archive"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["aps","application/mime"],["arc","application/octet-stream"],["arj",["application/arj","application/octet-stream"]],["art","image/x-jg"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asp","text/asp"],["asr","video/x-ms-asf"],["asx",["video/x-ms-asf","application/x-mplayer2","video/x-ms-asf-plugin"]],["atc","application/vnd.acucorp"],["atomcat","application/atomcat+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au",["audio/basic","audio/x-au"]],["avi",["video/avi","video/msvideo","application/x-troff-msvideo","video/x-msvideo"]],["avs","video/avs-video"],["aw","application/applixware"],["axs","application/olescript"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azw","application/vnd.amazon.ebook"],["bas","text/plain"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin",["application/octet-stream","application/mac-binary","application/macbinary","application/x-macbinary","application/x-binary"]],["bm","image/bmp"],["bmi","application/vnd.bmi"],["bmp",["image/bmp","image/x-windows-bmp"]],["boo","application/book"],["book","application/book"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bsh","application/x-bsh"],["btif","image/prs.btif"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c",["text/plain","text/x-c"]],["c++","text/plain"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["c4g","application/vnd.clonk.c4group"],["cab","application/vnd.ms-cab-compressed"],["car","application/vnd.curl.car"],["cat",["application/vnd.ms-pkiseccat","application/vnd.ms-pki.seccat"]],["cc",["text/plain","text/x-c"]],["ccad","application/clariscad"],["cco","application/x-cocoa"],["ccxml","application/ccxml+xml,"],["cdbcmsg","application/vnd.contact.cmsg"],["cdf",["application/cdf","application/x-cdf","application/x-netcdf"]],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer",["application/pkix-cert","application/x-x509-ca-cert"]],["cgm","image/cgm"],["cha","application/x-chat"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cla","application/vnd.claymore"],["class",["application/octet-stream","application/java","application/java-byte-code","application/java-vm","application/x-java-class"]],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod",["image/cis-cod","application/vnd.rim.cod"]],["com",["application/octet-stream","text/plain"]],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt",["application/mac-compactpro","application/x-compactpro","application/x-cpt"]],["crd","application/x-mscardfile"],["crl",["application/pkix-crl","application/pkcs-crl"]],["crt",["application/pkix-cert","application/x-x509-user-cert","application/x-x509-ca-cert"]],["cryptonote","application/vnd.rig.cryptonote"],["csh",["text/x-script.csh","application/x-csh"]],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["css",["text/css","application/x-pointplus"]],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxx","text/plain"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["davmount","application/davmount+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["deb","application/x-debian-package"],["deepv","application/x-deepv"],["def","text/plain"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dif","video/x-dv"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["djvu","image/vnd.djvu"],["dl",["video/dl","video/x-dl"]],["dll","application/x-msdownload"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.document.macroenabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroenabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp",["application/commonground","application/vnd.osgi.dp"]],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drw","application/drafting"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dv","video/x-dv"],["dvi","application/x-dvi"],["dwf",["model/vnd.dwf","drawing/x-dwf"]],["dwg",["application/acad","image/vnd.dwg","image/x-dwg"]],["dxf",["application/dxf","image/vnd.dwg","image/vnd.dxf","image/x-dwg"]],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["el","text/x-script.elisp"],["elc",["application/x-elc","application/x-bytecode.elisp"]],["eml","message/rfc822"],["emma","application/emma+xml"],["env","application/x-envoy"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es",["application/ecmascript","application/x-esrehber"]],["es3","application/vnd.eszigno3+xml"],["esf","application/vnd.epson.esf"],["etx","text/x-setext"],["evy",["application/envoy","application/x-envoy"]],["exe",["application/octet-stream","application/x-msdownload"]],["exi","application/exi"],["ext","application/vnd.novadigm.ext"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f",["text/plain","text/x-fortran"]],["f4v","video/x-f4v"],["f77","text/x-fortran"],["f90",["text/plain","text/x-fortran"]],["fbs","image/vnd.fastbidsheet"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fh","image/x-freehand"],["fif",["application/fractals","image/fif"]],["fig","application/x-xfig"],["fli",["video/fli","video/x-fli"]],["flo",["image/florian","application/vnd.micrografx.flo"]],["flr","x-world/x-vrml"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fmf","video/x-atomic3d-feature"],["fnc","application/vnd.frogans.fnc"],["for",["text/plain","text/x-fortran"]],["fpx",["image/vnd.fpx","image/vnd.net-fpx"]],["frl","application/freeloader"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["funk","audio/make"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g","text/plain"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gdl","model/vnd.gdl"],["geo","application/vnd.dynageo"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["gl",["video/gl","video/x-gl"]],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gph","application/vnd.flographit"],["gqf","application/vnd.grafeq"],["gram","application/srgs"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsd","audio/x-gsm"],["gsf","application/x-font-ghostscript"],["gsm","audio/x-gsm"],["gsp","application/x-gsp"],["gss","application/x-gss"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxt","application/vnd.geonext"],["gz",["application/x-gzip","application/x-compressed"]],["gzip",["multipart/x-gzip","application/x-gzip"]],["h",["text/plain","text/x-h"]],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hdf","application/x-hdf"],["help","application/x-helpfile"],["hgl","application/vnd.hp-hpgl"],["hh",["text/plain","text/x-h"]],["hlb","text/x-script"],["hlp",["application/winhlp","application/hlp","application/x-helpfile","application/x-winhelp"]],["hpg","application/vnd.hp-hpgl"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx",["application/mac-binhex40","application/binhex","application/binhex4","application/mac-binhex","application/x-binhex40","application/x-mac-binhex40"]],["hta","application/hta"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["htmls","text/html"],["htt","text/webviewhtml"],["htx","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["ico","image/x-icon"],["ics","text/calendar"],["idc","text/plain"],["ief","image/ief"],["iefs","image/ief"],["ifm","application/vnd.shana.informed.formdata"],["iges",["application/iges","model/iges"]],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs",["application/iges","model/iges"]],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["iii","application/x-iphone"],["ima","application/x-ima"],["imap","application/x-httpd-imap"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["inf","application/inf"],["ins",["application/x-internet-signup","application/x-internett-signup"]],["ip","application/x-ip2"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["isp","application/x-internet-signup"],["isu","video/x-isvideo"],["it","audio/it"],["itp","application/vnd.shana.informed.formtemplate"],["iv","application/x-inventor"],["ivp","application/vnd.immervision-ivp"],["ivr","i-world/i-vrml"],["ivu","application/vnd.immervision-ivu"],["ivy","application/x-livescreen"],["jad","text/vnd.sun.j2me.app-descriptor"],["jam",["application/vnd.jam","audio/x-jam"]],["jar","application/java-archive"],["jav",["text/plain","text/x-java-source"]],["java",["text/plain","text/x-java-source,java","text/x-java-source"]],["jcm","application/x-java-commerce"],["jfif",["image/pipeg","image/jpeg","image/pjpeg"]],["jfif-tbnl","image/jpeg"],["jisp","application/vnd.jisp"],["jlt","application/vnd.hp-jlyt"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jpe",["image/jpeg","image/pjpeg"]],["jpeg",["image/jpeg","image/pjpeg"]],["jpg",["image/jpeg","image/pjpeg"]],["jpgv","video/jpeg"],["jpm","video/jpm"],["jps","image/x-jps"],["js",["application/javascript","application/ecmascript","text/javascript","text/ecmascript","application/x-javascript"]],["json","application/json"],["jut","image/jutvision"],["kar",["audio/midi","music/x-karaoke"]],["karbon","application/vnd.kde.karbon"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["ksh",["application/x-ksh","text/x-script.ksh"]],["ksp","application/vnd.kde.kspread"],["ktx","image/ktx"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["la",["audio/nspaudio","audio/x-nspaudio"]],["lam","audio/x-liveaudio"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["lha",["application/octet-stream","application/lha","application/x-lha"]],["lhx","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["lma",["audio/nspaudio","audio/x-nspaudio"]],["log","text/plain"],["lrm","application/vnd.ms-lrm"],["lsf","video/x-la-asf"],["lsp",["application/x-lisp","text/x-script.lisp"]],["lst","text/plain"],["lsx",["video/x-la-asf","text/x-la-asf"]],["ltf","application/vnd.frogans.ltf"],["ltx","application/x-latex"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh",["application/octet-stream","application/x-lzh"]],["lzx",["application/lzx","application/octet-stream","application/x-lzx"]],["m",["text/plain","text/x-m"]],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m1v","video/mpeg"],["m21","application/mp21"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3u",["audio/x-mpegurl","audio/x-mpequrl"]],["m3u8","application/vnd.apple.mpegurl"],["m4v","video/x-m4v"],["ma","application/mathematica"],["mads","application/mads+xml"],["mag","application/vnd.ecowin.chart"],["man","application/x-troff-man"],["map","application/x-navimap"],["mar","text/plain"],["mathml","application/mathml+xml"],["mbd","application/mbedlet"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc$","application/x-magic-cap-package-1.0"],["mc1","application/vnd.medcalcdata"],["mcd",["application/mcad","application/vnd.mcd","application/x-mathcad"]],["mcf",["image/vasa","text/mcf"]],["mcp","application/netmc"],["mcurl","text/vnd.curl.mcurl"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["me","application/x-troff-me"],["meta4","application/metalink4+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mht","message/rfc822"],["mhtml","message/rfc822"],["mid",["audio/mid","audio/midi","music/crescendo","x-music/x-midi","audio/x-midi","application/x-midi","audio/x-mid"]],["midi",["audio/midi","music/crescendo","x-music/x-midi","audio/x-midi","application/x-midi","audio/x-mid"]],["mif",["application/vnd.mif","application/x-mif","application/x-frame"]],["mime",["message/rfc822","www/mime"]],["mj2","video/mj2"],["mjf","audio/x-vnd.audioexplosion.mjuicemediafile"],["mjpg","video/x-motion-jpeg"],["mlp","application/vnd.dolby.mlp"],["mm",["application/base64","application/x-meme"]],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mme","application/base64"],["mmf","application/vnd.smaf"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mny","application/x-msmoney"],["mod",["audio/mod","audio/x-mod"]],["mods","application/mods+xml"],["moov","video/quicktime"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2",["video/mpeg","audio/mpeg","video/x-mpeg","audio/x-mpeg","video/x-mpeq2a"]],["mp3",["audio/mpeg","audio/mpeg3","video/mpeg","audio/x-mpeg-3","video/x-mpeg"]],["mp4",["video/mp4","application/mp4"]],["mp4a","audio/mp4"],["mpa",["video/mpeg","audio/mpeg"]],["mpc",["application/vnd.mophun.certificate","application/x-project"]],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg",["video/mpeg","audio/mpeg"]],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/x-project"],["mpv","application/x-project"],["mpv2","video/mpeg"],["mpx","application/x-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","application/x-troff-ms"],["mscml","application/mediaservercontrol+xml"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msl","application/vnd.mobius.msl"],["msty","application/vnd.muvee.style"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musicxml","application/vnd.recordare.musicxml+xml"],["mv","video/x-sgi-movie"],["mvb","application/x-msmediaview"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["my","audio/make"],["mzz","application/x-vnd.audioexplosion.mzz"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nap","image/naplps"],["naplps","image/naplps"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncm","application/vnd.nokia.configuration-message"],["ncx","application/x-dtbncx+xml"],["ngdat","application/vnd.nokia.n-gage.data"],["nif","image/x-niff"],["niff","image/x-niff"],["nix","application/x-mix-transfer"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nvd","application/x-navidoc"],["nws","message/rfc822"],["o","application/octet-stream"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omc","application/x-omc"],["omcd","application/x-omcdatamaker"],["omcr","application/x-omcregerator"],["onetoc","application/onenote"],["opf","application/oebps-package+xml"],["org","application/vnd.lotus-organizer"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","application/x-font-otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p10",["application/pkcs10","application/x-pkcs10"]],["p12",["application/pkcs-12","application/x-pkcs12"]],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c",["application/pkcs7-mime","application/x-pkcs7-mime"]],["p7m",["application/pkcs7-mime","application/x-pkcs7-mime"]],["p7r","application/x-pkcs7-certreqresp"],["p7s",["application/pkcs7-signature","application/x-pkcs7-signature"]],["p8","application/pkcs8"],["par","text/plain-bas"],["part","application/pro_eng"],["pas","text/pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcf","application/x-font-pcf"],["pcl",["application/vnd.hp-pcl","application/x-pcl"]],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb",["application/vnd.palm","chemical/x-pdb"]],["pdf","application/pdf"],["pfa","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfunk",["audio/make","audio/make.my.funk"]],["pfx","application/x-pkcs12"],["pgm",["image/x-portable-graymap","image/x-portable-greymap"]],["pgn","application/x-chess-pgn"],["pgp","application/pgp-signature"],["pic",["image/pict","image/x-pict"]],["pict","image/pict"],["pkg","application/x-newton-compatible-pkg"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pko",["application/ynd.ms-pkipko","application/vnd.ms-pki.pko"]],["pl",["text/plain","text/x-script.perl"]],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["plx","application/x-pixclscript"],["pm",["text/x-script.perl-module","image/x-xpixmap"]],["pm4","application/x-pagemaker"],["pm5","application/x-pagemaker"],["pma","application/x-perfmon"],["pmc","application/x-perfmon"],["pml",["application/vnd.ctc-posml","application/x-perfmon"]],["pmr","application/x-perfmon"],["pmw","application/x-perfmon"],["png","image/png"],["pnm",["application/x-portable-anymap","image/x-portable-anymap"]],["portpkg","application/vnd.macports.portpkg"],["pot",["application/vnd.ms-powerpoint","application/mspowerpoint"]],["potm","application/vnd.ms-powerpoint.template.macroenabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["pov","model/x-pov"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroenabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps",["application/vnd.ms-powerpoint","application/mspowerpoint"]],["ppsm","application/vnd.ms-powerpoint.slideshow.macroenabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt",["application/vnd.ms-powerpoint","application/mspowerpoint","application/powerpoint","application/x-mspowerpoint"]],["pptm","application/vnd.ms-powerpoint.presentation.macroenabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["ppz","application/mspowerpoint"],["prc","application/x-mobipocket-ebook"],["pre",["application/vnd.lotus-freelance","application/x-freelance"]],["prf","application/pics-rules"],["prt","application/pro_eng"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd",["application/octet-stream","image/vnd.adobe.photoshop"]],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pvu","paleovu/x-pv"],["pwn","application/vnd.3m.post-it-notes"],["pwz","application/vnd.ms-powerpoint"],["py","text/x-script.phyton"],["pya","audio/vnd.ms-playready.media.pya"],["pyc","applicaiton/x-bytecode.python"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qcp","audio/vnd.qcelp"],["qd3","x-world/x-3dmf"],["qd3d","x-world/x-3dmf"],["qfx","application/vnd.intu.qfx"],["qif","image/x-quicktime"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qtc","video/x-qtc"],["qti","image/x-quicktime"],["qtif","image/x-quicktime"],["qxd","application/vnd.quark.quarkxpress"],["ra",["audio/x-realaudio","audio/x-pn-realaudio","audio/x-pn-realaudio-plugin"]],["ram","audio/x-pn-realaudio"],["rar","application/x-rar-compressed"],["ras",["image/cmu-raster","application/x-cmu-raster","image/x-cmu-raster"]],["rast","image/cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rexx","text/x-script.rexx"],["rf","image/vnd.rn-realflash"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm",["application/vnd.rn-realmedia","audio/x-pn-realaudio"]],["rmi","audio/mid"],["rmm","audio/x-pn-realaudio"],["rmp",["audio/x-pn-realaudio-plugin","audio/x-pn-realaudio"]],["rms","application/vnd.jcp.javame.midlet-rms"],["rnc","application/relax-ng-compact-syntax"],["rng",["application/ringing-tones","application/vnd.nokia.ringing-tone"]],["rnx","application/vnd.rn-realplayer"],["roff","application/x-troff"],["rp","image/vnd.rn-realpix"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsd","application/rsd+xml"],["rt",["text/richtext","text/vnd.rn-realtext"]],["rtf",["application/rtf","text/richtext","application/x-rtf"]],["rtx",["text/richtext","application/rtf"]],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["saveme","application/octet-stream"],["sbk","application/x-tbook"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm",["application/vnd.lotus-screencam","video/x-scm","text/x-script.guile","application/x-lotusscreencam","text/x-script.scheme"]],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["sct","text/scriptlet"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkm","application/vnd.solent.sdkm+xml"],["sdml","text/plain"],["sdp",["application/sdp","application/x-sdp"]],["sdr","application/sounder"],["sdw","application/vnd.stardivision.writer"],["sea",["application/sea","application/x-sea"]],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["ser","application/java-serialized-object"],["set","application/set"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sgl","application/vnd.stardivision.writer-global"],["sgm",["text/sgml","text/x-sgml"]],["sgml",["text/sgml","text/x-sgml"]],["sh",["application/x-shar","application/x-bsh","application/x-sh","text/x-script.sh"]],["shar",["application/x-bsh","application/x-shar"]],["shf","application/shf+xml"],["shtml",["text/html","text/x-server-parsed-html"]],["sid","audio/x-psid"],["sis","application/vnd.symbian.install"],["sit",["application/x-stuffit","application/x-sit"]],["sitx","application/x-stuffitx"],["skd","application/x-koan"],["skm","application/x-koan"],["skp",["application/vnd.koan","application/x-koan"]],["skt","application/x-koan"],["sl","application/x-seelogo"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi",["application/smil","application/smil+xml"]],["smil","application/smil"],["snd",["audio/basic","audio/x-adpcm"]],["snf","application/x-font-snf"],["sol","application/solids"],["spc",["text/x-speech","application/x-pkcs7-certificates"]],["spf","application/vnd.yamaha.smaf-phrase"],["spl",["application/futuresplash","application/x-futuresplash"]],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spr","application/x-sprite"],["sprite","application/x-sprite"],["src","application/x-wais-source"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssi","text/x-server-parsed-html"],["ssm","application/streamingmedia"],["ssml","application/ssml+xml"],["sst",["application/vnd.ms-pkicertstore","application/vnd.ms-pki.certstore"]],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["step","application/step"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl",["application/vnd.ms-pkistl","application/sla","application/vnd.ms-pki.stl","application/x-navistyle"]],["stm","text/html"],["stp","application/step"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["sub","image/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svf",["image/vnd.dwg","image/x-dwg"]],["svg","image/svg+xml"],["svr",["x-world/x-svr","application/x-world"]],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t",["text/troff","application/x-troff"]],["talk","text/x-speech"],["tao","application/vnd.tao.intent-module-archive"],["tar","application/x-tar"],["tbk",["application/toolbook","application/x-tbook"]],["tcap","application/vnd.3gpp2.tcap"],["tcl",["text/x-script.tcl","application/x-tcl"]],["tcsh","text/x-script.tcsh"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text",["application/plain","text/plain"]],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tgz",["application/gnutar","application/x-compressed"]],["thmx","application/vnd.ms-officetheme"],["tif",["image/tiff","image/x-tiff"]],["tiff",["image/tiff","image/x-tiff"]],["tmo","application/vnd.tmobile-livetv"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","application/x-troff"],["tra","application/vnd.trueapp"],["trm","application/x-msterminal"],["tsd","application/timestamped-data"],["tsi","audio/tsp-audio"],["tsp",["application/dsptype","audio/tsplayer"]],["tsv","text/tab-separated-values"],["ttf","application/x-font-ttf"],["ttl","text/turtle"],["turbot","image/florian"],["twd","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["ufd","application/vnd.ufdl"],["uil","text/x-uil"],["uls","text/iuls"],["umj","application/vnd.umajin"],["uni","text/uri-list"],["unis","text/uri-list"],["unityweb","application/vnd.unity"],["unv","application/i-deas"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["ustar",["application/x-ustar","multipart/x-ustar"]],["utz","application/vnd.uiq.theme"],["uu",["application/octet-stream","text/x-uuencode"]],["uue","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vda","application/vda"],["vdo","video/vdo"],["vew","application/groupwise"],["vis","application/vnd.visionary"],["viv",["video/vivo","video/vnd.vivo"]],["vivo",["video/vivo","video/vnd.vivo"]],["vmd","application/vocaltec-media-desc"],["vmf","application/vocaltec-media-file"],["voc",["audio/voc","audio/x-voc"]],["vos","video/vosaic"],["vox","audio/voxware"],["vqe","audio/x-twinvq-plugin"],["vqf","audio/x-twinvq"],["vql","audio/x-twinvq-plugin"],["vrml",["model/vrml","x-world/x-vrml","application/x-vrml"]],["vrt","x-world/x-vrt"],["vsd",["application/vnd.visio","application/x-visio"]],["vsf","application/vnd.vsf"],["vst","application/x-visio"],["vsw","application/x-visio"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w60","application/wordperfect6.0"],["w61","application/wordperfect6.1"],["w6w","application/msword"],["wad","application/x-doom"],["wav",["audio/wav","audio/x-wav"]],["wax","audio/x-ms-wax"],["wb1","application/x-qpro"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/vnd.wap.wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["web","application/vnd.xara"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wiz","application/msword"],["wk1","application/x-123"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf",["windows/metafile","application/x-msmetafile"]],["wml","text/vnd.wap.wml"],["wmlc","application/vnd.wap.wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-ms-wmz"],["woff","application/x-font-woff"],["word","application/msword"],["wp","application/wordperfect"],["wp5",["application/wordperfect","application/wordperfect6.0"]],["wp6","application/wordperfect"],["wpd",["application/wordperfect","application/vnd.wordperfect","application/x-wpwin"]],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wq1","application/x-lotus"],["wqd","application/vnd.wqd"],["wri",["application/mswrite","application/x-wri","application/x-mswrite"]],["wrl",["model/vrml","x-world/x-vrml","application/x-world"]],["wrz",["model/vrml","x-world/x-vrml"]],["wsc","text/scriplet"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wsrc","application/x-wais-source"],["wtb","application/vnd.webturbo"],["wtk","application/x-wintalk"],["wvx","video/x-ms-wvx"],["x-png","image/png"],["x3d","application/vnd.hzn-3d-crossword"],["xaf","x-world/x-vrml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm",["image/xbm","image/x-xbm","image/x-xbitmap"]],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdr","video/x-amt-demorun"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xgz","xgl/drawing"],["xhtml","application/xhtml+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla",["application/vnd.ms-excel","application/excel","application/x-msexcel","application/x-excel"]],["xlam","application/vnd.ms-excel.addin.macroenabled.12"],["xlb",["application/excel","application/vnd.ms-excel","application/x-excel"]],["xlc",["application/vnd.ms-excel","application/excel","application/x-excel"]],["xld",["application/excel","application/x-excel"]],["xlk",["application/excel","application/x-excel"]],["xll",["application/excel","application/vnd.ms-excel","application/x-excel"]],["xlm",["application/vnd.ms-excel","application/excel","application/x-excel"]],["xls",["application/vnd.ms-excel","application/excel","application/x-msexcel","application/x-excel"]],["xlsb","application/vnd.ms-excel.sheet.binary.macroenabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroenabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt",["application/vnd.ms-excel","application/excel","application/x-excel"]],["xltm","application/vnd.ms-excel.template.macroenabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlv",["application/excel","application/x-excel"]],["xlw",["application/vnd.ms-excel","application/excel","application/x-msexcel","application/x-excel"]],["xm","audio/xm"],["xml",["application/xml","text/xml","application/atom+xml","application/rss+xml"]],["xmz","xgl/movie"],["xo","application/vnd.olpc-sugar"],["xof","x-world/x-vrml"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpix","application/x-vnd.ls-xpix"],["xpm",["image/xpm","image/x-xpixmap"]],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xsr","video/x-amt-showrun"],["xul","application/vnd.mozilla.xul+xml"],["xwd",["image/x-xwd","image/x-xwindowdump"]],["xyz",["chemical/x-xyz","chemical/x-pdb"]],["yang","application/yang"],["yin","application/yin+xml"],["z",["application/x-compressed","application/x-compress"]],["zaz","application/vnd.zzazz.deck+xml"],["zip",["application/zip","multipart/x-zip","application/x-zip-compressed","application/x-compressed"]],["zir","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zoo","application/octet-stream"],["zsh","text/x-script.zsh"]]);e.exports={detectMimeType(e){if(!e)return"application/octet-stream";let t=i.parse(e),n=(t.ext.substr(1)||t.name||"").split("?").shift().trim().toLowerCase(),o="application/octet-stream";return r.has(n)&&(o=r.get(n)),Array.isArray(o)?o[0]:o},detectExtension(e){if(!e)return"bin";let t=(e||"").toLowerCase().trim().split("/"),n=t.shift().trim(),i=t.join("/").trim();if(o.has(n+"/"+i)){let e=o.get(n+"/"+i);return Array.isArray(e)?e[0]:e}switch(n){case"text":return"txt";default:return"bin"}}}},function(e,t,n){"use strict";const i=n(17),o=n(131),r=n(44),s=n(272),a=n(14).PassThrough,c=n(86),l=n(250),p=n(274),u=n(273),d=n(312),h=n(249),f=n(313);class m{constructor(e,t){this.nodeCounter=0,t=t||{},this.baseBoundary=t.baseBoundary||i.randomBytes(8).toString("hex"),this.boundaryPrefix=t.boundaryPrefix||"--_NmP",this.disableFileAccess=!!t.disableFileAccess,this.disableUrlAccess=!!t.disableUrlAccess,this.normalizeHeaderKey=t.normalizeHeaderKey,this.date=new Date,this.rootNode=t.rootNode||this,this.keepBcc=!!t.keepBcc,t.filename&&(this.filename=t.filename,e||(e=l.detectMimeType(this.filename.split(".").pop()))),this.textEncoding=(t.textEncoding||"").toString().trim().charAt(0).toUpperCase(),this.parentNode=t.parentNode,this.hostname=t.hostname,this.childNodes=[],this._nodeId=++this.rootNode.nodeCounter,this._headers=[],this._isPlainText=!1,this._hasLongLines=!1,this._envelope=!1,this._raw=!1,this._transforms=[],this._processFuncs=[],e&&this.setHeader("Content-Type",e)}createChild(e,t){t||"object"!=typeof e||(t=e,e=void 0);let n=new m(e,t);return this.appendChild(n),n}appendChild(e){return e.rootNode!==this.rootNode&&(e.rootNode=this.rootNode,e._nodeId=++this.rootNode.nodeCounter),e.parentNode=this,this.childNodes.push(e),e}replace(e){return e===this?this:(this.parentNode.childNodes.forEach((t,n)=>{t===this&&(e.rootNode=this.rootNode,e.parentNode=this.parentNode,e._nodeId=this._nodeId,this.rootNode=this,this.parentNode=void 0,e.parentNode.childNodes[n]=e)}),e)}remove(){if(!this.parentNode)return this;for(let e=this.parentNode.childNodes.length-1;e>=0;e--)if(this.parentNode.childNodes[e]===this)return this.parentNode.childNodes.splice(e,1),this.parentNode=void 0,this.rootNode=this,this}setHeader(e,t){let n,i=!1;if(!t&&e&&"object"==typeof e)return e.key&&"value"in e?this.setHeader(e.key,e.value):Array.isArray(e)?e.forEach(e=>{this.setHeader(e.key,e.value)}):Object.keys(e).forEach(t=>{this.setHeader(t,e[t])}),this;n={key:e=this._normalizeHeaderKey(e),value:t};for(let t=0,o=this._headers.length;t<o;t++)this._headers[t].key===e&&(i?(this._headers.splice(t,1),t--,o--):(this._headers[t]=n,i=!0));return i||this._headers.push(n),this}addHeader(e,t){return!t&&e&&"object"==typeof e?(e.key&&e.value?this.addHeader(e.key,e.value):Array.isArray(e)?e.forEach(e=>{this.addHeader(e.key,e.value)}):Object.keys(e).forEach(t=>{this.addHeader(t,e[t])}),this):Array.isArray(t)?(t.forEach(t=>{this.addHeader(e,t)}),this):(this._headers.push({key:this._normalizeHeaderKey(e),value:t}),this)}getHeader(e){e=this._normalizeHeaderKey(e);for(let t=0,n=this._headers.length;t<n;t++)if(this._headers[t].key===e)return this._headers[t].value}setContent(e){return this.content=e,"function"==typeof this.content.pipe?(this._contentErrorHandler=e=>{this.content.removeListener("error",this._contentErrorHandler),this.content=e},this.content.once("error",this._contentErrorHandler)):"string"==typeof this.content&&(this._isPlainText=l.isPlainText(this.content),this._isPlainText&&l.hasLongerLines(this.content,76)&&(this._hasLongLines=!0)),this}build(e){let t;e||(t=new Promise((t,n)=>{e=c.callbackPromise(t,n)}));let n=this.createReadStream(),i=[],o=0,r=!1;return n.on("readable",()=>{let e;for(;null!==(e=n.read());)i.push(e),o+=e.length}),n.once("error",t=>{if(!r)return r=!0,e(t)}),n.once("end",t=>{if(!r)return r=!0,t&&t.length&&(i.push(t),o+=t.length),e(null,Buffer.concat(i,o))}),t}getTransferEncoding(){let e=!1,t=(this.getHeader("Content-Type")||"").toString().toLowerCase().trim();return this.content&&(e=(this.getHeader("Content-Transfer-Encoding")||"").toString().toLowerCase().trim(),e&&["base64","quoted-printable"].includes(e)||(/^text\//i.test(t)?e=this._isPlainText&&!this._hasLongLines?"7bit":"string"==typeof this.content||this.content instanceof Buffer?"Q"===this._getTextEncoding(this.content)?"quoted-printable":"base64":"B"===this.transferEncoding?"base64":"quoted-printable":/^(multipart|message)\//i.test(t)||(e=e||"base64"))),e}buildHeaders(){let e=this.getTransferEncoding(),t=[];return e&&this.setHeader("Content-Transfer-Encoding",e),this.filename&&!this.getHeader("Content-Disposition")&&this.setHeader("Content-Disposition","attachment"),this.rootNode===this&&(this.getHeader("Date")||this.setHeader("Date",this.date.toUTCString().replace(/GMT/,"+0000")),this.messageId(),this.getHeader("MIME-Version")||this.setHeader("MIME-Version","1.0")),this._headers.forEach(e=>{let n,i,o=e.key,r=e.value,s={};if(!r||"object"!=typeof r||["From","Sender","To","Cc","Bcc","Reply-To","Date","References"].includes(o)||(Object.keys(r).forEach(e=>{"value"!==e&&(s[e]=r[e])}),r=(r.value||"").toString(),r.trim()))if(s.prepared)s.foldLines?t.push(l.foldLines(o+": "+r)):t.push(o+": "+r);else{switch(e.key){case"Content-Disposition":n=l.parseHeaderValue(r),this.filename&&(n.params.filename=this.filename),r=l.buildHeaderValue(n);break;case"Content-Type":n=l.parseHeaderValue(r),this._handleContentType(n),n.value.match(/^text\/plain\b/)&&"string"==typeof this.content&&/[\u0080-\uFFFF]/.test(this.content)&&(n.params.charset="utf-8"),r=l.buildHeaderValue(n),this.filename&&(i=this._encodeWords(this.filename),(i!==this.filename||/[\s'"\\;:/=(),<>@[\]?]|^-/.test(i))&&(i='"'+i+'"'),r+="; name="+i);break;case"Bcc":if(!this.keepBcc)return}if(r=this._encodeHeaderValue(o,r),(r||"").toString().trim()){if("function"==typeof this.normalizeHeaderKey){let e=this.normalizeHeaderKey(o,r);e&&"string"==typeof e&&e.length&&(o=e)}t.push(l.foldLines(o+": "+r,76))}}}),t.join("\r\n")}createReadStream(e){let t,n=new a(e=e||{}),i=n;this.stream(n,e,e=>{e?i.emit("error",e):n.end()});for(let e=0,n=this._transforms.length;e<n;e++)t="function"==typeof this._transforms[e]?this._transforms[e]():this._transforms[e],i.once("error",e=>{t.emit("error",e)}),i=i.pipe(t);t=new f,i.once("error",e=>{t.emit("error",e)}),i=i.pipe(t);for(let e=0,n=this._processFuncs.length;e<n;e++)t=this._processFuncs[e],i=t(i);return i}transform(e){this._transforms.push(e)}processFunc(e){this._processFuncs.push(e)}stream(e,t,n){let i,o,r=this.getTransferEncoding(),s=!1,a=e=>{s||(s=!0,n(e))},c=()=>{let n=0,i=()=>{if(n>=this.childNodes.length)return e.write("\r\n--"+this.boundary+"--\r\n"),a();let o=this.childNodes[n++];e.write((n>1?"\r\n":"")+"--"+this.boundary+"\r\n"),o.stream(e,t,e=>{if(e)return a(e);setImmediate(i)})};if(!this.multipart)return a();setImmediate(i)},l=()=>{if(!this.content)return setImmediate(c);{if("[object Error]"===Object.prototype.toString.call(this.content))return a(this.content);"function"==typeof this.content.pipe&&(this.content.removeListener("error",this._contentErrorHandler),this._contentErrorHandler=e=>a(e),this.content.once("error",this._contentErrorHandler));let n=()=>{["quoted-printable","base64"].includes(r)?(i=new("base64"===r?u:p).Encoder(t),i.pipe(e,{end:!1}),i.once("end",c),i.once("error",e=>a(e)),o=this._getStream(this.content),o.pipe(i)):(o=this._getStream(this.content),o.pipe(e,{end:!1}),o.once("end",c)),o.once("error",e=>a(e))};if(this.content._resolve){let e=[],t=0,i=!1,o=this._getStream(this.content);o.on("error",e=>{i||(i=!0,a(e))}),o.on("readable",()=>{let n;for(;null!==(n=o.read());)e.push(n),t+=n.length}),o.on("end",()=>{i||(i=!0,this.content._resolve=!1,this.content._resolvedValue=Buffer.concat(e,t),setImmediate(n))})}else setImmediate(n)}};this._raw?setImmediate(()=>{if("[object Error]"===Object.prototype.toString.call(this._raw))return a(this._raw);"function"==typeof this._raw.pipe&&this._raw.removeListener("error",this._contentErrorHandler);let t=this._getStream(this._raw);t.pipe(e,{end:!1}),t.on("error",t=>e.emit("error",t)),t.on("end",c)}):(e.write(this.buildHeaders()+"\r\n\r\n"),setImmediate(l))}setEnvelope(e){let t;this._envelope={from:!1,to:[]},e.from&&(t=[],this._convertAddresses(this._parseAddresses(e.from),t),t=t.filter(e=>e&&e.address),t.length&&t[0]&&(this._envelope.from=t[0].address)),["to","cc","bcc"].forEach(t=>{e[t]&&this._convertAddresses(this._parseAddresses(e[t]),this._envelope.to)}),this._envelope.to=this._envelope.to.map(e=>e.address).filter(e=>e);let n=["to","cc","bcc","from"];return Object.keys(e).forEach(t=>{n.includes(t)||(this._envelope[t]=e[t])}),this}getAddresses(){let e={};return this._headers.forEach(t=>{let n=t.key.toLowerCase();["from","sender","reply-to","to","cc","bcc"].includes(n)&&(Array.isArray(e[n])||(e[n]=[]),this._convertAddresses(this._parseAddresses(t.value),e[n]))}),e}getEnvelope(){if(this._envelope)return this._envelope;let e={from:!1,to:[]};return this._headers.forEach(t=>{let n=[];"From"===t.key||!e.from&&["Reply-To","Sender"].includes(t.key)?(this._convertAddresses(this._parseAddresses(t.value),n),n.length&&n[0]&&(e.from=n[0].address)):["To","Cc","Bcc"].includes(t.key)&&this._convertAddresses(this._parseAddresses(t.value),e.to)}),e.to=e.to.map(e=>e.address),e}messageId(){let e=this.getHeader("Message-ID");return e||(e=this._generateMessageId(),this.setHeader("Message-ID",e)),e}setRaw(e){return this._raw=e,this._raw&&"function"==typeof this._raw.pipe&&(this._contentErrorHandler=e=>{this._raw.removeListener("error",this._contentErrorHandler),this._raw=e},this._raw.once("error",this._contentErrorHandler)),this}_getStream(e){let t;return e._resolvedValue?(t=new a,setImmediate(()=>t.end(e._resolvedValue)),t):"function"==typeof e.pipe?e:e&&"string"==typeof e.path&&!e.href?this.disableFileAccess?(t=new a,setImmediate(()=>t.emit("error",new Error("File access rejected for "+e.path))),t):r.createReadStream(e.path):e&&"string"==typeof e.href?this.disableUrlAccess?(t=new a,setImmediate(()=>t.emit("error",new Error("Url access rejected for "+e.href))),t):h(e.href,{headers:e.httpHeaders}):(t=new a,setImmediate(()=>t.end(e||"")),t)}_parseAddresses(e){return[].concat.apply([],[].concat(e).map(e=>e&&e.address?(e.address=this._normalizeAddress(e.address),e.name=e.name||"",[e]):d(e)))}_normalizeHeaderKey(e){return e=(e||"").toString().replace(/\r?\n|\r/g," ").trim().toLowerCase().replace(/^X-SMTPAPI$|^(MIME|DKIM|ARC|BIMI)\b|^[a-z]|-(SPF|FBL|ID|MD5)$|-[a-z]/gi,e=>e.toUpperCase()).replace(/^Content-Features$/i,"Content-features")}_handleContentType(e){this.contentType=e.value.trim().toLowerCase(),this.multipart=!!/^multipart\//i.test(this.contentType)&&this.contentType.substr(this.contentType.indexOf("/")+1),this.multipart?this.boundary=e.params.boundary=e.params.boundary||this.boundary||this._generateBoundary():this.boundary=!1}_generateBoundary(){return this.rootNode.boundaryPrefix+"-"+this.rootNode.baseBoundary+"-Part_"+this._nodeId}_encodeHeaderValue(e,t){switch(e=this._normalizeHeaderKey(e)){case"From":case"Sender":case"To":case"Cc":case"Bcc":case"Reply-To":return this._convertAddresses(this._parseAddresses(t));case"Message-ID":case"In-Reply-To":case"Content-Id":return"<"!==(t=(t||"").toString().replace(/\r?\n|\r/g," ")).charAt(0)&&(t="<"+t),">"!==t.charAt(t.length-1)&&(t+=">"),t;case"References":return(t=[].concat.apply([],[].concat(t||"").map(e=>(e=(e||"").toString().replace(/\r?\n|\r/g," ").trim()).replace(/<[^>]*>/g,e=>e.replace(/\s/g,"")).split(/\s+/))).map(e=>("<"!==e.charAt(0)&&(e="<"+e),">"!==e.charAt(e.length-1)&&(e+=">"),e))).join(" ").trim();case"Date":return"[object Date]"===Object.prototype.toString.call(t)?t.toUTCString().replace(/GMT/,"+0000"):(t=(t||"").toString().replace(/\r?\n|\r/g," "),this._encodeWords(t));case"Content-Type":case"Content-Disposition":return(t||"").toString().replace(/\r?\n|\r/g," ");default:return t=(t||"").toString().replace(/\r?\n|\r/g," "),this._encodeWords(t)}}_convertAddresses(e,t){let n=[];return t=t||[],[].concat(e||[]).forEach(e=>{e.address?(e.address=this._normalizeAddress(e.address),e.name?e.name&&n.push(this._encodeAddressName(e.name)+" <"+e.address+">"):n.push(e.address),e.address&&(t.filter(t=>t.address===e.address).length||t.push(e))):e.group&&n.push(this._encodeAddressName(e.name)+":"+(e.group.length?this._convertAddresses(e.group,t):"").trim()+";")}),n.join(", ")}_normalizeAddress(e){let t=(e=(e||"").toString().trim()).lastIndexOf("@");if(t<0)return e;let n=e.substr(0,t),i=e.substr(t+1);return n+"@"+s.toASCII(i.toLowerCase())}_encodeAddressName(e){return/^[\w ']*$/.test(e)?e:/^[\x20-\x7e]*$/.test(e)?'"'+e.replace(/([\\"])/g,"\\$1")+'"':l.encodeWord(e,this._getTextEncoding(e),52)}_encodeWords(e){return l.encodeWords(e,this._getTextEncoding(e),52,!0)}_getTextEncoding(e){e=(e||"").toString();let t,n,i=this.textEncoding;return i||(n=(e.match(/[\x00-\x08\x0B\x0C\x0E-\x1F\u0080-\uFFFF]/g)||[]).length,t=(e.match(/[a-z]/gi)||[]).length,i=n<t?"Q":"B"),i}_generateMessageId(){return"<"+[2,2,2,6].reduce((e,t)=>e+"-"+i.randomBytes(t).toString("hex"),i.randomBytes(4).toString("hex"))+"@"+(this.getEnvelope().from||this.hostname||o.hostname()||"localhost").split("@").pop()+">"}}e.exports=m},function(e,t){e.exports=require("punycode")},function(e,t,n){"use strict";const i=n(14).Transform;function o(e){return"string"==typeof e&&(e=Buffer.from(e,"utf-8")),e.toString("base64")}function r(e,t){if(t=t||76,(e=(e||"").toString()).length<=t)return e;let n=[],i=0,o=1024*t;for(;i<e.length;){let r=e.substr(i,o).replace(new RegExp(".{"+t+"}","g"),"$&\r\n").trim();n.push(r),i+=o}return n.join("\r\n").trim()}e.exports={encode:o,wrap:r,Encoder:class extends i{constructor(e){super(),this.options=e||{},!1!==this.options.lineLength&&(this.options.lineLength=this.options.lineLength||76),this._curLine="",this._remainingBytes=!1,this.inputBytes=0,this.outputBytes=0}_transform(e,t,n){if("buffer"!==t&&(e=Buffer.from(e,t)),!e||!e.length)return setImmediate(n);this.inputBytes+=e.length,this._remainingBytes&&this._remainingBytes.length&&(e=Buffer.concat([this._remainingBytes,e],this._remainingBytes.length+e.length),this._remainingBytes=!1),e.length%3?(this._remainingBytes=e.slice(e.length-e.length%3),e=e.slice(0,e.length-e.length%3)):this._remainingBytes=!1;let i=this._curLine+o(e);if(this.options.lineLength){i=r(i,this.options.lineLength);let e=i.lastIndexOf("\n");e<0?(this._curLine=i,i=""):e===i.length-1?this._curLine="":(this._curLine=i.substr(e+1),i=i.substr(0,e+1))}i&&(this.outputBytes+=i.length,this.push(Buffer.from(i,"ascii"))),setImmediate(n)}_flush(e){this._remainingBytes&&this._remainingBytes.length&&(this._curLine+=o(this._remainingBytes)),this._curLine&&(this._curLine=r(this._curLine,this.options.lineLength),this.outputBytes+=this._curLine.length,this.push(this._curLine,"ascii"),this._curLine=""),e()}}}},function(e,t,n){"use strict";const i=n(14).Transform;function o(e){"string"==typeof e&&(e=Buffer.from(e,"utf-8"));let t,n=[[9],[10],[13],[32,60],[62,126]],i="";for(let o=0,r=e.length;o<r;o++)t=e[o],s(t,n)&&(32!==t&&9!==t||o!==r-1&&10!==e[o+1]&&13!==e[o+1])?i+=String.fromCharCode(t):i+="="+(t<16?"0":"")+t.toString(16).toUpperCase();return i}function r(e,t){if(t=t||76,(e=(e||"").toString()).length<=t)return e;let n,i,o,r=0,s=e.length,a=Math.floor(t/3),c="";for(;r<s;)if(o=e.substr(r,t),n=o.match(/\r\n/))o=o.substr(0,n.index+n[0].length),c+=o,r+=o.length;else if("\n"!==o.substr(-1))if(n=o.substr(-a).match(/\n.*?$/))o=o.substr(0,o.length-(n[0].length-1)),c+=o,r+=o.length;else{if(o.length>t-a&&(n=o.substr(-a).match(/[ \t.,!?][^ \t.,!?]*$/)))o=o.substr(0,o.length-(n[0].length-1));else if(o.match(/[=][\da-f]{0,2}$/i))for((n=o.match(/[=][\da-f]{0,1}$/i))&&(o=o.substr(0,o.length-n[0].length));o.length>3&&o.length<s-r&&!o.match(/^(?:=[\da-f]{2}){1,4}$/i)&&(n=o.match(/[=][\da-f]{2}$/gi))&&(i=parseInt(n[0].substr(1,2),16),!(i<128))&&(o=o.substr(0,o.length-3),!(i>=192)););r+o.length<s&&"\n"!==o.substr(-1)?(o.length===t&&o.match(/[=][\da-f]{2}$/i)?o=o.substr(0,o.length-3):o.length===t&&(o=o.substr(0,o.length-1)),r+=o.length,o+="=\r\n"):r+=o.length,c+=o}else c+=o,r+=o.length;return c}function s(e,t){for(let n=t.length-1;n>=0;n--)if(t[n].length){if(1===t[n].length&&e===t[n][0])return!0;if(2===t[n].length&&e>=t[n][0]&&e<=t[n][1])return!0}return!1}e.exports={encode:o,wrap:r,Encoder:class extends i{constructor(e){super(),this.options=e||{},!1!==this.options.lineLength&&(this.options.lineLength=this.options.lineLength||76),this._curLine="",this.inputBytes=0,this.outputBytes=0}_transform(e,t,n){let i;if("buffer"!==t&&(e=Buffer.from(e,t)),!e||!e.length)return n();this.inputBytes+=e.length,this.options.lineLength?(i=this._curLine+o(e),i=r(i,this.options.lineLength),i=i.replace(/(^|\n)([^\n]*)$/,(e,t,n)=>(this._curLine=n,t)),i&&(this.outputBytes+=i.length,this.push(i))):(i=o(e),this.outputBytes+=i.length,this.push(i,"ascii")),n()}_flush(e){this._curLine&&(this.outputBytes+=this._curLine.length,this.push(this._curLine,"ascii")),e()}}}},function(e,t,n){"use strict";const i=n(14).Stream,o=n(249),r=n(17),s=n(86);e.exports=class extends i{constructor(e,t){if(super(),this.options=e||{},e&&e.serviceClient){if(!e.privateKey||!e.user)return void setImmediate(()=>this.emit("error",new Error('Options "privateKey" and "user" are required for service account!')));let t=Math.min(Math.max(Number(this.options.serviceRequestTimeout)||0,0),3600);this.options.serviceRequestTimeout=t||300}if(this.logger=s.getLogger({logger:t},{component:this.options.component||"OAuth2"}),this.provisionCallback="function"==typeof this.options.provisionCallback&&this.options.provisionCallback,this.options.accessUrl=this.options.accessUrl||"https://accounts.google.com/o/oauth2/token",this.options.customHeaders=this.options.customHeaders||{},this.options.customParams=this.options.customParams||{},this.accessToken=this.options.accessToken||!1,this.options.expires&&Number(this.options.expires))this.expires=this.options.expires;else{let e=Math.max(Number(this.options.timeout)||0,0);this.expires=e&&Date.now()+1e3*e||0}}getToken(e,t){if(!e&&this.accessToken&&(!this.expires||this.expires>Date.now()))return t(null,this.accessToken);let n=(...e)=>{e[0]?this.logger.error({err:e[0],tnx:"OAUTH2",user:this.options.user,action:"renew"},"Failed generating new Access Token for %s",this.options.user):this.logger.info({tnx:"OAUTH2",user:this.options.user,action:"renew"},"Generated new Access Token for %s",this.options.user),t(...e)};this.provisionCallback?this.provisionCallback(this.options.user,!!e,(e,t,i)=>{!e&&t&&(this.accessToken=t,this.expires=i||0),n(e,t)}):this.generateToken(n)}updateToken(e,t){this.accessToken=e,t=Math.max(Number(t)||0,0),this.expires=t&&Date.now()+1e3*t||0,this.emit("token",{user:this.options.user,accessToken:e||"",expires:this.expires})}generateToken(e){let t,n;if(this.options.serviceClient){let i,o=Math.floor(Date.now()/1e3),r={iss:this.options.serviceClient,scope:this.options.scope||"https://mail.google.com/",sub:this.options.user,aud:this.options.accessUrl,iat:o,exp:o+this.options.serviceRequestTimeout};try{i=this.jwtSignRS256(r)}catch(t){return e(new Error("Can't generate token. Check your auth options"))}t={grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:i},n={grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:r}}else{if(!this.options.refreshToken)return e(new Error("Can't create new access token for user"));t={client_id:this.options.clientId||"",client_secret:this.options.clientSecret||"",refresh_token:this.options.refreshToken,grant_type:"refresh_token"},n={client_id:this.options.clientId||"",client_secret:(this.options.clientSecret||"").substr(0,6)+"...",refresh_token:(this.options.refreshToken||"").substr(0,6)+"...",grant_type:"refresh_token"}}Object.keys(this.options.customParams).forEach(e=>{t[e]=this.options.customParams[e],n[e]=this.options.customParams[e]}),this.logger.debug({tnx:"OAUTH2",user:this.options.user,action:"generate"},"Requesting token using: %s",JSON.stringify(n)),this.postRequest(this.options.accessUrl,t,this.options,(t,n)=>{let i;if(t)return e(t);try{i=JSON.parse(n.toString())}catch(t){return e(t)}if(!i||"object"!=typeof i)return this.logger.debug({tnx:"OAUTH2",user:this.options.user,action:"post"},"Response: %s",(n||"").toString()),e(new Error("Invalid authentication response"));let o={};if(Object.keys(i).forEach(e=>{o[e]="access_token"!==e?i[e]:(i[e]||"").toString().substr(0,6)+"..."}),this.logger.debug({tnx:"OAUTH2",user:this.options.user,action:"post"},"Response: %s",JSON.stringify(o)),i.error){let t=i.error;return i.error_description&&(t+=": "+i.error_description),i.error_uri&&(t+=" ("+i.error_uri+")"),e(new Error(t))}return i.access_token?(this.updateToken(i.access_token,i.expires_in),e(null,this.accessToken)):e(new Error("No access token"))})}buildXOAuth2Token(e){let t=["user="+(this.options.user||""),"auth=Bearer "+(e||this.accessToken),"",""];return Buffer.from(t.join(""),"utf-8").toString("base64")}postRequest(e,t,n,i){let r=!1,s=[],a=0,c=o(e,{method:"post",headers:n.customHeaders,body:t,allowErrorResponse:!0});c.on("readable",()=>{let e;for(;null!==(e=c.read());)s.push(e),a+=e.length}),c.once("error",e=>{if(!r)return r=!0,i(e)}),c.once("end",()=>{if(!r)return r=!0,i(null,Buffer.concat(s,a))})}toBase64URL(e){return"string"==typeof e&&(e=Buffer.from(e)),e.toString("base64").replace(/[=]+/g,"").replace(/\+/g,"-").replace(/\//g,"_")}jwtSignRS256(e){e=['{"alg":"RS256","typ":"JWT"}',JSON.stringify(e)].map(e=>this.toBase64URL(e)).join(".");let t=r.createSign("RSA-SHA256").update(e).sign(this.options.privateKey);return e+"."+this.toBase64URL(t)}}},function(e,t,n){"use strict";const i=n(323),o={};function r(e){return e.replace(/[^a-zA-Z0-9.-]/g,"").toLowerCase()}function s(e){let t=["domains","aliases"],n={};return Object.keys(e).forEach(i=>{t.indexOf(i)<0&&(n[i]=e[i])}),n}Object.keys(i).forEach(e=>{let t=i[e];o[r(e)]=s(t),[].concat(t.aliases||[]).forEach(e=>{o[r(e)]=s(t)}),[].concat(t.domains||[]).forEach(e=>{o[r(e)]=s(t)})}),e.exports=function(e){return e=r(e.split("@").pop()),o[e]||!1}},function(e,t,n){"use strict";const i=n(14).Transform;e.exports=class extends i{constructor(e){super(e),this.options=e||{}}_transform(e,t,n){let i,o=0;for(let t=0,n=e.length;t<n;t++)13===e[t]&&(i=e.slice(o,t),o=t+1,this.push(i));o&&o<e.length?(i=e.slice(o),this.push(i)):o||this.push(e),n()}}},,,,,,,,,,,,,,,,,,,,,,function(e,t,n){n(300),n(263),n(304),n(264);var i=n(307),o=n(89).MongoClient,r=n(17);t.handler=function(e,t,n){var s=i.createTransport({host:process.env.MAIL_HOST,port:587,auth:{user:process.env.MAIL_USERNAME,pass:process.env.MAIL_PASSWORD},secure:!1}),a=r.randomBytes(4).toString("hex");function c(){n(null,{statusCode:500,body:JSON.stringify({success:!1})})}o.connect(process.env.DB_CONNECTION_STRING,{useNewUrlParser:!0,useUnifiedTopology:!0}).then((function(t){t.db(process.env.DB_NAME).collection("profiles").findOneAndUpdate({email:e.queryStringParameters.email},{$set:{hashCode:a}},{upsert:!1}).then((function(){s.sendMail({from:"no-reply@ecomperthings.br",to:e.queryStringParameters.email,subject:"Meia noite eu te conto...",html:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional //EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:v="urn:schemas-microsoft-com:vml"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta content="width=device-width" name="viewport"/><meta content="IE=edge" http-equiv="X-UA-Compatible"/><title></title><link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" type="text/css"/><style type="text/css">body{margin: 0;padding: 0;}table,td,tr{vertical-align: top;border-collapse: collapse;}*{line-height: inherit;}a[x-apple-data-detectors=true]{color: inherit !important;text-decoration: none !important;}</style><style id="media-query" type="text/css">@media (max-width: 520px){.block-grid,.col{min-width: 320px !important;max-width: 100% !important;display: block !important;}.block-grid{width: 100% !important;}.col{width: 100% !important;}.col_cont{margin: 0 auto;}img.fullwidth,img.fullwidthOnMobile{max-width: 100% !important;}.no-stack .col{min-width: 0 !important;display: table-cell !important;}.no-stack.two-up .col{width: 50% !important;}.no-stack .col.num2{width: 16.6% !important;}.no-stack .col.num3{width: 25% !important;}.no-stack .col.num4{width: 33% !important;}.no-stack .col.num5{width: 41.6% !important;}.no-stack .col.num6{width: 50% !important;}.no-stack .col.num7{width: 58.3% !important;}.no-stack .col.num8{width: 66.6% !important;}.no-stack .col.num9{width: 75% !important;}.no-stack .col.num10{width: 83.3% !important;}.video-block{max-width: none !important;}.mobile_hide{min-height: 0px;max-height: 0px;max-width: 0px;display: none;overflow: hidden;font-size: 0px;}.desktop_hide{display: block !important;max-height: none !important;}}</style></head><body class="clean-body" style="margin: 0; padding: 0; -webkit-text-size-adjust: 100%; background-color: #FFFFFF;"><table bgcolor="#FFFFFF" cellpadding="0" cellspacing="0" class="nl-container" role="presentation" style="table-layout: fixed; vertical-align: top; min-width: 320px; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #FFFFFF; width: 100%;" valign="top" width="100%"><tbody><tr style="vertical-align: top;" valign="top"><td style="word-break: break-word; vertical-align: top;" valign="top"><div style="background-color:transparent;"><div class="block-grid" style="min-width: 320px; max-width: 500px; overflow-wrap: break-word; word-wrap: break-word; word-break: break-word; Margin: 0 auto; background-color: transparent;"><div style="border-collapse: collapse;display: table;width: 100%;background-color:transparent;"><div class="col num12" style="min-width: 320px; max-width: 500px; display: table-cell; vertical-align: top; width: 500px;"><div class="col_cont" style="width:100% !important;"><div style="border-top:0px solid transparent; border-left:0px solid transparent; border-bottom:0px solid transparent; border-right:0px solid transparent; padding-top:5px; padding-bottom:5px; padding-right: 0px; padding-left: 0px;"><div style="color:#555555;font-family:\'Montserrat\', \'Trebuchet MS\', \'Lucida Grande\', \'Lucida Sans Unicode\', \'Lucida Sans\', Tahoma, sans-serif;line-height:1.2;padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:10px;"><div style="line-height: 1.2; font-size: 12px; font-family: \'Montserrat\', \'Trebuchet MS\', \'Lucida Grande\', \'Lucida Sans Unicode\', \'Lucida Sans\', Tahoma, sans-serif; color: #555555; mso-line-height-alt: 14px;"><p style="font-size: 30px; line-height: 1.2; font-family: Montserrat, \'Trebuchet MS\', \'Lucida Grande\', \'Lucida Sans Unicode\', \'Lucida Sans\', Tahoma, sans-serif; word-break: break-word; mso-line-height-alt: 36px; margin: 0;"><span style="font-size: 30px;"><strong>Olá '.concat(e.queryStringParameters.name,'!</strong></span></p></div></div><table border="0" cellpadding="0" cellspacing="0" class="divider" role="presentation" style="table-layout: fixed; vertical-align: top; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; min-width: 100%; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;" valign="top" width="100%"><tbody><tr style="vertical-align: top;" valign="top"><td class="divider_inner" style="word-break: break-word; vertical-align: top; min-width: 100%; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; padding-top: 10px; padding-right: 10px; padding-bottom: 10px; padding-left: 10px;" valign="top"><table align="center" border="0" cellpadding="0" cellspacing="0" class="divider_content" role="presentation" style="table-layout: fixed; vertical-align: top; border-spacing: 0; border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; border-top: 1px solid #BBBBBB; width: 100%;" valign="top" width="100%"><tbody><tr style="vertical-align: top;" valign="top"><td style="word-break: break-word; vertical-align: top; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;" valign="top"><span></span></td></tr></tbody></table></td></tr></tbody></table><div style="color:#555555;font-family:\'Montserrat\', \'Trebuchet MS\', \'Lucida Grande\', \'Lucida Sans Unicode\', \'Lucida Sans\', Tahoma, sans-serif;line-height:1.2;padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:10px;"><div style="line-height: 1.2; font-size: 12px; font-family: \'Montserrat\', \'Trebuchet MS\', \'Lucida Grande\', \'Lucida Sans Unicode\', \'Lucida Sans\', Tahoma, sans-serif; color: #555555; mso-line-height-alt: 14px;"><p style="font-size: 16px; line-height: 1.2; font-family: Montserrat, \'Trebuchet MS\', \'Lucida Grande\', \'Lucida Sans Unicode\', \'Lucida Sans\', Tahoma, sans-serif; word-break: break-word; mso-line-height-alt: 19px; margin: 0;"><span style="font-size: 16px;">Aqui está o segredo que quero te contar:</span></p></div></div><div style="color:#0068a5;font-family:\'Montserrat\', \'Trebuchet MS\', \'Lucida Grande\', \'Lucida Sans Unicode\', \'Lucida Sans\', Tahoma, sans-serif;line-height:1.2;padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:10px;"><div style="line-height: 1.2; font-size: 12px; font-family: \'Montserrat\', \'Trebuchet MS\', \'Lucida Grande\', \'Lucida Sans Unicode\', \'Lucida Sans\', Tahoma, sans-serif; color: #0068a5; mso-line-height-alt: 14px;"><p style="font-size: 24px; line-height: 1.2; text-align: center; font-family: Montserrat, \'Trebuchet MS\', \'Lucida Grande\', \'Lucida Sans Unicode\', \'Lucida Sans\', Tahoma, sans-serif; word-break: break-word; mso-line-height-alt: 29px; margin: 0;"><span style="font-size: 24px;"><strong>').concat(a,"</strong></span></p></div></div><div style=\"color:#555555;font-family:'Montserrat', 'Trebuchet MS', 'Lucida Grande', 'Lucida Sans Unicode', 'Lucida Sans', Tahoma, sans-serif;line-height:1.2;padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:10px;\"><div style=\"line-height: 1.2; font-size: 12px; font-family: 'Montserrat', 'Trebuchet MS', 'Lucida Grande', 'Lucida Sans Unicode', 'Lucida Sans', Tahoma, sans-serif; color: #555555; mso-line-height-alt: 14px;\"><p style=\"font-size: 14px; line-height: 1.2; font-family: Montserrat, 'Trebuchet MS', 'Lucida Grande', 'Lucida Sans Unicode', 'Lucida Sans', Tahoma, sans-serif; word-break: break-word; mso-line-height-alt: 17px; margin: 0;\">Agora digite isso no site.</p></div></div></div></div></div></div></div></div></td></tr></tbody></table></body></html>")}).then((function(){n(null,{statusCode:200,body:JSON.stringify({success:!0})})})).catch((function(){return c()}))})).catch((function(){return c()}))})).catch((function(){return c()}))}},function(e,t,n){"use strict";var i=n(240),o=n(65),r=n(248),s=n(84),a=n(260),c=n(235),l=n(301),p=n(261),u=n(302),d=n(129),h=n(269),f=d("isConcatSpreadable"),m=h>=51||!o((function(){var e=[];return e[f]=!1,e.concat()[0]!==e})),g=u("concat"),y=function(e){if(!s(e))return!1;var t=e[f];return void 0!==t?!!t:r(e)};i({target:"Array",proto:!0,forced:!m||!g},{concat:function(e){var t,n,i,o,r,s=a(this),u=p(s,0),d=0;for(t=-1,i=arguments.length;t<i;t++)if(y(r=-1===t?s:arguments[t])){if(d+(o=c(r.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<o;n++,d++)n in r&&l(u,d,r[n])}else{if(d>=9007199254740991)throw TypeError("Maximum allowed index exceeded");l(u,d++,r)}return u.length=d,u}})},function(e,t,n){"use strict";var i=n(226),o=n(87),r=n(225);e.exports=function(e,t,n){var s=i(t);s in e?o.f(e,s,r(0,n)):e[s]=n}},function(e,t,n){var i=n(65),o=n(129),r=n(269),s=o("species");e.exports=function(e){return r>=51||!i((function(){var t=[];return(t.constructor={})[s]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},function(e,t,n){var i=n(228);e.exports=i("navigator","userAgent")||""},function(e,t,n){var i=n(265),o=n(222),r=n(305);i||o(Object.prototype,"toString",r,{unsafe:!0})},function(e,t,n){"use strict";var i=n(265),o=n(306);e.exports=i?{}.toString:function(){return"[object "+o(this)+"]"}},function(e,t,n){var i=n(265),o=n(221),r=n(129)("toStringTag"),s="Arguments"==o(function(){return arguments}());e.exports=i?o:function(e){var t,n,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),r))?n:s?o(t):"Object"==(i=o(t))&&"function"==typeof t.callee?"Arguments":i}},function(e,t,n){"use strict";const i=n(308),o=n(86),r=n(320),s=n(324),a=n(325),c=n(327),l=n(328),p=n(329),u=n(249),d=n(130),h=(process.env.ETHEREAL_API||"https://api.nodemailer.com").replace(/\/+$/,""),f=(process.env.ETHEREAL_WEB||"https://ethereal.email").replace(/\/+$/,""),m=["true","yes","y","1"].includes((process.env.ETHEREAL_CACHE||"yes").toString().trim().toLowerCase());let g=!1;e.exports.createTransport=function(e,t){let n,u,d;return("object"==typeof e&&"function"!=typeof e.send||"string"==typeof e&&/^(smtps?|direct):/i.test(e))&&(u=(n="string"==typeof e?e:e.url)?o.parseConnectionUrl(n):e,e=u.pool?new r(u):u.sendmail?new a(u):u.streamTransport?new c(u):u.jsonTransport?new l(u):u.SES?new p(u):new s(u)),d=new i(e,u,t),d},e.exports.createTestAccount=function(e,t){let n;if(t||"function"!=typeof e||(t=e,e=!1),t||(n=new Promise((e,n)=>{t=o.callbackPromise(e,n)})),m&&g)return setImmediate(()=>t(null,g)),n;let i=[],r=0,s=u((e=e||h)+"/user",{contentType:"application/json",method:"POST",body:Buffer.from(JSON.stringify({requestor:d.name,version:d.version}))});return s.on("readable",()=>{let e;for(;null!==(e=s.read());)i.push(e),r+=e.length}),s.once("error",e=>t(e)),s.once("end",()=>{let e,n,o=Buffer.concat(i,r);try{e=JSON.parse(o.toString())}catch(e){n=e}return n?t(n):"success"!==e.status||e.error?t(new Error(e.error||"Request failed")):(delete e.status,g=e,void t(null,g))}),n},e.exports.getTestMessageUrl=function(e){if(!e||!e.response)return!1;let t=new Map;return e.response.replace(/\[([^\]]+)\]$/,(e,n)=>{n.replace(/\b([A-Z0-9]+)=([^\s]+)/g,(e,n,i)=>{t.set(n,i)})}),!(!t.has("STATUS")||!t.has("MSGID"))&&(g.web||f)+"/message/"+t.get("MSGID")}},function(e,t,n){"use strict";const i=n(8),o=n(86),r=n(270),s=n(311),a=n(314),c=n(318),l=n(5),p=n(34),u=n(130),d=n(319),h=n(96),f=n(45),m=n(17);e.exports=class extends i{constructor(e,t,n){super(),this.options=t||{},this._defaults=n||{},this._defaultPlugins={compile:[(...e)=>this._convertDataImages(...e)],stream:[]},this._userPlugins={compile:[],stream:[]},this.meta=new Map,this.dkim=!!this.options.dkim&&new a(this.options.dkim),this.transporter=e,this.transporter.mailer=this,this.logger=o.getLogger(this.options,{component:this.options.component||"mail"}),this.logger.debug({tnx:"create"},"Creating transport: %s",this.getVersionString()),"function"==typeof this.transporter.on&&(this.transporter.on("log",e=>{this.logger.debug({tnx:"transport"},"%s: %s",e.type,e.message)}),this.transporter.on("error",e=>{this.logger.error({err:e,tnx:"transport"},"Transport Error: %s",e.message),this.emit("error",e)}),this.transporter.on("idle",(...e)=>{this.emit("idle",...e)})),["close","isIdle","verify"].forEach(e=>{this[e]=(...t)=>"function"==typeof this.transporter[e]?this.transporter[e](...t):(this.logger.warn({tnx:"transport",methodName:e},"Non existing method %s called for transport",e),!1)}),this.options.proxy&&"string"==typeof this.options.proxy&&this.setupProxy(this.options.proxy)}use(e,t){return e=(e||"").toString(),this._userPlugins.hasOwnProperty(e)?this._userPlugins[e].push(t):this._userPlugins[e]=[t],this}sendMail(e,t){let n;t||(n=new Promise((e,n)=>{t=o.callbackPromise(e,n)})),"function"==typeof this.getSocket&&(this.transporter.getSocket=this.getSocket,this.getSocket=!1);let i=new d(this,e);return this.logger.debug({tnx:"transport",name:this.transporter.name,version:this.transporter.version,action:"send"},"Sending mail using %s/%s",this.transporter.name,this.transporter.version),this._processPlugins("compile",i,e=>{if(e)return this.logger.error({err:e,tnx:"plugin",action:"compile"},"PluginCompile Error: %s",e.message),t(e);i.message=new s(i.data).compile(),i.setMailerHeader(),i.setPriorityHeaders(),i.setListHeaders(),this._processPlugins("stream",i,e=>{if(e)return this.logger.error({err:e,tnx:"plugin",action:"stream"},"PluginStream Error: %s",e.message),t(e);(i.data.dkim||this.dkim)&&i.message.processFunc(e=>{let t=i.data.dkim?new a(i.data.dkim):this.dkim;return this.logger.debug({tnx:"DKIM",messageId:i.message.messageId(),dkimDomains:t.keys.map(e=>e.keySelector+"."+e.domainName).join(", ")},"Signing outgoing message with %s keys",t.keys.length),t.sign(e,i.data._dkim)}),this.transporter.send(i,(...e)=>{e[0]&&this.logger.error({err:e[0],tnx:"transport",action:"send"},"Send Error: %s",e[0].message),t(...e)})})}),n}getVersionString(){return l.format("%s (%s; +%s; %s/%s)",u.name,u.version,u.homepage,this.transporter.name,this.transporter.version)}_processPlugins(e,t,n){if(e=(e||"").toString(),!this._userPlugins.hasOwnProperty(e))return n();let i=this._userPlugins[e]||[],o=this._defaultPlugins[e]||[];if(i.length&&this.logger.debug({tnx:"transaction",pluginCount:i.length,step:e},"Using %s plugins for %s",i.length,e),i.length+o.length===0)return n();let r=0,s="default",a=()=>{let e="default"===s?o:i;if(r>=e.length){if("default"!==s||!i.length)return n();s="user",r=0,e=i}(0,e[r++])(t,e=>{if(e)return n(e);a()})};a()}setupProxy(e){let t=p.parse(e);this.getSocket=(e,n)=>{let i=t.protocol.replace(/:$/,"").toLowerCase();if(this.meta.has("proxy_handler_"+i))return this.meta.get("proxy_handler_"+i)(t,e,n);switch(i){case"http":case"https":return void c(t.href,e.port,e.host,(e,t)=>e?n(e):n(null,{connection:t}));case"socks":case"socks5":case"socks4":case"socks4a":{if(!this.meta.has("proxy_socks_module"))return n(new Error("Socks module not loaded"));let i=i=>{let o=!!this.meta.get("proxy_socks_module").SocksClient,r=o?this.meta.get("proxy_socks_module").SocksClient:this.meta.get("proxy_socks_module"),s=Number(t.protocol.replace(/\D/g,""))||5,a={proxy:{ipaddress:i,port:Number(t.port),type:s},[o?"destination":"target"]:{host:e.host,port:e.port},command:"connect"};if(t.auth){let e=decodeURIComponent(t.auth.split(":").shift()),n=decodeURIComponent(t.auth.split(":").pop());o?(a.proxy.userId=e,a.proxy.password=n):4===s?a.userid=e:a.authentication={username:e,password:n}}r.createConnection(a,(e,t)=>e?n(e):n(null,{connection:t.socket||t}))};return h.isIP(t.hostname)?i(t.hostname):f.resolve(t.hostname,(e,t)=>{if(e)return n(e);i(Array.isArray(t)?t[0]:t)})}}n(new Error("Unknown proxy configuration"))}}_convertDataImages(e,t){if(!this.options.attachDataUrls&&!e.data.attachDataUrls||!e.data.html)return t();e.resolveContent(e.data,"html",(n,i)=>{if(n)return t(n);let o=0;i=(i||"").toString().replace(/(<img\b[^>]* src\s*=[\s"']*)(data:([^;]+);[^"'>\s]+)/gi,(t,n,i,s)=>{let a=m.randomBytes(10).toString("hex")+"@localhost";return e.data.attachments||(e.data.attachments=[]),Array.isArray(e.data.attachments)||(e.data.attachments=[].concat(e.data.attachments||[])),e.data.attachments.push({path:i,cid:a,filename:"image-"+ ++o+"."+r.detectExtension(s)}),n+"cid:"+a}),e.data.html=i,t()})}set(e,t){return this.meta.set(e,t)}get(e){return this.meta.get(e)}}},function(e,t){e.exports=require("https")},function(e,t,n){"use strict";const i=n(34);e.exports=class{constructor(e){this.options=e||{},this.cookies=[]}set(e,t){let n,o=i.parse(t||""),r=this.parse(e);return r.domain?(n=r.domain.replace(/^\./,""),(o.hostname.length<n.length||("."+o.hostname).substr(1-n.length)!=="."+n)&&(r.domain=o.hostname)):r.domain=o.hostname,r.path||(r.path=this.getPath(o.pathname)),r.expires||(r.expires=new Date(Date.now()+1e3*(Number(this.options.sessionTimeout||1800)||1800))),this.add(r)}get(e){return this.list(e).map(e=>e.name+"="+e.value).join("; ")}list(e){let t,n,i=[];for(t=this.cookies.length-1;t>=0;t--)n=this.cookies[t],this.isExpired(n)?this.cookies.splice(t,t):this.match(n,e)&&i.unshift(n);return i}parse(e){let t={};return(e||"").toString().split(";").forEach(e=>{let n,i=e.split("="),o=i.shift().trim().toLowerCase(),r=i.join("=").trim();if(o)switch(o){case"expires":r=new Date(r),"Invalid Date"!==r.toString()&&(t.expires=r);break;case"path":t.path=r;break;case"domain":n=r.toLowerCase(),n.length&&"."!==n.charAt(0)&&(n="."+n),t.domain=n;break;case"max-age":t.expires=new Date(Date.now()+1e3*(Number(r)||0));break;case"secure":t.secure=!0;break;case"httponly":t.httponly=!0;break;default:t.name||(t.name=o,t.value=r)}}),t}match(e,t){let n=i.parse(t||"");return(n.hostname===e.domain||"."===e.domain.charAt(0)&&("."+n.hostname).substr(-e.domain.length)===e.domain)&&(this.getPath(n.pathname).substr(0,e.path.length)===e.path&&(!e.secure||"https:"===n.protocol))}add(e){let t,n;if(!e||!e.name)return!1;for(t=0,n=this.cookies.length;t<n;t++)if(this.compare(this.cookies[t],e))return this.isExpired(e)?(this.cookies.splice(t,1),!1):(this.cookies[t]=e,!0);return this.isExpired(e)||this.cookies.push(e),!0}compare(e,t){return e.name===t.name&&e.path===t.path&&e.domain===t.domain&&e.secure===t.secure&&e.httponly==e.httponly}isExpired(e){return e.expires&&e.expires<new Date||!e.value}getPath(e){let t=(e||"/").split("/");return t.pop(),t=t.join("/").trim(),"/"!==t.charAt(0)&&(t="/"+t),"/"!==t.substr(-1)&&(t+="/"),t}}},function(e,t,n){"use strict";const i=n(271),o=n(250);e.exports=class{constructor(e){this.mail=e||{},this.message=!1}compile(){return this._alternatives=this.getAlternatives(),this._htmlNode=this._alternatives.filter(e=>/^text\/html\b/i.test(e.contentType)).pop(),this._attachments=this.getAttachments(!!this._htmlNode),this._useRelated=!(!this._htmlNode||!this._attachments.related.length),this._useAlternative=this._alternatives.length>1,this._useMixed=this._attachments.attached.length>1||this._alternatives.length&&1===this._attachments.attached.length,this.mail.raw?this.message=(new i).setRaw(this.mail.raw):this._useMixed?this.message=this._createMixed():this._useAlternative?this.message=this._createAlternative():this._useRelated?this.message=this._createRelated():this.message=this._createContentNode(!1,[].concat(this._alternatives||[]).concat(this._attachments.attached||[]).shift()||{contentType:"text/plain",content:""}),this.mail.headers&&this.message.addHeader(this.mail.headers),["from","sender","to","cc","bcc","reply-to","in-reply-to","references","subject","message-id","date"].forEach(e=>{let t=e.replace(/-(\w)/g,(e,t)=>t.toUpperCase());this.mail[t]&&this.message.setHeader(e,this.mail[t])}),this.mail.envelope&&this.message.setEnvelope(this.mail.envelope),this.message.messageId(),this.message}getAttachments(e){let t,n,i=[].concat(this.mail.attachments||[]).map((e,t)=>{let n,i=/^message\//i.test(e.contentType);return/^data:/i.test(e.path||e.href)&&(e=this._processDataUrl(e)),n={contentType:e.contentType||o.detectMimeType(e.filename||e.path||e.href||"bin"),contentDisposition:e.contentDisposition||(i?"inline":"attachment"),contentTransferEncoding:"contentTransferEncoding"in e?e.contentTransferEncoding:"base64"},e.filename?n.filename=e.filename:i||!1===e.filename||(n.filename=(e.path||e.href||"").split("/").pop().split("?").shift()||"attachment-"+(t+1),n.filename.indexOf(".")<0&&(n.filename+="."+o.detectExtension(n.contentType))),/^https?:\/\//i.test(e.path)&&(e.href=e.path,e.path=void 0),e.cid&&(n.cid=e.cid),e.raw?n.raw=e.raw:e.path?n.content={path:e.path}:e.href?n.content={href:e.href,httpHeaders:e.httpHeaders}:n.content=e.content||"",e.encoding&&(n.encoding=e.encoding),e.headers&&(n.headers=e.headers),n});return this.mail.icalEvent&&(t="object"==typeof this.mail.icalEvent&&(this.mail.icalEvent.content||this.mail.icalEvent.path||this.mail.icalEvent.href||this.mail.icalEvent.raw)?this.mail.icalEvent:{content:this.mail.icalEvent},n={},Object.keys(t).forEach(e=>{n[e]=t[e]}),n.contentType="application/ics",n.headers||(n.headers={}),n.filename=n.filename||"invite.ics",n.headers["Content-Disposition"]="attachment",n.headers["Content-Transfer-Encoding"]="base64"),e?{attached:i.filter(e=>!e.cid).concat(n||[]),related:i.filter(e=>!!e.cid)}:{attached:i.concat(n||[]),related:[]}}getAlternatives(){let e,t,n,i,r,s,a=[];return this.mail.text&&(e="object"==typeof this.mail.text&&(this.mail.text.content||this.mail.text.path||this.mail.text.href||this.mail.text.raw)?this.mail.text:{content:this.mail.text},e.contentType="text/plain; charset=utf-8"),this.mail.watchHtml&&(n="object"==typeof this.mail.watchHtml&&(this.mail.watchHtml.content||this.mail.watchHtml.path||this.mail.watchHtml.href||this.mail.watchHtml.raw)?this.mail.watchHtml:{content:this.mail.watchHtml},n.contentType="text/watch-html; charset=utf-8"),this.mail.amp&&(i="object"==typeof this.mail.amp&&(this.mail.amp.content||this.mail.amp.path||this.mail.amp.href||this.mail.amp.raw)?this.mail.amp:{content:this.mail.amp},i.contentType="text/x-amp-html; charset=utf-8"),this.mail.icalEvent&&(r="object"==typeof this.mail.icalEvent&&(this.mail.icalEvent.content||this.mail.icalEvent.path||this.mail.icalEvent.href||this.mail.icalEvent.raw)?this.mail.icalEvent:{content:this.mail.icalEvent},s={},Object.keys(r).forEach(e=>{s[e]=r[e]}),s.content&&"object"==typeof s.content&&(s.content._resolve=!0),s.filename=!1,s.contentType="text/calendar; charset=utf-8; method="+(s.method||"PUBLISH").toString().trim().toUpperCase(),s.headers||(s.headers={})),this.mail.html&&(t="object"==typeof this.mail.html&&(this.mail.html.content||this.mail.html.path||this.mail.html.href||this.mail.html.raw)?this.mail.html:{content:this.mail.html},t.contentType="text/html; charset=utf-8"),[].concat(e||[]).concat(n||[]).concat(i||[]).concat(t||[]).concat(s||[]).concat(this.mail.alternatives||[]).forEach(e=>{let t;/^data:/i.test(e.path||e.href)&&(e=this._processDataUrl(e)),t={contentType:e.contentType||o.detectMimeType(e.filename||e.path||e.href||"txt"),contentTransferEncoding:e.contentTransferEncoding},e.filename&&(t.filename=e.filename),/^https?:\/\//i.test(e.path)&&(e.href=e.path,e.path=void 0),e.raw?t.raw=e.raw:e.path?t.content={path:e.path}:e.href?t.content={href:e.href}:t.content=e.content||"",e.encoding&&(t.encoding=e.encoding),e.headers&&(t.headers=e.headers),a.push(t)}),a}_createMixed(e){let t;return t=e?e.createChild("multipart/mixed",{disableUrlAccess:this.mail.disableUrlAccess,disableFileAccess:this.mail.disableFileAccess,normalizeHeaderKey:this.mail.normalizeHeaderKey}):new i("multipart/mixed",{baseBoundary:this.mail.baseBoundary,textEncoding:this.mail.textEncoding,boundaryPrefix:this.mail.boundaryPrefix,disableUrlAccess:this.mail.disableUrlAccess,disableFileAccess:this.mail.disableFileAccess,normalizeHeaderKey:this.mail.normalizeHeaderKey}),this._useAlternative?this._createAlternative(t):this._useRelated&&this._createRelated(t),[].concat(!this._useAlternative&&this._alternatives||[]).concat(this._attachments.attached||[]).forEach(e=>{this._useRelated&&e===this._htmlNode||this._createContentNode(t,e)}),t}_createAlternative(e){let t;return t=e?e.createChild("multipart/alternative",{disableUrlAccess:this.mail.disableUrlAccess,disableFileAccess:this.mail.disableFileAccess,normalizeHeaderKey:this.mail.normalizeHeaderKey}):new i("multipart/alternative",{baseBoundary:this.mail.baseBoundary,textEncoding:this.mail.textEncoding,boundaryPrefix:this.mail.boundaryPrefix,disableUrlAccess:this.mail.disableUrlAccess,disableFileAccess:this.mail.disableFileAccess,normalizeHeaderKey:this.mail.normalizeHeaderKey}),this._alternatives.forEach(e=>{this._useRelated&&this._htmlNode===e?this._createRelated(t):this._createContentNode(t,e)}),t}_createRelated(e){let t;return t=e?e.createChild('multipart/related; type="text/html"',{disableUrlAccess:this.mail.disableUrlAccess,disableFileAccess:this.mail.disableFileAccess,normalizeHeaderKey:this.mail.normalizeHeaderKey}):new i('multipart/related; type="text/html"',{baseBoundary:this.mail.baseBoundary,textEncoding:this.mail.textEncoding,boundaryPrefix:this.mail.boundaryPrefix,disableUrlAccess:this.mail.disableUrlAccess,disableFileAccess:this.mail.disableFileAccess,normalizeHeaderKey:this.mail.normalizeHeaderKey}),this._createContentNode(t,this._htmlNode),this._attachments.related.forEach(e=>this._createContentNode(t,e)),t}_createContentNode(e,t){let n;(t=t||{}).content=t.content||"";let o=(t.encoding||"utf8").toString().toLowerCase().replace(/[-_\s]/g,"");return n=e?e.createChild(t.contentType,{filename:t.filename,disableUrlAccess:this.mail.disableUrlAccess,disableFileAccess:this.mail.disableFileAccess,normalizeHeaderKey:this.mail.normalizeHeaderKey}):new i(t.contentType,{filename:t.filename,baseBoundary:this.mail.baseBoundary,textEncoding:this.mail.textEncoding,boundaryPrefix:this.mail.boundaryPrefix,disableUrlAccess:this.mail.disableUrlAccess,disableFileAccess:this.mail.disableFileAccess,normalizeHeaderKey:this.mail.normalizeHeaderKey}),t.headers&&n.addHeader(t.headers),t.cid&&n.setHeader("Content-Id","<"+t.cid.replace(/[<>]/g,"")+">"),t.contentTransferEncoding?n.setHeader("Content-Transfer-Encoding",t.contentTransferEncoding):this.mail.encoding&&/^text\//i.test(t.contentType)&&n.setHeader("Content-Transfer-Encoding",this.mail.encoding),/^text\//i.test(t.contentType)&&!t.contentDisposition||n.setHeader("Content-Disposition",t.contentDisposition||(t.cid?"inline":"attachment")),"string"!=typeof t.content||["utf8","usascii","ascii"].includes(o)||(t.content=Buffer.from(t.content,o)),t.raw?n.setRaw(t.raw):n.setContent(t.content),n}_processDataUrl(e){let t=(e.path||e.href).match(/^data:((?:[^;]*;)*(?:[^,]*)),(.*)$/i);return t?(e.content=/\bbase64$/i.test(t[1])?Buffer.from(t[2],"base64"):Buffer.from(decodeURIComponent(t[2])),"path"in e&&(e.path=!1),"href"in e&&(e.href=!1),t[1].split(";").forEach(t=>{/^\w+\/[^/]+$/i.test(t)&&(e.contentType=e.contentType||t.toLowerCase())}),e):e}}},function(e,t,n){"use strict";class i{constructor(e){this.str=(e||"").toString(),this.operatorCurrent="",this.operatorExpecting="",this.node=null,this.escaped=!1,this.list=[],this.operators={'"':'"',"(":")","<":">",",":"",":":";",";":""}}tokenize(){let e,t=[];for(let t=0,n=this.str.length;t<n;t++)e=this.str.charAt(t),this.checkChar(e);return this.list.forEach(e=>{e.value=(e.value||"").toString().trim(),e.value&&t.push(e)}),t}checkChar(e){if(this.escaped);else{if(e===this.operatorExpecting)return this.node={type:"operator",value:e},this.list.push(this.node),this.node=null,this.operatorExpecting="",void(this.escaped=!1);if(!this.operatorExpecting&&e in this.operators)return this.node={type:"operator",value:e},this.list.push(this.node),this.node=null,this.operatorExpecting=this.operators[e],void(this.escaped=!1);if(['"',"'"].includes(this.operatorExpecting)&&"\\"===e)return void(this.escaped=!0)}this.node||(this.node={type:"text",value:""},this.list.push(this.node)),"\n"===e&&(e=" "),(e.charCodeAt(0)>=33||[" ","\t"].includes(e))&&(this.node.value+=e),this.escaped=!1}}function o(e,t){t=t||{};let n=new i(e).tokenize(),r=[],s=[],a=[];if(n.forEach(e=>{"operator"!==e.type||","!==e.value&&";"!==e.value?s.push(e):(s.length&&r.push(s),s=[])}),s.length&&r.push(s),r.forEach(e=>{(e=function(e){let t,n,i,r,s=!1,a="text",c=[],l={address:[],comment:[],group:[],text:[]};for(i=0,r=e.length;i<r;i++)if(t=e[i],"operator"===t.type)switch(t.value){case"<":a="address";break;case"(":a="comment";break;case":":a="group",s=!0;break;default:a="text"}else t.value&&("address"===a&&(t.value=t.value.replace(/^[^<]*<\s*/,"")),l[a].push(t.value));if(!l.text.length&&l.comment.length&&(l.text=l.comment,l.comment=[]),s)l.text=l.text.join(" "),c.push({name:l.text||n&&n.name,group:l.group.length?o(l.group.join(",")):[]});else{if(!l.address.length&&l.text.length){for(i=l.text.length-1;i>=0;i--)if(l.text[i].match(/^[^@\s]+@[^@\s]+$/)){l.address=l.text.splice(i,1);break}let e=function(e){return l.address.length?e:(l.address=[e.trim()]," ")};if(!l.address.length)for(i=l.text.length-1;i>=0&&(l.text[i]=l.text[i].replace(/\s*\b[^@\s]+@[^\s]+\b\s*/,e).trim(),!l.address.length);i--);}if(!l.text.length&&l.comment.length&&(l.text=l.comment,l.comment=[]),l.address.length>1&&(l.text=l.text.concat(l.address.splice(1))),l.text=l.text.join(" "),l.address=l.address.join(" "),!l.address&&s)return[];n={address:l.address||l.text||"",name:l.text||l.address||""},n.address===n.name&&((n.address||"").match(/@/)?n.name="":n.address=""),c.push(n)}return c}(e)).length&&(a=a.concat(e))}),t.flatten){let e=[],t=n=>{n.forEach(n=>{if(n.group)return t(n.group);e.push(n)})};return t(a),e}return a}e.exports=o},function(e,t,n){"use strict";const i=n(14).Transform;e.exports=class extends i{constructor(){super(),this.lastByte=!1}_transform(e,t,n){e.length&&(this.lastByte=e[e.length-1]),this.push(e),n()}_flush(e){return 10===this.lastByte?e():13===this.lastByte?(this.push(Buffer.from("\n")),e()):(this.push(Buffer.from("\r\n")),e())}}},function(e,t,n){"use strict";const i=n(315),o=n(316),r=n(317),s=n(14).PassThrough,a=n(44),c=n(66),l=n(17);class p{constructor(e,t,n,i){this.options=e||{},this.keys=t,this.cacheTreshold=Number(this.options.cacheTreshold)||131072,this.hashAlgo=this.options.hashAlgo||"sha256",this.cacheDir=this.options.cacheDir||!1,this.chunks=[],this.chunklen=0,this.readPos=0,this.cachePath=!!this.cacheDir&&c.join(this.cacheDir,"message."+Date.now()+"-"+l.randomBytes(14).toString("hex")),this.cache=!1,this.headers=!1,this.bodyHash=!1,this.parser=!1,this.relaxedBody=!1,this.input=n,this.output=i,this.output.usingCache=!1,this.errored=!1,this.input.on("error",e=>{this.errored=!0,this.cleanup(),i.emit("error",e)})}cleanup(){this.cache&&this.cachePath&&a.unlink(this.cachePath,()=>!1)}createReadCache(){this.cache=a.createReadStream(this.cachePath),this.cache.once("error",e=>{this.cleanup(),this.output.emit("error",e)}),this.cache.once("close",()=>{this.cleanup()}),this.cache.pipe(this.output)}sendNextChunk(){if(this.errored)return;if(this.readPos>=this.chunks.length)return this.cache?this.createReadCache():this.output.end();let e=this.chunks[this.readPos++];if(!1===this.output.write(e))return this.output.once("drain",()=>{this.sendNextChunk()});setImmediate(()=>this.sendNextChunk())}sendSignedOutput(){let e=0,t=()=>{if(e>=this.keys.length)return this.output.write(this.parser.rawHeaders),setImmediate(()=>this.sendNextChunk());let n=this.keys[e++],i=r(this.headers,this.hashAlgo,this.bodyHash,{domainName:n.domainName,keySelector:n.keySelector,privateKey:n.privateKey,headerFieldNames:this.options.headerFieldNames,skipFields:this.options.skipFields});return i&&this.output.write(Buffer.from(i+"\r\n")),setImmediate(t)};if(this.bodyHash&&this.headers)return t();this.output.write(this.parser.rawHeaders),this.sendNextChunk()}createWriteCache(){this.output.usingCache=!0,this.cache=a.createWriteStream(this.cachePath),this.cache.once("error",e=>{this.cleanup(),this.relaxedBody.unpipe(this.cache),this.relaxedBody.on("readable",()=>{for(;null!==this.relaxedBody.read(););}),this.errored=!0,this.output.emit("error",e)}),this.cache.once("close",()=>{this.sendSignedOutput()}),this.relaxedBody.removeAllListeners("readable"),this.relaxedBody.pipe(this.cache)}signStream(){this.parser=new i,this.relaxedBody=new o({hashAlgo:this.hashAlgo}),this.parser.on("headers",e=>{this.headers=e}),this.relaxedBody.on("hash",e=>{this.bodyHash=e}),this.relaxedBody.on("readable",()=>{let e;if(!this.cache)for(;null!==(e=this.relaxedBody.read());)if(this.chunks.push(e),this.chunklen+=e.length,this.chunklen>=this.cacheTreshold&&this.cachePath)return this.createWriteCache()}),this.relaxedBody.on("end",()=>{this.cache||this.sendSignedOutput()}),this.parser.pipe(this.relaxedBody),setImmediate(()=>this.input.pipe(this.parser))}}e.exports=class{constructor(e){this.options=e||{},this.keys=[].concat(this.options.keys||{domainName:e.domainName,keySelector:e.keySelector,privateKey:e.privateKey})}sign(e,t){let n=new s,i=e,o=!1;Buffer.isBuffer(e)?(o=e,i=new s):"string"==typeof e&&(o=Buffer.from(e),i=new s);let r=this.options;t&&Object.keys(t).length&&(r={},Object.keys(this.options||{}).forEach(e=>{r[e]=this.options[e]}),Object.keys(t||{}).forEach(e=>{e in r||(r[e]=t[e])}));let a=new p(r,this.keys,i,n);return setImmediate(()=>{a.signStream(),o&&setImmediate(()=>{i.end(o)})}),n}}},function(e,t,n){"use strict";const i=n(14).Transform;e.exports=class extends i{constructor(e){super(e),this.lastBytes=Buffer.alloc(4),this.headersParsed=!1,this.headerBytes=0,this.headerChunks=[],this.rawHeaders=!1,this.bodySize=0}updateLastBytes(e){let t=this.lastBytes.length,n=Math.min(e.length,t);for(let e=0,i=t-n;e<i;e++)this.lastBytes[e]=this.lastBytes[e+n];for(let i=1;i<=n;i++)this.lastBytes[t-i]=e[e.length-i]}checkHeaders(e){if(this.headersParsed)return!0;let t=this.lastBytes.length,n=0;this.curLinePos=0;for(let i=0,o=this.lastBytes.length+e.length;i<o;i++){let o;if(o=i<t?this.lastBytes[i]:e[i-t],10===o&&i){let o=i-1<t?this.lastBytes[i-1]:e[i-1-t],r=i>1&&(i-2<t?this.lastBytes[i-2]:e[i-2-t]);if(10===o){this.headersParsed=!0,n=i-t+1,this.headerBytes+=n;break}if(13===o&&10===r){this.headersParsed=!0,n=i-t+1,this.headerBytes+=n;break}}}if(this.headersParsed){if(this.headerChunks.push(e.slice(0,n)),this.rawHeaders=Buffer.concat(this.headerChunks,this.headerBytes),this.headerChunks=null,this.emit("headers",this.parseHeaders()),e.length-1>n){let t=e.slice(n);this.bodySize+=t.length,setImmediate(()=>this.push(t))}return!1}return this.headerBytes+=e.length,this.headerChunks.push(e),this.updateLastBytes(e),!1}_transform(e,t,n){if(!e||!e.length)return n();let i;"string"==typeof e&&(e=Buffer.from(e,t));try{i=this.checkHeaders(e)}catch(e){return n(e)}i&&(this.bodySize+=e.length,this.push(e)),setImmediate(n)}_flush(e){if(this.headerChunks){let e=Buffer.concat(this.headerChunks,this.headerBytes);this.bodySize+=e.length,this.push(e),this.headerChunks=null}e()}parseHeaders(){let e=(this.rawHeaders||"").toString().split(/\r?\n/);for(let t=e.length-1;t>0;t--)/^\s/.test(e[t])&&(e[t-1]+="\n"+e[t],e.splice(t,1));return e.filter(e=>e.trim()).map(e=>({key:e.substr(0,e.indexOf(":")).trim().toLowerCase(),line:e}))}}},function(e,t,n){"use strict";const i=n(14).Transform,o=n(17);e.exports=class extends i{constructor(e){super(),e=e||{},this.chunkBuffer=[],this.chunkBufferLen=0,this.bodyHash=o.createHash(e.hashAlgo||"sha1"),this.remainder="",this.byteLength=0,this.debug=e.debug,this._debugBody=!!e.debug&&[]}updateHash(e){let t,n="",i="file";for(let t=e.length-1;t>=0;t--){let o=e[t];if("file"!==i||10!==o&&13!==o)if("file"!==i||9!==o&&32!==o)if("line"!==i||9!==o&&32!==o){if(("file"===i||"line"===i)&&(i="body",t===e.length-1))break}else;else i="line";else;if(0===t){if("file"===i&&(!this.remainder||/[\r\n]$/.test(this.remainder))||"line"===i&&(!this.remainder||/[ \t]$/.test(this.remainder)))return void(this.remainder+=e.toString("binary"));if("line"===i||"file"===i){n=e.toString("binary"),e=!1;break}}if("body"===i){n=e.slice(t+1).toString("binary"),e=e.slice(0,t+1);break}}let o=!!this.remainder;if(e&&!o)for(let t=0,n=e.length;t<n;t++){if(t&&10===e[t]&&13!==e[t-1]){o=!0;break}if(t&&13===e[t]&&32===e[t-1]){o=!0;break}if(t&&32===e[t]&&32===e[t-1]){o=!0;break}if(9===e[t]){o=!0;break}}o?(t=this.remainder+(e?e.toString("binary"):""),this.remainder=n,t=t.replace(/\r?\n/g,"\n").replace(/[ \t]*$/gm,"").replace(/[ \t]+/gm," ").replace(/\n/g,"\r\n"),e=Buffer.from(t,"binary")):n&&(this.remainder=n),this.debug&&this._debugBody.push(e),this.bodyHash.update(e)}_transform(e,t,n){if(!e||!e.length)return n();"string"==typeof e&&(e=Buffer.from(e,t)),this.updateHash(e),this.byteLength+=e.length,this.push(e),n()}_flush(e){/[\r\n]$/.test(this.remainder)&&this.byteLength>2&&this.bodyHash.update(Buffer.from("\r\n")),this.byteLength||this.push(Buffer.from("\r\n")),this.emit("hash",this.bodyHash.digest("base64"),!!this.debug&&Buffer.concat(this._debugBody)),e()}}},function(e,t,n){"use strict";const i=n(272),o=n(250),r=n(17);function s(e,t,n){let i=new Set,o=new Set,r=new Map;(n||"").toLowerCase().split(":").forEach(e=>{o.add(e.trim())}),(t||"").toLowerCase().split(":").filter(e=>!o.has(e.trim())).forEach(e=>{i.add(e.trim())});for(let t=e.length-1;t>=0;t--){let n=e[t];i.has(n.key)&&!r.has(n.key)&&r.set(n.key,a(n.line))}let s=[],c=[];return i.forEach(e=>{r.has(e)&&(c.push(e),s.push(e+":"+r.get(e)))}),{headers:s.join("\r\n")+"\r\n",fieldNames:c.join(":")}}function a(e){return e.substr(e.indexOf(":")+1).replace(/\r?\n/g,"").replace(/\s+/g," ").trim()}e.exports=(e,t,n,c)=>{let l,p,u=s(e,(c=c||{}).headerFieldNames||"From:Sender:Reply-To:Subject:Date:Message-ID:To:Cc:MIME-Version:Content-Type:Content-Transfer-Encoding:Content-ID:Content-Description:Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:In-Reply-To:References:List-Id:List-Help:List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive",c.skipFields),d=function(e,t,n,r,s){let a=["v=1","a=rsa-"+r,"c=relaxed/relaxed","d="+i.toASCII(e),"q=dns/txt","s="+t,"bh="+s,"h="+n].join("; ");return o.foldLines("DKIM-Signature: "+a,76)+";\r\n b="}(c.domainName,c.keySelector,u.fieldNames,t,n);u.headers+="dkim-signature:"+a(d),l=r.createSign(("rsa-"+t).toUpperCase()),l.update(u.headers);try{p=l.sign(c.privateKey,"base64")}catch(e){return!1}return d+p.replace(/(^.{73}|.{75}(?!\r?\n|\r))/g,"$&\r\n ").trim()},e.exports.relaxedHeaders=s},function(e,t,n){"use strict";const i=n(96),o=n(132),r=n(34);e.exports=function(e,t,n,s){let a,c,l,p=r.parse(e);a={host:p.hostname,port:Number(p.port)?Number(p.port):"https:"===p.protocol?443:80},"https:"===p.protocol?(a.rejectUnauthorized=!1,c=o.connect.bind(o)):c=i.connect.bind(i);let u=!1,d=function(e){if(!u){u=!0;try{l.destroy()}catch(e){}s(e)}};l=c(a,()=>{if(u)return;let e={Host:n+":"+t,Connection:"close"};p.auth&&(e["Proxy-Authorization"]="Basic "+Buffer.from(p.auth).toString("base64")),l.write("CONNECT "+n+":"+t+" HTTP/1.1\r\n"+Object.keys(e).map(t=>t+": "+e[t]).join("\r\n")+"\r\n\r\n");let i="",o=e=>{let t,n;if(!u&&(i+=e.toString("binary"),t=i.match(/\r\n\r\n/))){if(l.removeListener("data",o),n=i.substr(t.index+t[0].length),i=i.substr(0,t.index),n&&l.unshift(Buffer.from(n,"binary")),u=!0,t=i.match(/^HTTP\/\d+\.\d+ (\d+)/i),!t||"2"!==(t[1]||"").charAt(0)){try{l.destroy()}catch(e){}return s(new Error("Invalid response from proxy"+(t&&": "+t[1]||"")))}return l.removeListener("error",d),s(null,l)}};l.on("data",o)}),l.once("error",d)}},function(e,t,n){"use strict";const i=n(86),o=n(271),r=n(250);e.exports=class{constructor(e,t){this.mailer=e,this.data={},this.message=null,t=t||{};let n=e.options||{},i=e._defaults||{};Object.keys(t).forEach(e=>{this.data[e]=t[e]}),this.data.headers=this.data.headers||{},Object.keys(i).forEach(e=>{e in this.data?"headers"===e&&Object.keys(i.headers).forEach(e=>{e in this.data.headers||(this.data.headers[e]=i.headers[e])}):this.data[e]=i[e]}),["disableFileAccess","disableUrlAccess","normalizeHeaderKey"].forEach(e=>{e in n&&(this.data[e]=n[e])})}resolveContent(...e){return i.resolveContent(...e)}resolveAll(e){let t=[[this.data,"html"],[this.data,"text"],[this.data,"watchHtml"],[this.data,"amp"],[this.data,"icalEvent"]];this.data.alternatives&&this.data.alternatives.length&&this.data.alternatives.forEach((e,n)=>{t.push([this.data.alternatives,n])}),this.data.attachments&&this.data.attachments.length&&this.data.attachments.forEach((e,n)=>{e.filename||(e.filename=(e.path||e.href||"").split("/").pop().split("?").shift()||"attachment-"+(n+1),e.filename.indexOf(".")<0&&(e.filename+="."+r.detectExtension(e.contentType))),e.contentType||(e.contentType=r.detectMimeType(e.filename||e.path||e.href||"bin")),t.push([this.data.attachments,n])});let n=new o;["from","to","cc","bcc","sender","replyTo"].forEach(e=>{let t;this.message?t=[].concat(n._parseAddresses(this.message.getHeader("replyTo"===e?"reply-to":e))||[]):this.data[e]&&(t=[].concat(n._parseAddresses(this.data[e])||[])),t&&t.length?this.data[e]=t:e in this.data&&(this.data[e]=null)});["from","sender","replyTo"].forEach(e=>{this.data[e]&&(this.data[e]=this.data[e].shift())});let s=0,a=()=>{if(s>=t.length)return e(null,this.data);let n=t[s++];if(!n[0]||!n[0][n[1]])return a();i.resolveContent(...n,(t,i)=>{if(t)return e(t);let o={content:i};n[0][n[1]]&&"object"==typeof n[0][n[1]]&&!Buffer.isBuffer(n[0][n[1]])&&Object.keys(n[0][n[1]]).forEach(e=>{e in o||["content","path","href","raw"].includes(e)||(o[e]=n[0][n[1]][e])}),n[0][n[1]]=o,a()})};setImmediate(()=>a())}normalize(e){let t=this.data.envelope||this.message.getEnvelope(),n=this.message.messageId();this.resolveAll((i,o)=>{if(i)return e(i);if(o.envelope=t,o.messageId=n,["html","text","watchHtml","amp"].forEach(e=>{o[e]&&o[e].content&&("string"==typeof o[e].content?o[e]=o[e].content:Buffer.isBuffer(o[e].content)&&(o[e]=o[e].content.toString()))}),o.icalEvent&&Buffer.isBuffer(o.icalEvent.content)&&(o.icalEvent.content=o.icalEvent.content.toString("base64"),o.icalEvent.encoding="base64"),o.alternatives&&o.alternatives.length&&o.alternatives.forEach(e=>{e&&e.content&&Buffer.isBuffer(e.content)&&(e.content=e.content.toString("base64"),e.encoding="base64")}),o.attachments&&o.attachments.length&&o.attachments.forEach(e=>{e&&e.content&&Buffer.isBuffer(e.content)&&(e.content=e.content.toString("base64"),e.encoding="base64")}),o.normalizedHeaders={},Object.keys(o.headers||{}).forEach(e=>{let t=[].concat(o.headers[e]||[]).shift();t=t&&t.value||t,t&&(["references","in-reply-to","message-id","content-id"].includes(e)&&(t=this.message._encodeHeaderValue(e,t)),o.normalizedHeaders[e]=t)}),o.list&&"object"==typeof o.list){this._getListHeaders(o.list).forEach(e=>{o.normalizedHeaders[e.key]=e.value.map(e=>e&&e.value||e).join(", ")})}return o.references&&(o.normalizedHeaders.references=this.message._encodeHeaderValue("references",o.references)),o.inReplyTo&&(o.normalizedHeaders["in-reply-to"]=this.message._encodeHeaderValue("in-reply-to",o.inReplyTo)),e(null,o)})}setMailerHeader(){this.message&&this.data.xMailer&&this.message.setHeader("X-Mailer",this.data.xMailer)}setPriorityHeaders(){if(this.message&&this.data.priority)switch((this.data.priority||"").toString().toLowerCase()){case"high":this.message.setHeader("X-Priority","1 (Highest)"),this.message.setHeader("X-MSMail-Priority","High"),this.message.setHeader("Importance","High");break;case"low":this.message.setHeader("X-Priority","5 (Lowest)"),this.message.setHeader("X-MSMail-Priority","Low"),this.message.setHeader("Importance","Low")}}setListHeaders(){this.message&&this.data.list&&"object"==typeof this.data.list&&this.data.list&&"object"==typeof this.data.list&&this._getListHeaders(this.data.list).forEach(e=>{e.value.forEach(t=>{this.message.addHeader(e.key,t)})})}_getListHeaders(e){return Object.keys(e).map(t=>({key:"list-"+t.toLowerCase().trim(),value:[].concat(e[t]||[]).map(e=>({prepared:!0,foldLines:!0,value:[].concat(e||[]).map(e=>{if("string"==typeof e&&(e={url:e}),e&&e.url){if("id"===t.toLowerCase().trim()){let t=e.comment||"";return t=r.isPlainText(t)?'"'+t+'"':r.encodeWord(t),(e.comment?t+" ":"")+this._formatListUrl(e.url).replace(/^<[^:]+\/{,2}/,"")}let n=e.comment||"";return r.isPlainText(n)||(n=r.encodeWord(n)),this._formatListUrl(e.url)+(e.comment?" ("+n+")":"")}return""}).filter(e=>e).join(", ")}))}))}_formatListUrl(e){return e=e.replace(/[\s<]+|[\s>]+/g,""),/^(https?|mailto|ftp):/.test(e)?"<"+e+">":/^[^@]+@[^@]+$/.test(e)?"<mailto:"+e+">":"<http://"+e+">"}}},function(e,t,n){"use strict";const i=n(8),o=n(321),r=n(266),s=n(276),a=n(86),c=n(130);e.exports=class extends i{constructor(e){let t;super(),"string"==typeof(e=e||{})&&(e={url:e});let n=e.service;"function"==typeof e.getSocket&&(this.getSocket=e.getSocket),e.url&&(t=a.parseConnectionUrl(e.url),n=n||t.service),this.options=a.assign(!1,e,t,n&&s(n)),this.options.maxConnections=this.options.maxConnections||5,this.options.maxMessages=this.options.maxMessages||100,this.logger=a.getLogger(this.options,{component:this.options.component||"smtp-pool"});let i=new r(this.options);this.name="SMTP (pool)",this.version=c.version+"[client:"+i.version+"]",this._rateLimit={counter:0,timeout:null,waiting:[],checkpoint:!1,delta:Number(this.options.rateDelta)||1e3,limit:Number(this.options.rateLimit)||0},this._closed=!1,this._queue=[],this._connections=[],this._connectionCounter=0,this.idling=!0,setImmediate(()=>{this.idling&&this.emit("idle")})}getSocket(e,t){return setImmediate(()=>t(null,!1))}send(e,t){return!this._closed&&(this._queue.push({mail:e,requeueAttempts:0,callback:t}),this.idling&&this._queue.length>=this.options.maxConnections&&(this.idling=!1),setImmediate(()=>this._processMessages()),!0)}close(){let e,t=this._connections.length;if(this._closed=!0,clearTimeout(this._rateLimit.timeout),!t&&!this._queue.length)return;for(let n=t-1;n>=0;n--)this._connections[n]&&this._connections[n].available&&(e=this._connections[n],e.close(),this.logger.info({tnx:"connection",cid:e.id,action:"removed"},"Connection #%s removed",e.id));if(t&&!this._connections.length&&this.logger.debug({tnx:"connection"},"All connections removed"),!this._queue.length)return;let n=()=>{if(!this._queue.length)return void this.logger.debug({tnx:"connection"},"Pending queue entries cleared");let t=this._queue.shift();if(t&&"function"==typeof t.callback)try{t.callback(new Error("Connection pool was closed"))}catch(t){this.logger.error({err:t,tnx:"callback",cid:e.id},"Callback error for #%s: %s",e.id,t.message)}setImmediate(n)};setImmediate(n)}_processMessages(){let e,t,n;if(this._closed)return;if(!this._queue.length)return void(this.idling||(this.idling=!0,this.emit("idle")));for(t=0,n=this._connections.length;t<n;t++)if(this._connections[t].available){e=this._connections[t];break}if(!e&&this._connections.length<this.options.maxConnections&&(e=this._createConnection()),!e)return void(this.idling=!1);!this.idling&&this._queue.length<this.options.maxConnections&&(this.idling=!0,this.emit("idle"));let i=e.queueEntry=this._queue.shift();i.messageId=(e.queueEntry.mail.message.getHeader("message-id")||"").replace(/[<>\s]/g,""),e.available=!1,this.logger.debug({tnx:"pool",cid:e.id,messageId:i.messageId,action:"assign"},"Assigned message <%s> to #%s (%s)",i.messageId,e.id,e.messages+1),this._rateLimit.limit&&(this._rateLimit.counter++,this._rateLimit.checkpoint||(this._rateLimit.checkpoint=Date.now())),e.send(i.mail,(t,n)=>{if(i===e.queueEntry){try{i.callback(t,n)}catch(t){this.logger.error({err:t,tnx:"callback",cid:e.id},"Callback error for #%s: %s",e.id,t.message)}e.queueEntry=!1}})}_createConnection(){let e=new o(this);return e.id=++this._connectionCounter,this.logger.info({tnx:"pool",cid:e.id,action:"conection"},"Created new pool resource #%s",e.id),e.on("available",()=>{this.logger.debug({tnx:"connection",cid:e.id,action:"available"},"Connection #%s became available",e.id),this._closed?this.close():this._processMessages()}),e.once("error",t=>{if("EMAXLIMIT"!==t.code?this.logger.error({err:t,tnx:"pool",cid:e.id},"Pool Error for #%s: %s",e.id,t.message):this.logger.debug({tnx:"pool",cid:e.id,action:"maxlimit"},"Max messages limit exchausted for #%s",e.id),e.queueEntry){try{e.queueEntry.callback(t)}catch(t){this.logger.error({err:t,tnx:"callback",cid:e.id},"Callback error for #%s: %s",e.id,t.message)}e.queueEntry=!1}this._removeConnection(e),this._continueProcessing()}),e.once("close",()=>{this.logger.info({tnx:"connection",cid:e.id,action:"closed"},"Connection #%s was closed",e.id),this._removeConnection(e),e.queueEntry?setTimeout(()=>{e.queueEntry&&(this._shouldRequeuOnConnectionClose(e.queueEntry)?this._requeueEntryOnConnectionClose(e):this._failDeliveryOnConnectionClose(e)),this._continueProcessing()},50):this._continueProcessing()}),this._connections.push(e),e}_shouldRequeuOnConnectionClose(e){return void 0===this.options.maxRequeues||this.options.maxRequeues<0||e.requeueAttempts<this.options.maxRequeues}_failDeliveryOnConnectionClose(e){if(e.queueEntry&&e.queueEntry.callback){try{e.queueEntry.callback(new Error("Reached maximum number of retries after connection was closed"))}catch(t){this.logger.error({err:t,tnx:"callback",messageId:e.queueEntry.messageId,cid:e.id},"Callback error for #%s: %s",e.id,t.message)}e.queueEntry=!1}}_requeueEntryOnConnectionClose(e){e.queueEntry.requeueAttempts=e.queueEntry.requeueAttempts+1,this.logger.debug({tnx:"pool",cid:e.id,messageId:e.queueEntry.messageId,action:"requeue"},"Re-queued message <%s> for #%s. Attempt: #%s",e.queueEntry.messageId,e.id,e.queueEntry.requeueAttempts),this._queue.unshift(e.queueEntry),e.queueEntry=!1}_continueProcessing(){this._closed?this.close():setTimeout(()=>this._processMessages(),100)}_removeConnection(e){let t=this._connections.indexOf(e);-1!==t&&this._connections.splice(t,1)}_checkRateLimit(e){if(!this._rateLimit.limit)return e();let t=Date.now();return this._rateLimit.counter<this._rateLimit.limit?e():(this._rateLimit.waiting.push(e),this._rateLimit.checkpoint<=t-this._rateLimit.delta?this._clearRateLimit():void(this._rateLimit.timeout||(this._rateLimit.timeout=setTimeout(()=>this._clearRateLimit(),this._rateLimit.delta-(t-this._rateLimit.checkpoint)),this._rateLimit.checkpoint=t)))}_clearRateLimit(){for(clearTimeout(this._rateLimit.timeout),this._rateLimit.timeout=null,this._rateLimit.counter=0,this._rateLimit.checkpoint=!1;this._rateLimit.waiting.length;){let e=this._rateLimit.waiting.shift();setImmediate(e)}}isIdle(){return this.idling}verify(e){let t;e||(t=new Promise((t,n)=>{e=a.callbackPromise(t,n)}));let n=new o(this).auth;return this.getSocket(this.options,(t,i)=>{if(t)return e(t);let o=this.options;i&&i.connection&&(this.logger.info({tnx:"proxy",remoteAddress:i.connection.remoteAddress,remotePort:i.connection.remotePort,destHost:o.host||"",destPort:o.port||"",action:"connected"},"Using proxied socket from %s:%s to %s:%s",i.connection.remoteAddress,i.connection.remotePort,o.host||"",o.port||""),o=a.assign(!1,o),Object.keys(i).forEach(e=>{o[e]=i[e]}));let s=new r(o),c=!1;s.once("error",t=>{if(!c)return c=!0,s.close(),e(t)}),s.once("end",()=>{if(!c)return c=!0,e(new Error("Connection closed"))});let l=()=>{if(!c)return c=!0,s.quit(),e(null,!0)};s.connect(()=>{c||(n&&(s.allowsAuth||o.forceAuth)?s.login(n,t=>{if(!c)return t?(c=!0,s.close(),e(t)):void l()}):l())})}),t}}},function(e,t,n){"use strict";const i=n(266),o=n(86).assign,r=n(275),s=n(8);e.exports=class extends s{constructor(e){if(super(),this.pool=e,this.options=e.options,this.logger=this.pool.logger,this.options.auth)switch((this.options.auth.type||"").toString().toUpperCase()){case"OAUTH2":{let e=new r(this.options.auth,this.logger);e.provisionCallback=this.pool.mailer&&this.pool.mailer.get("oauth2_provision_cb")||e.provisionCallback,this.auth={type:"OAUTH2",user:this.options.auth.user,oauth2:e,method:"XOAUTH2"},e.on("token",e=>this.pool.mailer.emit("token",e)),e.on("error",e=>this.emit("error",e));break}default:if(!this.options.auth.user&&!this.options.auth.pass)break;this.auth={type:(this.options.auth.type||"").toString().toUpperCase()||"LOGIN",user:this.options.auth.user,credentials:{user:this.options.auth.user||"",pass:this.options.auth.pass,options:this.options.auth.options},method:(this.options.auth.method||"").trim().toUpperCase()||this.options.authMethod||!1}}this._connection=!1,this._connected=!1,this.messages=0,this.available=!0}connect(e){this.pool.getSocket(this.options,(t,n)=>{if(t)return e(t);let r=!1,s=this.options;n&&n.connection&&(this.logger.info({tnx:"proxy",remoteAddress:n.connection.remoteAddress,remotePort:n.connection.remotePort,destHost:s.host||"",destPort:s.port||"",action:"connected"},"Using proxied socket from %s:%s to %s:%s",n.connection.remoteAddress,n.connection.remotePort,s.host||"",s.port||""),s=o(!1,s),Object.keys(n).forEach(e=>{s[e]=n[e]})),this.connection=new i(s),this.connection.once("error",t=>{if(this.emit("error",t),!r)return r=!0,e(t)}),this.connection.once("end",()=>{if(this.close(),r)return;r=!0;let t=setTimeout(()=>{if(r)return;let t=new Error("Unexpected socket close");this.connection&&this.connection._socket&&this.connection._socket.upgrading&&(t.code="ETLS"),e(t)},1e3);try{t.unref()}catch(e){}}),this.connection.connect(()=>{if(!r)return this.auth&&(this.connection.allowsAuth||s.forceAuth)?void this.connection.login(this.auth,t=>{if(!r){if(r=!0,t)return this.connection.close(),this.emit("error",t),e(t);this._connected=!0,e(null,!0)}}):(r=!0,this._connected=!0,e(null,!0))})})}send(e,t){if(!this._connected)return this.connect(n=>n?t(n):this.send(e,t));let n=e.message.getEnvelope(),i=e.message.messageId(),o=[].concat(n.to||[]);o.length>3&&o.push("...and "+o.splice(2).length+" more"),this.logger.info({tnx:"send",messageId:i,cid:this.id},"Sending message %s using #%s to <%s>",i,this.id,o.join(", ")),e.data.dsn&&(n.dsn=e.data.dsn),this.connection.send(n,e.message.createReadStream(),(e,o)=>{if(this.messages++,e)return this.connection.close(),this.emit("error",e),t(e);o.envelope={from:n.from,to:n.to},o.messageId=i,setImmediate(()=>{let e;this.messages>=this.options.maxMessages?(e=new Error("Resource exhausted"),e.code="EMAXLIMIT",this.connection.close(),this.emit("error",e)):this.pool._checkRateLimit(()=>{this.available=!0,this.emit("available")})}),t(null,o)})}close(){this._connected=!1,this.auth&&this.auth.oauth2&&this.auth.oauth2.removeAllListeners(),this.connection&&this.connection.close(),this.emit("close")}}},function(e,t,n){"use strict";const i=n(14).Transform;e.exports=class extends i{constructor(e){super(e),this.options=e||{},this._curLine="",this.inByteCount=0,this.outByteCount=0,this.lastByte=!1}_transform(e,t,n){let i,o,r,s=[],a=0,c=0;if(!e||!e.length)return n();for("string"==typeof e&&(e=Buffer.from(e)),this.inByteCount+=e.length,i=0,o=e.length;i<o;i++)46===e[i]?(i&&10===e[i-1]||!i&&(!this.lastByte||10===this.lastByte))&&(r=e.slice(c,i+1),s.push(r),s.push(Buffer.from(".")),a+=r.length+1,c=i+1):10===e[i]&&(i&&13!==e[i-1]||!i&&13!==this.lastByte)&&(i>c?(r=e.slice(c,i),s.push(r),a+=r.length+2):a+=2,s.push(Buffer.from("\r\n")),c=i+1);a?(c<e.length&&(r=e.slice(c),s.push(r),a+=r.length),this.outByteCount+=a,this.push(Buffer.concat(s,a))):(this.outByteCount+=e.length,this.push(e)),this.lastByte=e[e.length-1],n()}_flush(e){let t;t=10===this.lastByte?Buffer.from(".\r\n"):13===this.lastByte?Buffer.from("\n.\r\n"):Buffer.from("\r\n.\r\n"),this.outByteCount+=t.length,this.push(t),e()}}},function(e){e.exports=JSON.parse('{"126":{"host":"smtp.126.com","port":465,"secure":true},"163":{"host":"smtp.163.com","port":465,"secure":true},"1und1":{"host":"smtp.1und1.de","port":465,"secure":true,"authMethod":"LOGIN"},"AOL":{"domains":["aol.com"],"host":"smtp.aol.com","port":587},"DebugMail":{"host":"debugmail.io","port":25},"DynectEmail":{"aliases":["Dynect"],"host":"smtp.dynect.net","port":25},"Ethereal":{"aliases":["ethereal.email"],"host":"smtp.ethereal.email","port":587},"FastMail":{"domains":["fastmail.fm"],"host":"smtp.fastmail.com","port":465,"secure":true},"GandiMail":{"aliases":["Gandi","Gandi Mail"],"host":"mail.gandi.net","port":587},"Gmail":{"aliases":["Google Mail"],"domains":["gmail.com","googlemail.com"],"host":"smtp.gmail.com","port":465,"secure":true},"Godaddy":{"host":"smtpout.secureserver.net","port":25},"GodaddyAsia":{"host":"smtp.asia.secureserver.net","port":25},"GodaddyEurope":{"host":"smtp.europe.secureserver.net","port":25},"hot.ee":{"host":"mail.hot.ee"},"Hotmail":{"aliases":["Outlook","Outlook.com","Hotmail.com"],"domains":["hotmail.com","outlook.com"],"host":"smtp.live.com","port":587},"iCloud":{"aliases":["Me","Mac"],"domains":["me.com","mac.com"],"host":"smtp.mail.me.com","port":587},"mail.ee":{"host":"smtp.mail.ee"},"Mail.ru":{"host":"smtp.mail.ru","port":465,"secure":true},"Maildev":{"port":1025,"ignoreTLS":true},"Mailgun":{"host":"smtp.mailgun.org","port":465,"secure":true},"Mailjet":{"host":"in.mailjet.com","port":587},"Mailosaur":{"host":"mailosaur.io","port":25},"Mailtrap":{"host":"smtp.mailtrap.io","port":2525},"Mandrill":{"host":"smtp.mandrillapp.com","port":587},"Naver":{"host":"smtp.naver.com","port":587},"One":{"host":"send.one.com","port":465,"secure":true},"OpenMailBox":{"aliases":["OMB","openmailbox.org"],"host":"smtp.openmailbox.org","port":465,"secure":true},"Outlook365":{"host":"smtp.office365.com","port":587,"secure":false},"Postmark":{"aliases":["PostmarkApp"],"host":"smtp.postmarkapp.com","port":2525},"qiye.aliyun":{"host":"smtp.mxhichina.com","port":"465","secure":true},"QQ":{"domains":["qq.com"],"host":"smtp.qq.com","port":465,"secure":true},"QQex":{"aliases":["QQ Enterprise"],"domains":["exmail.qq.com"],"host":"smtp.exmail.qq.com","port":465,"secure":true},"SendCloud":{"host":"smtpcloud.sohu.com","port":25},"SendGrid":{"host":"smtp.sendgrid.net","port":587},"SendinBlue":{"host":"smtp-relay.sendinblue.com","port":587},"SendPulse":{"host":"smtp-pulse.com","port":465,"secure":true},"SES":{"host":"email-smtp.us-east-1.amazonaws.com","port":465,"secure":true},"SES-US-EAST-1":{"host":"email-smtp.us-east-1.amazonaws.com","port":465,"secure":true},"SES-US-WEST-2":{"host":"email-smtp.us-west-2.amazonaws.com","port":465,"secure":true},"SES-EU-WEST-1":{"host":"email-smtp.eu-west-1.amazonaws.com","port":465,"secure":true},"Sparkpost":{"aliases":["SparkPost","SparkPost Mail"],"domains":["sparkpost.com"],"host":"smtp.sparkpostmail.com","port":587,"secure":false},"Tipimail":{"host":"smtp.tipimail.com","port":587},"Yahoo":{"domains":["yahoo.com"],"host":"smtp.mail.yahoo.com","port":465,"secure":true},"Yandex":{"domains":["yandex.ru"],"host":"smtp.yandex.ru","port":465,"secure":true},"Zoho":{"host":"smtp.zoho.com","port":465,"secure":true,"authMethod":"LOGIN"}}')},function(e,t,n){"use strict";const i=n(8),o=n(266),r=n(276),s=n(86),a=n(275),c=n(130);e.exports=class extends i{constructor(e){let t;super(),"string"==typeof(e=e||{})&&(e={url:e});let n=e.service;"function"==typeof e.getSocket&&(this.getSocket=e.getSocket),e.url&&(t=s.parseConnectionUrl(e.url),n=n||t.service),this.options=s.assign(!1,e,t,n&&r(n)),this.logger=s.getLogger(this.options,{component:this.options.component||"smtp-transport"});let i=new o(this.options);this.name="SMTP",this.version=c.version+"[client:"+i.version+"]",this.options.auth&&(this.auth=this.getAuth({}))}getSocket(e,t){return setImmediate(()=>t(null,!1))}getAuth(e){if(!e)return this.auth;let t=!1,n={};if(this.options.auth&&"object"==typeof this.options.auth&&Object.keys(this.options.auth).forEach(e=>{t=!0,n[e]=this.options.auth[e]}),e&&"object"==typeof e&&Object.keys(e).forEach(i=>{t=!0,n[i]=e[i]}),!t)return!1;switch((n.type||"").toString().toUpperCase()){case"OAUTH2":{if(!n.service&&!n.user)return!1;let e=new a(n,this.logger);return e.provisionCallback=this.mailer&&this.mailer.get("oauth2_provision_cb")||e.provisionCallback,e.on("token",e=>this.mailer.emit("token",e)),e.on("error",e=>this.emit("error",e)),{type:"OAUTH2",user:n.user,oauth2:e,method:"XOAUTH2"}}default:return{type:(n.type||"").toString().toUpperCase()||"LOGIN",user:n.user,credentials:{user:n.user||"",pass:n.pass,options:n.options},method:(n.method||"").trim().toUpperCase()||this.options.authMethod||!1}}}send(e,t){this.getSocket(this.options,(n,i)=>{if(n)return t(n);let r=!1,a=this.options;i&&i.connection&&(this.logger.info({tnx:"proxy",remoteAddress:i.connection.remoteAddress,remotePort:i.connection.remotePort,destHost:a.host||"",destPort:a.port||"",action:"connected"},"Using proxied socket from %s:%s to %s:%s",i.connection.remoteAddress,i.connection.remotePort,a.host||"",a.port||""),a=s.assign(!1,a),Object.keys(i).forEach(e=>{a[e]=i[e]}));let c=new o(a);c.once("error",e=>{if(!r)return r=!0,c.close(),t(e)}),c.once("end",()=>{if(r)return;let e=setTimeout(()=>{if(r)return;r=!0;let e=new Error("Unexpected socket close");c&&c._socket&&c._socket.upgrading&&(e.code="ETLS"),t(e)},1e3);try{e.unref()}catch(e){}});let l=()=>{let n=e.message.getEnvelope(),i=e.message.messageId(),o=[].concat(n.to||[]);o.length>3&&o.push("...and "+o.splice(2).length+" more"),e.data.dsn&&(n.dsn=e.data.dsn),this.logger.info({tnx:"send",messageId:i},"Sending message %s to <%s>",i,o.join(", ")),c.send(n,e.message.createReadStream(),(e,o)=>{if(r=!0,c.close(),e)return this.logger.error({err:e,tnx:"send"},"Send error for %s: %s",i,e.message),t(e);o.envelope={from:n.from,to:n.to},o.messageId=i;try{return t(null,o)}catch(e){this.logger.error({err:e,tnx:"callback"},"Callback error for %s: %s",i,e.message)}})};c.connect(()=>{if(r)return;let n=this.getAuth(e.data.auth);n&&(c.allowsAuth||a.forceAuth)?c.login(n,e=>{if(n&&n!==this.auth&&n.oauth2&&n.oauth2.removeAllListeners(),!r)return e?(r=!0,c.close(),t(e)):void l()}):l()})})}verify(e){let t;return e||(t=new Promise((t,n)=>{e=s.callbackPromise(t,n)})),this.getSocket(this.options,(t,n)=>{if(t)return e(t);let i=this.options;n&&n.connection&&(this.logger.info({tnx:"proxy",remoteAddress:n.connection.remoteAddress,remotePort:n.connection.remotePort,destHost:i.host||"",destPort:i.port||"",action:"connected"},"Using proxied socket from %s:%s to %s:%s",n.connection.remoteAddress,n.connection.remotePort,i.host||"",i.port||""),i=s.assign(!1,i),Object.keys(n).forEach(e=>{i[e]=n[e]}));let r=new o(i),a=!1;r.once("error",t=>{if(!a)return a=!0,r.close(),e(t)}),r.once("end",()=>{if(!a)return a=!0,e(new Error("Connection closed"))});let c=()=>{if(!a)return a=!0,r.quit(),e(null,!0)};r.connect(()=>{if(a)return;let t=this.getAuth({});t&&(r.allowsAuth||i.forceAuth)?r.login(t,t=>{if(!a)return t?(a=!0,r.close(),e(t)):void c()}):c()})}),t}close(){this.auth&&this.auth.oauth2&&this.auth.oauth2.removeAllListeners(),this.emit("close")}}},function(e,t,n){"use strict";const i=n(326).spawn,o=n(130),r=n(267),s=n(277),a=n(86);e.exports=class{constructor(e){e=e||{},this._spawn=i,this.options=e||{},this.name="Sendmail",this.version=o.version,this.path="sendmail",this.args=!1,this.winbreak=!1,this.logger=a.getLogger(this.options,{component:this.options.component||"sendmail"}),e&&("string"==typeof e?this.path=e:"object"==typeof e&&(e.path&&(this.path=e.path),Array.isArray(e.args)&&(this.args=e.args),this.winbreak=["win","windows","dos","\r\n"].includes((e.newline||"").toString().toLowerCase())))}send(e,t){e.message.keepBcc=!0;let n,i,o,a,c=e.data.envelope||e.message.getEnvelope(),l=e.message.messageId();if([].concat(c.from||[]).concat(c.to||[]).some(e=>/^-/.test(e)))return t(new Error("Can not send mail. Invalid envelope addresses."));n=this.args?["-i"].concat(this.args).concat(c.to):["-i"].concat(c.from?["-f",c.from]:[]).concat(c.to);let p=n=>{if(!o)return o=!0,"function"==typeof t?n?t(n):t(null,{envelope:e.data.envelope||e.message.getEnvelope(),messageId:l,response:"Messages queued for delivery"}):void 0};try{i=this._spawn(this.path,n)}catch(e){return this.logger.error({err:e,tnx:"spawn",messageId:l},"Error occurred while spawning sendmail. %s",e.message),p(e)}if(!i)return p(new Error("sendmail was not found"));{i.on("error",e=>{this.logger.error({err:e,tnx:"spawn",messageId:l},"Error occurred when sending message %s. %s",l,e.message),p(e)}),i.once("exit",e=>{if(!e)return p();let t;t=127===e?new Error("Sendmail command not found, process exited with code "+e):new Error("Sendmail exited with code "+e),this.logger.error({err:t,tnx:"stdin",messageId:l},"Error sending message %s to sendmail. %s",l,t.message),p(t)}),i.once("close",p),i.stdin.on("error",e=>{this.logger.error({err:e,tnx:"stdin",messageId:l},"Error occurred when piping message %s to sendmail. %s",l,e.message),p(e)});let t=[].concat(c.to||[]);t.length>3&&t.push("...and "+t.splice(2).length+" more"),this.logger.info({tnx:"send",messageId:l},"Sending message %s to <%s>",l,t.join(", ")),a=this.winbreak?new r:new s;let n=e.message.createReadStream();a.once("error",e=>{this.logger.error({err:e,tnx:"stdin",messageId:l},"Error occurred when generating message %s. %s",l,e.message),i.kill("SIGINT"),p(e)}),n.once("error",e=>a.emit("error",e)),n.pipe(a).pipe(i.stdin)}}}},function(e,t){e.exports=require("child_process")},function(e,t,n){"use strict";const i=n(130),o=n(86),r=n(267),s=n(277);e.exports=class{constructor(e){e=e||{},this.options=e||{},this.name="StreamTransport",this.version=i.version,this.logger=o.getLogger(this.options,{component:this.options.component||"stream-transport"}),this.winbreak=["win","windows","dos","\r\n"].includes((e.newline||"").toString().toLowerCase())}send(e,t){e.message.keepBcc=!0;let n=e.data.envelope||e.message.getEnvelope(),i=e.message.messageId(),o=[].concat(n.to||[]);o.length>3&&o.push("...and "+o.splice(2).length+" more"),this.logger.info({tnx:"send",messageId:i},"Sending message %s to <%s> using %s line breaks",i,o.join(", "),this.winbreak?"<CR><LF>":"<LF>"),setImmediate(()=>{let n,o,a;try{a=this.winbreak?new r:new s,n=e.message.createReadStream(),o=n.pipe(a),n.on("error",e=>o.emit("error",e))}catch(e){return this.logger.error({err:e,tnx:"send",messageId:i},"Creating send stream failed for %s. %s",i,e.message),t(e)}if(!this.options.buffer)return o.once("error",e=>{this.logger.error({err:e,tnx:"send",messageId:i},"Failed creating message for %s. %s",i,e.message)}),t(null,{envelope:e.data.envelope||e.message.getEnvelope(),messageId:i,message:o});let c=[],l=0;o.on("readable",()=>{let e;for(;null!==(e=o.read());)c.push(e),l+=e.length}),o.once("error",e=>(this.logger.error({err:e,tnx:"send",messageId:i},"Failed creating message for %s. %s",i,e.message),t(e))),o.on("end",()=>t(null,{envelope:e.data.envelope||e.message.getEnvelope(),messageId:i,message:Buffer.concat(c,l)}))})}}},function(e,t,n){"use strict";const i=n(130),o=n(86);e.exports=class{constructor(e){e=e||{},this.options=e||{},this.name="JSONTransport",this.version=i.version,this.logger=o.getLogger(this.options,{component:this.options.component||"json-transport"})}send(e,t){e.message.keepBcc=!0;let n=e.data.envelope||e.message.getEnvelope(),i=e.message.messageId(),o=[].concat(n.to||[]);o.length>3&&o.push("...and "+o.splice(2).length+" more"),this.logger.info({tnx:"send",messageId:i},"Composing JSON structure of %s to <%s>",i,o.join(", ")),setImmediate(()=>{e.normalize((e,o)=>e?(this.logger.error({err:e,tnx:"send",messageId:i},"Failed building JSON structure for %s. %s",i,e.message),t(e)):(delete o.envelope,delete o.normalizedHeaders,t(null,{envelope:n,messageId:i,message:this.options.skipEncoding?o:JSON.stringify(o)})))})}}},function(e,t,n){"use strict";const i=n(8),o=n(130),r=n(86),s=n(267);e.exports=class extends i{constructor(e){super(),e=e||{},this.options=e||{},this.ses=this.options.SES,this.name="SESTransport",this.version=o.version,this.logger=r.getLogger(this.options,{component:this.options.component||"ses-transport"}),this.maxConnections=Number(this.options.maxConnections)||1/0,this.connections=0,this.sendingRate=Number(this.options.sendingRate)||1/0,this.sendingRateTTL=null,this.rateInterval=1e3,this.rateMessages=[],this.pending=[],this.idling=!0,setImmediate(()=>{this.idling&&this.emit("idle")})}send(e,t){return this.connections>=this.maxConnections?(this.idling=!1,this.pending.push({mail:e,callback:t})):this._checkSendingRate()?void this._send(e,(...e)=>{setImmediate(()=>t(...e)),this._sent()}):(this.idling=!1,this.pending.push({mail:e,callback:t}))}_checkRatedQueue(){if(this.connections>=this.maxConnections||!this._checkSendingRate())return;if(!this.pending.length)return void(this.idling||(this.idling=!0,this.emit("idle")));let e=this.pending.shift();this._send(e.mail,(...t)=>{setImmediate(()=>e.callback(...t)),this._sent()})}_checkSendingRate(){clearTimeout(this.sendingRateTTL);let e=Date.now(),t=!1;for(let n=this.rateMessages.length-1;n>=0;n--)this.rateMessages[n].ts>=e-this.rateInterval&&(!t||this.rateMessages[n].ts<t)&&(t=this.rateMessages[n].ts),this.rateMessages[n].ts<e-this.rateInterval&&!this.rateMessages[n].pending&&this.rateMessages.splice(n,1);if(this.rateMessages.length<this.sendingRate)return!0;let n=Math.max(t+1001,e+20);this.sendingRateTTL=setTimeout(()=>this._checkRatedQueue(),e-n);try{this.sendingRateTTL.unref()}catch(e){}return!1}_sent(){this.connections--,this._checkRatedQueue()}isIdle(){return this.idling}_send(e,t){let n={ts:Date.now(),pending:!0};this.connections++,this.rateMessages.push(n);let i=e.data.envelope||e.message.getEnvelope(),o=e.message.messageId(),r=[].concat(i.to||[]);r.length>3&&r.push("...and "+r.splice(2).length+" more"),this.logger.info({tnx:"send",messageId:o},"Sending message %s to <%s>",o,r.join(", "));setImmediate(()=>(t=>{e.data._dkim||(e.data._dkim={}),e.data._dkim.skipFields&&"string"==typeof e.data._dkim.skipFields?e.data._dkim.skipFields+=":date:message-id":e.data._dkim.skipFields="date:message-id";let n=e.message.createReadStream(),i=n.pipe(new s),o=[],r=0;i.on("readable",()=>{let e;for(;null!==(e=i.read());)o.push(e),r+=e.length}),n.once("error",e=>i.emit("error",e)),i.once("error",e=>{t(e)}),i.once("end",()=>t(null,Buffer.concat(o,r)))})((r,s)=>{if(r)return this.logger.error({err:r,tnx:"send",messageId:o},"Failed creating message for %s. %s",o,r.message),n.pending=!1,t(r);let a={RawMessage:{Data:s},Source:i.from,Destinations:i.to};Object.keys(e.data.ses||{}).forEach(t=>{a[t]=e.data.ses[t]}),this.ses.sendRawEmail(a,(e,r)=>{if(e)return this.logger.error({err:e,tnx:"send"},"Send error for %s: %s",o,e.message),n.pending=!1,t(e);let a=this.ses.config&&this.ses.config.region||"us-east-1";"us-east-1"===a&&(a="email"),n.pending=!1,t(null,{envelope:{from:i.from,to:i.to},messageId:"<"+r.MessageId+(/@/.test(r.MessageId)?"":"@"+a+".amazonses.com")+">",response:r.MessageId,raw:s})})}))}verify(e){let t;return e||(t=new Promise((t,n)=>{e=r.callbackPromise(t,n)})),this.ses.sendRawEmail({RawMessage:{Data:"From: invalid@invalid\r\nTo: invalid@invalid\r\n Subject: Invalid\r\n\r\nInvalid"},Source:"invalid@invalid",Destinations:["invalid@invalid"]},t=>t&&"InvalidParameterValue"!==t.code?e(t):e(null,!0)),t}}}]));